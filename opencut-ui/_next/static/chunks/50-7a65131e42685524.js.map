{"version":3,"file":"static/chunks/50-7a65131e42685524.js","mappings":"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,EAAAA,CAAMA,CAAAA,CACLC,QAAQ,OACRC,KAAK,OACLzjB,UAAW,6CAIV,OAHCy9B,EACI,kCACA,yBAEN70B,QAjDiBlH,CAiDRi+B,GAhDfj+B,EAAE2F,eAAe,GACjBq2B,GACF,EA+CQpL,MAAOmL,EAAU,oBAAsB,sBAEvC,UAACqB,GAAAA,CAASA,CAAAA,CAAC9+B,UAAW,WAAyC,OAA9By9B,EAAU,eAAiB,aAKtE,qDEnfO,IAAMmC,GAAS,CACpB,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,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","sources":["webpack://_N_E/./src/lib/time.ts","webpack://_N_E/./src/hooks/use-timeline-zoom.ts","webpack://_N_E/./src/components/editor/audio-waveform.tsx","webpack://_N_E/./src/hooks/use-timeline-element-resize.ts","webpack://_N_E/./src/components/editor/timeline/timeline-element.tsx","webpack://_N_E/./src/hooks/use-timeline-snapping.ts","webpack://_N_E/./src/components/editor/timeline/timeline-track.tsx","webpack://_N_E/./src/hooks/use-timeline-playhead.ts","webpack://_N_E/./src/components/editor/timeline/timeline-playhead.tsx","webpack://_N_E/./src/components/editor/selection-box.tsx","webpack://_N_E/./src/hooks/use-selection-box.ts","webpack://_N_E/./src/components/editor/snap-indicator.tsx","webpack://_N_E/./src/components/editor/timeline/index.tsx","webpack://_N_E/./src/constants/actions.ts","webpack://_N_E/./src/hooks/use-keybindings.ts","webpack://_N_E/./src/hooks/use-editor-actions.ts","webpack://_N_E/./src/components/editor-provider.tsx","webpack://_N_E/./src/stores/panel-store.ts","webpack://_N_E/./src/stores/keybindings-store.ts","webpack://_N_E/./src/components/ui/slider.tsx","webpack://_N_E/./src/components/header-base.tsx","webpack://_N_E/./src/components/editor/media-panel/store.ts","webpack://_N_E/./src/components/editor/media-panel/tabbar.tsx","webpack://_N_E/./src/hooks/use-drag-drop.ts","webpack://_N_E/./src/components/editor/media-panel/drag-overlay.tsx","webpack://_N_E/./src/components/ui/aspect-ratio.tsx","webpack://_N_E/./src/components/ui/draggable-item.tsx","webpack://_N_E/./src/components/editor/media-panel/views/media.tsx","webpack://_N_E/./src/components/ui/tabs.tsx","webpack://_N_E/./src/components/editor/media-panel/views/base-view.tsx","webpack://_N_E/./src/components/editor/media-panel/views/text.tsx","webpack://_N_E/./src/stores/sounds-store.ts","webpack://_N_E/./src/hooks/use-sound-search.ts","webpack://_N_E/./src/components/editor/media-panel/views/sounds.tsx","webpack://_N_E/./src/hooks/use-aspect-ratio.ts","webpack://_N_E/./src/data/colors/solid.ts","webpack://_N_E/./src/data/colors/pattern-craft.ts","webpack://_N_E/./src/data/colors/syntax-ui.tsx","webpack://_N_E/./src/components/editor/media-panel/views/settings.tsx","webpack://_N_E/./src/components/language-select.tsx","webpack://_N_E/./src/lib/zk-encryption.ts","webpack://_N_E/./src/components/editor/media-panel/views/captions.tsx","webpack://_N_E/./src/components/editor/media-panel/index.tsx","webpack://_N_E/./src/components/editor/properties-panel/audio-properties.tsx","webpack://_N_E/./src/components/editor/properties-panel/media-properties.tsx","webpack://_N_E/./src/components/ui/textarea.tsx","webpack://_N_E/./src/constants/font-constants.ts","webpack://_N_E/./src/components/ui/font-picker.tsx","webpack://_N_E/./src/components/editor/properties-panel/text-properties.tsx","webpack://_N_E/./src/components/editor/properties-panel/index.tsx","webpack://_N_E/./src/components/editor/properties-panel/property-item.tsx","webpack://_N_E/./src/components/ui/tooltip.tsx","webpack://_N_E/./src/lib/media-processing.ts","webpack://_N_E/./src/components/ui/separator.tsx","webpack://_N_E/./src/components/ui/resizable.tsx","webpack://_N_E/./src/lib/ffmpeg-utils.ts","webpack://_N_E/./src/stores/editor-store.ts","webpack://_N_E/./src/components/icons.tsx","webpack://_N_E/./src/stores/playback-store.ts","webpack://_N_E/./src/components/ui/context-menu.tsx","webpack://_N_E/./src/components/ui/video-player.tsx","webpack://_N_E/./src/components/ui/audio-player.tsx","webpack://_N_E/./src/components/ui/editable-timecode.tsx","webpack://_N_E/./src/lib/font-config.ts","webpack://_N_E/./src/components/ui/popover.tsx","webpack://_N_E/./src/components/editor/layout-guide-overlay.tsx","webpack://_N_E/./src/components/ui/label.tsx","webpack://_N_E/./src/components/editor/preview-panel.tsx","webpack://_N_E/./src/components/onboarding.tsx","webpack://_N_E/./src/hooks/use-playback-controls.ts","webpack://_N_E/./src/hooks/use-keyboard-shortcuts-help.ts","webpack://_N_E/./src/components/keyboard-shortcuts-help.tsx","webpack://_N_E/./src/components/panel-preset-selector.tsx","webpack://_N_E/./src/components/editor-header.tsx"],"sourcesContent":["// Time-related utility functions\r\n\r\n// Helper function to format time in various formats (MM:SS, HH:MM:SS, HH:MM:SS:CS, HH:MM:SS:FF)\r\nexport const formatTimeCode = (\r\n  timeInSeconds: number,\r\n  format: \"MM:SS\" | \"HH:MM:SS\" | \"HH:MM:SS:CS\" | \"HH:MM:SS:FF\" = \"HH:MM:SS:CS\",\r\n  fps = 30\r\n): string => {\r\n  const hours = Math.floor(timeInSeconds / 3600);\r\n  const minutes = Math.floor((timeInSeconds % 3600) / 60);\r\n  const seconds = Math.floor(timeInSeconds % 60);\r\n  const centiseconds = Math.floor((timeInSeconds % 1) * 100);\r\n  const frames = Math.floor((timeInSeconds % 1) * fps);\r\n\r\n  switch (format) {\r\n    case \"MM:SS\":\r\n      return `${minutes.toString().padStart(2, \"0\")}:${seconds.toString().padStart(2, \"0\")}`;\r\n    case \"HH:MM:SS\":\r\n      return `${hours.toString().padStart(2, \"0\")}:${minutes.toString().padStart(2, \"0\")}:${seconds.toString().padStart(2, \"0\")}`;\r\n    case \"HH:MM:SS:CS\":\r\n      return `${hours.toString().padStart(2, \"0\")}:${minutes.toString().padStart(2, \"0\")}:${seconds.toString().padStart(2, \"0\")}:${centiseconds.toString().padStart(2, \"0\")}`;\r\n    case \"HH:MM:SS:FF\":\r\n      return `${hours.toString().padStart(2, \"0\")}:${minutes.toString().padStart(2, \"0\")}:${seconds.toString().padStart(2, \"0\")}:${frames.toString().padStart(2, \"0\")}`;\r\n  }\r\n};\r\n\r\nexport const parseTimeCode = (\r\n  timeCode: string,\r\n  format: \"MM:SS\" | \"HH:MM:SS\" | \"HH:MM:SS:CS\" | \"HH:MM:SS:FF\" = \"HH:MM:SS:CS\",\r\n  fps = 30\r\n): number | null => {\r\n  if (!timeCode || typeof timeCode !== \"string\") return null;\r\n\r\n  // Remove any extra whitespace\r\n  const cleanTimeCode = timeCode.trim();\r\n\r\n  try {\r\n    switch (format) {\r\n      case \"MM:SS\": {\r\n        const parts = cleanTimeCode.split(\":\");\r\n        if (parts.length !== 2) return null;\r\n        const [minutes, seconds] = parts.map((part) => parseInt(part, 10));\r\n        if (isNaN(minutes) || isNaN(seconds)) return null;\r\n        if (minutes < 0 || seconds < 0 || seconds >= 60) return null;\r\n        return minutes * 60 + seconds;\r\n      }\r\n\r\n      case \"HH:MM:SS\": {\r\n        const parts = cleanTimeCode.split(\":\");\r\n        if (parts.length !== 3) return null;\r\n        const [hours, minutes, seconds] = parts.map((part) =>\r\n          parseInt(part, 10)\r\n        );\r\n        if (isNaN(hours) || isNaN(minutes) || isNaN(seconds)) return null;\r\n        if (\r\n          hours < 0 ||\r\n          minutes < 0 ||\r\n          seconds < 0 ||\r\n          minutes >= 60 ||\r\n          seconds >= 60\r\n        )\r\n          return null;\r\n        return hours * 3600 + minutes * 60 + seconds;\r\n      }\r\n\r\n      case \"HH:MM:SS:CS\": {\r\n        const parts = cleanTimeCode.split(\":\");\r\n        if (parts.length !== 4) return null;\r\n        const [hours, minutes, seconds, centiseconds] = parts.map((part) =>\r\n          parseInt(part, 10)\r\n        );\r\n        if (\r\n          isNaN(hours) ||\r\n          isNaN(minutes) ||\r\n          isNaN(seconds) ||\r\n          isNaN(centiseconds)\r\n        )\r\n          return null;\r\n        if (\r\n          hours < 0 ||\r\n          minutes < 0 ||\r\n          seconds < 0 ||\r\n          centiseconds < 0 ||\r\n          minutes >= 60 ||\r\n          seconds >= 60 ||\r\n          centiseconds >= 100\r\n        )\r\n          return null;\r\n        return hours * 3600 + minutes * 60 + seconds + centiseconds / 100;\r\n      }\r\n\r\n      case \"HH:MM:SS:FF\": {\r\n        const parts = cleanTimeCode.split(\":\");\r\n        if (parts.length !== 4) return null;\r\n        const [hours, minutes, seconds, frames] = parts.map((part) =>\r\n          parseInt(part, 10)\r\n        );\r\n        if (isNaN(hours) || isNaN(minutes) || isNaN(seconds) || isNaN(frames))\r\n          return null;\r\n        if (\r\n          hours < 0 ||\r\n          minutes < 0 ||\r\n          seconds < 0 ||\r\n          frames < 0 ||\r\n          minutes >= 60 ||\r\n          seconds >= 60 ||\r\n          frames >= fps\r\n        )\r\n          return null;\r\n        return hours * 3600 + minutes * 60 + seconds + frames / fps;\r\n      }\r\n    }\r\n  } catch {\r\n    return null;\r\n  }\r\n\r\n  return null;\r\n};\r\n","import { useState, useCallback, useEffect, RefObject } from \"react\";\r\n\r\ninterface UseTimelineZoomProps {\r\n  containerRef: RefObject<HTMLDivElement>;\r\n  isInTimeline?: boolean;\r\n}\r\n\r\ninterface UseTimelineZoomReturn {\r\n  zoomLevel: number;\r\n  setZoomLevel: (zoomLevel: number | ((prev: number) => number)) => void;\r\n  handleWheel: (e: React.WheelEvent) => void;\r\n}\r\n\r\nexport function useTimelineZoom({\r\n  containerRef,\r\n  isInTimeline = false,\r\n}: UseTimelineZoomProps): UseTimelineZoomReturn {\r\n  const [zoomLevel, setZoomLevel] = useState(1);\r\n\r\n  const handleWheel = useCallback((e: React.WheelEvent) => {\r\n    // Only zoom if user is using pinch gesture (ctrlKey or metaKey is true)\r\n    if (e.ctrlKey || e.metaKey) {\r\n      e.preventDefault();\r\n      const delta = e.deltaY > 0 ? -0.15 : 0.15;\r\n      setZoomLevel((prev) => Math.max(0.1, Math.min(10, prev + delta)));\r\n    }\r\n    // For horizontal scrolling (when shift is held or horizontal wheel movement),\r\n    // let the event bubble up to allow ScrollArea to handle it\r\n    else if (e.shiftKey || Math.abs(e.deltaX) > Math.abs(e.deltaY)) {\r\n      // Don't prevent default - let ScrollArea handle horizontal scrolling\r\n      return;\r\n    }\r\n    // Otherwise, allow normal scrolling\r\n  }, []);\r\n\r\n  // Prevent browser zooming in/out when in timeline\r\n  useEffect(() => {\r\n    const preventZoom = (e: WheelEvent) => {\r\n      if (\r\n        isInTimeline &&\r\n        (e.ctrlKey || e.metaKey) &&\r\n        containerRef.current?.contains(e.target as Node)\r\n      ) {\r\n        e.preventDefault();\r\n      }\r\n    };\r\n\r\n    document.addEventListener(\"wheel\", preventZoom, { passive: false });\r\n\r\n    return () => {\r\n      document.removeEventListener(\"wheel\", preventZoom);\r\n    };\r\n  }, [isInTimeline, containerRef]);\r\n\r\n  return {\r\n    zoomLevel,\r\n    setZoomLevel,\r\n    handleWheel,\r\n  };\r\n}\r\n","import React, { useEffect, useRef, useState } from \"react\";\r\nimport WaveSurfer from \"wavesurfer.js\";\r\n\r\ninterface AudioWaveformProps {\r\n  audioUrl: string;\r\n  height?: number;\r\n  className?: string;\r\n}\r\n\r\nconst AudioWaveform: React.FC<AudioWaveformProps> = ({\r\n  audioUrl,\r\n  height = 32,\r\n  className = \"\",\r\n}) => {\r\n  const waveformRef = useRef<HTMLDivElement>(null);\r\n  const wavesurfer = useRef<WaveSurfer | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState(false);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    let ws = wavesurfer.current;\r\n\r\n    const initWaveSurfer = async () => {\r\n      if (!waveformRef.current || !audioUrl) return;\r\n\r\n      try {\r\n        // Clear any existing instance safely\r\n        if (ws) {\r\n          // Instead of immediately destroying, just set to null\r\n          // We'll destroy it outside this function\r\n          wavesurfer.current = null;\r\n        }\r\n\r\n        // Create a fresh instance\r\n        const newWaveSurfer = WaveSurfer.create({\r\n          container: waveformRef.current,\r\n          waveColor: \"rgba(255, 255, 255, 0.6)\",\r\n          progressColor: \"rgba(255, 255, 255, 0.9)\",\r\n          cursorColor: \"transparent\",\r\n          barWidth: 2,\r\n          barGap: 1,\r\n          height,\r\n          normalize: true,\r\n          interact: false,\r\n        });\r\n\r\n        // Assign to ref only if component is still mounted\r\n        if (mounted) {\r\n          wavesurfer.current = newWaveSurfer;\r\n        } else {\r\n          // Component unmounted during initialization, clean up\r\n          try {\r\n            newWaveSurfer.destroy();\r\n          } catch (e) {\r\n            // Ignore destroy errors\r\n          }\r\n          return;\r\n        }\r\n\r\n        // Event listeners\r\n        newWaveSurfer.on(\"ready\", () => {\r\n          if (mounted) {\r\n            setIsLoading(false);\r\n            setError(false);\r\n          }\r\n        });\r\n\r\n        newWaveSurfer.on(\"error\", (err) => {\r\n          console.error(\"WaveSurfer error:\", err);\r\n          if (mounted) {\r\n            setError(true);\r\n            setIsLoading(false);\r\n          }\r\n        });\r\n\r\n        await newWaveSurfer.load(audioUrl);\r\n      } catch (err) {\r\n        console.error(\"Failed to initialize WaveSurfer:\", err);\r\n        if (mounted) {\r\n          setError(true);\r\n          setIsLoading(false);\r\n        }\r\n      }\r\n    };\r\n\r\n    // First safely destroy previous instance if it exists\r\n    if (ws) {\r\n      // Use this pattern to safely destroy the previous instance\r\n      const wsToDestroy = ws;\r\n      // Detach from ref immediately\r\n      wavesurfer.current = null;\r\n\r\n      // Wait a tick to destroy so any pending operations can complete\r\n      requestAnimationFrame(() => {\r\n        try {\r\n          wsToDestroy.destroy();\r\n        } catch (e) {\r\n          // Ignore errors during destroy\r\n        }\r\n        // Only initialize new instance after destroying the old one\r\n        if (mounted) {\r\n          initWaveSurfer();\r\n        }\r\n      });\r\n    } else {\r\n      // No previous instance to clean up, initialize directly\r\n      initWaveSurfer();\r\n    }\r\n\r\n    return () => {\r\n      // Mark component as unmounted\r\n      mounted = false;\r\n\r\n      // Store reference to current wavesurfer instance\r\n      const wsToDestroy = wavesurfer.current;\r\n\r\n      // Immediately clear the ref to prevent accessing it after unmount\r\n      wavesurfer.current = null;\r\n\r\n      // If we have an instance to clean up, do it safely\r\n      if (wsToDestroy) {\r\n        // Delay destruction to avoid race conditions\r\n        requestAnimationFrame(() => {\r\n          try {\r\n            wsToDestroy.destroy();\r\n          } catch (e) {\r\n            // Ignore destroy errors - they're expected\r\n          }\r\n        });\r\n      }\r\n    };\r\n  }, [audioUrl, height]);\r\n\r\n  if (error) {\r\n    return (\r\n      <div\r\n        className={`flex items-center justify-center ${className}`}\r\n        style={{ height }}\r\n      >\r\n        <span className=\"text-xs text-foreground/60\">Audio unavailable</span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={`relative ${className}`}>\r\n      {isLoading && (\r\n        <div className=\"absolute inset-0 flex items-center justify-center\">\r\n          <span className=\"text-xs text-foreground/60\">Loading...</span>\r\n        </div>\r\n      )}\r\n      <div\r\n        ref={waveformRef}\r\n        className={`w-full transition-opacity duration-200 ${isLoading ? \"opacity-0\" : \"opacity-100\"}`}\r\n        style={{ height }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AudioWaveform;\r\n","import { useState, useEffect } from \"react\";\r\nimport { ResizeState, TimelineElement, TimelineTrack } from \"@/types/timeline\";\r\nimport { useMediaStore } from \"@/stores/media-store\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { useProjectStore } from \"@/stores/project-store\";\r\nimport { snapTimeToFrame } from \"@/constants/timeline-constants\";\r\n\r\ninterface UseTimelineElementResizeProps {\r\n  element: TimelineElement;\r\n  track: TimelineTrack;\r\n  zoomLevel: number;\r\n  onUpdateTrim: (\r\n    trackId: string,\r\n    elementId: string,\r\n    trimStart: number,\r\n    trimEnd: number\r\n  ) => void;\r\n  onUpdateDuration: (\r\n    trackId: string,\r\n    elementId: string,\r\n    duration: number\r\n  ) => void;\r\n}\r\n\r\nexport function useTimelineElementResize({\r\n  element,\r\n  track,\r\n  zoomLevel,\r\n  onUpdateTrim,\r\n  onUpdateDuration,\r\n}: UseTimelineElementResizeProps) {\r\n  const [resizing, setResizing] = useState<ResizeState | null>(null);\r\n  const { mediaItems } = useMediaStore();\r\n  const {\r\n    updateElementStartTime,\r\n    updateElementTrim,\r\n    updateElementDuration,\r\n    pushHistory,\r\n  } = useTimelineStore();\r\n\r\n  // Set up document-level mouse listeners during resize (like proper drag behavior)\r\n  useEffect(() => {\r\n    if (!resizing) return;\r\n\r\n    const handleDocumentMouseMove = (e: MouseEvent) => {\r\n      updateTrimFromMouseMove({ clientX: e.clientX });\r\n    };\r\n\r\n    const handleDocumentMouseUp = () => {\r\n      handleResizeEnd();\r\n    };\r\n\r\n    // Add document-level listeners for proper drag behavior\r\n    document.addEventListener(\"mousemove\", handleDocumentMouseMove);\r\n    document.addEventListener(\"mouseup\", handleDocumentMouseUp);\r\n\r\n    return () => {\r\n      document.removeEventListener(\"mousemove\", handleDocumentMouseMove);\r\n      document.removeEventListener(\"mouseup\", handleDocumentMouseUp);\r\n    };\r\n  }, [resizing]); // Re-run when resizing state changes\r\n\r\n  const handleResizeStart = (\r\n    e: React.MouseEvent,\r\n    elementId: string,\r\n    side: \"left\" | \"right\"\r\n  ) => {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n\r\n    // Push history once at the start of the resize operation\r\n    pushHistory();\r\n\r\n    setResizing({\r\n      elementId,\r\n      side,\r\n      startX: e.clientX,\r\n      initialTrimStart: element.trimStart,\r\n      initialTrimEnd: element.trimEnd,\r\n    });\r\n  };\r\n\r\n  const canExtendElementDuration = () => {\r\n    // Text elements can always be extended\r\n    if (element.type === \"text\") {\r\n      return true;\r\n    }\r\n\r\n    // Media elements - check the media type\r\n    if (element.type === \"media\") {\r\n      const mediaItem = mediaItems.find((item) => item.id === element.mediaId);\r\n      if (!mediaItem) return false;\r\n\r\n      // Images can be extended (static content)\r\n      if (mediaItem.type === \"image\") {\r\n        return true;\r\n      }\r\n\r\n      // Videos and audio cannot be extended beyond their natural duration\r\n      // (no additional content exists)\r\n      return false;\r\n    }\r\n\r\n    return false;\r\n  };\r\n\r\n  const updateTrimFromMouseMove = (e: { clientX: number }) => {\r\n    if (!resizing) return;\r\n\r\n    const deltaX = e.clientX - resizing.startX;\r\n    // Reasonable sensitivity for resize operations - similar to timeline scale\r\n    const deltaTime = deltaX / (50 * zoomLevel);\r\n\r\n    // Get project FPS for frame snapping\r\n    const projectStore = useProjectStore.getState();\r\n    const projectFps = projectStore.activeProject?.fps || 30;\r\n\r\n    if (resizing.side === \"left\") {\r\n      // Left resize - different behavior for media vs text/image elements\r\n      const maxAllowed = element.duration - resizing.initialTrimEnd - 0.1;\r\n      const calculated = resizing.initialTrimStart + deltaTime;\r\n\r\n      if (calculated >= 0) {\r\n        // Normal trimming within available content\r\n        const newTrimStart = snapTimeToFrame(\r\n          Math.min(maxAllowed, calculated),\r\n          projectFps\r\n        );\r\n        const trimDelta = newTrimStart - resizing.initialTrimStart;\r\n        const newStartTime = snapTimeToFrame(\r\n          element.startTime + trimDelta,\r\n          projectFps\r\n        );\r\n\r\n        updateElementTrim(\r\n          track.id,\r\n          element.id,\r\n          newTrimStart,\r\n          resizing.initialTrimEnd,\r\n          false\r\n        );\r\n        updateElementStartTime(track.id, element.id, newStartTime, false);\r\n      } else {\r\n        // Trying to extend beyond trimStart = 0\r\n        if (canExtendElementDuration()) {\r\n          // Text/Image: extend element to the left by moving startTime and increasing duration\r\n          const extensionAmount = Math.abs(calculated);\r\n          const maxExtension = element.startTime;\r\n          const actualExtension = Math.min(extensionAmount, maxExtension);\r\n          const newStartTime = snapTimeToFrame(\r\n            element.startTime - actualExtension,\r\n            projectFps\r\n          );\r\n          const newDuration = snapTimeToFrame(\r\n            element.duration + actualExtension,\r\n            projectFps\r\n          );\r\n\r\n          // Keep trimStart at 0 and extend the element\r\n          updateElementTrim(\r\n            track.id,\r\n            element.id,\r\n            0,\r\n            resizing.initialTrimEnd,\r\n            false\r\n          );\r\n          updateElementDuration(track.id, element.id, newDuration, false);\r\n          updateElementStartTime(track.id, element.id, newStartTime, false);\r\n        } else {\r\n          // Video/Audio: can't extend beyond original content - limit to trimStart = 0\r\n          const newTrimStart = 0;\r\n          const trimDelta = newTrimStart - resizing.initialTrimStart;\r\n          const newStartTime = snapTimeToFrame(\r\n            element.startTime + trimDelta,\r\n            projectFps\r\n          );\r\n\r\n          updateElementTrim(\r\n            track.id,\r\n            element.id,\r\n            newTrimStart,\r\n            resizing.initialTrimEnd,\r\n            false\r\n          );\r\n          updateElementStartTime(track.id, element.id, newStartTime, false);\r\n        }\r\n      }\r\n    } else {\r\n      // Right resize - can extend duration for supported element types\r\n      const calculated = resizing.initialTrimEnd - deltaTime;\r\n\r\n      if (calculated < 0) {\r\n        // We're trying to extend beyond original duration\r\n        if (canExtendElementDuration()) {\r\n          // Extend the duration instead of reducing trimEnd further\r\n          const extensionNeeded = Math.abs(calculated);\r\n          const newDuration = snapTimeToFrame(\r\n            element.duration + extensionNeeded,\r\n            projectFps\r\n          );\r\n          const newTrimEnd = 0; // Reset trimEnd to 0 since we're extending\r\n\r\n          // Update duration first, then trim\r\n          updateElementDuration(track.id, element.id, newDuration, false);\r\n          updateElementTrim(\r\n            track.id,\r\n            element.id,\r\n            resizing.initialTrimStart,\r\n            newTrimEnd,\r\n            false\r\n          );\r\n        } else {\r\n          // Can't extend - just set trimEnd to 0 (maximum possible extension)\r\n          updateElementTrim(\r\n            track.id,\r\n            element.id,\r\n            resizing.initialTrimStart,\r\n            0,\r\n            false\r\n          );\r\n        }\r\n      } else {\r\n        // Normal trimming within original duration\r\n        // Calculate the desired end time based on mouse movement\r\n        const currentEndTime =\r\n          element.startTime +\r\n          element.duration -\r\n          element.trimStart -\r\n          element.trimEnd;\r\n        const desiredEndTime = currentEndTime + deltaTime;\r\n\r\n        // Snap the desired end time to frame\r\n        const snappedEndTime = snapTimeToFrame(desiredEndTime, projectFps);\r\n\r\n        // Calculate what trimEnd should be to achieve this snapped end time\r\n        const newTrimEnd = Math.max(\r\n          0,\r\n          element.duration -\r\n            element.trimStart -\r\n            (snappedEndTime - element.startTime)\r\n        );\r\n\r\n        // Ensure we don't trim more than available content (leave at least 0.1s visible)\r\n        const maxTrimEnd = element.duration - element.trimStart - 0.1;\r\n        const finalTrimEnd = Math.min(maxTrimEnd, newTrimEnd);\r\n\r\n        updateElementTrim(\r\n          track.id,\r\n          element.id,\r\n          element.trimStart,\r\n          finalTrimEnd,\r\n          false\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleResizeEnd = () => {\r\n    setResizing(null);\r\n  };\r\n\r\n  return {\r\n    resizing,\r\n    isResizing: resizing !== null,\r\n    handleResizeStart,\r\n    // Return empty handlers since we use document listeners now\r\n    handleResizeMove: () => {}, // Not used anymore\r\n    handleResizeEnd: () => {}, // Not used anymore\r\n  };\r\n}\r\n","\"use client\";\r\n\r\nimport {\r\n  Scissors,\r\n  Trash2,\r\n  Copy,\r\n  RefreshCw,\r\n  EyeOff,\r\n  Eye,\r\n  Volume2,\r\n  VolumeX,\r\n} from \"lucide-react\";\r\nimport { useMediaStore } from \"@/stores/media-store\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\nimport AudioWaveform from \"../audio-waveform\";\r\nimport { toast } from \"sonner\";\r\nimport { TimelineElementProps } from \"@/types/timeline\";\r\nimport { useTimelineElementResize } from \"@/hooks/use-timeline-element-resize\";\r\nimport {\r\n  getTrackElementClasses,\r\n  TIMELINE_CONSTANTS,\r\n  getTrackHeight,\r\n} from \"@/constants/timeline-constants\";\r\nimport {\r\n  ContextMenu,\r\n  ContextMenuContent,\r\n  ContextMenuItem,\r\n  ContextMenuSeparator,\r\n  ContextMenuTrigger,\r\n} from \"../../ui/context-menu\";\r\n\r\nexport function TimelineElement({\r\n  element,\r\n  track,\r\n  zoomLevel,\r\n  isSelected,\r\n  onElementMouseDown,\r\n  onElementClick,\r\n}: TimelineElementProps) {\r\n  const { mediaItems } = useMediaStore();\r\n  const {\r\n    updateElementTrim,\r\n    updateElementDuration,\r\n    removeElementFromTrack,\r\n    removeElementFromTrackWithRipple,\r\n    dragState,\r\n    splitElement,\r\n    addElementToTrack,\r\n    replaceElementMedia,\r\n    rippleEditingEnabled,\r\n    toggleElementHidden,\r\n  } = useTimelineStore();\r\n  const { currentTime } = usePlaybackStore();\r\n\r\n  const mediaItem =\r\n    element.type === \"media\"\r\n      ? mediaItems.find((item) => item.id === element.mediaId)\r\n      : null;\r\n  const isAudio = mediaItem?.type === \"audio\";\r\n\r\n  const { resizing, handleResizeStart, handleResizeMove, handleResizeEnd } =\r\n    useTimelineElementResize({\r\n      element,\r\n      track,\r\n      zoomLevel,\r\n      onUpdateTrim: updateElementTrim,\r\n      onUpdateDuration: updateElementDuration,\r\n    });\r\n\r\n  const effectiveDuration =\r\n    element.duration - element.trimStart - element.trimEnd;\r\n  const elementWidth = Math.max(\r\n    TIMELINE_CONSTANTS.ELEMENT_MIN_WIDTH,\r\n    effectiveDuration * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel\r\n  );\r\n\r\n  // Use real-time position during drag, otherwise use stored position\r\n  const isBeingDragged = dragState.elementId === element.id;\r\n  const elementStartTime =\r\n    isBeingDragged && dragState.isDragging\r\n      ? dragState.currentTime\r\n      : element.startTime;\r\n\r\n  // Element should always be positioned at startTime - trimStart only affects content, not position\r\n  const elementLeft = elementStartTime * 50 * zoomLevel;\r\n\r\n  const handleElementSplitContext = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    const effectiveStart = element.startTime;\r\n    const effectiveEnd =\r\n      element.startTime +\r\n      (element.duration - element.trimStart - element.trimEnd);\r\n\r\n    if (currentTime > effectiveStart && currentTime < effectiveEnd) {\r\n      const secondElementId = splitElement(track.id, element.id, currentTime);\r\n      if (!secondElementId) {\r\n        toast.error(\"Failed to split element\");\r\n      }\r\n    } else {\r\n      toast.error(\"Playhead must be within element to split\");\r\n    }\r\n  };\r\n\r\n  const handleElementDuplicateContext = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    const { id, ...elementWithoutId } = element;\r\n    addElementToTrack(track.id, {\r\n      ...elementWithoutId,\r\n      name: element.name + \" (copy)\",\r\n      startTime:\r\n        element.startTime +\r\n        (element.duration - element.trimStart - element.trimEnd) +\r\n        0.1,\r\n    });\r\n  };\r\n\r\n  const handleElementDeleteContext = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    if (rippleEditingEnabled) {\r\n      removeElementFromTrackWithRipple(track.id, element.id);\r\n    } else {\r\n      removeElementFromTrack(track.id, element.id);\r\n    }\r\n  };\r\n\r\n  const handleToggleElementHidden = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    toggleElementHidden(track.id, element.id);\r\n  };\r\n\r\n  const handleReplaceClip = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    if (element.type !== \"media\") {\r\n      toast.error(\"Replace is only available for media clips\");\r\n      return;\r\n    }\r\n\r\n    // Create a file input to select replacement media\r\n    const input = document.createElement(\"input\");\r\n    input.type = \"file\";\r\n    input.accept = \"video/*,audio/*,image/*\";\r\n    input.onchange = async (e) => {\r\n      const file = (e.target as HTMLInputElement).files?.[0];\r\n      if (!file) return;\r\n\r\n      try {\r\n        const result = await replaceElementMedia(track.id, element.id, file);\r\n        if (result.success) {\r\n          toast.success(\"Clip replaced successfully\");\r\n        } else {\r\n          toast.error(result.error || \"Failed to replace clip\");\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Unexpected error replacing clip:\", error);\r\n        toast.error(\r\n          `Unexpected error: ${error instanceof Error ? error.message : \"Unknown error\"}`\r\n        );\r\n      }\r\n    };\r\n    input.click();\r\n  };\r\n\r\n  const renderElementContent = () => {\r\n    if (element.type === \"text\") {\r\n      return (\r\n        <div className=\"w-full h-full flex items-center justify-start pl-2\">\r\n          <span className=\"text-xs text-white truncate\">{element.content}</span>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    // Render media element ->\r\n    const mediaItem = mediaItems.find((item) => item.id === element.mediaId);\r\n    if (!mediaItem) {\r\n      return (\r\n        <span className=\"text-xs text-foreground/80 truncate\">\r\n          {element.name}\r\n        </span>\r\n      );\r\n    }\r\n\r\n    const TILE_ASPECT_RATIO = 16 / 9;\r\n\r\n    if (\r\n      mediaItem.type === \"image\" ||\r\n      (mediaItem.type === \"video\" && mediaItem.thumbnailUrl)\r\n    ) {\r\n      // Calculate tile size based on 16:9 aspect ratio\r\n      const trackHeight = getTrackHeight(track.type);\r\n      const tileHeight = trackHeight;\r\n      const tileWidth = tileHeight * TILE_ASPECT_RATIO;\r\n\r\n      const imageUrl =\r\n        mediaItem.type === \"image\" ? mediaItem.url : mediaItem.thumbnailUrl;\r\n      const isImage = mediaItem.type === \"image\";\r\n\r\n      return (\r\n        <div className=\"w-full h-full flex items-center justify-center\">\r\n          <div\r\n            className={`w-full h-full relative ${\r\n              isSelected ? \"bg-primary\" : \"bg-transparent\"\r\n            }`}\r\n          >\r\n            <div\r\n              className={`absolute top-[0.15rem] bottom-[0.15rem] left-0 right-0`}\r\n              style={{\r\n                backgroundImage: imageUrl ? `url(${imageUrl})` : \"none\",\r\n                backgroundRepeat: \"repeat-x\",\r\n                backgroundSize: `${tileWidth}px ${tileHeight}px`,\r\n                backgroundPosition: \"left center\",\r\n                pointerEvents: \"none\",\r\n              }}\r\n              aria-label={`Tiled ${isImage ? \"background\" : \"thumbnail\"} of ${mediaItem.name}`}\r\n            />\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    // Render audio element ->\r\n    if (mediaItem.type === \"audio\") {\r\n      return (\r\n        <div className=\"w-full h-full flex items-center gap-2\">\r\n          <div className=\"flex-1 min-w-0\">\r\n            <AudioWaveform\r\n              audioUrl={mediaItem.url || \"\"}\r\n              height={24}\r\n              className=\"w-full\"\r\n            />\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <span className=\"text-xs text-foreground/80 truncate\">\r\n        {element.name}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  const handleElementMouseDown = (e: React.MouseEvent) => {\r\n    if (onElementMouseDown) {\r\n      onElementMouseDown(e, element);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <ContextMenu>\r\n      <ContextMenuTrigger asChild>\r\n        <div\r\n          className={`absolute top-0 h-full select-none timeline-element ${\r\n            isBeingDragged ? \"z-50\" : \"z-10\"\r\n          }`}\r\n          style={{\r\n            left: `${elementLeft}px`,\r\n            width: `${elementWidth}px`,\r\n          }}\r\n          data-element-id={element.id}\r\n          data-track-id={track.id}\r\n          onMouseMove={resizing ? handleResizeMove : undefined}\r\n          onMouseUp={resizing ? handleResizeEnd : undefined}\r\n          onMouseLeave={resizing ? handleResizeEnd : undefined}\r\n        >\r\n          <div\r\n            className={`relative h-full rounded-[0.15rem] cursor-pointer overflow-hidden ${getTrackElementClasses(\r\n              track.type\r\n            )} ${isSelected ? \"\" : \"\"} ${\r\n              isBeingDragged ? \"z-50\" : \"z-10\"\r\n            } ${element.hidden ? \"opacity-50\" : \"\"}`}\r\n            onClick={(e) => onElementClick && onElementClick(e, element)}\r\n            onMouseDown={handleElementMouseDown}\r\n            onContextMenu={(e) =>\r\n              onElementMouseDown && onElementMouseDown(e, element)\r\n            }\r\n          >\r\n            <div className=\"absolute inset-0 flex items-center h-full\">\r\n              {renderElementContent()}\r\n            </div>\r\n\r\n            {element.hidden && (\r\n              <div className=\"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center pointer-events-none\">\r\n                {isAudio ? (\r\n                  <VolumeX className=\"h-6 w-6 text-white\" />\r\n                ) : (\r\n                  <EyeOff className=\"h-6 w-6 text-white\" />\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {isSelected && (\r\n              <>\r\n                <div\r\n                  className=\"absolute left-0 top-0 bottom-0 w-[0.2rem] cursor-w-resize bg-primary z-50\"\r\n                  onMouseDown={(e) => handleResizeStart(e, element.id, \"left\")}\r\n                />\r\n                <div\r\n                  className=\"absolute right-0 top-0 bottom-0 w-[0.2rem] cursor-e-resize bg-primary z-50\"\r\n                  onMouseDown={(e) => handleResizeStart(e, element.id, \"right\")}\r\n                />\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </ContextMenuTrigger>\r\n      <ContextMenuContent className=\"z-200\">\r\n        <ContextMenuItem onClick={handleElementSplitContext}>\r\n          <Scissors className=\"h-4 w-4 mr-2\" />\r\n          Split at playhead\r\n        </ContextMenuItem>\r\n        <ContextMenuItem onClick={handleToggleElementHidden}>\r\n          {isAudio ? (\r\n            element.hidden ? (\r\n              <Volume2 className=\"h-4 w-4 mr-2\" />\r\n            ) : (\r\n              <VolumeX className=\"h-4 w-4 mr-2\" />\r\n            )\r\n          ) : element.hidden ? (\r\n            <Eye className=\"h-4 w-4 mr-2\" />\r\n          ) : (\r\n            <EyeOff className=\"h-4 w-4 mr-2\" />\r\n          )}\r\n          <span>\r\n            {isAudio\r\n              ? element.hidden\r\n                ? \"Unmute\"\r\n                : \"Mute\"\r\n              : element.hidden\r\n                ? \"Show\"\r\n                : \"Hide\"}{\" \"}\r\n            {element.type === \"text\" ? \"text\" : \"clip\"}\r\n          </span>\r\n        </ContextMenuItem>\r\n        <ContextMenuItem onClick={handleElementDuplicateContext}>\r\n          <Copy className=\"h-4 w-4 mr-2\" />\r\n          Duplicate {element.type === \"text\" ? \"text\" : \"clip\"}\r\n        </ContextMenuItem>\r\n        {element.type === \"media\" && (\r\n          <ContextMenuItem onClick={handleReplaceClip}>\r\n            <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n            Replace clip\r\n          </ContextMenuItem>\r\n        )}\r\n        <ContextMenuSeparator />\r\n        <ContextMenuItem\r\n          onClick={handleElementDeleteContext}\r\n          className=\"text-destructive focus:text-destructive\"\r\n        >\r\n          <Trash2 className=\"h-4 w-4 mr-2\" />\r\n          Delete {element.type === \"text\" ? \"text\" : \"clip\"}\r\n        </ContextMenuItem>\r\n      </ContextMenuContent>\r\n    </ContextMenu>\r\n  );\r\n}\r\n","import { useCallback } from \"react\";\r\nimport { TimelineTrack } from \"@/types/timeline\";\r\nimport { TIMELINE_CONSTANTS } from \"@/constants/timeline-constants\";\r\n\r\nexport interface SnapPoint {\r\n  time: number;\r\n  type: \"element-start\" | \"element-end\" | \"playhead\";\r\n  elementId?: string;\r\n  trackId?: string;\r\n}\r\n\r\nexport interface SnapResult {\r\n  snappedTime: number;\r\n  snapPoint: SnapPoint | null;\r\n  snapDistance: number;\r\n}\r\n\r\nexport interface UseTimelineSnappingOptions {\r\n  snapThreshold?: number; // Distance in pixels to trigger snapping\r\n  enableElementSnapping?: boolean;\r\n  enablePlayheadSnapping?: boolean;\r\n}\r\n\r\nexport function useTimelineSnapping({\r\n  snapThreshold = 10,\r\n  enableElementSnapping = true,\r\n  enablePlayheadSnapping = true,\r\n}: UseTimelineSnappingOptions = {}) {\r\n  const findSnapPoints = useCallback(\r\n    (\r\n      tracks: TimelineTrack[],\r\n      currentTime: number,\r\n      playheadTime: number,\r\n      zoomLevel: number,\r\n      excludeElementId?: string\r\n    ): SnapPoint[] => {\r\n      const snapPoints: SnapPoint[] = [];\r\n\r\n      // Add element snap points\r\n      if (enableElementSnapping) {\r\n        tracks.forEach((track) => {\r\n          track.elements.forEach((element) => {\r\n            // Skip the element being dragged\r\n            if (element.id === excludeElementId) return;\r\n\r\n            const elementStart = element.startTime;\r\n            const elementEnd =\r\n              element.startTime +\r\n              (element.duration - element.trimStart - element.trimEnd);\r\n\r\n            snapPoints.push(\r\n              {\r\n                time: elementStart,\r\n                type: \"element-start\",\r\n                elementId: element.id,\r\n                trackId: track.id,\r\n              },\r\n              {\r\n                time: elementEnd,\r\n                type: \"element-end\",\r\n                elementId: element.id,\r\n                trackId: track.id,\r\n              }\r\n            );\r\n          });\r\n        });\r\n      }\r\n\r\n      // Add playhead snap point\r\n      if (enablePlayheadSnapping) {\r\n        snapPoints.push({\r\n          time: playheadTime,\r\n          type: \"playhead\",\r\n        });\r\n      }\r\n\r\n      return snapPoints;\r\n    },\r\n    [enableElementSnapping, enablePlayheadSnapping]\r\n  );\r\n\r\n  const snapToNearestPoint = useCallback(\r\n    (\r\n      targetTime: number,\r\n      snapPoints: SnapPoint[],\r\n      zoomLevel: number\r\n    ): SnapResult => {\r\n      const pixelsPerSecond = TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel;\r\n      const thresholdInSeconds = snapThreshold / pixelsPerSecond;\r\n\r\n      let closestSnapPoint: SnapPoint | null = null;\r\n      let closestDistance = Infinity;\r\n\r\n      snapPoints.forEach((snapPoint) => {\r\n        const distance = Math.abs(targetTime - snapPoint.time);\r\n        if (distance < thresholdInSeconds && distance < closestDistance) {\r\n          closestDistance = distance;\r\n          closestSnapPoint = snapPoint;\r\n        }\r\n      });\r\n\r\n      return {\r\n        snappedTime: closestSnapPoint\r\n          ? (closestSnapPoint as SnapPoint).time\r\n          : targetTime,\r\n        snapPoint: closestSnapPoint,\r\n        snapDistance: closestDistance,\r\n      };\r\n    },\r\n    [snapThreshold]\r\n  );\r\n\r\n  const snapElementPosition = useCallback(\r\n    (\r\n      targetTime: number,\r\n      tracks: TimelineTrack[],\r\n      playheadTime: number,\r\n      zoomLevel: number,\r\n      excludeElementId?: string\r\n    ): SnapResult => {\r\n      const snapPoints = findSnapPoints(\r\n        tracks,\r\n        targetTime,\r\n        playheadTime,\r\n        zoomLevel,\r\n        excludeElementId\r\n      );\r\n\r\n      return snapToNearestPoint(targetTime, snapPoints, zoomLevel);\r\n    },\r\n    [findSnapPoints, snapToNearestPoint]\r\n  );\r\n\r\n  const snapElementEdge = useCallback(\r\n    (\r\n      targetTime: number,\r\n      elementDuration: number,\r\n      tracks: TimelineTrack[],\r\n      playheadTime: number,\r\n      zoomLevel: number,\r\n      excludeElementId?: string,\r\n      snapToStart = true // true for start edge, false for end edge\r\n    ): SnapResult => {\r\n      const snapPoints = findSnapPoints(\r\n        tracks,\r\n        targetTime,\r\n        playheadTime,\r\n        zoomLevel,\r\n        excludeElementId\r\n      );\r\n\r\n      // For end edge snapping, we need to account for element duration\r\n      const effectiveTargetTime = snapToStart\r\n        ? targetTime\r\n        : targetTime + elementDuration;\r\n      const snapResult = snapToNearestPoint(\r\n        effectiveTargetTime,\r\n        snapPoints,\r\n        zoomLevel\r\n      );\r\n\r\n      // Adjust the snapped time back for end edge\r\n      if (!snapToStart && snapResult.snapPoint) {\r\n        snapResult.snappedTime = snapResult.snappedTime - elementDuration;\r\n      }\r\n\r\n      return snapResult;\r\n    },\r\n    [findSnapPoints, snapToNearestPoint]\r\n  );\r\n\r\n  return {\r\n    snapElementPosition,\r\n    snapElementEdge,\r\n    findSnapPoints,\r\n    snapToNearestPoint,\r\n  };\r\n}\r\n","\"use client\";\r\n\r\nimport { useRef, useState, useEffect } from \"react\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { useMediaStore } from \"@/stores/media-store\";\r\nimport { toast } from \"sonner\";\r\nimport { processMediaFiles } from \"@/lib/media-processing\";\r\nimport { TimelineElement } from \"./timeline-element\";\r\nimport {\r\n  TimelineTrack,\r\n  getMainTrack,\r\n  canElementGoOnTrack,\r\n} from \"@/types/timeline\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\nimport type {\r\n  TimelineElement as TimelineElementType,\r\n  DragData,\r\n  TrackType,\r\n} from \"@/types/timeline\";\r\nimport {\r\n  snapTimeToFrame,\r\n  TIMELINE_CONSTANTS,\r\n} from \"@/constants/timeline-constants\";\r\nimport { useProjectStore } from \"@/stores/project-store\";\r\nimport { useTimelineSnapping, SnapPoint } from \"@/hooks/use-timeline-snapping\";\r\n\r\nexport function TimelineTrackContent({\r\n  track,\r\n  zoomLevel,\r\n  onSnapPointChange,\r\n}: {\r\n  track: TimelineTrack;\r\n  zoomLevel: number;\r\n  onSnapPointChange?: (snapPoint: SnapPoint | null) => void;\r\n}) {\r\n  const { mediaItems } = useMediaStore();\r\n  const {\r\n    tracks,\r\n    addTrack,\r\n    moveElementToTrack,\r\n    updateElementStartTime,\r\n    updateElementStartTimeWithRipple,\r\n    addElementToTrack,\r\n    selectedElements,\r\n    selectElement,\r\n    dragState,\r\n    startDrag: startDragAction,\r\n    updateDragTime,\r\n    endDrag: endDragAction,\r\n    clearSelectedElements,\r\n    insertTrackAt,\r\n    snappingEnabled,\r\n    rippleEditingEnabled,\r\n  } = useTimelineStore();\r\n\r\n  const { currentTime } = usePlaybackStore();\r\n\r\n  // Initialize snapping hook\r\n  const { snapElementPosition, snapElementEdge } = useTimelineSnapping({\r\n    snapThreshold: 10,\r\n    enableElementSnapping: snappingEnabled,\r\n    enablePlayheadSnapping: snappingEnabled,\r\n  });\r\n\r\n  // Helper function for drop snapping that tries both edges\r\n  const getDropSnappedTime = (\r\n    dropTime: number,\r\n    elementDuration: number,\r\n    excludeElementId?: string\r\n  ) => {\r\n    // Always apply frame snapping first\r\n    const projectStore = useProjectStore.getState();\r\n    const projectFps = projectStore.activeProject?.fps || 30;\r\n    let finalTime = snapTimeToFrame(dropTime, projectFps);\r\n\r\n    // Additionally apply element snapping if enabled\r\n    if (snappingEnabled) {\r\n      // Try snapping both start and end edges for drops\r\n      const startSnapResult = snapElementEdge(\r\n        dropTime,\r\n        elementDuration,\r\n        tracks,\r\n        currentTime,\r\n        zoomLevel,\r\n        excludeElementId,\r\n        true // snap to start edge\r\n      );\r\n\r\n      const endSnapResult = snapElementEdge(\r\n        dropTime,\r\n        elementDuration,\r\n        tracks,\r\n        currentTime,\r\n        zoomLevel,\r\n        excludeElementId,\r\n        false // snap to end edge\r\n      );\r\n\r\n      // Choose the snap result with the smaller distance (closer snap)\r\n      let bestSnapResult = startSnapResult;\r\n      if (\r\n        endSnapResult.snapPoint &&\r\n        (!startSnapResult.snapPoint ||\r\n          endSnapResult.snapDistance < startSnapResult.snapDistance)\r\n      ) {\r\n        bestSnapResult = endSnapResult;\r\n      }\r\n\r\n      // Only use element snapping if it found a snap point, otherwise keep frame-snapped time\r\n      if (bestSnapResult.snapPoint) {\r\n        finalTime = bestSnapResult.snappedTime;\r\n      }\r\n    }\r\n\r\n    return finalTime;\r\n  };\r\n\r\n  const timelineRef = useRef<HTMLDivElement>(null);\r\n  const [isDropping, setIsDropping] = useState(false);\r\n  const [dropPosition, setDropPosition] = useState<number | null>(null);\r\n  const [wouldOverlap, setWouldOverlap] = useState(false);\r\n  const dragCounterRef = useRef(0);\r\n  const [mouseDownLocation, setMouseDownLocation] = useState<{\r\n    x: number;\r\n    y: number;\r\n  } | null>(null);\r\n\r\n  // Set up mouse event listeners for drag\r\n  useEffect(() => {\r\n    if (!dragState.isDragging) return;\r\n\r\n    const handleMouseMove = (e: MouseEvent) => {\r\n      if (!timelineRef.current) return;\r\n\r\n      // On first mouse move during drag, ensure the element is selected\r\n      if (dragState.elementId && dragState.trackId) {\r\n        const isSelected = selectedElements.some(\r\n          (c) =>\r\n            c.trackId === dragState.trackId &&\r\n            c.elementId === dragState.elementId\r\n        );\r\n\r\n        if (!isSelected) {\r\n          // Select this element (replacing other selections) since we're dragging it\r\n          selectElement(dragState.trackId, dragState.elementId, false);\r\n        }\r\n      }\r\n\r\n      const timelineRect = timelineRef.current.getBoundingClientRect();\r\n      const mouseX = e.clientX - timelineRect.left;\r\n      const mouseTime = Math.max(\r\n        0,\r\n        mouseX / (TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel)\r\n      );\r\n      const adjustedTime = Math.max(0, mouseTime - dragState.clickOffsetTime);\r\n\r\n      // Always apply frame snapping first\r\n      const projectStore = useProjectStore.getState();\r\n      const projectFps = projectStore.activeProject?.fps || 30;\r\n      let finalTime = snapTimeToFrame(adjustedTime, projectFps);\r\n      let snapPoint = null;\r\n\r\n      // Additionally apply element snapping if enabled\r\n      if (snappingEnabled) {\r\n        // Find the element being dragged to get its duration\r\n        let elementDuration = 5; // fallback duration\r\n        if (dragState.elementId && dragState.trackId) {\r\n          const sourceTrack = tracks.find((t) => t.id === dragState.trackId);\r\n          const element = sourceTrack?.elements.find(\r\n            (e) => e.id === dragState.elementId\r\n          );\r\n          if (element) {\r\n            elementDuration =\r\n              element.duration - element.trimStart - element.trimEnd;\r\n          }\r\n        }\r\n\r\n        // Try snapping both start and end edges\r\n        const startSnapResult = snapElementEdge(\r\n          adjustedTime,\r\n          elementDuration,\r\n          tracks,\r\n          currentTime,\r\n          zoomLevel,\r\n          dragState.elementId || undefined,\r\n          true // snap to start edge\r\n        );\r\n\r\n        const endSnapResult = snapElementEdge(\r\n          adjustedTime,\r\n          elementDuration,\r\n          tracks,\r\n          currentTime,\r\n          zoomLevel,\r\n          dragState.elementId || undefined,\r\n          false // snap to end edge\r\n        );\r\n\r\n        // Choose the snap result with the smaller distance (closer snap)\r\n        let bestSnapResult = startSnapResult;\r\n        if (\r\n          endSnapResult.snapPoint &&\r\n          (!startSnapResult.snapPoint ||\r\n            endSnapResult.snapDistance < startSnapResult.snapDistance)\r\n        ) {\r\n          bestSnapResult = endSnapResult;\r\n        }\r\n\r\n        // Only use element snapping if it found a snap point, otherwise keep frame-snapped time\r\n        if (bestSnapResult.snapPoint) {\r\n          finalTime = bestSnapResult.snappedTime;\r\n          snapPoint = bestSnapResult.snapPoint;\r\n        }\r\n\r\n        // Notify parent component about snap point change\r\n        onSnapPointChange?.(snapPoint);\r\n      } else {\r\n        // Clear snap point when element snapping is disabled\r\n        onSnapPointChange?.(null);\r\n      }\r\n\r\n      updateDragTime(finalTime);\r\n    };\r\n\r\n    const handleMouseUp = (e: MouseEvent) => {\r\n      if (!dragState.elementId || !dragState.trackId) return;\r\n\r\n      // If this track initiated the drag, we should handle the mouse up regardless of where it occurs\r\n      const isTrackThatStartedDrag = dragState.trackId === track.id;\r\n\r\n      const timelineRect = timelineRef.current?.getBoundingClientRect();\r\n      if (!timelineRect) {\r\n        if (isTrackThatStartedDrag) {\r\n          if (rippleEditingEnabled) {\r\n            updateElementStartTimeWithRipple(\r\n              track.id,\r\n              dragState.elementId,\r\n              dragState.currentTime\r\n            );\r\n          } else {\r\n            updateElementStartTime(\r\n              track.id,\r\n              dragState.elementId,\r\n              dragState.currentTime\r\n            );\r\n          }\r\n          endDragAction();\r\n          // Clear snap point when drag ends\r\n          onSnapPointChange?.(null);\r\n        }\r\n        return;\r\n      }\r\n\r\n      const isMouseOverThisTrack =\r\n        e.clientY >= timelineRect.top && e.clientY <= timelineRect.bottom;\r\n\r\n      if (!isMouseOverThisTrack && !isTrackThatStartedDrag) return;\r\n\r\n      const finalTime = dragState.currentTime;\r\n\r\n      if (isMouseOverThisTrack) {\r\n        const sourceTrack = tracks.find((t) => t.id === dragState.trackId);\r\n        const movingElement = sourceTrack?.elements.find(\r\n          (c) => c.id === dragState.elementId\r\n        );\r\n\r\n        if (movingElement) {\r\n          const movingElementDuration =\r\n            movingElement.duration -\r\n            movingElement.trimStart -\r\n            movingElement.trimEnd;\r\n          const movingElementEnd = finalTime + movingElementDuration;\r\n\r\n          const targetTrack = tracks.find((t) => t.id === track.id);\r\n          const hasOverlap = targetTrack?.elements.some((existingElement) => {\r\n            if (\r\n              dragState.trackId === track.id &&\r\n              existingElement.id === dragState.elementId\r\n            ) {\r\n              return false;\r\n            }\r\n            const existingStart = existingElement.startTime;\r\n            const existingEnd =\r\n              existingElement.startTime +\r\n              (existingElement.duration -\r\n                existingElement.trimStart -\r\n                existingElement.trimEnd);\r\n            return finalTime < existingEnd && movingElementEnd > existingStart;\r\n          });\r\n\r\n          if (!hasOverlap) {\r\n            if (dragState.trackId === track.id) {\r\n              if (rippleEditingEnabled) {\r\n                updateElementStartTimeWithRipple(\r\n                  track.id,\r\n                  dragState.elementId,\r\n                  finalTime\r\n                );\r\n              } else {\r\n                updateElementStartTime(\r\n                  track.id,\r\n                  dragState.elementId,\r\n                  finalTime\r\n                );\r\n              }\r\n            } else {\r\n              moveElementToTrack(\r\n                dragState.trackId,\r\n                track.id,\r\n                dragState.elementId\r\n              );\r\n              requestAnimationFrame(() => {\r\n                if (rippleEditingEnabled) {\r\n                  updateElementStartTimeWithRipple(\r\n                    track.id,\r\n                    dragState.elementId!,\r\n                    finalTime\r\n                  );\r\n                } else {\r\n                  updateElementStartTime(\r\n                    track.id,\r\n                    dragState.elementId!,\r\n                    finalTime\r\n                  );\r\n                }\r\n              });\r\n            }\r\n          }\r\n        }\r\n      } else if (isTrackThatStartedDrag) {\r\n        // Mouse is not over this track, but this track started the drag\r\n        // This means user released over ruler/outside - update position within same track\r\n        const sourceTrack = tracks.find((t) => t.id === dragState.trackId);\r\n        const movingElement = sourceTrack?.elements.find(\r\n          (c) => c.id === dragState.elementId\r\n        );\r\n\r\n        if (movingElement) {\r\n          const movingElementDuration =\r\n            movingElement.duration -\r\n            movingElement.trimStart -\r\n            movingElement.trimEnd;\r\n          const movingElementEnd = finalTime + movingElementDuration;\r\n\r\n          const hasOverlap = track.elements.some((existingElement) => {\r\n            if (existingElement.id === dragState.elementId) {\r\n              return false;\r\n            }\r\n            const existingStart = existingElement.startTime;\r\n            const existingEnd =\r\n              existingElement.startTime +\r\n              (existingElement.duration -\r\n                existingElement.trimStart -\r\n                existingElement.trimEnd);\r\n            return finalTime < existingEnd && movingElementEnd > existingStart;\r\n          });\r\n\r\n          if (!hasOverlap) {\r\n            if (rippleEditingEnabled) {\r\n              updateElementStartTimeWithRipple(\r\n                track.id,\r\n                dragState.elementId,\r\n                finalTime\r\n              );\r\n            } else {\r\n              updateElementStartTime(track.id, dragState.elementId, finalTime);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      if (isTrackThatStartedDrag) {\r\n        endDragAction();\r\n        // Clear snap point when drag ends\r\n        onSnapPointChange?.(null);\r\n      }\r\n    };\r\n\r\n    document.addEventListener(\"mousemove\", handleMouseMove);\r\n    document.addEventListener(\"mouseup\", handleMouseUp);\r\n\r\n    return () => {\r\n      document.removeEventListener(\"mousemove\", handleMouseMove);\r\n      document.removeEventListener(\"mouseup\", handleMouseUp);\r\n    };\r\n  }, [\r\n    dragState.isDragging,\r\n    dragState.clickOffsetTime,\r\n    dragState.elementId,\r\n    dragState.trackId,\r\n    dragState.currentTime,\r\n    zoomLevel,\r\n    tracks,\r\n    track.id,\r\n    updateDragTime,\r\n    updateElementStartTime,\r\n    moveElementToTrack,\r\n    endDragAction,\r\n    selectedElements,\r\n    selectElement,\r\n    onSnapPointChange,\r\n  ]);\r\n\r\n  const handleElementMouseDown = (\r\n    e: React.MouseEvent,\r\n    element: TimelineElementType\r\n  ) => {\r\n    setMouseDownLocation({ x: e.clientX, y: e.clientY });\r\n\r\n    // Detect right-click (button 2) and handle selection without starting drag\r\n    const isRightClick = e.button === 2;\r\n    const isMultiSelect = e.metaKey || e.ctrlKey || e.shiftKey;\r\n\r\n    if (isRightClick) {\r\n      // Handle right-click selection\r\n      const isSelected = selectedElements.some(\r\n        (c) => c.trackId === track.id && c.elementId === element.id\r\n      );\r\n\r\n      // If element is not selected, select it (keep other selections if multi-select)\r\n      if (!isSelected) {\r\n        selectElement(track.id, element.id, isMultiSelect);\r\n      }\r\n      // If element is already selected, keep it selected\r\n\r\n      // Don't start drag action for right-clicks\r\n      return;\r\n    }\r\n\r\n    // Handle multi-selection for left-click with modifiers\r\n    if (isMultiSelect) {\r\n      selectElement(track.id, element.id, true);\r\n    }\r\n\r\n    // Calculate the offset from the left edge of the element to where the user clicked\r\n    const elementElement = e.currentTarget as HTMLElement;\r\n    const elementRect = elementElement.getBoundingClientRect();\r\n    const clickOffsetX = e.clientX - elementRect.left;\r\n    const clickOffsetTime =\r\n      clickOffsetX / (TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel);\r\n\r\n    startDragAction(\r\n      element.id,\r\n      track.id,\r\n      e.clientX,\r\n      element.startTime,\r\n      clickOffsetTime\r\n    );\r\n  };\r\n\r\n  const handleElementClick = (\r\n    e: React.MouseEvent,\r\n    element: TimelineElementType\r\n  ) => {\r\n    e.stopPropagation();\r\n\r\n    // Check if mouse moved significantly\r\n    if (mouseDownLocation) {\r\n      const deltaX = Math.abs(e.clientX - mouseDownLocation.x);\r\n      const deltaY = Math.abs(e.clientY - mouseDownLocation.y);\r\n      // If it moved more than a few pixels, consider it a drag and not a click.\r\n      if (deltaX > 5 || deltaY > 5) {\r\n        setMouseDownLocation(null); // Reset for next interaction\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Skip selection logic for multi-selection (handled in mousedown)\r\n    if (e.metaKey || e.ctrlKey || e.shiftKey) {\r\n      return;\r\n    }\r\n\r\n    // Handle single selection\r\n    const isSelected = selectedElements.some(\r\n      (c) => c.trackId === track.id && c.elementId === element.id\r\n    );\r\n\r\n    if (!isSelected) {\r\n      // If element is not selected, select it (replacing other selections)\r\n      selectElement(track.id, element.id, false);\r\n    }\r\n    // If element is already selected, keep it selected (do nothing)\r\n  };\r\n\r\n  const handleTrackDragOver = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n\r\n    // Handle both timeline elements and media items\r\n    const hasTimelineElement = e.dataTransfer.types.includes(\r\n      \"application/x-timeline-element\"\r\n    );\r\n    const hasMediaItem = e.dataTransfer.types.includes(\r\n      \"application/x-media-item\"\r\n    );\r\n\r\n    if (!hasTimelineElement && !hasMediaItem) return;\r\n\r\n    // Calculate drop position for overlap checking\r\n    const trackContainer = e.currentTarget.querySelector(\r\n      \".track-elements-container\"\r\n    ) as HTMLElement;\r\n    let dropTime = 0;\r\n    if (trackContainer) {\r\n      const rect = trackContainer.getBoundingClientRect();\r\n      const mouseX = Math.max(0, e.clientX - rect.left);\r\n      dropTime = mouseX / (TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel);\r\n    }\r\n\r\n    // Check for potential overlaps and show appropriate feedback\r\n    let wouldOverlap = false;\r\n\r\n    if (hasMediaItem) {\r\n      try {\r\n        const mediaItemData = e.dataTransfer.getData(\r\n          \"application/x-media-item\"\r\n        );\r\n        if (mediaItemData) {\r\n          const dragData: DragData = JSON.parse(mediaItemData);\r\n\r\n          if (dragData.type === \"text\") {\r\n            // Text elements have default duration of 5 seconds\r\n            const newElementDuration = 5;\r\n            const snappedTime = getDropSnappedTime(\r\n              dropTime,\r\n              newElementDuration\r\n            );\r\n            const newElementEnd = snappedTime + newElementDuration;\r\n\r\n            wouldOverlap = track.elements.some((existingElement) => {\r\n              const existingStart = existingElement.startTime;\r\n              const existingEnd =\r\n                existingElement.startTime +\r\n                (existingElement.duration -\r\n                  existingElement.trimStart -\r\n                  existingElement.trimEnd);\r\n              return snappedTime < existingEnd && newElementEnd > existingStart;\r\n            });\r\n          } else {\r\n            // Media elements\r\n            const mediaItem = mediaItems.find(\r\n              (item) => item.id === dragData.id\r\n            );\r\n            if (mediaItem) {\r\n              const newElementDuration = mediaItem.duration || 5;\r\n              const snappedTime = getDropSnappedTime(\r\n                dropTime,\r\n                newElementDuration\r\n              );\r\n              const newElementEnd = snappedTime + newElementDuration;\r\n\r\n              wouldOverlap = track.elements.some((existingElement) => {\r\n                const existingStart = existingElement.startTime;\r\n                const existingEnd =\r\n                  existingElement.startTime +\r\n                  (existingElement.duration -\r\n                    existingElement.trimStart -\r\n                    existingElement.trimEnd);\r\n                return (\r\n                  snappedTime < existingEnd && newElementEnd > existingStart\r\n                );\r\n              });\r\n            }\r\n          }\r\n        }\r\n      } catch (error) {\r\n        // Continue with default behavior\r\n      }\r\n    } else if (hasTimelineElement) {\r\n      try {\r\n        const timelineElementData = e.dataTransfer.getData(\r\n          \"application/x-timeline-element\"\r\n        );\r\n        if (timelineElementData) {\r\n          const { elementId, trackId: fromTrackId } =\r\n            JSON.parse(timelineElementData);\r\n          const sourceTrack = tracks.find(\r\n            (t: TimelineTrack) => t.id === fromTrackId\r\n          );\r\n          const movingElement = sourceTrack?.elements.find(\r\n            (c: any) => c.id === elementId\r\n          );\r\n\r\n          if (movingElement) {\r\n            const movingElementDuration =\r\n              movingElement.duration -\r\n              movingElement.trimStart -\r\n              movingElement.trimEnd;\r\n            const snappedTime = getDropSnappedTime(\r\n              dropTime,\r\n              movingElementDuration,\r\n              elementId\r\n            );\r\n            const movingElementEnd = snappedTime + movingElementDuration;\r\n\r\n            wouldOverlap = track.elements.some((existingElement) => {\r\n              if (fromTrackId === track.id && existingElement.id === elementId)\r\n                return false;\r\n\r\n              const existingStart = existingElement.startTime;\r\n              const existingEnd =\r\n                existingElement.startTime +\r\n                (existingElement.duration -\r\n                  existingElement.trimStart -\r\n                  existingElement.trimEnd);\r\n              return (\r\n                snappedTime < existingEnd && movingElementEnd > existingStart\r\n              );\r\n            });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        // Continue with default behavior\r\n      }\r\n    }\r\n\r\n    if (wouldOverlap) {\r\n      e.dataTransfer.dropEffect = \"none\";\r\n      setWouldOverlap(true);\r\n      // Use default duration for position indicator\r\n      setDropPosition(getDropSnappedTime(dropTime, 5));\r\n      return;\r\n    }\r\n\r\n    e.dataTransfer.dropEffect = hasTimelineElement ? \"move\" : \"copy\";\r\n    setWouldOverlap(false);\r\n    // Use default duration for position indicator\r\n    setDropPosition(getDropSnappedTime(dropTime, 5));\r\n  };\r\n\r\n  const handleTrackDragEnter = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n\r\n    const hasTimelineElement = e.dataTransfer.types.includes(\r\n      \"application/x-timeline-element\"\r\n    );\r\n    const hasMediaItem = e.dataTransfer.types.includes(\r\n      \"application/x-media-item\"\r\n    );\r\n\r\n    if (!hasTimelineElement && !hasMediaItem) return;\r\n\r\n    dragCounterRef.current++;\r\n    setIsDropping(true);\r\n  };\r\n\r\n  const handleTrackDragLeave = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n\r\n    const hasTimelineElement = e.dataTransfer.types.includes(\r\n      \"application/x-timeline-element\"\r\n    );\r\n    const hasMediaItem = e.dataTransfer.types.includes(\r\n      \"application/x-media-item\"\r\n    );\r\n\r\n    if (!hasTimelineElement && !hasMediaItem) return;\r\n\r\n    dragCounterRef.current--;\r\n\r\n    if (dragCounterRef.current === 0) {\r\n      setIsDropping(false);\r\n      setWouldOverlap(false);\r\n      setDropPosition(null);\r\n    }\r\n  };\r\n\r\n  const handleTrackDrop = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    // Debug logging\r\n    console.log(\r\n      JSON.stringify({\r\n        message: \"Drop event started in timeline track\",\r\n        dataTransferTypes: Array.from(e.dataTransfer.types),\r\n        trackId: track.id,\r\n        trackType: track.type,\r\n      })\r\n    );\r\n\r\n    // Reset all drag states\r\n    dragCounterRef.current = 0;\r\n    setIsDropping(false);\r\n    setWouldOverlap(false);\r\n\r\n    const hasTimelineElement = e.dataTransfer.types.includes(\r\n      \"application/x-timeline-element\"\r\n    );\r\n    const hasMediaItem = e.dataTransfer.types.includes(\r\n      \"application/x-media-item\"\r\n    );\r\n    const hasFiles = e.dataTransfer.files?.length > 0;\r\n\r\n    if (!hasTimelineElement && !hasMediaItem && !hasFiles) return;\r\n\r\n    const trackContainer = e.currentTarget.querySelector(\r\n      \".track-elements-container\"\r\n    ) as HTMLElement;\r\n    if (!trackContainer) return;\r\n\r\n    const rect = trackContainer.getBoundingClientRect();\r\n    const mouseX = Math.max(0, e.clientX - rect.left);\r\n    const mouseY = e.clientY - rect.top; // Get Y position relative to this track\r\n    const newStartTime =\r\n      mouseX / (TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel);\r\n    const projectStore = useProjectStore.getState();\r\n    const projectFps = projectStore.activeProject?.fps || 30;\r\n    const snappedTime = snapTimeToFrame(newStartTime, projectFps);\r\n\r\n    // Calculate drop position relative to tracks\r\n    const currentTrackIndex = tracks.findIndex((t) => t.id === track.id);\r\n\r\n    // Determine drop zone within the track (top 20px, middle 20px, bottom 20px)\r\n    let dropPosition: \"above\" | \"on\" | \"below\";\r\n    if (mouseY < 20) {\r\n      dropPosition = \"above\";\r\n    } else if (mouseY > 40) {\r\n      dropPosition = \"below\";\r\n    } else {\r\n      dropPosition = \"on\";\r\n    }\r\n\r\n    try {\r\n      if (hasTimelineElement) {\r\n        // Handle timeline element movement\r\n        const timelineElementData = e.dataTransfer.getData(\r\n          \"application/x-timeline-element\"\r\n        );\r\n        if (!timelineElementData) return;\r\n\r\n        const {\r\n          elementId,\r\n          trackId: fromTrackId,\r\n          clickOffsetTime = 0,\r\n        } = JSON.parse(timelineElementData);\r\n\r\n        // Find the element being moved\r\n        const sourceTrack = tracks.find(\r\n          (t: TimelineTrack) => t.id === fromTrackId\r\n        );\r\n        const movingElement = sourceTrack?.elements.find(\r\n          (c: TimelineElementType) => c.id === elementId\r\n        );\r\n\r\n        if (!movingElement) {\r\n          toast.error(\"Element not found\");\r\n          return;\r\n        }\r\n\r\n        // Check for overlaps with existing elements (excluding the moving element itself)\r\n        const movingElementDuration =\r\n          movingElement.duration -\r\n          movingElement.trimStart -\r\n          movingElement.trimEnd;\r\n\r\n        // Adjust position based on where user clicked on the element\r\n        const adjustedStartTime = newStartTime - clickOffsetTime;\r\n        const snappedStartTime = getDropSnappedTime(\r\n          adjustedStartTime,\r\n          movingElementDuration,\r\n          elementId\r\n        );\r\n        const finalStartTime = Math.max(0, snappedStartTime);\r\n        const movingElementEnd = finalStartTime + movingElementDuration;\r\n\r\n        const hasOverlap = track.elements.some((existingElement) => {\r\n          // Skip the element being moved if it's on the same track\r\n          if (fromTrackId === track.id && existingElement.id === elementId)\r\n            return false;\r\n\r\n          const existingStart = existingElement.startTime;\r\n          const existingEnd =\r\n            existingElement.startTime +\r\n            (existingElement.duration -\r\n              existingElement.trimStart -\r\n              existingElement.trimEnd);\r\n\r\n          // Check if elements overlap\r\n          return (\r\n            finalStartTime < existingEnd && movingElementEnd > existingStart\r\n          );\r\n        });\r\n\r\n        if (hasOverlap) {\r\n          toast.error(\r\n            \"Cannot move element here - it would overlap with existing elements\"\r\n          );\r\n          return;\r\n        }\r\n\r\n        if (fromTrackId === track.id) {\r\n          // Moving within same track\r\n          if (rippleEditingEnabled) {\r\n            updateElementStartTimeWithRipple(\r\n              track.id,\r\n              elementId,\r\n              finalStartTime\r\n            );\r\n          } else {\r\n            updateElementStartTime(track.id, elementId, finalStartTime);\r\n          }\r\n        } else {\r\n          // Moving to different track\r\n          moveElementToTrack(fromTrackId, track.id, elementId);\r\n          requestAnimationFrame(() => {\r\n            if (rippleEditingEnabled) {\r\n              updateElementStartTimeWithRipple(\r\n                track.id,\r\n                elementId,\r\n                finalStartTime\r\n              );\r\n            } else {\r\n              updateElementStartTime(track.id, elementId, finalStartTime);\r\n            }\r\n          });\r\n        }\r\n      } else if (hasMediaItem) {\r\n        // Handle media item drop\r\n        const mediaItemData = e.dataTransfer.getData(\r\n          \"application/x-media-item\"\r\n        );\r\n        if (!mediaItemData) return;\r\n\r\n        const dragData: DragData = JSON.parse(mediaItemData);\r\n\r\n        if (dragData.type === \"text\") {\r\n          let targetTrackId = track.id;\r\n          let targetTrack = track;\r\n\r\n          // Handle position-aware track creation for text\r\n          if (track.type !== \"text\" || dropPosition !== \"on\") {\r\n            // Text tracks should go above the main track\r\n            const mainTrack = getMainTrack(tracks);\r\n            let insertIndex: number;\r\n\r\n            if (dropPosition === \"above\") {\r\n              insertIndex = currentTrackIndex;\r\n            } else if (dropPosition === \"below\") {\r\n              insertIndex = currentTrackIndex + 1;\r\n            } else {\r\n              // dropPosition === \"on\" but track is not text type\r\n              // Insert above main track if main track exists, otherwise at top\r\n              if (mainTrack) {\r\n                const mainTrackIndex = tracks.findIndex(\r\n                  (t) => t.id === mainTrack.id\r\n                );\r\n                insertIndex = mainTrackIndex;\r\n              } else {\r\n                insertIndex = 0; // Top of timeline\r\n              }\r\n            }\r\n\r\n            targetTrackId = insertTrackAt(\"text\", insertIndex);\r\n            // Get the updated tracks array after creating the new track\r\n            const updatedTracks = useTimelineStore.getState().tracks;\r\n            const newTargetTrack = updatedTracks.find(\r\n              (t) => t.id === targetTrackId\r\n            );\r\n            if (!newTargetTrack) return;\r\n            targetTrack = newTargetTrack;\r\n          }\r\n\r\n          // Check for overlaps with existing elements in target track\r\n          const newElementDuration = 5; // Default text duration\r\n          const textSnappedTime = getDropSnappedTime(\r\n            newStartTime,\r\n            newElementDuration\r\n          );\r\n          const newElementEnd = textSnappedTime + newElementDuration;\r\n\r\n          const hasOverlap = targetTrack.elements.some((existingElement) => {\r\n            const existingStart = existingElement.startTime;\r\n            const existingEnd =\r\n              existingElement.startTime +\r\n              (existingElement.duration -\r\n                existingElement.trimStart -\r\n                existingElement.trimEnd);\r\n\r\n            // Check if elements overlap\r\n            return (\r\n              textSnappedTime < existingEnd && newElementEnd > existingStart\r\n            );\r\n          });\r\n\r\n          if (hasOverlap) {\r\n            toast.error(\r\n              \"Cannot place element here - it would overlap with existing elements\"\r\n            );\r\n            return;\r\n          }\r\n\r\n          addElementToTrack(targetTrackId, {\r\n            type: \"text\",\r\n            name: dragData.name || \"Text\",\r\n            content: dragData.content || \"Default Text\",\r\n            duration: TIMELINE_CONSTANTS.DEFAULT_TEXT_DURATION,\r\n            startTime: textSnappedTime,\r\n            trimStart: 0,\r\n            trimEnd: 0,\r\n            fontSize: 48,\r\n            fontFamily: \"Arial\",\r\n            color: \"#ffffff\",\r\n            backgroundColor: \"transparent\",\r\n            textAlign: \"center\",\r\n            fontWeight: \"normal\",\r\n            fontStyle: \"normal\",\r\n            textDecoration: \"none\",\r\n            x: 0,\r\n            y: 0,\r\n            rotation: 0,\r\n            opacity: 1,\r\n          });\r\n        } else {\r\n          // Handle media items\r\n          const mediaItem = mediaItems.find((item) => item.id === dragData.id);\r\n\r\n          if (!mediaItem) {\r\n            toast.error(\"Media item not found\");\r\n            return;\r\n          }\r\n\r\n          let targetTrackId = track.id;\r\n\r\n          // Check if track type is compatible\r\n          const isVideoOrImage =\r\n            dragData.type === \"video\" || dragData.type === \"image\";\r\n          const isAudio = dragData.type === \"audio\";\r\n          const isCompatible = isVideoOrImage\r\n            ? canElementGoOnTrack(\"media\", track.type)\r\n            : isAudio\r\n              ? canElementGoOnTrack(\"media\", track.type)\r\n              : false;\r\n\r\n          let targetTrack = tracks.find((t) => t.id === targetTrackId);\r\n\r\n          // Handle position-aware track creation for media elements\r\n          if (!isCompatible || dropPosition !== \"on\") {\r\n            if (isVideoOrImage) {\r\n              // For video/image, check if we need a main track or additional media track\r\n              const mainTrack = getMainTrack(tracks);\r\n\r\n              if (!mainTrack) {\r\n                // No main track exists, create it\r\n                targetTrackId = addTrack(\"media\");\r\n                const updatedTracks = useTimelineStore.getState().tracks;\r\n                const newTargetTrack = updatedTracks.find(\r\n                  (t) => t.id === targetTrackId\r\n                );\r\n                if (!newTargetTrack) return;\r\n                targetTrack = newTargetTrack;\r\n              } else if (\r\n                mainTrack.elements.length === 0 &&\r\n                dropPosition === \"on\"\r\n              ) {\r\n                // Main track exists and is empty, use it\r\n                targetTrackId = mainTrack.id;\r\n                targetTrack = mainTrack;\r\n              } else {\r\n                // Create new media track\r\n                let insertIndex: number;\r\n\r\n                if (dropPosition === \"above\") {\r\n                  insertIndex = currentTrackIndex;\r\n                } else if (dropPosition === \"below\") {\r\n                  insertIndex = currentTrackIndex + 1;\r\n                } else {\r\n                  // Insert above main track\r\n                  const mainTrackIndex = tracks.findIndex(\r\n                    (t) => t.id === mainTrack.id\r\n                  );\r\n                  insertIndex = mainTrackIndex;\r\n                }\r\n\r\n                targetTrackId = insertTrackAt(\"media\", insertIndex);\r\n                const updatedTracks = useTimelineStore.getState().tracks;\r\n                const newTargetTrack = updatedTracks.find(\r\n                  (t) => t.id === targetTrackId\r\n                );\r\n                if (!newTargetTrack) return;\r\n                targetTrack = newTargetTrack;\r\n              }\r\n            } else if (isAudio) {\r\n              // Audio tracks go at the bottom\r\n              const mainTrack = getMainTrack(tracks);\r\n              let insertIndex: number;\r\n\r\n              if (dropPosition === \"above\") {\r\n                insertIndex = currentTrackIndex;\r\n              } else if (dropPosition === \"below\") {\r\n                insertIndex = currentTrackIndex + 1;\r\n              } else {\r\n                // Insert after main track (bottom area)\r\n                if (mainTrack) {\r\n                  const mainTrackIndex = tracks.findIndex(\r\n                    (t) => t.id === mainTrack.id\r\n                  );\r\n                  insertIndex = mainTrackIndex + 1;\r\n                } else {\r\n                  insertIndex = tracks.length; // Bottom of timeline\r\n                }\r\n              }\r\n\r\n              targetTrackId = insertTrackAt(\"audio\", insertIndex);\r\n              const updatedTracks = useTimelineStore.getState().tracks;\r\n              const newTargetTrack = updatedTracks.find(\r\n                (t) => t.id === targetTrackId\r\n              );\r\n              if (!newTargetTrack) return;\r\n              targetTrack = newTargetTrack;\r\n            }\r\n          }\r\n\r\n          if (!targetTrack) return;\r\n\r\n          // Check for overlaps with existing elements in target track\r\n          const newElementDuration = mediaItem.duration || 5;\r\n          const mediaSnappedTime = getDropSnappedTime(\r\n            newStartTime,\r\n            newElementDuration\r\n          );\r\n          const newElementEnd = mediaSnappedTime + newElementDuration;\r\n\r\n          const hasOverlap = targetTrack.elements.some((existingElement) => {\r\n            const existingStart = existingElement.startTime;\r\n            const existingEnd =\r\n              existingElement.startTime +\r\n              (existingElement.duration -\r\n                existingElement.trimStart -\r\n                existingElement.trimEnd);\r\n\r\n            // Check if elements overlap\r\n            return (\r\n              mediaSnappedTime < existingEnd && newElementEnd > existingStart\r\n            );\r\n          });\r\n\r\n          if (hasOverlap) {\r\n            toast.error(\r\n              \"Cannot place element here - it would overlap with existing elements\"\r\n            );\r\n            return;\r\n          }\r\n\r\n          addElementToTrack(targetTrackId, {\r\n            type: \"media\",\r\n            mediaId: mediaItem.id,\r\n            name: mediaItem.name,\r\n            duration: mediaItem.duration || 5,\r\n            startTime: mediaSnappedTime,\r\n            trimStart: 0,\r\n            trimEnd: 0,\r\n          });\r\n        }\r\n      } else if (hasFiles) {\r\n        // External file drops\r\n        const { activeProject } = useProjectStore.getState();\r\n        const { addMediaItem } = useMediaStore.getState();\r\n        const { addElementToTrack } = useTimelineStore.getState();\r\n\r\n        if (!activeProject) {\r\n          toast.error(\"No active project\");\r\n          return;\r\n        }\r\n\r\n        // Process and add files to new timeline tracks at playhead position\r\n        processMediaFiles(e.dataTransfer.files)\r\n          .then(async (processedItems) => {\r\n            for (const processedItem of processedItems) {\r\n              await addMediaItem(activeProject.id, processedItem);\r\n              const currentMediaItems = useMediaStore.getState().mediaItems;\r\n              const addedItem = currentMediaItems.find(\r\n                (item) =>\r\n                  item.name === processedItem.name &&\r\n                  item.url === processedItem.url\r\n              );\r\n\r\n              if (addedItem) {\r\n                const trackType: TrackType =\r\n                  addedItem.type === \"audio\" ? \"audio\" : \"media\";\r\n                const targetTrackId = insertTrackAt(trackType, 0);\r\n\r\n                addElementToTrack(targetTrackId, {\r\n                  type: \"media\",\r\n                  mediaId: addedItem.id,\r\n                  name: addedItem.name,\r\n                  duration: addedItem.duration || 5,\r\n                  startTime: currentTime,\r\n                  trimStart: 0,\r\n                  trimEnd: 0,\r\n                });\r\n              }\r\n            }\r\n          })\r\n          .catch((error) => {\r\n            console.error(\"Error processing external files:\", error);\r\n            toast.error(\"Failed to process dropped files\");\r\n          });\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error handling drop:\", error);\r\n      toast.error(\"Failed to add media to track\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className=\"w-full h-full hover:bg-muted/20\"\r\n      onClick={(e) => {\r\n        // If clicking empty area (not on an element), deselect all elements\r\n        if (!(e.target as HTMLElement).closest(\".timeline-element\")) {\r\n          clearSelectedElements();\r\n        }\r\n      }}\r\n      onDragOver={handleTrackDragOver}\r\n      onDragEnter={handleTrackDragEnter}\r\n      onDragLeave={handleTrackDragLeave}\r\n      onDrop={handleTrackDrop}\r\n    >\r\n      <div\r\n        ref={timelineRef}\r\n        className=\"h-full relative track-elements-container min-w-full\"\r\n      >\r\n        {track.elements.length === 0 ? (\r\n          <div\r\n            className={`h-full w-full rounded-sm border-2 border-dashed flex items-center justify-center text-xs text-muted-foreground transition-colors ${\r\n              isDropping\r\n                ? wouldOverlap\r\n                  ? \"border-red-500 bg-red-500/10 text-red-600\"\r\n                  : \"border-blue-500 bg-blue-500/10 text-blue-600\"\r\n                : \"border-muted/30\"\r\n            }`}\r\n          >\r\n            {isDropping\r\n              ? wouldOverlap\r\n                ? \"Cannot drop - would overlap\"\r\n                : \"Drop element here\"\r\n              : \"\"}\r\n          </div>\r\n        ) : (\r\n          <>\r\n            {track.elements.map((element) => {\r\n              const isSelected = selectedElements.some(\r\n                (c) => c.trackId === track.id && c.elementId === element.id\r\n              );\r\n\r\n              const handleElementSplit = () => {\r\n                const { currentTime } = usePlaybackStore();\r\n                const { splitElement } = useTimelineStore();\r\n                const splitTime = currentTime;\r\n                const effectiveStart = element.startTime;\r\n                const effectiveEnd =\r\n                  element.startTime +\r\n                  (element.duration - element.trimStart - element.trimEnd);\r\n\r\n                if (splitTime > effectiveStart && splitTime < effectiveEnd) {\r\n                  const secondElementId = splitElement(\r\n                    track.id,\r\n                    element.id,\r\n                    splitTime\r\n                  );\r\n                  if (!secondElementId) {\r\n                    toast.error(\"Failed to split element\");\r\n                  }\r\n                } else {\r\n                  toast.error(\"Playhead must be within element to split\");\r\n                }\r\n              };\r\n\r\n              const handleElementDuplicate = () => {\r\n                const { addElementToTrack } = useTimelineStore.getState();\r\n                const { id, ...elementWithoutId } = element;\r\n                addElementToTrack(track.id, {\r\n                  ...elementWithoutId,\r\n                  name: element.name + \" (copy)\",\r\n                  startTime:\r\n                    element.startTime +\r\n                    (element.duration - element.trimStart - element.trimEnd) +\r\n                    0.1,\r\n                });\r\n              };\r\n\r\n              const handleElementDelete = () => {\r\n                const { removeElementFromTrack } = useTimelineStore.getState();\r\n                removeElementFromTrack(track.id, element.id);\r\n              };\r\n\r\n              return (\r\n                <TimelineElement\r\n                  key={element.id}\r\n                  element={element}\r\n                  track={track}\r\n                  zoomLevel={zoomLevel}\r\n                  isSelected={isSelected}\r\n                  onElementMouseDown={handleElementMouseDown}\r\n                  onElementClick={handleElementClick}\r\n                />\r\n              );\r\n            })}\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { snapTimeToFrame } from \"@/constants/timeline-constants\";\r\nimport { useProjectStore } from \"@/stores/project-store\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\nimport { useState, useEffect, useCallback, useRef } from \"react\";\r\n\r\ninterface UseTimelinePlayheadProps {\r\n  currentTime: number;\r\n  duration: number;\r\n  zoomLevel: number;\r\n  seek: (time: number) => void;\r\n  rulerRef: React.RefObject<HTMLDivElement>;\r\n  rulerScrollRef: React.RefObject<HTMLDivElement>;\r\n  tracksScrollRef: React.RefObject<HTMLDivElement>;\r\n  playheadRef?: React.RefObject<HTMLDivElement>;\r\n}\r\n\r\nexport function useTimelinePlayhead({\r\n  currentTime,\r\n  duration,\r\n  zoomLevel,\r\n  seek,\r\n  rulerRef,\r\n  rulerScrollRef,\r\n  tracksScrollRef,\r\n  playheadRef,\r\n}: UseTimelinePlayheadProps) {\r\n  // Playhead scrubbing state\r\n  const [isScrubbing, setIsScrubbing] = useState(false);\r\n  const [scrubTime, setScrubTime] = useState<number | null>(null);\r\n\r\n  // Ruler drag detection state\r\n  const [isDraggingRuler, setIsDraggingRuler] = useState(false);\r\n  const [hasDraggedRuler, setHasDraggedRuler] = useState(false);\r\n\r\n  // Auto-scroll state during dragging\r\n  const autoScrollRef = useRef<number | null>(null);\r\n  const lastMouseXRef = useRef<number>(0);\r\n\r\n  const playheadPosition =\r\n    isScrubbing && scrubTime !== null ? scrubTime : currentTime;\r\n\r\n  // --- Playhead Scrubbing Handlers ---\r\n  const handlePlayheadMouseDown = useCallback(\r\n    (e: React.MouseEvent) => {\r\n      e.preventDefault();\r\n      e.stopPropagation(); // Prevent ruler drag from triggering\r\n      setIsScrubbing(true);\r\n      handleScrub(e);\r\n    },\r\n    [duration, zoomLevel]\r\n  );\r\n\r\n  // Ruler mouse down handler\r\n  const handleRulerMouseDown = useCallback(\r\n    (e: React.MouseEvent) => {\r\n      // Only handle left mouse button\r\n      if (e.button !== 0) return;\r\n\r\n      // Don't interfere if clicking on the playhead itself\r\n      if (playheadRef?.current?.contains(e.target as Node)) return;\r\n\r\n      e.preventDefault();\r\n      setIsDraggingRuler(true);\r\n      setHasDraggedRuler(false);\r\n\r\n      // Start scrubbing immediately\r\n      setIsScrubbing(true);\r\n      handleScrub(e);\r\n    },\r\n    [duration, zoomLevel]\r\n  );\r\n\r\n  const handleScrub = useCallback(\r\n    (e: MouseEvent | React.MouseEvent) => {\r\n      const ruler = rulerRef.current;\r\n      if (!ruler) return;\r\n      const rect = ruler.getBoundingClientRect();\r\n      const rawX = e.clientX - rect.left;\r\n\r\n      // Get the timeline content width based on duration and zoom\r\n      const timelineContentWidth = duration * 50 * zoomLevel; // TIMELINE_CONSTANTS.PIXELS_PER_SECOND = 50\r\n\r\n      // Constrain x to be within the timeline content bounds\r\n      const x = Math.max(0, Math.min(timelineContentWidth, rawX));\r\n\r\n      const rawTime = Math.max(0, Math.min(duration, x / (50 * zoomLevel)));\r\n      // Use frame snapping for playhead scrubbing\r\n      const projectStore = useProjectStore.getState();\r\n      const projectFps = projectStore.activeProject?.fps || 30;\r\n      const time = snapTimeToFrame(rawTime, projectFps);\r\n\r\n      // Debug logging\r\n      if (rawX < 0 || x !== rawX) {\r\n        console.log(\r\n          \"PLAYHEAD DEBUG:\",\r\n          JSON.stringify({\r\n            mouseX: e.clientX,\r\n            rulerLeft: rect.left,\r\n            rawX,\r\n            constrainedX: x,\r\n            timelineContentWidth,\r\n            rawTime,\r\n            finalTime: time,\r\n            duration,\r\n            zoomLevel,\r\n            playheadPx: time * 50 * zoomLevel,\r\n          })\r\n        );\r\n      }\r\n\r\n      setScrubTime(time);\r\n      seek(time); // update video preview in real time\r\n\r\n      // Store mouse position for auto-scrolling\r\n      lastMouseXRef.current = e.clientX;\r\n    },\r\n    [duration, zoomLevel, seek, rulerRef]\r\n  );\r\n\r\n  // Auto-scroll function during dragging\r\n  const performAutoScroll = useCallback(() => {\r\n    const rulerViewport = rulerScrollRef.current;\r\n    const tracksViewport = tracksScrollRef.current;\r\n\r\n    if (!rulerViewport || !tracksViewport || !isScrubbing) return;\r\n\r\n    const viewportRect = rulerViewport.getBoundingClientRect();\r\n    const mouseX = lastMouseXRef.current;\r\n    const mouseXRelative = mouseX - viewportRect.left;\r\n\r\n    const edgeThreshold = 100; // pixels from edge to start scrolling\r\n    const maxScrollSpeed = 15; // max pixels per frame\r\n    const viewportWidth = rulerViewport.clientWidth;\r\n\r\n    // Calculate timeline content boundaries\r\n    const timelineContentWidth = duration * 50 * zoomLevel; // TIMELINE_CONSTANTS.PIXELS_PER_SECOND = 50\r\n    const scrollMax = Math.max(0, timelineContentWidth - viewportWidth);\r\n\r\n    let scrollSpeed = 0;\r\n\r\n    // Check if near left edge (and can scroll left)\r\n    if (mouseXRelative < edgeThreshold && rulerViewport.scrollLeft > 0) {\r\n      const edgeDistance = Math.max(0, mouseXRelative);\r\n      const intensity = 1 - edgeDistance / edgeThreshold;\r\n      scrollSpeed = -maxScrollSpeed * intensity;\r\n    }\r\n    // Check if near right edge (and can scroll right, and haven't reached timeline end)\r\n    else if (\r\n      mouseXRelative > viewportWidth - edgeThreshold &&\r\n      rulerViewport.scrollLeft < scrollMax\r\n    ) {\r\n      const edgeDistance = Math.max(\r\n        0,\r\n        viewportWidth - edgeThreshold - mouseXRelative\r\n      );\r\n      const intensity = 1 - edgeDistance / edgeThreshold;\r\n      scrollSpeed = maxScrollSpeed * intensity;\r\n    }\r\n\r\n    if (scrollSpeed !== 0) {\r\n      const newScrollLeft = Math.max(\r\n        0,\r\n        Math.min(scrollMax, rulerViewport.scrollLeft + scrollSpeed)\r\n      );\r\n      rulerViewport.scrollLeft = newScrollLeft;\r\n      tracksViewport.scrollLeft = newScrollLeft;\r\n    }\r\n\r\n    if (isScrubbing) {\r\n      autoScrollRef.current = requestAnimationFrame(performAutoScroll);\r\n    }\r\n  }, [isScrubbing, rulerScrollRef, tracksScrollRef, duration, zoomLevel]);\r\n\r\n  // Mouse move/up event handlers\r\n  useEffect(() => {\r\n    if (!isScrubbing) return;\r\n\r\n    const onMouseMove = (e: MouseEvent) => {\r\n      handleScrub(e);\r\n      // Mark that we've dragged if ruler drag is active\r\n      if (isDraggingRuler) {\r\n        setHasDraggedRuler(true);\r\n      }\r\n    };\r\n\r\n    const onMouseUp = (e: MouseEvent) => {\r\n      setIsScrubbing(false);\r\n      if (scrubTime !== null) seek(scrubTime); // finalize seek\r\n      setScrubTime(null);\r\n\r\n      // Stop auto-scrolling\r\n      if (autoScrollRef.current) {\r\n        cancelAnimationFrame(autoScrollRef.current);\r\n        autoScrollRef.current = null;\r\n      }\r\n\r\n      // Handle ruler click vs drag\r\n      if (isDraggingRuler) {\r\n        setIsDraggingRuler(false);\r\n        // If we didn't drag, treat it as a click-to-seek\r\n        if (!hasDraggedRuler) {\r\n          handleScrub(e);\r\n        }\r\n        setHasDraggedRuler(false);\r\n      }\r\n    };\r\n\r\n    window.addEventListener(\"mousemove\", onMouseMove);\r\n    window.addEventListener(\"mouseup\", onMouseUp);\r\n\r\n    // Start auto-scrolling\r\n    autoScrollRef.current = requestAnimationFrame(performAutoScroll);\r\n\r\n    return () => {\r\n      window.removeEventListener(\"mousemove\", onMouseMove);\r\n      window.removeEventListener(\"mouseup\", onMouseUp);\r\n      if (autoScrollRef.current) {\r\n        cancelAnimationFrame(autoScrollRef.current);\r\n        autoScrollRef.current = null;\r\n      }\r\n    };\r\n  }, [\r\n    isScrubbing,\r\n    scrubTime,\r\n    seek,\r\n    handleScrub,\r\n    isDraggingRuler,\r\n    hasDraggedRuler,\r\n    performAutoScroll,\r\n  ]);\r\n\r\n  // --- Playhead auto-scroll effect (only during playback) ---\r\n  useEffect(() => {\r\n    const { isPlaying } = usePlaybackStore.getState();\r\n\r\n    // Only auto-scroll during playback, not during manual interactions\r\n    if (!isPlaying || isScrubbing) return;\r\n\r\n    const rulerViewport = rulerScrollRef.current;\r\n    const tracksViewport = tracksScrollRef.current;\r\n    if (!rulerViewport || !tracksViewport) return;\r\n\r\n    const playheadPx = playheadPosition * 50 * zoomLevel; // TIMELINE_CONSTANTS.PIXELS_PER_SECOND = 50\r\n    const viewportWidth = rulerViewport.clientWidth;\r\n    const scrollMin = 0;\r\n    const scrollMax = rulerViewport.scrollWidth - viewportWidth;\r\n\r\n    // Only auto-scroll if playhead is completely out of view (no buffer)\r\n    const needsScroll =\r\n      playheadPx < rulerViewport.scrollLeft ||\r\n      playheadPx > rulerViewport.scrollLeft + viewportWidth;\r\n\r\n    if (needsScroll) {\r\n      // Center the playhead in the viewport\r\n      const desiredScroll = Math.max(\r\n        scrollMin,\r\n        Math.min(scrollMax, playheadPx - viewportWidth / 2)\r\n      );\r\n      rulerViewport.scrollLeft = tracksViewport.scrollLeft = desiredScroll;\r\n    }\r\n  }, [\r\n    playheadPosition,\r\n    duration,\r\n    zoomLevel,\r\n    rulerScrollRef,\r\n    tracksScrollRef,\r\n    isScrubbing,\r\n  ]);\r\n\r\n  return {\r\n    playheadPosition,\r\n    handlePlayheadMouseDown,\r\n    handleRulerMouseDown,\r\n    isDraggingRuler,\r\n  };\r\n}\r\n","\"use client\";\r\n\r\nimport { useRef, useState, useEffect } from \"react\";\r\nimport { TimelineTrack } from \"@/types/timeline\";\r\nimport { TIMELINE_CONSTANTS } from \"@/constants/timeline-constants\";\r\nimport { useTimelinePlayhead } from \"@/hooks/use-timeline-playhead\";\r\n\r\ninterface TimelinePlayheadProps {\r\n  currentTime: number;\r\n  duration: number;\r\n  zoomLevel: number;\r\n  tracks: TimelineTrack[];\r\n  seek: (time: number) => void;\r\n  rulerRef: React.RefObject<HTMLDivElement>;\r\n  rulerScrollRef: React.RefObject<HTMLDivElement>;\r\n  tracksScrollRef: React.RefObject<HTMLDivElement>;\r\n  trackLabelsRef?: React.RefObject<HTMLDivElement>;\r\n  timelineRef: React.RefObject<HTMLDivElement>;\r\n  playheadRef?: React.RefObject<HTMLDivElement>;\r\n  isSnappingToPlayhead?: boolean;\r\n}\r\n\r\nexport function TimelinePlayhead({\r\n  currentTime,\r\n  duration,\r\n  zoomLevel,\r\n  tracks,\r\n  seek,\r\n  rulerRef,\r\n  rulerScrollRef,\r\n  tracksScrollRef,\r\n  trackLabelsRef,\r\n  timelineRef,\r\n  playheadRef: externalPlayheadRef,\r\n  isSnappingToPlayhead = false,\r\n}: TimelinePlayheadProps) {\r\n  const internalPlayheadRef = useRef<HTMLDivElement>(null);\r\n  const playheadRef = externalPlayheadRef || internalPlayheadRef;\r\n  const [scrollLeft, setScrollLeft] = useState(0);\r\n\r\n  const { playheadPosition, handlePlayheadMouseDown } = useTimelinePlayhead({\r\n    currentTime,\r\n    duration,\r\n    zoomLevel,\r\n    seek,\r\n    rulerRef,\r\n    rulerScrollRef,\r\n    tracksScrollRef,\r\n    playheadRef,\r\n  });\r\n\r\n  // Track scroll position to lock playhead to frame\r\n  useEffect(() => {\r\n    const tracksViewport = tracksScrollRef.current;\r\n\r\n    if (!tracksViewport) return;\r\n\r\n    const handleScroll = () => {\r\n      setScrollLeft(tracksViewport.scrollLeft);\r\n    };\r\n\r\n    // Set initial scroll position\r\n    setScrollLeft(tracksViewport.scrollLeft);\r\n\r\n    tracksViewport.addEventListener(\"scroll\", handleScroll);\r\n    return () => tracksViewport.removeEventListener(\"scroll\", handleScroll);\r\n  }, [tracksScrollRef]);\r\n\r\n  // Use timeline container height minus a few pixels for breathing room\r\n  const timelineContainerHeight = timelineRef.current?.offsetHeight || 400;\r\n  const totalHeight = timelineContainerHeight - 4;\r\n\r\n  // Get dynamic track labels width, fallback to 0 if no tracks or no ref\r\n  const trackLabelsWidth =\r\n    tracks.length > 0 && trackLabelsRef?.current\r\n      ? trackLabelsRef.current.offsetWidth\r\n      : 0;\r\n\r\n  // Calculate position locked to timeline content (accounting for scroll)\r\n  const timelinePosition =\r\n    playheadPosition * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel;\r\n  const rawLeftPosition = trackLabelsWidth + timelinePosition - scrollLeft;\r\n\r\n  // Get the timeline content width and viewport width for right boundary\r\n  const timelineContentWidth =\r\n    duration * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel;\r\n  const tracksViewport = tracksScrollRef.current;\r\n  const viewportWidth = tracksViewport?.clientWidth || 1000;\r\n\r\n  // Constrain playhead to never appear outside the timeline area\r\n  const leftBoundary = trackLabelsWidth;\r\n  const rightBoundary = Math.min(\r\n    trackLabelsWidth + timelineContentWidth - scrollLeft, // Don't go beyond timeline content\r\n    trackLabelsWidth + viewportWidth // Don't go beyond viewport\r\n  );\r\n\r\n  const leftPosition = Math.max(\r\n    leftBoundary,\r\n    Math.min(rightBoundary, rawLeftPosition)\r\n  );\r\n\r\n  // Debug logging when playhead might go outside\r\n  if (rawLeftPosition < leftBoundary || rawLeftPosition > rightBoundary) {\r\n    console.log(\r\n      \"PLAYHEAD VISUAL DEBUG:\",\r\n      JSON.stringify({\r\n        playheadPosition,\r\n        timelinePosition,\r\n        trackLabelsWidth,\r\n        scrollLeft,\r\n        rawLeftPosition,\r\n        constrainedLeftPosition: leftPosition,\r\n        leftBoundary,\r\n        rightBoundary,\r\n        timelineContentWidth,\r\n        viewportWidth,\r\n        zoomLevel,\r\n      })\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div\r\n      ref={playheadRef}\r\n      className=\"absolute pointer-events-auto z-40\"\r\n      style={{\r\n        left: `${leftPosition}px`,\r\n        top: 0,\r\n        height: `${totalHeight}px`,\r\n        width: \"2px\", // Slightly wider for better click target\r\n      }}\r\n      onMouseDown={handlePlayheadMouseDown}\r\n    >\r\n      {/* The playhead line spanning full height */}\r\n      <div\r\n        className={`absolute left-0 w-0.5 cursor-col-resize h-full ${isSnappingToPlayhead ? \"bg-foreground\" : \"bg-foreground\"}`}\r\n      />\r\n\r\n      {/* Playhead dot indicator at the top (in ruler area) */}\r\n      <div\r\n        className={`absolute top-1 left-1/2 transform -translate-x-1/2 w-3 h-3 rounded-full border-2 shadow-xs ${isSnappingToPlayhead ? \"bg-foreground border-foreground\" : \"bg-foreground border-foreground/50\"}`}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\n// Also export a hook for getting ruler handlers\r\nexport function useTimelinePlayheadRuler({\r\n  currentTime,\r\n  duration,\r\n  zoomLevel,\r\n  seek,\r\n  rulerRef,\r\n  rulerScrollRef,\r\n  tracksScrollRef,\r\n  playheadRef,\r\n}: Omit<TimelinePlayheadProps, \"tracks\" | \"trackLabelsRef\" | \"timelineRef\">) {\r\n  const { handleRulerMouseDown, isDraggingRuler } = useTimelinePlayhead({\r\n    currentTime,\r\n    duration,\r\n    zoomLevel,\r\n    seek,\r\n    rulerRef,\r\n    rulerScrollRef,\r\n    tracksScrollRef,\r\n    playheadRef,\r\n  });\r\n\r\n  return { handleRulerMouseDown, isDraggingRuler };\r\n}\r\n\r\nexport { TimelinePlayhead as default };\r\n","\"use client\";\r\n\r\nimport { useEffect, useRef } from \"react\";\r\n\r\ninterface SelectionBoxProps {\r\n  startPos: { x: number; y: number } | null;\r\n  currentPos: { x: number; y: number } | null;\r\n  containerRef: React.RefObject<HTMLElement>;\r\n  isActive: boolean;\r\n}\r\n\r\nexport function SelectionBox({\r\n  startPos,\r\n  currentPos,\r\n  containerRef,\r\n  isActive,\r\n}: SelectionBoxProps) {\r\n  const selectionBoxRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    if (!isActive || !startPos || !currentPos || !containerRef.current) return;\r\n\r\n    const container = containerRef.current;\r\n    const containerRect = container.getBoundingClientRect();\r\n\r\n    // Calculate relative positions within the container\r\n    const startX = startPos.x - containerRect.left;\r\n    const startY = startPos.y - containerRect.top;\r\n    const currentX = currentPos.x - containerRect.left;\r\n    const currentY = currentPos.y - containerRect.top;\r\n\r\n    // Calculate the selection rectangle bounds\r\n    const left = Math.min(startX, currentX);\r\n    const top = Math.min(startY, currentY);\r\n    const width = Math.abs(currentX - startX);\r\n    const height = Math.abs(currentY - startY);\r\n\r\n    // Update the selection box position and size\r\n    if (selectionBoxRef.current) {\r\n      selectionBoxRef.current.style.left = `${left}px`;\r\n      selectionBoxRef.current.style.top = `${top}px`;\r\n      selectionBoxRef.current.style.width = `${width}px`;\r\n      selectionBoxRef.current.style.height = `${height}px`;\r\n    }\r\n  }, [startPos, currentPos, isActive, containerRef]);\r\n\r\n  if (!isActive || !startPos || !currentPos) return null;\r\n\r\n  return (\r\n    <div\r\n      ref={selectionBoxRef}\r\n      className=\"absolute pointer-events-none z-50 bg-foreground/10\"\r\n    />\r\n  );\r\n}\r\n","import { useState, useEffect, useCallback } from \"react\";\r\n\r\ninterface UseSelectionBoxProps {\r\n  containerRef: React.RefObject<HTMLElement>;\r\n  playheadRef?: React.RefObject<HTMLElement>;\r\n  onSelectionComplete: (\r\n    elements: { trackId: string; elementId: string }[]\r\n  ) => void;\r\n  isEnabled?: boolean;\r\n}\r\n\r\ninterface SelectionBoxState {\r\n  startPos: { x: number; y: number };\r\n  currentPos: { x: number; y: number };\r\n  isActive: boolean;\r\n}\r\n\r\nexport function useSelectionBox({\r\n  containerRef,\r\n  playheadRef,\r\n  onSelectionComplete,\r\n  isEnabled = true,\r\n}: UseSelectionBoxProps) {\r\n  const [selectionBox, setSelectionBox] = useState<SelectionBoxState | null>(\r\n    null\r\n  );\r\n  const [justFinishedSelecting, setJustFinishedSelecting] = useState(false);\r\n\r\n  // Mouse down handler to start selection\r\n  const handleMouseDown = useCallback(\r\n    (e: React.MouseEvent) => {\r\n      if (!isEnabled) return;\r\n\r\n      // Only start selection on empty space clicks\r\n      if ((e.target as HTMLElement).closest(\".timeline-element\")) {\r\n        return;\r\n      }\r\n      if (playheadRef?.current?.contains(e.target as Node)) {\r\n        return;\r\n      }\r\n      if ((e.target as HTMLElement).closest(\"[data-track-labels]\")) {\r\n        return;\r\n      }\r\n      // Don't start selection when clicking in the ruler area - this interferes with playhead dragging\r\n      if ((e.target as HTMLElement).closest(\"[data-ruler-area]\")) {\r\n        return;\r\n      }\r\n\r\n      setSelectionBox({\r\n        startPos: { x: e.clientX, y: e.clientY },\r\n        currentPos: { x: e.clientX, y: e.clientY },\r\n        isActive: false, // Will become active when mouse moves\r\n      });\r\n    },\r\n    [isEnabled, playheadRef]\r\n  );\r\n\r\n  // Function to select elements within the selection box\r\n  const selectElementsInBox = useCallback(\r\n    (startPos: { x: number; y: number }, endPos: { x: number; y: number }) => {\r\n      if (!containerRef.current) return;\r\n\r\n      const container = containerRef.current;\r\n      const containerRect = container.getBoundingClientRect();\r\n\r\n      // Calculate selection rectangle in container coordinates\r\n      const startX = startPos.x - containerRect.left;\r\n      const startY = startPos.y - containerRect.top;\r\n      const endX = endPos.x - containerRect.left;\r\n      const endY = endPos.y - containerRect.top;\r\n\r\n      const selectionRect = {\r\n        left: Math.min(startX, endX),\r\n        top: Math.min(startY, endY),\r\n        right: Math.max(startX, endX),\r\n        bottom: Math.max(startY, endY),\r\n      };\r\n\r\n      // Find all timeline elements within the selection rectangle\r\n      const timelineElements = container.querySelectorAll(\".timeline-element\");\r\n\r\n      const selectedElements: { trackId: string; elementId: string }[] = [];\r\n\r\n      timelineElements.forEach((element) => {\r\n        const elementRect = element.getBoundingClientRect();\r\n        // Use absolute coordinates for more accurate intersection detection\r\n        const elementAbsolute = {\r\n          left: elementRect.left,\r\n          top: elementRect.top,\r\n          right: elementRect.right,\r\n          bottom: elementRect.bottom,\r\n        };\r\n\r\n        const selectionAbsolute = {\r\n          left: startPos.x,\r\n          top: startPos.y,\r\n          right: endPos.x,\r\n          bottom: endPos.y,\r\n        };\r\n\r\n        // Normalize selection rectangle (handle dragging in any direction)\r\n        const normalizedSelection = {\r\n          left: Math.min(selectionAbsolute.left, selectionAbsolute.right),\r\n          top: Math.min(selectionAbsolute.top, selectionAbsolute.bottom),\r\n          right: Math.max(selectionAbsolute.left, selectionAbsolute.right),\r\n          bottom: Math.max(selectionAbsolute.top, selectionAbsolute.bottom),\r\n        };\r\n\r\n        const elementId = element.getAttribute(\"data-element-id\");\r\n        const trackId = element.getAttribute(\"data-track-id\");\r\n\r\n        // Check if element intersects with selection rectangle (any overlap)\r\n        // Using absolute coordinates for more precise detection\r\n        const intersects = !(\r\n          elementAbsolute.right < normalizedSelection.left ||\r\n          elementAbsolute.left > normalizedSelection.right ||\r\n          elementAbsolute.bottom < normalizedSelection.top ||\r\n          elementAbsolute.top > normalizedSelection.bottom\r\n        );\r\n\r\n        if (intersects && elementId && trackId) {\r\n          selectedElements.push({ trackId, elementId });\r\n        }\r\n      });\r\n\r\n      // Always call the callback - with elements or empty array to clear selection\r\n      console.log(\r\n        JSON.stringify({ selectElementsInBox: selectedElements.length })\r\n      );\r\n      onSelectionComplete(selectedElements);\r\n    },\r\n    [containerRef, onSelectionComplete]\r\n  );\r\n\r\n  // Effect to track selection box movement\r\n  useEffect(() => {\r\n    if (!selectionBox) return;\r\n\r\n    const handleMouseMove = (e: MouseEvent) => {\r\n      const deltaX = Math.abs(e.clientX - selectionBox.startPos.x);\r\n      const deltaY = Math.abs(e.clientY - selectionBox.startPos.y);\r\n\r\n      // Start selection if mouse moved more than 5px\r\n      const shouldActivate = deltaX > 5 || deltaY > 5;\r\n\r\n      const newSelectionBox = {\r\n        ...selectionBox,\r\n        currentPos: { x: e.clientX, y: e.clientY },\r\n        isActive: shouldActivate || selectionBox.isActive,\r\n      };\r\n\r\n      setSelectionBox(newSelectionBox);\r\n\r\n      // Real-time visual feedback: update selection as we drag\r\n      if (newSelectionBox.isActive) {\r\n        selectElementsInBox(\r\n          newSelectionBox.startPos,\r\n          newSelectionBox.currentPos\r\n        );\r\n      }\r\n    };\r\n\r\n    const handleMouseUp = () => {\r\n      console.log(\r\n        JSON.stringify({ mouseUp: { wasActive: selectionBox?.isActive } })\r\n      );\r\n\r\n      // If we had an active selection, mark that we just finished selecting\r\n      if (selectionBox?.isActive) {\r\n        console.log(JSON.stringify({ settingJustFinishedSelecting: true }));\r\n        setJustFinishedSelecting(true);\r\n        // Clear the flag after a short delay to allow click events to check it\r\n        setTimeout(() => {\r\n          console.log(JSON.stringify({ clearingJustFinishedSelecting: true }));\r\n          setJustFinishedSelecting(false);\r\n        }, 50);\r\n      }\r\n\r\n      // Don't call selectElementsInBox again - real-time selection already handled it\r\n      // Just clean up the selection box visual\r\n      setSelectionBox(null);\r\n    };\r\n\r\n    window.addEventListener(\"mousemove\", handleMouseMove);\r\n    window.addEventListener(\"mouseup\", handleMouseUp);\r\n\r\n    return () => {\r\n      window.removeEventListener(\"mousemove\", handleMouseMove);\r\n      window.removeEventListener(\"mouseup\", handleMouseUp);\r\n    };\r\n  }, [selectionBox, selectElementsInBox]);\r\n\r\n  return {\r\n    selectionBox,\r\n    handleMouseDown,\r\n    isSelecting: selectionBox?.isActive || false,\r\n    justFinishedSelecting,\r\n  };\r\n}\r\n","\"use client\";\r\n\r\nimport { SnapPoint } from \"@/hooks/use-timeline-snapping\";\r\nimport { TIMELINE_CONSTANTS } from \"@/constants/timeline-constants\";\r\nimport type { TimelineTrack } from \"@/types/timeline\";\r\nimport { useState, useEffect } from \"react\";\r\n\r\ninterface SnapIndicatorProps {\r\n  snapPoint: SnapPoint | null;\r\n  zoomLevel: number;\r\n  isVisible: boolean;\r\n  tracks: TimelineTrack[];\r\n  timelineRef: React.RefObject<HTMLDivElement>;\r\n  trackLabelsRef?: React.RefObject<HTMLDivElement>;\r\n  tracksScrollRef: React.RefObject<HTMLDivElement>;\r\n}\r\n\r\nexport function SnapIndicator({\r\n  snapPoint,\r\n  zoomLevel,\r\n  isVisible,\r\n  tracks,\r\n  timelineRef,\r\n  trackLabelsRef,\r\n  tracksScrollRef,\r\n}: SnapIndicatorProps) {\r\n  const [scrollLeft, setScrollLeft] = useState(0);\r\n\r\n  // Track scroll position to lock snap indicator to frame\r\n  useEffect(() => {\r\n    const tracksViewport = tracksScrollRef.current;\r\n\r\n    if (!tracksViewport) return;\r\n\r\n    const handleScroll = () => {\r\n      setScrollLeft(tracksViewport.scrollLeft);\r\n    };\r\n\r\n    // Set initial scroll position\r\n    setScrollLeft(tracksViewport.scrollLeft);\r\n\r\n    tracksViewport.addEventListener(\"scroll\", handleScroll);\r\n    return () => tracksViewport.removeEventListener(\"scroll\", handleScroll);\r\n  }, [tracksScrollRef]);\r\n\r\n  if (!isVisible || !snapPoint) {\r\n    return null;\r\n  }\r\n\r\n  const timelineContainerHeight = timelineRef.current?.offsetHeight || 400;\r\n  const totalHeight = timelineContainerHeight - 8; // 8px padding from edges\r\n\r\n  // Get dynamic track labels width, fallback to 0 if no tracks or no ref\r\n  const trackLabelsWidth =\r\n    tracks.length > 0 && trackLabelsRef?.current\r\n      ? trackLabelsRef.current.offsetWidth\r\n      : 0;\r\n\r\n  // Calculate position locked to timeline content (accounting for scroll)\r\n  const timelinePosition =\r\n    snapPoint.time * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel;\r\n  const leftPosition = trackLabelsWidth + timelinePosition - scrollLeft;\r\n\r\n  return (\r\n    <div\r\n      className=\"absolute pointer-events-none z-90\"\r\n      style={{\r\n        left: `${leftPosition}px`,\r\n        top: 0,\r\n        height: `${totalHeight}px`,\r\n        width: \"2px\",\r\n      }}\r\n    >\r\n      <div className={\"w-0.5 h-full bg-primary/40 opacity-80\"} />\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { Button } from \"../../ui/button\";\r\nimport {\r\n  Scissors,\r\n  ArrowLeftToLine,\r\n  ArrowRightToLine,\r\n  Trash2,\r\n  Snowflake,\r\n  Copy,\r\n  SplitSquareHorizontal,\r\n  Pause,\r\n  Play,\r\n  Video,\r\n  Music,\r\n  TypeIcon,\r\n  Magnet,\r\n  Link,\r\n  ZoomIn,\r\n  ZoomOut,\r\n  Bookmark,\r\n  Eye,\r\n  MicOff,\r\n  Mic,\r\n} from \"lucide-react\";\r\nimport {\r\n  Tooltip,\r\n  TooltipContent,\r\n  TooltipTrigger,\r\n  TooltipProvider,\r\n} from \"../../ui/tooltip\";\r\nimport {\r\n  ContextMenu,\r\n  ContextMenuContent,\r\n  ContextMenuItem,\r\n  ContextMenuTrigger,\r\n} from \"../../ui/context-menu\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { useMediaStore } from \"@/stores/media-store\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\nimport { useProjectStore } from \"@/stores/project-store\";\r\nimport { useTimelineZoom } from \"@/hooks/use-timeline-zoom\";\r\nimport { processMediaFiles } from \"@/lib/media-processing\";\r\nimport { toast } from \"sonner\";\r\nimport { useState, useRef, useEffect, useCallback } from \"react\";\r\nimport { TimelineTrackContent } from \"./timeline-track\";\r\nimport {\r\n  TimelinePlayhead,\r\n  useTimelinePlayheadRuler,\r\n} from \"./timeline-playhead\";\r\nimport { SelectionBox } from \"../selection-box\";\r\nimport { useSelectionBox } from \"@/hooks/use-selection-box\";\r\nimport { SnapIndicator } from \"../snap-indicator\";\r\nimport { SnapPoint } from \"@/hooks/use-timeline-snapping\";\r\nimport type { DragData, TimelineTrack, TrackType } from \"@/types/timeline\";\r\nimport {\r\n  getTrackHeight,\r\n  getCumulativeHeightBefore,\r\n  getTotalTracksHeight,\r\n  TIMELINE_CONSTANTS,\r\n  snapTimeToFrame,\r\n} from \"@/constants/timeline-constants\";\r\nimport { Slider } from \"@/components/ui/slider\";\r\n\r\nexport function Timeline() {\r\n  // Timeline shows all tracks (video, audio, effects) and their elements.\r\n  // You can drag media here to add it to your project.\r\n  // elements can be trimmed, deleted, and moved.\r\n\r\n  const {\r\n    tracks,\r\n    getTotalDuration,\r\n    clearSelectedElements,\r\n    snappingEnabled,\r\n    setSelectedElements,\r\n    toggleTrackMute,\r\n    dragState,\r\n  } = useTimelineStore();\r\n  const { mediaItems, addMediaItem } = useMediaStore();\r\n  const { activeProject } = useProjectStore();\r\n  const { currentTime, duration, seek, setDuration, isPlaying, toggle } =\r\n    usePlaybackStore();\r\n  const [isDragOver, setIsDragOver] = useState(false);\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [progress, setProgress] = useState(0);\r\n  const dragCounterRef = useRef(0);\r\n  const timelineRef = useRef<HTMLDivElement>(null);\r\n  const rulerRef = useRef<HTMLDivElement>(null);\r\n  const [isInTimeline, setIsInTimeline] = useState(false);\r\n\r\n  // Track mouse down/up for distinguishing clicks from drag/resize ends\r\n  const mouseTrackingRef = useRef({\r\n    isMouseDown: false,\r\n    downX: 0,\r\n    downY: 0,\r\n    downTime: 0,\r\n  });\r\n\r\n  // Timeline zoom functionality\r\n  const { zoomLevel, setZoomLevel, handleWheel } = useTimelineZoom({\r\n    containerRef: timelineRef,\r\n    isInTimeline,\r\n  });\r\n\r\n  // Old marquee selection removed - using new SelectionBox component instead\r\n\r\n  // Dynamic timeline width calculation based on playhead position and duration\r\n  const dynamicTimelineWidth = Math.max(\r\n    (duration || 0) * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel, // Base width from duration\r\n    (currentTime + 30) * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel, // Width to show current time + 30 seconds buffer\r\n    timelineRef.current?.clientWidth || 1000 // Minimum width\r\n  );\r\n\r\n  // Scroll synchronization and auto-scroll to playhead\r\n  const rulerScrollRef = useRef<HTMLDivElement>(null);\r\n  const tracksScrollRef = useRef<HTMLDivElement>(null);\r\n  const trackLabelsRef = useRef<HTMLDivElement>(null);\r\n  const playheadRef = useRef<HTMLDivElement>(null);\r\n  const trackLabelsScrollRef = useRef<HTMLDivElement>(null);\r\n  const isUpdatingRef = useRef(false);\r\n  const lastRulerSync = useRef(0);\r\n  const lastTracksSync = useRef(0);\r\n  const lastVerticalSync = useRef(0);\r\n\r\n  // Timeline playhead ruler handlers\r\n  const { handleRulerMouseDown } = useTimelinePlayheadRuler({\r\n    currentTime,\r\n    duration,\r\n    zoomLevel,\r\n    seek,\r\n    rulerRef,\r\n    rulerScrollRef,\r\n    tracksScrollRef,\r\n    playheadRef,\r\n  });\r\n\r\n  // Selection box functionality\r\n  const tracksContainerRef = useRef<HTMLDivElement>(null);\r\n  const {\r\n    selectionBox,\r\n    handleMouseDown: handleSelectionMouseDown,\r\n    isSelecting,\r\n    justFinishedSelecting,\r\n  } = useSelectionBox({\r\n    containerRef: tracksContainerRef,\r\n    playheadRef,\r\n    onSelectionComplete: (elements) => {\r\n      console.log(JSON.stringify({ onSelectionComplete: elements.length }));\r\n      setSelectedElements(elements);\r\n    },\r\n  });\r\n\r\n  // Calculate snap indicator state\r\n  const [currentSnapPoint, setCurrentSnapPoint] = useState<SnapPoint | null>(\r\n    null\r\n  );\r\n  const showSnapIndicator =\r\n    dragState.isDragging && snappingEnabled && currentSnapPoint !== null;\r\n\r\n  // Callback to handle snap point changes from TimelineTrackContent\r\n  const handleSnapPointChange = useCallback((snapPoint: SnapPoint | null) => {\r\n    setCurrentSnapPoint(snapPoint);\r\n  }, []);\r\n\r\n  // Track mouse down to distinguish real clicks from drag/resize ends\r\n  const handleTimelineMouseDown = useCallback((e: React.MouseEvent) => {\r\n    // Only track mouse down on timeline background areas (not elements)\r\n    const target = e.target as HTMLElement;\r\n    console.log(\r\n      JSON.stringify({\r\n        debug_mousedown: \"START\",\r\n        target_class: target.className,\r\n        target_parent_class: target.parentElement?.className,\r\n        clientX: e.clientX,\r\n        clientY: e.clientY,\r\n        timeStamp: e.timeStamp,\r\n      })\r\n    );\r\n\r\n    const isTimelineBackground =\r\n      !target.closest(\".timeline-element\") &&\r\n      !playheadRef.current?.contains(target) &&\r\n      !target.closest(\"[data-track-labels]\");\r\n\r\n    console.log(\r\n      JSON.stringify({\r\n        debug_mousedown: \"CHECK\",\r\n        isTimelineBackground,\r\n        hasTimelineElement: !!target.closest(\".timeline-element\"),\r\n        hasPlayhead: !!playheadRef.current?.contains(target),\r\n        hasTrackLabels: !!target.closest(\"[data-track-labels]\"),\r\n      })\r\n    );\r\n\r\n    if (isTimelineBackground) {\r\n      mouseTrackingRef.current = {\r\n        isMouseDown: true,\r\n        downX: e.clientX,\r\n        downY: e.clientY,\r\n        downTime: e.timeStamp,\r\n      };\r\n      console.log(\r\n        JSON.stringify({\r\n          debug_mousedown: \"TRACKED\",\r\n          mouseTracking: mouseTrackingRef.current,\r\n        })\r\n      );\r\n    } else {\r\n      console.log(\r\n        JSON.stringify({\r\n          debug_mousedown: \"IGNORED - not timeline background\",\r\n        })\r\n      );\r\n    }\r\n  }, []);\r\n\r\n  // Timeline content click to seek handler\r\n  const handleTimelineContentClick = useCallback(\r\n    (e: React.MouseEvent) => {\r\n      console.log(\r\n        JSON.stringify({\r\n          debug_click: \"START\",\r\n          target: (e.target as HTMLElement).className,\r\n          target_parent: (e.target as HTMLElement).parentElement?.className,\r\n          mouseTracking: mouseTrackingRef.current,\r\n          isSelecting,\r\n          justFinishedSelecting,\r\n          clickX: e.clientX,\r\n          clickY: e.clientY,\r\n          timeStamp: e.timeStamp,\r\n        })\r\n      );\r\n\r\n      const { isMouseDown, downX, downY, downTime } = mouseTrackingRef.current;\r\n\r\n      // Reset mouse tracking\r\n      mouseTrackingRef.current = {\r\n        isMouseDown: false,\r\n        downX: 0,\r\n        downY: 0,\r\n        downTime: 0,\r\n      };\r\n\r\n      // Only process as click if we tracked a mouse down on timeline background\r\n      if (!isMouseDown) {\r\n        console.log(\r\n          JSON.stringify({\r\n            debug_click: \"REJECTED - no mousedown\",\r\n            mouseTracking: mouseTrackingRef.current,\r\n          })\r\n        );\r\n        return;\r\n      }\r\n\r\n      // Check if mouse moved significantly (indicates drag, not click)\r\n      const deltaX = Math.abs(e.clientX - downX);\r\n      const deltaY = Math.abs(e.clientY - downY);\r\n      const deltaTime = e.timeStamp - downTime;\r\n\r\n      if (deltaX > 5 || deltaY > 5 || deltaTime > 500) {\r\n        console.log(\r\n          JSON.stringify({\r\n            debug_click: \"REJECTED - movement too large\",\r\n            deltaX,\r\n            deltaY,\r\n            deltaTime,\r\n          })\r\n        );\r\n        return;\r\n      }\r\n\r\n      // Don't seek if this was a selection box operation\r\n      if (isSelecting || justFinishedSelecting) {\r\n        console.log(\r\n          JSON.stringify({\r\n            debug_click: \"REJECTED - selection operation\",\r\n            isSelecting,\r\n            justFinishedSelecting,\r\n          })\r\n        );\r\n        return;\r\n      }\r\n\r\n      // Don't seek if clicking on timeline elements, but still deselect\r\n      if ((e.target as HTMLElement).closest(\".timeline-element\")) {\r\n        console.log(\r\n          JSON.stringify({\r\n            debug_click: \"REJECTED - clicked timeline element\",\r\n          })\r\n        );\r\n        return;\r\n      }\r\n\r\n      // Don't seek if clicking on playhead\r\n      if (playheadRef.current?.contains(e.target as Node)) {\r\n        console.log(\r\n          JSON.stringify({\r\n            debug_click: \"REJECTED - clicked playhead\",\r\n          })\r\n        );\r\n        return;\r\n      }\r\n\r\n      // Don't seek if clicking on track labels\r\n      if ((e.target as HTMLElement).closest(\"[data-track-labels]\")) {\r\n        console.log(\r\n          JSON.stringify({\r\n            debug_click: \"REJECTED - clicked track labels\",\r\n          })\r\n        );\r\n        clearSelectedElements();\r\n        return;\r\n      }\r\n\r\n      // Clear selected elements when clicking empty timeline area\r\n      console.log(\r\n        JSON.stringify({\r\n          debug_click: \"PROCEEDING - clearing elements\",\r\n          clearingSelectedElements: true,\r\n        })\r\n      );\r\n      clearSelectedElements();\r\n\r\n      // Determine if we're clicking in ruler or tracks area\r\n      const isRulerClick = (e.target as HTMLElement).closest(\r\n        \"[data-ruler-area]\"\r\n      );\r\n\r\n      console.log(\r\n        JSON.stringify({\r\n          debug_click: \"CALCULATING POSITION\",\r\n          isRulerClick,\r\n          clientX: e.clientX,\r\n          clientY: e.clientY,\r\n          target_element: (e.target as HTMLElement).tagName,\r\n          target_class: (e.target as HTMLElement).className,\r\n        })\r\n      );\r\n\r\n      let mouseX: number;\r\n      let scrollLeft = 0;\r\n\r\n      if (isRulerClick) {\r\n        // Calculate based on ruler position\r\n        const rulerContent = rulerScrollRef.current;\r\n        if (!rulerContent) {\r\n          console.log(\r\n            JSON.stringify({\r\n              debug_click: \"ERROR - no ruler container found\",\r\n            })\r\n          );\r\n          return;\r\n        }\r\n        const rect = rulerContent.getBoundingClientRect();\r\n        mouseX = e.clientX - rect.left;\r\n        scrollLeft = rulerContent.scrollLeft;\r\n      } else {\r\n        const tracksContent = tracksScrollRef.current;\r\n        if (!tracksContent) {\r\n          return;\r\n        }\r\n        const rect = tracksContent.getBoundingClientRect();\r\n        mouseX = e.clientX - rect.left;\r\n        scrollLeft = tracksContent.scrollLeft;\r\n      }\r\n\r\n      const rawTime = Math.max(\r\n        0,\r\n        Math.min(\r\n          duration,\r\n          (mouseX + scrollLeft) /\r\n            (TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel)\r\n        )\r\n      );\r\n\r\n      // Use frame snapping for timeline clicking\r\n      const projectFps = activeProject?.fps || 30;\r\n      const time = snapTimeToFrame(rawTime, projectFps);\r\n      seek(time);\r\n    },\r\n    [\r\n      duration,\r\n      zoomLevel,\r\n      seek,\r\n      rulerScrollRef,\r\n      tracksScrollRef,\r\n      clearSelectedElements,\r\n      isSelecting,\r\n      justFinishedSelecting,\r\n    ]\r\n  );\r\n\r\n  // Update timeline duration when tracks change\r\n  useEffect(() => {\r\n    const totalDuration = getTotalDuration();\r\n    setDuration(Math.max(totalDuration, 10)); // Minimum 10 seconds for empty timeline\r\n  }, [tracks, setDuration, getTotalDuration]);\r\n\r\n  // Old marquee system removed - using new SelectionBox component instead\r\n\r\n  const handleDragEnter = (e: React.DragEvent) => {\r\n    // When something is dragged over the timeline, show overlay\r\n    e.preventDefault();\r\n    // Don't show overlay for timeline elements - they're handled by tracks\r\n    if (e.dataTransfer.types.includes(\"application/x-timeline-element\")) {\r\n      return;\r\n    }\r\n    dragCounterRef.current += 1;\r\n    if (!isDragOver) {\r\n      setIsDragOver(true);\r\n    }\r\n  };\r\n\r\n  const handleDragOver = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n  };\r\n\r\n  const handleDragLeave = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n\r\n    // Don't update state for timeline elements - they're handled by tracks\r\n    if (e.dataTransfer.types.includes(\"application/x-timeline-element\")) {\r\n      return;\r\n    }\r\n\r\n    dragCounterRef.current -= 1;\r\n    if (dragCounterRef.current === 0) {\r\n      setIsDragOver(false);\r\n    }\r\n  };\r\n\r\n  const handleDrop = async (e: React.DragEvent) => {\r\n    // When media is dropped, add it as a new track/element\r\n    e.preventDefault();\r\n    setIsDragOver(false);\r\n    dragCounterRef.current = 0;\r\n\r\n    // Ignore timeline element drags - they're handled by track-specific handlers\r\n    const hasTimelineElement = e.dataTransfer.types.includes(\r\n      \"application/x-timeline-element\"\r\n    );\r\n    if (hasTimelineElement) {\r\n      return;\r\n    }\r\n\r\n    const itemData = e.dataTransfer.getData(\"application/x-media-item\");\r\n    if (itemData) {\r\n      try {\r\n        const dragData: DragData = JSON.parse(itemData);\r\n\r\n        if (dragData.type === \"text\") {\r\n          // Always create new text track to avoid overlaps\r\n          useTimelineStore.getState().addTextToNewTrack(dragData);\r\n        } else {\r\n          // Handle media items\r\n          const mediaItem = mediaItems.find(\r\n            (item: any) => item.id === dragData.id\r\n          );\r\n          if (!mediaItem) {\r\n            toast.error(\"Media item not found\");\r\n            return;\r\n          }\r\n\r\n          useTimelineStore.getState().addMediaToNewTrack(mediaItem);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error parsing dropped item data:\", error);\r\n        toast.error(\"Failed to add item to timeline\");\r\n      }\r\n    } else if (e.dataTransfer.files?.length > 0) {\r\n      // Handle file drops by creating new tracks\r\n      if (!activeProject) {\r\n        toast.error(\"No active project\");\r\n        return;\r\n      }\r\n\r\n      setIsProcessing(true);\r\n      setProgress(0);\r\n      try {\r\n        const processedItems = await processMediaFiles(\r\n          e.dataTransfer.files,\r\n          (p) => setProgress(p)\r\n        );\r\n        for (const processedItem of processedItems) {\r\n          await addMediaItem(activeProject.id, processedItem);\r\n          const currentMediaItems = useMediaStore.getState().mediaItems;\r\n          const addedItem = currentMediaItems.find(\r\n            (item) =>\r\n              item.name === processedItem.name && item.url === processedItem.url\r\n          );\r\n          if (addedItem) {\r\n            const trackType: TrackType =\r\n              addedItem.type === \"audio\" ? \"audio\" : \"media\";\r\n            const targetTrackId = useTimelineStore\r\n              .getState()\r\n              .insertTrackAt(trackType, 0);\r\n\r\n            useTimelineStore.getState().addElementToTrack(targetTrackId, {\r\n              type: \"media\",\r\n              mediaId: addedItem.id,\r\n              name: addedItem.name,\r\n              duration: addedItem.duration || 5,\r\n              startTime: currentTime,\r\n              trimStart: 0,\r\n              trimEnd: 0,\r\n            });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        // Show error if file processing fails\r\n        console.error(\"Error processing external files:\", error);\r\n        toast.error(\"Failed to process dropped files\");\r\n      } finally {\r\n        setIsProcessing(false);\r\n        setProgress(0);\r\n      }\r\n    }\r\n  };\r\n\r\n  const dragProps = {\r\n    onDragEnter: handleDragEnter,\r\n    onDragOver: handleDragOver,\r\n    onDragLeave: handleDragLeave,\r\n    onDrop: handleDrop,\r\n  };\r\n\r\n  // --- Scroll synchronization effect ---\r\n  useEffect(() => {\r\n    const rulerViewport = rulerScrollRef.current;\r\n    const tracksViewport = tracksScrollRef.current;\r\n    const trackLabelsViewport = trackLabelsScrollRef.current;\r\n\r\n    if (!rulerViewport || !tracksViewport) return;\r\n\r\n    // Horizontal scroll synchronization between ruler and tracks\r\n    const handleRulerScroll = () => {\r\n      const now = Date.now();\r\n      if (isUpdatingRef.current || now - lastRulerSync.current < 16) return;\r\n      lastRulerSync.current = now;\r\n      isUpdatingRef.current = true;\r\n      tracksViewport.scrollLeft = rulerViewport.scrollLeft;\r\n      isUpdatingRef.current = false;\r\n    };\r\n    const handleTracksScroll = () => {\r\n      const now = Date.now();\r\n      if (isUpdatingRef.current || now - lastTracksSync.current < 16) return;\r\n      lastTracksSync.current = now;\r\n      isUpdatingRef.current = true;\r\n      rulerViewport.scrollLeft = tracksViewport.scrollLeft;\r\n      isUpdatingRef.current = false;\r\n    };\r\n\r\n    rulerViewport.addEventListener(\"scroll\", handleRulerScroll);\r\n    tracksViewport.addEventListener(\"scroll\", handleTracksScroll);\r\n\r\n    // Vertical scroll synchronization between track labels and tracks content\r\n    if (trackLabelsViewport) {\r\n      const handleTrackLabelsScroll = () => {\r\n        const now = Date.now();\r\n        if (isUpdatingRef.current || now - lastVerticalSync.current < 16)\r\n          return;\r\n        lastVerticalSync.current = now;\r\n        isUpdatingRef.current = true;\r\n        tracksViewport.scrollTop = trackLabelsViewport.scrollTop;\r\n        isUpdatingRef.current = false;\r\n      };\r\n      const handleTracksVerticalScroll = () => {\r\n        const now = Date.now();\r\n        if (isUpdatingRef.current || now - lastVerticalSync.current < 16)\r\n          return;\r\n        lastVerticalSync.current = now;\r\n        isUpdatingRef.current = true;\r\n        trackLabelsViewport.scrollTop = tracksViewport.scrollTop;\r\n        isUpdatingRef.current = false;\r\n      };\r\n\r\n      trackLabelsViewport.addEventListener(\"scroll\", handleTrackLabelsScroll);\r\n      tracksViewport.addEventListener(\"scroll\", handleTracksVerticalScroll);\r\n\r\n      return () => {\r\n        rulerViewport.removeEventListener(\"scroll\", handleRulerScroll);\r\n        tracksViewport.removeEventListener(\"scroll\", handleTracksScroll);\r\n        trackLabelsViewport.removeEventListener(\r\n          \"scroll\",\r\n          handleTrackLabelsScroll\r\n        );\r\n        tracksViewport.removeEventListener(\r\n          \"scroll\",\r\n          handleTracksVerticalScroll\r\n        );\r\n      };\r\n    }\r\n\r\n    return () => {\r\n      rulerViewport.removeEventListener(\"scroll\", handleRulerScroll);\r\n      tracksViewport.removeEventListener(\"scroll\", handleTracksScroll);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div\r\n      className={\r\n        \"h-full flex flex-col transition-colors duration-200 relative bg-panel rounded-sm overflow-hidden\"\r\n      }\r\n      {...dragProps}\r\n      onMouseEnter={() => setIsInTimeline(true)}\r\n      onMouseLeave={() => setIsInTimeline(false)}\r\n    >\r\n      <TimelineToolbar zoomLevel={zoomLevel} setZoomLevel={setZoomLevel} />\r\n\r\n      {/* Timeline Container */}\r\n      <div\r\n        className=\"flex-1 flex flex-col overflow-hidden relative\"\r\n        ref={timelineRef}\r\n      >\r\n        <TimelinePlayhead\r\n          currentTime={currentTime}\r\n          duration={duration}\r\n          zoomLevel={zoomLevel}\r\n          tracks={tracks}\r\n          seek={seek}\r\n          rulerRef={rulerRef}\r\n          rulerScrollRef={rulerScrollRef}\r\n          tracksScrollRef={tracksScrollRef}\r\n          trackLabelsRef={trackLabelsRef}\r\n          timelineRef={timelineRef}\r\n          playheadRef={playheadRef}\r\n          isSnappingToPlayhead={\r\n            showSnapIndicator && currentSnapPoint?.type === \"playhead\"\r\n          }\r\n        />\r\n        <SnapIndicator\r\n          snapPoint={currentSnapPoint}\r\n          zoomLevel={zoomLevel}\r\n          tracks={tracks}\r\n          timelineRef={timelineRef}\r\n          trackLabelsRef={trackLabelsRef}\r\n          tracksScrollRef={tracksScrollRef}\r\n          isVisible={showSnapIndicator}\r\n        />\r\n        {/* Timeline Header with Ruler */}\r\n        <div className=\"flex bg-panel sticky top-0 z-10\">\r\n          {/* Track Labels Header */}\r\n          <div className=\"w-28 shrink-0 bg-panel border-r flex items-center justify-between px-3 py-2\">\r\n            {/* Empty space */}\r\n            <span className=\"text-sm font-medium text-muted-foreground opacity-0\">\r\n              .\r\n            </span>\r\n          </div>\r\n\r\n          {/* Timeline Ruler */}\r\n          <div\r\n            className=\"flex-1 relative overflow-hidden h-10\"\r\n            onWheel={(e) => {\r\n              // Check if this is horizontal scrolling - if so, don't handle it here\r\n              if (e.shiftKey || Math.abs(e.deltaX) > Math.abs(e.deltaY)) {\r\n                return; // Let ScrollArea handle horizontal scrolling\r\n              }\r\n              handleWheel(e);\r\n            }}\r\n            onMouseDown={handleSelectionMouseDown}\r\n            onClick={handleTimelineContentClick}\r\n            data-ruler-area\r\n          >\r\n            <ScrollArea className=\"w-full\" ref={rulerScrollRef}>\r\n              <div\r\n                ref={rulerRef}\r\n                className=\"relative h-10 select-none cursor-default\"\r\n                style={{\r\n                  width: `${dynamicTimelineWidth}px`,\r\n                }}\r\n                onMouseDown={handleRulerMouseDown}\r\n              >\r\n                {/* Time markers */}\r\n                {(() => {\r\n                  // Calculate appropriate time interval based on zoom level\r\n                  const getTimeInterval = (zoom: number) => {\r\n                    const pixelsPerSecond =\r\n                      TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoom;\r\n                    if (pixelsPerSecond >= 200) return 0.1; // Every 0.1s when very zoomed in\r\n                    if (pixelsPerSecond >= 100) return 0.5; // Every 0.5s when zoomed in\r\n                    if (pixelsPerSecond >= 50) return 1; // Every 1s at normal zoom\r\n                    if (pixelsPerSecond >= 25) return 2; // Every 2s when zoomed out\r\n                    if (pixelsPerSecond >= 12) return 5; // Every 5s when more zoomed out\r\n                    if (pixelsPerSecond >= 6) return 10; // Every 10s when very zoomed out\r\n                    return 30; // Every 30s when extremely zoomed out\r\n                  };\r\n\r\n                  const interval = getTimeInterval(zoomLevel);\r\n                  const markerCount = Math.ceil(duration / interval) + 1;\r\n\r\n                  return Array.from({ length: markerCount }, (_, i) => {\r\n                    const time = i * interval;\r\n                    if (time > duration) return null;\r\n\r\n                    const isMainMarker =\r\n                      time % (interval >= 1 ? Math.max(1, interval) : 1) === 0;\r\n\r\n                    return (\r\n                      <div\r\n                        key={i}\r\n                        className={`absolute top-0 h-4 ${\r\n                          isMainMarker\r\n                            ? \"border-l border-muted-foreground/40\"\r\n                            : \"border-l border-muted-foreground/20\"\r\n                        }`}\r\n                        style={{\r\n                          left: `${\r\n                            time *\r\n                            TIMELINE_CONSTANTS.PIXELS_PER_SECOND *\r\n                            zoomLevel\r\n                          }px`,\r\n                        }}\r\n                      >\r\n                        <span\r\n                          className={`absolute top-1 left-1 text-[0.6rem] ${\r\n                            isMainMarker\r\n                              ? \"text-muted-foreground font-medium\"\r\n                              : \"text-muted-foreground/70\"\r\n                          }`}\r\n                        >\r\n                          {(() => {\r\n                            const formatTime = (seconds: number) => {\r\n                              const hours = Math.floor(seconds / 3600);\r\n                              const minutes = Math.floor((seconds % 3600) / 60);\r\n                              const secs = seconds % 60;\r\n\r\n                              if (hours > 0) {\r\n                                return `${hours}:${minutes\r\n                                  .toString()\r\n                                  .padStart(2, \"0\")}:${Math.floor(secs)\r\n                                  .toString()\r\n                                  .padStart(2, \"0\")}`;\r\n                              }\r\n                              if (minutes > 0) {\r\n                                return `${minutes}:${Math.floor(secs)\r\n                                  .toString()\r\n                                  .padStart(2, \"0\")}`;\r\n                              }\r\n                              if (interval >= 1) {\r\n                                return `${Math.floor(secs)}s`;\r\n                              }\r\n                              return `${secs.toFixed(1)}s`;\r\n                            };\r\n                            return formatTime(time);\r\n                          })()}\r\n                        </span>\r\n                      </div>\r\n                    );\r\n                  }).filter(Boolean);\r\n                })()}\r\n\r\n                {/* Bookmark markers */}\r\n                {(() => {\r\n                  const { activeProject } = useProjectStore.getState();\r\n                  if (!activeProject?.bookmarks?.length) return null;\r\n\r\n                  return activeProject.bookmarks.map((bookmarkTime, i) => (\r\n                    <div\r\n                      key={`bookmark-${i}`}\r\n                      className=\"absolute top-0 h-10 w-0.5 !bg-primary cursor-pointer\"\r\n                      style={{\r\n                        left: `${bookmarkTime * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel}px`,\r\n                      }}\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        usePlaybackStore.getState().seek(bookmarkTime);\r\n                      }}\r\n                    >\r\n                      <div className=\"absolute top-[-1px] left-[-5px] text-primary\">\r\n                        <Bookmark className=\"h-3 w-3 fill-primary\" />\r\n                      </div>\r\n                    </div>\r\n                  ));\r\n                })()}\r\n              </div>\r\n            </ScrollArea>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Tracks Area */}\r\n        <div className=\"flex-1 flex overflow-hidden\">\r\n          {/* Track Labels */}\r\n          {tracks.length > 0 && (\r\n            <div\r\n              ref={trackLabelsRef}\r\n              className=\"w-28 shrink-0 border-r overflow-y-auto z-100 bg-panel\"\r\n              data-track-labels\r\n            >\r\n              <ScrollArea className=\"w-full h-full\" ref={trackLabelsScrollRef}>\r\n                <div className=\"flex flex-col gap-1\">\r\n                  {tracks.map((track) => (\r\n                    <div\r\n                      key={track.id}\r\n                      className=\"flex items-center px-3 group\"\r\n                      style={{ height: `${getTrackHeight(track.type)}px` }}\r\n                    >\r\n                      <div className=\"flex items-center justify-end flex-1 min-w-0 gap-2\">\r\n                        {track.muted ? (\r\n                          <MicOff\r\n                            className=\"h-4 w-4 text-destructive cursor-pointer\"\r\n                            onClick={() => toggleTrackMute(track.id)}\r\n                          />\r\n                        ) : (\r\n                          <Mic\r\n                            className=\"h-4 w-4 text-muted-foreground cursor-pointer\"\r\n                            onClick={() => toggleTrackMute(track.id)}\r\n                          />\r\n                        )}\r\n                        <Eye className=\"h-4 w-4 text-muted-foreground\" />\r\n                        <TrackIcon track={track} />\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </ScrollArea>\r\n            </div>\r\n          )}\r\n\r\n          {/* Timeline Tracks Content */}\r\n          <div\r\n            className=\"flex-1 relative overflow-hidden\"\r\n            onWheel={(e) => {\r\n              // Check if this is horizontal scrolling - if so, don't handle it here\r\n              if (e.shiftKey || Math.abs(e.deltaX) > Math.abs(e.deltaY)) {\r\n                return; // Let ScrollArea handle horizontal scrolling\r\n              }\r\n              handleWheel(e);\r\n            }}\r\n            onMouseDown={(e) => {\r\n              handleTimelineMouseDown(e);\r\n              handleSelectionMouseDown(e);\r\n            }}\r\n            onClick={handleTimelineContentClick}\r\n            ref={tracksContainerRef}\r\n          >\r\n            <SelectionBox\r\n              startPos={selectionBox?.startPos || null}\r\n              currentPos={selectionBox?.currentPos || null}\r\n              containerRef={tracksContainerRef}\r\n              isActive={selectionBox?.isActive || false}\r\n            />\r\n            <ScrollArea className=\"w-full h-full\" ref={tracksScrollRef}>\r\n              <div\r\n                className=\"relative flex-1\"\r\n                style={{\r\n                  height: `${Math.max(\r\n                    200,\r\n                    Math.min(800, getTotalTracksHeight(tracks))\r\n                  )}px`,\r\n                  width: `${dynamicTimelineWidth}px`,\r\n                }}\r\n              >\r\n                {tracks.length === 0 ? (\r\n                  <div />\r\n                ) : (\r\n                  <>\r\n                    {tracks.map((track, index) => (\r\n                      <ContextMenu key={track.id}>\r\n                        <ContextMenuTrigger asChild>\r\n                          <div\r\n                            className=\"absolute left-0 right-0\"\r\n                            style={{\r\n                              top: `${getCumulativeHeightBefore(\r\n                                tracks,\r\n                                index\r\n                              )}px`,\r\n                              height: `${getTrackHeight(track.type)}px`,\r\n                            }}\r\n                            onClick={(e) => {\r\n                              // If clicking empty area (not on a element), deselect all elements\r\n                              if (\r\n                                !(e.target as HTMLElement).closest(\r\n                                  \".timeline-element\"\r\n                                )\r\n                              ) {\r\n                                clearSelectedElements();\r\n                              }\r\n                            }}\r\n                          >\r\n                            <TimelineTrackContent\r\n                              track={track}\r\n                              zoomLevel={zoomLevel}\r\n                              onSnapPointChange={handleSnapPointChange}\r\n                            />\r\n                          </div>\r\n                        </ContextMenuTrigger>\r\n                        <ContextMenuContent className=\"z-200\">\r\n                          <ContextMenuItem\r\n                            onClick={(e) => {\r\n                              e.stopPropagation();\r\n                              toggleTrackMute(track.id);\r\n                            }}\r\n                          >\r\n                            {track.muted ? \"Unmute Track\" : \"Mute Track\"}\r\n                          </ContextMenuItem>\r\n                          <ContextMenuItem onClick={(e) => e.stopPropagation()}>\r\n                            Track settings (soon)\r\n                          </ContextMenuItem>\r\n                        </ContextMenuContent>\r\n                      </ContextMenu>\r\n                    ))}\r\n                  </>\r\n                )}\r\n              </div>\r\n            </ScrollArea>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction TrackIcon({ track }: { track: TimelineTrack }) {\r\n  return (\r\n    <>\r\n      {track.type === \"media\" && (\r\n        <Video className=\"w-4 h-4 shrink-0 text-muted-foreground\" />\r\n      )}\r\n      {track.type === \"text\" && (\r\n        <TypeIcon className=\"w-4 h-4 shrink-0 text-muted-foreground\" />\r\n      )}\r\n      {track.type === \"audio\" && (\r\n        <Music className=\"w-4 h-4 shrink-0 text-muted-foreground\" />\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\nfunction TimelineToolbar({\r\n  zoomLevel,\r\n  setZoomLevel,\r\n}: {\r\n  zoomLevel: number;\r\n  setZoomLevel: (zoom: number) => void;\r\n}) {\r\n  const {\r\n    tracks,\r\n    addTrack,\r\n    addElementToTrack,\r\n    removeElementFromTrack,\r\n    removeElementFromTrackWithRipple,\r\n    selectedElements,\r\n    clearSelectedElements,\r\n    splitElement,\r\n    splitAndKeepLeft,\r\n    splitAndKeepRight,\r\n    separateAudio,\r\n    snappingEnabled,\r\n    toggleSnapping,\r\n    rippleEditingEnabled,\r\n    toggleRippleEditing,\r\n  } = useTimelineStore();\r\n  const { currentTime, duration, isPlaying, toggle } = usePlaybackStore();\r\n  const { toggleBookmark, isBookmarked } = useProjectStore();\r\n\r\n  // Action handlers\r\n  const handleSplitSelected = () => {\r\n    if (selectedElements.length === 0) return;\r\n    let splitCount = 0;\r\n    selectedElements.forEach(({ trackId, elementId }) => {\r\n      const track = tracks.find((t) => t.id === trackId);\r\n      const element = track?.elements.find((c) => c.id === elementId);\r\n      if (element && track) {\r\n        const effectiveStart = element.startTime;\r\n        const effectiveEnd =\r\n          element.startTime +\r\n          (element.duration - element.trimStart - element.trimEnd);\r\n        if (currentTime > effectiveStart && currentTime < effectiveEnd) {\r\n          const newElementId = splitElement(trackId, elementId, currentTime);\r\n          if (newElementId) splitCount++;\r\n        }\r\n      }\r\n    });\r\n    if (splitCount === 0) {\r\n      toast.error(\"Playhead must be within selected elements to split\");\r\n    }\r\n  };\r\n\r\n  const handleDuplicateSelected = () => {\r\n    if (selectedElements.length === 0) return;\r\n    const canDuplicate = selectedElements.length === 1;\r\n    if (!canDuplicate) return;\r\n\r\n    selectedElements.forEach(({ trackId, elementId }) => {\r\n      const track = tracks.find((t) => t.id === trackId);\r\n      const element = track?.elements.find((el) => el.id === elementId);\r\n      if (element) {\r\n        const newStartTime =\r\n          element.startTime +\r\n          (element.duration - element.trimStart - element.trimEnd) +\r\n          0.1;\r\n        const { id, ...elementWithoutId } = element;\r\n        addElementToTrack(trackId, {\r\n          ...elementWithoutId,\r\n          startTime: newStartTime,\r\n        });\r\n      }\r\n    });\r\n    clearSelectedElements();\r\n  };\r\n\r\n  const handleFreezeSelected = () => {\r\n    toast.info(\"Freeze frame functionality coming soon!\");\r\n  };\r\n\r\n  const handleSplitAndKeepLeft = () => {\r\n    if (selectedElements.length !== 1) {\r\n      toast.error(\"Select exactly one element\");\r\n      return;\r\n    }\r\n    const { trackId, elementId } = selectedElements[0];\r\n    const track = tracks.find((t) => t.id === trackId);\r\n    const element = track?.elements.find((c) => c.id === elementId);\r\n    if (!element) return;\r\n    const effectiveStart = element.startTime;\r\n    const effectiveEnd =\r\n      element.startTime +\r\n      (element.duration - element.trimStart - element.trimEnd);\r\n    if (currentTime <= effectiveStart || currentTime >= effectiveEnd) {\r\n      toast.error(\"Playhead must be within selected element\");\r\n      return;\r\n    }\r\n    splitAndKeepLeft(trackId, elementId, currentTime);\r\n  };\r\n\r\n  const handleSplitAndKeepRight = () => {\r\n    if (selectedElements.length !== 1) {\r\n      toast.error(\"Select exactly one element\");\r\n      return;\r\n    }\r\n    const { trackId, elementId } = selectedElements[0];\r\n    const track = tracks.find((t) => t.id === trackId);\r\n    const element = track?.elements.find((c) => c.id === elementId);\r\n    if (!element) return;\r\n    const effectiveStart = element.startTime;\r\n    const effectiveEnd =\r\n      element.startTime +\r\n      (element.duration - element.trimStart - element.trimEnd);\r\n    if (currentTime <= effectiveStart || currentTime >= effectiveEnd) {\r\n      toast.error(\"Playhead must be within selected element\");\r\n      return;\r\n    }\r\n    splitAndKeepRight(trackId, elementId, currentTime);\r\n  };\r\n\r\n  const handleSeparateAudio = () => {\r\n    if (selectedElements.length !== 1) {\r\n      toast.error(\"Select exactly one media element to separate audio\");\r\n      return;\r\n    }\r\n    const { trackId, elementId } = selectedElements[0];\r\n    const track = tracks.find((t) => t.id === trackId);\r\n    if (!track || track.type !== \"media\") {\r\n      toast.error(\"Select a media element to separate audio\");\r\n      return;\r\n    }\r\n    separateAudio(trackId, elementId);\r\n  };\r\n\r\n  const handleDeleteSelected = () => {\r\n    if (selectedElements.length === 0) return;\r\n    selectedElements.forEach(({ trackId, elementId }) => {\r\n      if (rippleEditingEnabled) {\r\n        removeElementFromTrackWithRipple(trackId, elementId);\r\n      } else {\r\n        removeElementFromTrack(trackId, elementId);\r\n      }\r\n    });\r\n    clearSelectedElements();\r\n  };\r\n\r\n  // Zoom handlers\r\n  const handleZoomIn = () => {\r\n    setZoomLevel(Math.min(4, zoomLevel + 0.25));\r\n  };\r\n\r\n  const handleZoomOut = () => {\r\n    setZoomLevel(Math.max(0.25, zoomLevel - 0.25));\r\n  };\r\n\r\n  const handleZoomSliderChange = (values: number[]) => {\r\n    setZoomLevel(values[0]);\r\n  };\r\n\r\n  const handleToggleBookmark = async () => {\r\n    await toggleBookmark(currentTime);\r\n  };\r\n\r\n  // Check if the current time is bookmarked\r\n  const currentBookmarked = isBookmarked(currentTime);\r\n  return (\r\n    <div className=\"border-b flex items-center justify-between px-2 py-1\">\r\n      <div className=\"flex items-center gap-1 w-full\">\r\n        <TooltipProvider delayDuration={500}>\r\n          {/* Play/Pause Button */}\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button\r\n                variant=\"text\"\r\n                size=\"icon\"\r\n                onClick={toggle}\r\n                className=\"mr-2\"\r\n              >\r\n                {isPlaying ? (\r\n                  <Pause className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Play className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>\r\n              {isPlaying ? \"Pause (Space)\" : \"Play (Space)\"}\r\n            </TooltipContent>\r\n          </Tooltip>\r\n          <div className=\"w-px h-6 bg-border mx-1\" />\r\n          {/* Time Display */}\r\n          <div\r\n            className=\"text-xs text-muted-foreground font-mono px-2\"\r\n            style={{ minWidth: \"18ch\", textAlign: \"center\" }}\r\n          >\r\n            {currentTime.toFixed(1)}s / {duration.toFixed(1)}s\r\n          </div>\r\n          {/* Test Clip Button - for debugging */}\r\n          {tracks.length === 0 && (\r\n            <>\r\n              <div className=\"w-px h-6 bg-border mx-1\" />\r\n              <Tooltip>\r\n                <TooltipTrigger asChild>\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => {\r\n                      const trackId = addTrack(\"media\");\r\n                      addElementToTrack(trackId, {\r\n                        type: \"media\",\r\n                        mediaId: \"test\",\r\n                        name: \"Test Clip\",\r\n                        duration: TIMELINE_CONSTANTS.DEFAULT_TEXT_DURATION,\r\n                        startTime: 0,\r\n                        trimStart: 0,\r\n                        trimEnd: 0,\r\n                      });\r\n                    }}\r\n                    className=\"text-xs\"\r\n                  >\r\n                    Add Test Clip\r\n                  </Button>\r\n                </TooltipTrigger>\r\n                <TooltipContent>Add a test clip to try playback</TooltipContent>\r\n              </Tooltip>\r\n            </>\r\n          )}\r\n          <div className=\"w-px h-6 bg-border mx-1\" />\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button variant=\"text\" size=\"icon\" onClick={handleSplitSelected}>\r\n                <Scissors className=\"h-4 w-4\" />\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>Split element (Ctrl+S)</TooltipContent>\r\n          </Tooltip>\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button\r\n                variant=\"text\"\r\n                size=\"icon\"\r\n                onClick={handleSplitAndKeepLeft}\r\n              >\r\n                <ArrowLeftToLine className=\"h-4 w-4\" />\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>Split and keep left (Ctrl+Q)</TooltipContent>\r\n          </Tooltip>\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button\r\n                variant=\"text\"\r\n                size=\"icon\"\r\n                onClick={handleSplitAndKeepRight}\r\n              >\r\n                <ArrowRightToLine className=\"h-4 w-4\" />\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>Split and keep right (Ctrl+W)</TooltipContent>\r\n          </Tooltip>\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button variant=\"text\" size=\"icon\" onClick={handleSeparateAudio}>\r\n                <SplitSquareHorizontal className=\"h-4 w-4\" />\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>Separate audio (Ctrl+D)</TooltipContent>\r\n          </Tooltip>\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button\r\n                variant=\"text\"\r\n                size=\"icon\"\r\n                onClick={handleDuplicateSelected}\r\n              >\r\n                <Copy className=\"h-4 w-4\" />\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>Duplicate element (Ctrl+D)</TooltipContent>\r\n          </Tooltip>\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button variant=\"text\" size=\"icon\" onClick={handleFreezeSelected}>\r\n                <Snowflake className=\"h-4 w-4\" />\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>Freeze frame (F)</TooltipContent>\r\n          </Tooltip>\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button variant=\"text\" size=\"icon\" onClick={handleDeleteSelected}>\r\n                <Trash2 className=\"h-4 w-4\" />\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>Delete element (Delete)</TooltipContent>\r\n          </Tooltip>\r\n          <div className=\"w-px h-6 bg-border mx-1\" />\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button variant=\"text\" size=\"icon\" onClick={handleToggleBookmark}>\r\n                <Bookmark\r\n                  className={`h-4 w-4 ${currentBookmarked ? \"fill-primary text-primary\" : \"\"}`}\r\n                />\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>\r\n              {currentBookmarked ? \"Remove bookmark\" : \"Add bookmark\"}\r\n            </TooltipContent>\r\n          </Tooltip>\r\n        </TooltipProvider>\r\n      </div>\r\n      <div className=\"flex items-center gap-1\">\r\n        <TooltipProvider delayDuration={500}>\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button variant=\"text\" size=\"icon\" onClick={toggleSnapping}>\r\n                {snappingEnabled ? (\r\n                  <Magnet className=\"h-4 w-4 text-primary\" />\r\n                ) : (\r\n                  <Magnet className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>Auto snapping</TooltipContent>\r\n          </Tooltip>\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button variant=\"text\" size=\"icon\" onClick={toggleRippleEditing}>\r\n                <Link\r\n                  className={`h-4 w-4 ${\r\n                    rippleEditingEnabled ? \"text-primary\" : \"\"\r\n                  }`}\r\n                />\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>\r\n              {rippleEditingEnabled\r\n                ? \"Disable Ripple Editing\"\r\n                : \"Enable Ripple Editing\"}\r\n            </TooltipContent>\r\n          </Tooltip>\r\n        </TooltipProvider>\r\n\r\n        <div className=\"h-6 w-px bg-border mx-1\" />\r\n        <div className=\"flex items-center gap-1\">\r\n          <Button variant=\"text\" size=\"icon\" onClick={handleZoomOut}>\r\n            <ZoomOut className=\"h-4 w-4\" />\r\n          </Button>\r\n          <Slider\r\n            className=\"w-24\"\r\n            value={[zoomLevel]}\r\n            onValueChange={handleZoomSliderChange}\r\n            min={0.25}\r\n            max={4}\r\n            step={0.25}\r\n          />\r\n          <Button variant=\"text\" size=\"icon\" onClick={handleZoomIn}>\r\n            <ZoomIn className=\"h-4 w-4\" />\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","/* An `action` is a unique verb that is associated with certain thing that can be done on OpenCut.\r\n * For example, toggling playback or seeking.\r\n */\r\n\r\nimport {\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n  useCallback,\r\n  MutableRefObject,\r\n} from \"react\";\r\n\r\n// Simple event emitter for action changes\r\nclass ActionEmitter {\r\n  private listeners: Array<(actions: Action[]) => void> = [];\r\n\r\n  subscribe(listener: (actions: Action[]) => void) {\r\n    this.listeners.push(listener);\r\n    return () => {\r\n      this.listeners = this.listeners.filter((l) => l !== listener);\r\n    };\r\n  }\r\n\r\n  emit(actions: Action[]) {\r\n    this.listeners.forEach((listener) => listener(actions));\r\n  }\r\n}\r\n\r\nconst actionEmitter = new ActionEmitter();\r\n\r\nexport type Action =\r\n  | \"toggle-play\" // Toggle play/pause state\r\n  | \"stop-playback\" // Stop playback\r\n  | \"seek-forward\" // Seek forward in playback\r\n  | \"seek-backward\" // Seek backward in playback\r\n  | \"frame-step-forward\" // Step forward by one frame\r\n  | \"frame-step-backward\" // Step backward by one frame\r\n  | \"jump-forward\" // Jump forward by 5 seconds\r\n  | \"jump-backward\" // Jump backward by 5 seconds\r\n  | \"goto-start\" // Go to timeline start\r\n  | \"goto-end\" // Go to timeline end\r\n  | \"split-element\" // Split element at current time\r\n  | \"delete-selected\" // Delete selected elements\r\n  | \"select-all\" // Select all elements\r\n  | \"duplicate-selected\" // Duplicate selected element\r\n  | \"toggle-snapping\" // Toggle snapping\r\n  | \"undo\" // Undo last action\r\n  | \"redo\"; // Redo last undone action\r\n\r\n/**\r\n * Defines the arguments, if present for a given type that is required to be passed on\r\n * invocation and will be passed to action handlers.\r\n *\r\n * This type is supposed to be an object with the key being one of the actions mentioned above.\r\n * The value to the key can be anything.\r\n * If an action has no argument, you do not need to add it to this type.\r\n *\r\n * NOTE: We can't enforce type checks to make sure the key is Action, you\r\n * will know if you got something wrong if there is a type error in this file\r\n */\r\ntype ActionArgsMap = {\r\n  \"seek-forward\": { seconds: number } | undefined; // Args needed for seeking forward (default: 1)\r\n  \"seek-backward\": { seconds: number } | undefined; // Args needed for seeking backward (default: 1)\r\n  \"jump-forward\": { seconds: number } | undefined; // Args needed for jumping forward (default: 5)\r\n  \"jump-backward\": { seconds: number } | undefined; // Args needed for jumping backward (default: 5)\r\n};\r\n\r\ntype KeysWithValueUndefined<T> = {\r\n  [K in keyof T]: undefined extends T[K] ? K : never;\r\n}[keyof T];\r\n\r\n/**\r\n * Actions which require arguments for their invocation\r\n */\r\nexport type ActionWithArgs = keyof ActionArgsMap;\r\n\r\n/**\r\n * Actions which optionally takes in arguments for their invocation\r\n */\r\n\r\nexport type ActionWithOptionalArgs =\r\n  | ActionWithNoArgs\r\n  | KeysWithValueUndefined<ActionArgsMap>;\r\n\r\n/**\r\n * Actions which do not require arguments for their invocation\r\n */\r\nexport type ActionWithNoArgs = Exclude<Action, ActionWithArgs>;\r\n\r\n/**\r\n * Resolves the argument type for a given Action\r\n */\r\ntype ArgOfHoppAction<A extends Action> = A extends ActionWithArgs\r\n  ? ActionArgsMap[A]\r\n  : undefined;\r\n\r\n/**\r\n * Resolves the action function for a given Action, used by action handler function defs\r\n */\r\ntype ActionFunc<A extends Action> = A extends ActionWithArgs\r\n  ? (arg: ArgOfHoppAction<A>, trigger?: InvocationTriggers) => void\r\n  : (_?: undefined, trigger?: InvocationTriggers) => void;\r\n\r\ntype BoundActionList = {\r\n  [A in Action]?: Array<ActionFunc<A>>;\r\n};\r\n\r\nconst boundActions: BoundActionList = {};\r\n\r\nlet currentActiveActions: Action[] = [];\r\n\r\nfunction updateActiveActions() {\r\n  const newActions = Object.keys(boundActions) as Action[];\r\n  currentActiveActions = newActions;\r\n  actionEmitter.emit(newActions);\r\n}\r\n\r\nexport function bindAction<A extends Action>(\r\n  action: A,\r\n  handler: ActionFunc<A>\r\n) {\r\n  if (boundActions[action]) {\r\n    boundActions[action]?.push(handler);\r\n  } else {\r\n    // 'any' assertion because TypeScript doesn't seem to be able to figure out the links.\r\n    boundActions[action] = [handler] as any;\r\n  }\r\n\r\n  updateActiveActions();\r\n}\r\n\r\nexport type InvocationTriggers = \"keypress\" | \"mouseclick\";\r\n\r\ntype InvokeActionFunc = {\r\n  (\r\n    action: ActionWithOptionalArgs,\r\n    args?: undefined,\r\n    trigger?: InvocationTriggers\r\n  ): void;\r\n  <A extends ActionWithArgs>(action: A, args: ActionArgsMap[A]): void;\r\n};\r\n\r\n/**\r\n * Invokes an action, triggering action handlers if any registered.\r\n * The second and third arguments are optional\r\n * @param action The action to fire\r\n * @param args The argument passed to the action handler. Optional if action has no args required\r\n * @param trigger Optionally supply the trigger that invoked the action (keypress/mouseclick)\r\n */\r\nexport const invokeAction: InvokeActionFunc = <A extends Action>(\r\n  action: A,\r\n  args?: ArgOfHoppAction<A>,\r\n  trigger?: InvocationTriggers\r\n) => {\r\n  boundActions[action]?.forEach((handler) => (handler as any)(args, trigger));\r\n};\r\n\r\nexport function unbindAction<A extends Action>(\r\n  action: A,\r\n  handler: ActionFunc<A>\r\n) {\r\n  // 'any' assertion because TypeScript doesn't seem to be able to figure out the links.\r\n  boundActions[action] = boundActions[action]?.filter(\r\n    (x) => x !== handler\r\n  ) as any;\r\n\r\n  if (boundActions[action]?.length === 0) {\r\n    delete boundActions[action];\r\n  }\r\n\r\n  updateActiveActions();\r\n}\r\n\r\n/**\r\n * Returns whether a given action is bound at a given time\r\n *\r\n * @param action The action to check\r\n */\r\nexport function isActionBound(action: Action): boolean {\r\n  return !!boundActions[action];\r\n}\r\n\r\n/**\r\n * A React hook that defines a component can handle a given\r\n * Action. The handler will be bound when the component is mounted\r\n * and unbound when the component is unmounted.\r\n * @param action The action to be bound\r\n * @param handler The function to be called when the action is invoked\r\n * @param isActive A ref that indicates whether the action is active\r\n */\r\nexport function useActionHandler<A extends Action>(\r\n  action: A,\r\n  handler: ActionFunc<A>,\r\n  isActive: MutableRefObject<boolean> | boolean | undefined\r\n) {\r\n  const handlerRef = useRef(handler);\r\n  const [isBound, setIsBound] = useState(false);\r\n\r\n  // Update handler ref when handler changes\r\n  useEffect(() => {\r\n    handlerRef.current = handler;\r\n  }, [handler]);\r\n\r\n  // Create a stable handler wrapper\r\n  const stableHandler = useCallback(\r\n    (args: any, trigger?: InvocationTriggers) => {\r\n      (handlerRef.current as any)(args, trigger);\r\n    },\r\n    []\r\n  ) as ActionFunc<A>;\r\n\r\n  useEffect(() => {\r\n    const shouldBind =\r\n      isActive === undefined ||\r\n      (typeof isActive === \"boolean\" ? isActive : isActive.current);\r\n\r\n    if (shouldBind && !isBound) {\r\n      bindAction(action, stableHandler);\r\n      setIsBound(true);\r\n    } else if (!shouldBind && isBound) {\r\n      unbindAction(action, stableHandler);\r\n      setIsBound(false);\r\n    }\r\n\r\n    return () => {\r\n      if (isBound) {\r\n        unbindAction(action, stableHandler);\r\n        setIsBound(false);\r\n      }\r\n    };\r\n  }, [action, stableHandler, isActive, isBound]);\r\n\r\n  // Handle ref-based isActive changes\r\n  useEffect(() => {\r\n    if (isActive && typeof isActive === \"object\" && \"current\" in isActive) {\r\n      // Poll for ref changes\r\n      const interval = setInterval(() => {\r\n        const shouldBind = isActive.current;\r\n        if (shouldBind !== isBound) {\r\n          if (shouldBind) {\r\n            bindAction(action, stableHandler);\r\n          } else {\r\n            unbindAction(action, stableHandler);\r\n          }\r\n          setIsBound(shouldBind);\r\n        }\r\n      }, 100);\r\n      return () => clearInterval(interval);\r\n    }\r\n  }, [action, stableHandler, isActive, isBound]);\r\n}\r\n\r\n/**\r\n * A React hook that returns the current list of active actions\r\n * and re-renders when the list changes\r\n */\r\nexport function useActiveActions(): Action[] {\r\n  const [activeActions, setActiveActions] = useState<Action[]>([]);\r\n\r\n  useEffect(() => {\r\n    // Set initial value\r\n    setActiveActions(currentActiveActions);\r\n\r\n    // Subscribe to changes\r\n    const unsubscribe = actionEmitter.subscribe(setActiveActions);\r\n    return unsubscribe;\r\n  }, []);\r\n\r\n  return activeActions;\r\n}\r\n\r\n/**\r\n * A React hook that returns whether a specific action is currently bound\r\n * and re-renders when the binding state changes\r\n */\r\nexport function useIsActionBound(action: Action): boolean {\r\n  const [isBound, setIsBound] = useState(() => isActionBound(action));\r\n\r\n  useEffect(() => {\r\n    const updateBoundState = () => {\r\n      setIsBound(isActionBound(action));\r\n    };\r\n\r\n    // Set initial value\r\n    updateBoundState();\r\n\r\n    // Subscribe to changes\r\n    const unsubscribe = actionEmitter.subscribe(updateBoundState);\r\n    return unsubscribe;\r\n  }, [action]);\r\n\r\n  return isBound;\r\n}\r\n","import { useEffect } from \"react\";\r\nimport { invokeAction } from \"../constants/actions\";\r\nimport { useKeybindingsStore } from \"@/stores/keybindings-store\";\r\n\r\n/**\r\n * A composable that hooks to the caller component's\r\n * lifecycle and hooks to the keyboard events to fire\r\n * the appropriate actions based on keybindings\r\n */\r\nexport function useKeybindingsListener() {\r\n  const { keybindings, getKeybindingString, keybindingsEnabled, isRecording } =\r\n    useKeybindingsStore();\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (ev: KeyboardEvent) => {\r\n      // Do not check keybinds if the mode is disabled\r\n      if (!keybindingsEnabled) return;\r\n      // ignore key events if user is changing keybindings\r\n      if (isRecording) return;\r\n\r\n      const binding = getKeybindingString(ev);\r\n      if (!binding) return;\r\n\r\n      const boundAction = keybindings[binding];\r\n      if (!boundAction) return;\r\n\r\n      const activeElement = document.activeElement;\r\n      const isTextInput =\r\n        activeElement &&\r\n        (activeElement.tagName === \"INPUT\" ||\r\n          activeElement.tagName === \"TEXTAREA\" ||\r\n          (activeElement as HTMLElement).isContentEditable);\r\n\r\n      if (isTextInput) return;\r\n\r\n      ev.preventDefault();\r\n\r\n      // Handle actions with default arguments\r\n      let actionArgs: any;\r\n\r\n      if (boundAction === \"seek-forward\") {\r\n        actionArgs = { seconds: 1 };\r\n      } else if (boundAction === \"seek-backward\") {\r\n        actionArgs = { seconds: 1 };\r\n      } else if (boundAction === \"jump-forward\") {\r\n        actionArgs = { seconds: 5 };\r\n      } else if (boundAction === \"jump-backward\") {\r\n        actionArgs = { seconds: 5 };\r\n      }\r\n\r\n      invokeAction(boundAction, actionArgs, \"keypress\");\r\n    };\r\n\r\n    document.addEventListener(\"keydown\", handleKeyDown);\r\n\r\n    return () => {\r\n      document.removeEventListener(\"keydown\", handleKeyDown);\r\n    };\r\n  }, [keybindings, getKeybindingString, keybindingsEnabled, isRecording]);\r\n}\r\n\r\n/**\r\n * This composable allows for the UI component to be disabled if the component in question is mounted\r\n */\r\nexport function useKeybindingDisabler() {\r\n  const { disableKeybindings, enableKeybindings } = useKeybindingsStore();\r\n\r\n  return {\r\n    disableKeybindings,\r\n    enableKeybindings,\r\n  };\r\n}\r\n\r\n// Export the bindings for backward compatibility\r\nexport const bindings = {};\r\n","\"use client\";\r\n\r\nimport { useEffect } from \"react\";\r\nimport { useActionHandler } from \"@/constants/actions\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\nimport { useProjectStore } from \"@/stores/project-store\";\r\nimport { toast } from \"sonner\";\r\n\r\nexport function useEditorActions() {\r\n  const {\r\n    tracks,\r\n    selectedElements,\r\n    clearSelectedElements,\r\n    setSelectedElements,\r\n    removeElementFromTrack,\r\n    splitElement,\r\n    addElementToTrack,\r\n    snappingEnabled,\r\n    toggleSnapping,\r\n    undo,\r\n    redo,\r\n  } = useTimelineStore();\r\n\r\n  const { currentTime, duration, isPlaying, toggle, seek } = usePlaybackStore();\r\n  const { activeProject } = useProjectStore();\r\n\r\n  // Playback actions\r\n  useActionHandler(\r\n    \"toggle-play\",\r\n    () => {\r\n      toggle();\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"stop-playback\",\r\n    () => {\r\n      if (isPlaying) {\r\n        toggle();\r\n      }\r\n      seek(0);\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"seek-forward\",\r\n    (args) => {\r\n      const seconds = args?.seconds ?? 1;\r\n      seek(Math.min(duration, currentTime + seconds));\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"seek-backward\",\r\n    (args) => {\r\n      const seconds = args?.seconds ?? 1;\r\n      seek(Math.max(0, currentTime - seconds));\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"frame-step-forward\",\r\n    () => {\r\n      const projectFps = activeProject?.fps || 30;\r\n      seek(Math.min(duration, currentTime + 1 / projectFps));\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"frame-step-backward\",\r\n    () => {\r\n      const projectFps = activeProject?.fps || 30;\r\n      seek(Math.max(0, currentTime - 1 / projectFps));\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"jump-forward\",\r\n    (args) => {\r\n      const seconds = args?.seconds ?? 5;\r\n      seek(Math.min(duration, currentTime + seconds));\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"jump-backward\",\r\n    (args) => {\r\n      const seconds = args?.seconds ?? 5;\r\n      seek(Math.max(0, currentTime - seconds));\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"goto-start\",\r\n    () => {\r\n      seek(0);\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"goto-end\",\r\n    () => {\r\n      seek(duration);\r\n    },\r\n    undefined\r\n  );\r\n\r\n  // Timeline editing actions\r\n  useActionHandler(\r\n    \"split-element\",\r\n    () => {\r\n      if (selectedElements.length !== 1) {\r\n        toast.error(\"Select exactly one element to split\");\r\n        return;\r\n      }\r\n\r\n      const { trackId, elementId } = selectedElements[0];\r\n      const track = tracks.find((t: any) => t.id === trackId);\r\n      const element = track?.elements.find((el: any) => el.id === elementId);\r\n\r\n      if (element) {\r\n        const effectiveStart = element.startTime;\r\n        const effectiveEnd =\r\n          element.startTime +\r\n          (element.duration - element.trimStart - element.trimEnd);\r\n\r\n        if (currentTime > effectiveStart && currentTime < effectiveEnd) {\r\n          splitElement(trackId, elementId, currentTime);\r\n        } else {\r\n          toast.error(\"Playhead must be within selected element\");\r\n        }\r\n      }\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"delete-selected\",\r\n    () => {\r\n      if (selectedElements.length === 0) {\r\n        return;\r\n      }\r\n      selectedElements.forEach(\r\n        ({ trackId, elementId }: { trackId: string; elementId: string }) => {\r\n          removeElementFromTrack(trackId, elementId);\r\n        }\r\n      );\r\n      clearSelectedElements();\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"select-all\",\r\n    () => {\r\n      const allElements = tracks.flatMap((track: any) =>\r\n        track.elements.map((element: any) => ({\r\n          trackId: track.id,\r\n          elementId: element.id,\r\n        }))\r\n      );\r\n      setSelectedElements(allElements);\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"duplicate-selected\",\r\n    () => {\r\n      if (selectedElements.length !== 1) {\r\n        toast.error(\"Select exactly one element to duplicate\");\r\n        return;\r\n      }\r\n\r\n      const { trackId, elementId } = selectedElements[0];\r\n      const track = tracks.find((t: any) => t.id === trackId);\r\n      const element = track?.elements.find((el: any) => el.id === elementId);\r\n\r\n      if (element) {\r\n        const newStartTime =\r\n          element.startTime +\r\n          (element.duration - element.trimStart - element.trimEnd) +\r\n          0.1;\r\n        const { id, ...elementWithoutId } = element;\r\n\r\n        addElementToTrack(trackId, {\r\n          ...elementWithoutId,\r\n          startTime: newStartTime,\r\n        });\r\n      }\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"toggle-snapping\",\r\n    () => {\r\n      toggleSnapping();\r\n    },\r\n    undefined\r\n  );\r\n\r\n  // History actions\r\n  useActionHandler(\r\n    \"undo\",\r\n    () => {\r\n      undo();\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"redo\",\r\n    () => {\r\n      redo();\r\n    },\r\n    undefined\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { useEffect } from \"react\";\r\nimport { Loader2 } from \"lucide-react\";\r\nimport { useEditorStore } from \"@/stores/editor-store\";\r\nimport {\r\n  useKeybindingsListener,\r\n  useKeybindingDisabler,\r\n} from \"@/hooks/use-keybindings\";\r\nimport { useEditorActions } from \"@/hooks/use-editor-actions\";\r\n\r\ninterface EditorProviderProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport function EditorProvider({ children }: EditorProviderProps) {\r\n  const { isInitializing, isPanelsReady, initializeApp } = useEditorStore();\r\n  const { disableKeybindings, enableKeybindings } = useKeybindingDisabler();\r\n\r\n  // Set up action handlers\r\n  useEditorActions();\r\n\r\n  // Set up keybinding listener\r\n  useKeybindingsListener();\r\n\r\n  // Disable keybindings when initializing\r\n  useEffect(() => {\r\n    if (isInitializing || !isPanelsReady) {\r\n      disableKeybindings();\r\n    } else {\r\n      enableKeybindings();\r\n    }\r\n  }, [isInitializing, isPanelsReady, disableKeybindings, enableKeybindings]);\r\n\r\n  useEffect(() => {\r\n    initializeApp();\r\n  }, [initializeApp]);\r\n\r\n  // Show loading screen while initializing\r\n  if (isInitializing || !isPanelsReady) {\r\n    return (\r\n      <div className=\"h-screen w-screen flex items-center justify-center bg-background\">\r\n        <div className=\"flex flex-col items-center gap-4\">\r\n          <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\r\n          <p className=\"text-sm text-muted-foreground\">Loading editor...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // App is ready, render children\r\n  return <>{children}</>;\r\n}\r\n","import { create } from \"zustand\";\r\nimport { persist } from \"zustand/middleware\";\r\n\r\nexport type PanelPreset =\r\n  | \"default\"\r\n  | \"media\"\r\n  | \"inspector\"\r\n  | \"vertical-preview\";\r\n\r\ninterface PanelSizes {\r\n  toolsPanel: number;\r\n  previewPanel: number;\r\n  propertiesPanel: number;\r\n  mainContent: number;\r\n  timeline: number;\r\n}\r\n\r\nexport const PRESET_CONFIGS: Record<PanelPreset, PanelSizes> = {\r\n  default: {\r\n    toolsPanel: 25,\r\n    previewPanel: 50,\r\n    propertiesPanel: 25,\r\n    mainContent: 70,\r\n    timeline: 30,\r\n  },\r\n  media: {\r\n    toolsPanel: 30,\r\n    previewPanel: 45,\r\n    propertiesPanel: 25,\r\n    mainContent: 100,\r\n    timeline: 25,\r\n  },\r\n  inspector: {\r\n    toolsPanel: 30,\r\n    previewPanel: 70,\r\n    propertiesPanel: 30,\r\n    mainContent: 75,\r\n    timeline: 25,\r\n  },\r\n  \"vertical-preview\": {\r\n    toolsPanel: 30,\r\n    previewPanel: 40,\r\n    propertiesPanel: 30,\r\n    mainContent: 75,\r\n    timeline: 25,\r\n  },\r\n};\r\n\r\ninterface PanelState extends PanelSizes {\r\n  activePreset: PanelPreset;\r\n  presetCustomSizes: Record<PanelPreset, Partial<PanelSizes>>;\r\n  resetCounter: number;\r\n\r\n  mediaViewMode: \"grid\" | \"list\";\r\n\r\n  setToolsPanel: (size: number) => void;\r\n  setPreviewPanel: (size: number) => void;\r\n  setPropertiesPanel: (size: number) => void;\r\n  setMainContent: (size: number) => void;\r\n  setTimeline: (size: number) => void;\r\n  setMediaViewMode: (mode: \"grid\" | \"list\") => void;\r\n\r\n  setActivePreset: (preset: PanelPreset) => void;\r\n  resetPreset: (preset: PanelPreset) => void;\r\n  getCurrentPresetSizes: () => PanelSizes;\r\n}\r\n\r\nexport const usePanelStore = create<PanelState>()(\r\n  persist(\r\n    (set, get) => ({\r\n      ...PRESET_CONFIGS.default,\r\n      activePreset: \"default\" as PanelPreset,\r\n      presetCustomSizes: {\r\n        default: {},\r\n        media: {},\r\n        inspector: {},\r\n        \"vertical-preview\": {},\r\n      },\r\n      resetCounter: 0,\r\n\r\n      mediaViewMode: \"grid\" as const,\r\n\r\n      setToolsPanel: (size) => {\r\n        const { activePreset, presetCustomSizes } = get();\r\n        set({\r\n          toolsPanel: size,\r\n          presetCustomSizes: {\r\n            ...presetCustomSizes,\r\n            [activePreset]: {\r\n              ...presetCustomSizes[activePreset],\r\n              toolsPanel: size,\r\n            },\r\n          },\r\n        });\r\n      },\r\n      setPreviewPanel: (size) => {\r\n        const { activePreset, presetCustomSizes } = get();\r\n        set({\r\n          previewPanel: size,\r\n          presetCustomSizes: {\r\n            ...presetCustomSizes,\r\n            [activePreset]: {\r\n              ...presetCustomSizes[activePreset],\r\n              previewPanel: size,\r\n            },\r\n          },\r\n        });\r\n      },\r\n      setPropertiesPanel: (size) => {\r\n        const { activePreset, presetCustomSizes } = get();\r\n        set({\r\n          propertiesPanel: size,\r\n          presetCustomSizes: {\r\n            ...presetCustomSizes,\r\n            [activePreset]: {\r\n              ...presetCustomSizes[activePreset],\r\n              propertiesPanel: size,\r\n            },\r\n          },\r\n        });\r\n      },\r\n      setMainContent: (size) => {\r\n        const { activePreset, presetCustomSizes } = get();\r\n        set({\r\n          mainContent: size,\r\n          presetCustomSizes: {\r\n            ...presetCustomSizes,\r\n            [activePreset]: {\r\n              ...presetCustomSizes[activePreset],\r\n              mainContent: size,\r\n            },\r\n          },\r\n        });\r\n      },\r\n      setTimeline: (size) => {\r\n        const { activePreset, presetCustomSizes } = get();\r\n        set({\r\n          timeline: size,\r\n          presetCustomSizes: {\r\n            ...presetCustomSizes,\r\n            [activePreset]: {\r\n              ...presetCustomSizes[activePreset],\r\n              timeline: size,\r\n            },\r\n          },\r\n        });\r\n      },\r\n      setMediaViewMode: (mode) => set({ mediaViewMode: mode }),\r\n\r\n      setActivePreset: (preset) => {\r\n        const {\r\n          activePreset: currentPreset,\r\n          presetCustomSizes,\r\n          toolsPanel,\r\n          previewPanel,\r\n          propertiesPanel,\r\n          mainContent,\r\n          timeline,\r\n        } = get();\r\n\r\n        const updatedPresetCustomSizes = {\r\n          ...presetCustomSizes,\r\n          [currentPreset]: {\r\n            toolsPanel,\r\n            previewPanel,\r\n            propertiesPanel,\r\n            mainContent,\r\n            timeline,\r\n          },\r\n        };\r\n\r\n        const defaultSizes = PRESET_CONFIGS[preset];\r\n        const customSizes = updatedPresetCustomSizes[preset] || {};\r\n        const finalSizes = { ...defaultSizes, ...customSizes } as PanelSizes;\r\n\r\n        set({\r\n          activePreset: preset,\r\n          presetCustomSizes: updatedPresetCustomSizes,\r\n          ...finalSizes,\r\n        });\r\n      },\r\n\r\n      resetPreset: (preset) => {\r\n        const { presetCustomSizes, activePreset, resetCounter } = get();\r\n        const defaultSizes = PRESET_CONFIGS[preset];\r\n\r\n        const newPresetCustomSizes = {\r\n          ...presetCustomSizes,\r\n          [preset]: {},\r\n        };\r\n\r\n        const updates: Partial<PanelState> = {\r\n          presetCustomSizes: newPresetCustomSizes,\r\n          resetCounter: resetCounter + 1,\r\n        };\r\n\r\n        if (preset === activePreset) {\r\n          Object.assign(updates, defaultSizes);\r\n        }\r\n\r\n        set(updates);\r\n      },\r\n\r\n      getCurrentPresetSizes: () => {\r\n        const {\r\n          toolsPanel,\r\n          previewPanel,\r\n          propertiesPanel,\r\n          mainContent,\r\n          timeline,\r\n        } = get();\r\n        return {\r\n          toolsPanel,\r\n          previewPanel,\r\n          propertiesPanel,\r\n          mainContent,\r\n          timeline,\r\n        };\r\n      },\r\n    }),\r\n    {\r\n      name: \"panel-sizes\",\r\n    }\r\n  )\r\n);\r\n","\"use client\";\r\n\r\nimport { create } from \"zustand\";\r\nimport { persist } from \"zustand/middleware\";\r\nimport { ActionWithOptionalArgs } from \"@/constants/actions\";\r\nimport { isAppleDevice, isDOMElement, isTypableElement } from \"@/lib/utils\";\r\nimport { KeybindingConfig, ShortcutKey } from \"@/types/keybinding\";\r\n\r\n// Default keybindings configuration\r\nexport const defaultKeybindings: KeybindingConfig = {\r\n  space: \"toggle-play\",\r\n  j: \"seek-backward\",\r\n  k: \"toggle-play\",\r\n  l: \"seek-forward\",\r\n  left: \"frame-step-backward\",\r\n  right: \"frame-step-forward\",\r\n  \"shift+left\": \"jump-backward\",\r\n  \"shift+right\": \"jump-forward\",\r\n  home: \"goto-start\",\r\n  end: \"goto-end\",\r\n  s: \"split-element\",\r\n  n: \"toggle-snapping\",\r\n  \"ctrl+a\": \"select-all\",\r\n  \"ctrl+d\": \"duplicate-selected\",\r\n  \"ctrl+z\": \"undo\",\r\n  \"ctrl+shift+z\": \"redo\",\r\n  \"ctrl+y\": \"redo\",\r\n  delete: \"delete-selected\",\r\n  backspace: \"delete-selected\",\r\n};\r\n\r\nexport interface KeybindingConflict {\r\n  key: ShortcutKey;\r\n  existingAction: ActionWithOptionalArgs;\r\n  newAction: ActionWithOptionalArgs;\r\n}\r\n\r\ninterface KeybindingsState {\r\n  keybindings: KeybindingConfig;\r\n  isCustomized: boolean;\r\n  keybindingsEnabled: boolean;\r\n  isRecording: boolean;\r\n\r\n  // Actions\r\n  updateKeybinding: (key: ShortcutKey, action: ActionWithOptionalArgs) => void;\r\n  removeKeybinding: (key: ShortcutKey) => void;\r\n  resetToDefaults: () => void;\r\n  importKeybindings: (config: KeybindingConfig) => void;\r\n  exportKeybindings: () => KeybindingConfig;\r\n  enableKeybindings: () => void;\r\n  disableKeybindings: () => void;\r\n  setIsRecording: (isRecording: boolean) => void;\r\n\r\n  // Validation\r\n  validateKeybinding: (\r\n    key: ShortcutKey,\r\n    action: ActionWithOptionalArgs\r\n  ) => KeybindingConflict | null;\r\n  getKeybindingsForAction: (action: ActionWithOptionalArgs) => ShortcutKey[];\r\n\r\n  // Utility\r\n  getKeybindingString: (ev: KeyboardEvent) => ShortcutKey | null;\r\n}\r\n\r\nexport const useKeybindingsStore = create<KeybindingsState>()(\r\n  persist(\r\n    (set, get) => ({\r\n      keybindings: { ...defaultKeybindings },\r\n      isCustomized: false,\r\n      keybindingsEnabled: true,\r\n      isRecording: false,\r\n\r\n      updateKeybinding: (key: ShortcutKey, action: ActionWithOptionalArgs) => {\r\n        set((state) => {\r\n          const newKeybindings = { ...state.keybindings };\r\n          newKeybindings[key] = action;\r\n\r\n          return {\r\n            keybindings: newKeybindings,\r\n            isCustomized: true,\r\n          };\r\n        });\r\n      },\r\n\r\n      removeKeybinding: (key: ShortcutKey) => {\r\n        set((state) => {\r\n          const newKeybindings = { ...state.keybindings };\r\n          delete newKeybindings[key];\r\n\r\n          return {\r\n            keybindings: newKeybindings,\r\n            isCustomized: true,\r\n          };\r\n        });\r\n      },\r\n\r\n      resetToDefaults: () => {\r\n        set({\r\n          keybindings: { ...defaultKeybindings },\r\n          isCustomized: false,\r\n        });\r\n      },\r\n\r\n      enableKeybindings: () => {\r\n        set({ keybindingsEnabled: true });\r\n      },\r\n\r\n      disableKeybindings: () => {\r\n        set({ keybindingsEnabled: false });\r\n      },\r\n\r\n      importKeybindings: (config: KeybindingConfig) => {\r\n        // Validate all keys and actions\r\n        for (const [key, action] of Object.entries(config)) {\r\n          // Validate the key format\r\n          if (typeof key !== \"string\" || key.length === 0) {\r\n            throw new Error(`Invalid key format: ${key}`);\r\n          }\r\n        }\r\n        set({\r\n          keybindings: { ...config },\r\n          isCustomized: true,\r\n        });\r\n      },\r\n\r\n      exportKeybindings: () => {\r\n        return get().keybindings;\r\n      },\r\n\r\n      validateKeybinding: (\r\n        key: ShortcutKey,\r\n        action: ActionWithOptionalArgs\r\n      ) => {\r\n        const { keybindings } = get();\r\n        const existingAction = keybindings[key];\r\n\r\n        if (existingAction && existingAction !== action) {\r\n          return {\r\n            key,\r\n            existingAction,\r\n            newAction: action,\r\n          };\r\n        }\r\n\r\n        return null;\r\n      },\r\n      setIsRecording: (isRecording: boolean) => {\r\n        set({ isRecording });\r\n      },\r\n\r\n      getKeybindingsForAction: (action: ActionWithOptionalArgs) => {\r\n        const { keybindings } = get();\r\n        return Object.keys(keybindings).filter(\r\n          (key) => keybindings[key as ShortcutKey] === action\r\n        ) as ShortcutKey[];\r\n      },\r\n\r\n      getKeybindingString: (ev: KeyboardEvent) => {\r\n        return generateKeybindingString(ev) as ShortcutKey | null;\r\n      },\r\n    }),\r\n    {\r\n      name: \"opencut-keybindings\",\r\n      version: 1,\r\n    }\r\n  )\r\n);\r\n\r\n// Utility functions\r\nfunction generateKeybindingString(ev: KeyboardEvent): ShortcutKey | null {\r\n  const target = ev.target;\r\n\r\n  // We may or may not have a modifier key\r\n  const modifierKey = getActiveModifier(ev);\r\n\r\n  // We will always have a non-modifier key\r\n  const key = getPressedKey(ev);\r\n  if (!key) return null;\r\n\r\n  // All key combos backed by modifiers are valid shortcuts (whether currently typing or not)\r\n  if (modifierKey) {\r\n    // If the modifier is shift and the target is an input, we ignore\r\n    if (\r\n      modifierKey === \"shift\" &&\r\n      isDOMElement(target) &&\r\n      isTypableElement(target)\r\n    ) {\r\n      return null;\r\n    }\r\n\r\n    return `${modifierKey}+${key}` as ShortcutKey;\r\n  }\r\n\r\n  // no modifier key here then we do not do anything while on input\r\n  if (isDOMElement(target) && isTypableElement(target)) return null;\r\n\r\n  // single key while not input\r\n  return `${key}` as ShortcutKey;\r\n}\r\n\r\nfunction getPressedKey(ev: KeyboardEvent): string | null {\r\n  // Sometimes the property code is not available on the KeyboardEvent object\r\n  const key = (ev.key ?? \"\").toLowerCase();\r\n  const code = ev.code ?? \"\";\r\n\r\n  // Check arrow keys\r\n  if (key.startsWith(\"arrow\")) {\r\n    return key.slice(5);\r\n  }\r\n\r\n  // Check for special keys\r\n  if (key === \"tab\") return \"tab\";\r\n  if (key === \" \" || key === \"space\") return \"space\";\r\n  if (key === \"home\") return \"home\";\r\n  if (key === \"end\") return \"end\";\r\n  if (key === \"delete\") return \"delete\";\r\n  if (key === \"backspace\") return \"backspace\";\r\n\r\n  // Check letter keys\r\n  if (code.startsWith(\"Key\")) {\r\n    const letter = code.slice(3).toLowerCase();\r\n    if (letter.length === 1 && letter >= \"a\" && letter <= \"z\") {\r\n      return letter;\r\n    }\r\n  }\r\n\r\n  // Check number keys using physical position for AZERTY support\r\n  if (code.startsWith(\"Digit\")) {\r\n    const digit = code.slice(5);\r\n    if (digit.length === 1 && digit >= \"0\" && digit <= \"9\") {\r\n      return digit;\r\n    }\r\n  }\r\n\r\n  // Fallback for other layouts\r\n  const isDigit = key.length === 1 && key >= \"0\" && key <= \"9\";\r\n  if (isDigit) return key;\r\n\r\n  // Check if slash, period or enter\r\n  if (key === \"/\" || key === \".\" || key === \"enter\") return key;\r\n\r\n  // If no other cases match, this is not a valid key\r\n  return null;\r\n}\r\n\r\nfunction getActiveModifier(ev: KeyboardEvent): string | null {\r\n  const modifierKeys = {\r\n    ctrl: isAppleDevice() ? ev.metaKey : ev.ctrlKey,\r\n    alt: ev.altKey,\r\n    shift: ev.shiftKey,\r\n  };\r\n\r\n  // active modifier: ctrl | alt | ctrl+alt | ctrl+shift | ctrl+alt+shift | alt+shift\r\n  // modiferKeys object's keys are sorted to match the above order\r\n  const activeModifier = Object.keys(modifierKeys)\r\n    .filter((key) => modifierKeys[key as keyof typeof modifierKeys])\r\n    .join(\"+\");\r\n\r\n  return activeModifier === \"\" ? null : activeModifier;\r\n}\r\n","\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { Slider as SliderPrimitive } from \"radix-ui\";\r\n\r\nimport { cn } from \"../../lib/utils\";\r\n\r\nconst Slider = React.forwardRef<\r\n  React.ElementRef<typeof SliderPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\r\n>(({ className, ...props }, ref) => (\r\n  <SliderPrimitive.Root\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex w-full touch-none select-none items-center\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\r\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\r\n    </SliderPrimitive.Track>\r\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow-sm transition-colors focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\r\n  </SliderPrimitive.Root>\r\n));\r\nSlider.displayName = SliderPrimitive.Root.displayName;\r\n\r\nexport { Slider };\r\n","\"use client\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport { ReactNode } from \"react\";\r\n\r\ninterface HeaderBaseProps {\r\n  leftContent?: ReactNode;\r\n  centerContent?: ReactNode;\r\n  rightContent?: ReactNode;\r\n  className?: string;\r\n  children?: ReactNode;\r\n}\r\n\r\nexport function HeaderBase({\r\n  leftContent,\r\n  centerContent,\r\n  rightContent,\r\n  className,\r\n  children,\r\n}: HeaderBaseProps) {\r\n  // If children is provided, render it directly without the grid layout\r\n  if (children) {\r\n    return (\r\n      <header className={cn(\"px-6 h-16 flex items-center\", className)}>\r\n        {children}\r\n      </header>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <header\r\n      className={cn(\"px-6 h-14 flex justify-between items-center\", className)}\r\n    >\r\n      {leftContent && <div className=\"flex items-center\">{leftContent}</div>}\r\n      {centerContent && (\r\n        <div className=\"flex items-center\">{centerContent}</div>\r\n      )}\r\n      {rightContent && <div className=\"flex items-center\">{rightContent}</div>}\r\n    </header>\r\n  );\r\n}\r\n","import {\r\n  CaptionsIcon,\r\n  ArrowLeftRightIcon,\r\n  SparklesIcon,\r\n  StickerIcon,\r\n  MusicIcon,\r\n  VideoIcon,\r\n  BlendIcon,\r\n  SlidersHorizontalIcon,\r\n  LucideIcon,\r\n  TypeIcon,\r\n  SettingsIcon,\r\n} from \"lucide-react\";\r\nimport { create } from \"zustand\";\r\n\r\nexport type Tab =\r\n  | \"media\"\r\n  | \"sounds\"\r\n  | \"text\"\r\n  | \"stickers\"\r\n  | \"effects\"\r\n  | \"transitions\"\r\n  | \"captions\"\r\n  | \"filters\"\r\n  | \"adjustment\"\r\n  | \"settings\";\r\n\r\nexport const tabs: { [key in Tab]: { icon: LucideIcon; label: string } } = {\r\n  media: {\r\n    icon: VideoIcon,\r\n    label: \"Media\",\r\n  },\r\n  sounds: {\r\n    icon: MusicIcon,\r\n    label: \"Sounds\",\r\n  },\r\n  text: {\r\n    icon: TypeIcon,\r\n    label: \"Text\",\r\n  },\r\n  stickers: {\r\n    icon: StickerIcon,\r\n    label: \"Stickers\",\r\n  },\r\n  effects: {\r\n    icon: SparklesIcon,\r\n    label: \"Effects\",\r\n  },\r\n  transitions: {\r\n    icon: ArrowLeftRightIcon,\r\n    label: \"Transitions\",\r\n  },\r\n  captions: {\r\n    icon: CaptionsIcon,\r\n    label: \"Captions\",\r\n  },\r\n  filters: {\r\n    icon: BlendIcon,\r\n    label: \"Filters\",\r\n  },\r\n  adjustment: {\r\n    icon: SlidersHorizontalIcon,\r\n    label: \"Adjustment\",\r\n  },\r\n  settings: {\r\n    icon: SettingsIcon,\r\n    label: \"Settings\",\r\n  },\r\n};\r\n\r\ninterface MediaPanelStore {\r\n  activeTab: Tab;\r\n  setActiveTab: (tab: Tab) => void;\r\n}\r\n\r\nexport const useMediaPanelStore = create<MediaPanelStore>((set) => ({\r\n  activeTab: \"media\",\r\n  setActiveTab: (tab) => set({ activeTab: tab }),\r\n}));\r\n","\"use client\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Tab, tabs, useMediaPanelStore } from \"./store\";\r\nimport {\r\n  Tooltip,\r\n  TooltipContent,\r\n  TooltipTrigger,\r\n} from \"@/components/ui/tooltip\";\r\n\r\nexport function TabBar() {\r\n  const { activeTab, setActiveTab } = useMediaPanelStore();\r\n\r\n  return (\r\n    <div className=\"flex\">\r\n      <div className=\"h-full px-4 flex flex-col justify-start items-center gap-5 overflow-x-auto scrollbar-x-hidden relative w-full py-4\">\r\n        {(Object.keys(tabs) as Tab[]).map((tabKey) => {\r\n          const tab = tabs[tabKey];\r\n          return (\r\n            <div\r\n              className={cn(\r\n                \"flex z-[100] flex-col gap-0.5 items-center cursor-pointer\",\r\n                activeTab === tabKey\r\n                  ? \"text-primary !opacity-100\"\r\n                  : \"text-muted-foreground\"\r\n              )}\r\n              onClick={() => setActiveTab(tabKey)}\r\n              key={tabKey}\r\n            >\r\n              <Tooltip delayDuration={10}>\r\n                <TooltipTrigger asChild>\r\n                  <tab.icon className=\"size-[1.1rem]! opacity-100 hover:opacity-75\" />\r\n                </TooltipTrigger>\r\n                <TooltipContent\r\n                  side=\"right\"\r\n                  align=\"center\"\r\n                  variant=\"sidebar\"\r\n                  sideOffset={8}\r\n                >\r\n                  <div className=\"dark:text-base-gray-950 text-black text-sm font-medium leading-none dark:text-white\">\r\n                    {tab.label}\r\n                  </div>\r\n                </TooltipContent>\r\n              </Tooltip>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { useState, useRef } from \"react\";\r\n\r\ninterface UseDragDropOptions {\r\n  onDrop?: (files: FileList) => void;\r\n}\r\n\r\n// Helper function to check if drag contains files from external sources (not internal app drags)\r\nconst containsFiles = (dataTransfer: DataTransfer): boolean => {\r\n  // Check if this is an internal app drag (media item)\r\n  if (dataTransfer.types.includes(\"application/x-media-item\")) {\r\n    return false;\r\n  }\r\n\r\n  // Only show overlay for external file drags\r\n  return dataTransfer.types.includes(\"Files\");\r\n};\r\n\r\nexport function useDragDrop(options: UseDragDropOptions = {}) {\r\n  const [isDragOver, setIsDragOver] = useState(false);\r\n  const dragCounterRef = useRef(0);\r\n\r\n  const handleDragEnter = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n\r\n    // Only handle external file drags, not internal app element drags\r\n    if (!containsFiles(e.dataTransfer)) {\r\n      return;\r\n    }\r\n\r\n    dragCounterRef.current += 1;\r\n    if (!isDragOver) {\r\n      setIsDragOver(true);\r\n    }\r\n  };\r\n\r\n  const handleDragOver = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n\r\n    // Only handle file drags\r\n    if (!containsFiles(e.dataTransfer)) {\r\n      return;\r\n    }\r\n  };\r\n\r\n  const handleDragLeave = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n\r\n    // Only handle file drags\r\n    if (!containsFiles(e.dataTransfer)) {\r\n      return;\r\n    }\r\n\r\n    dragCounterRef.current -= 1;\r\n    if (dragCounterRef.current === 0) {\r\n      setIsDragOver(false);\r\n    }\r\n  };\r\n\r\n  const handleDrop = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragOver(false);\r\n    dragCounterRef.current = 0;\r\n\r\n    // Only handle file drops\r\n    if (\r\n      options.onDrop &&\r\n      e.dataTransfer.files &&\r\n      containsFiles(e.dataTransfer)\r\n    ) {\r\n      options.onDrop(e.dataTransfer.files);\r\n    }\r\n  };\r\n\r\n  const dragProps = {\r\n    onDragEnter: handleDragEnter,\r\n    onDragOver: handleDragOver,\r\n    onDragLeave: handleDragLeave,\r\n    onDrop: handleDrop,\r\n  };\r\n\r\n  return {\r\n    isDragOver,\r\n    dragProps,\r\n  };\r\n}\r\n","import { Upload, Plus, Image } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\ninterface MediaDragOverlayProps {\r\n  isVisible: boolean;\r\n  isProcessing?: boolean;\r\n  progress?: number;\r\n  onClick?: () => void;\r\n  isEmptyState?: boolean;\r\n}\r\n\r\nexport function MediaDragOverlay({\r\n  isVisible,\r\n  isProcessing = false,\r\n  progress = 0,\r\n  onClick,\r\n  isEmptyState = false,\r\n}: MediaDragOverlayProps) {\r\n  if (!isVisible) return null;\r\n\r\n  const handleClick = (e: React.MouseEvent) => {\r\n    if (isProcessing || !onClick) return;\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    onClick();\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className=\"flex flex-col items-center justify-center gap-4 h-full text-center rounded-lg bg-foreground/5 hover:bg-foreground/10 transition-all duration-200 p-8\"\r\n      onClick={handleClick}\r\n    >\r\n      <div className=\"flex items-center justify-center\">\r\n        <Upload className=\"h-10 w-10 text-foreground\" />\r\n      </div>\r\n\r\n      <div className=\"space-y-2\">\r\n        <p className=\"text-xs text-muted-foreground max-w-sm\">\r\n          {isProcessing\r\n            ? `Processing your files (${progress}%)`\r\n            : \"Drag and drop videos, photos, and audio files here\"}\r\n        </p>\r\n      </div>\r\n\r\n      {isProcessing && (\r\n        <div className=\"w-full max-w-xs\">\r\n          <div className=\"w-full bg-muted/50 rounded-full h-2\">\r\n            <div\r\n              className=\"bg-primary h-2 rounded-full transition-all duration-300\"\r\n              style={{ width: `${progress}%` }}\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { AspectRatio as AspectRatioPrimitive } from \"radix-ui\";\r\n\r\nconst AspectRatio = AspectRatioPrimitive.Root;\r\n\r\nexport { AspectRatio };\r\n","\"use client\";\r\n\r\nimport { AspectRatio } from \"@/components/ui/aspect-ratio\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  Tooltip,\r\n  TooltipContent,\r\n  TooltipTrigger,\r\n} from \"@/components/ui/tooltip\";\r\nimport { ReactNode, useState, useRef, useEffect } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { Plus } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\n\r\nexport interface DraggableMediaItemProps {\r\n  name: string;\r\n  preview: ReactNode;\r\n  dragData: Record<string, any>;\r\n  onDragStart?: (e: React.DragEvent) => void;\r\n  onAddToTimeline?: (currentTime: number) => void;\r\n  aspectRatio?: number;\r\n  className?: string;\r\n  showPlusOnDrag?: boolean;\r\n  showLabel?: boolean;\r\n  rounded?: boolean;\r\n  variant?: \"card\" | \"compact\";\r\n}\r\n\r\nexport function DraggableMediaItem({\r\n  name,\r\n  preview,\r\n  dragData,\r\n  onDragStart,\r\n  onAddToTimeline,\r\n  aspectRatio = 16 / 9,\r\n  className = \"\",\r\n  showPlusOnDrag = true,\r\n  showLabel = true,\r\n  rounded = true,\r\n  variant = \"card\",\r\n}: DraggableMediaItemProps) {\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  const [dragPosition, setDragPosition] = useState({ x: 0, y: 0 });\r\n  const dragRef = useRef<HTMLDivElement>(null);\r\n  const currentTime = usePlaybackStore((state) => state.currentTime);\r\n\r\n  const handleAddToTimeline = () => {\r\n    onAddToTimeline?.(currentTime);\r\n  };\r\n\r\n  const emptyImg = new window.Image();\r\n  emptyImg.src =\r\n    \"data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=\";\r\n\r\n  useEffect(() => {\r\n    if (!isDragging) return;\r\n\r\n    const handleDragOver = (e: DragEvent) => {\r\n      setDragPosition({ x: e.clientX, y: e.clientY });\r\n    };\r\n\r\n    document.addEventListener(\"dragover\", handleDragOver);\r\n\r\n    return () => {\r\n      document.removeEventListener(\"dragover\", handleDragOver);\r\n    };\r\n  }, [isDragging]);\r\n\r\n  const handleDragStart = (e: React.DragEvent) => {\r\n    e.dataTransfer.setDragImage(emptyImg, 0, 0);\r\n\r\n    // Set drag data\r\n    e.dataTransfer.setData(\r\n      \"application/x-media-item\",\r\n      JSON.stringify(dragData)\r\n    );\r\n    e.dataTransfer.effectAllowed = \"copy\";\r\n\r\n    // Set initial position and show custom drag preview\r\n    setDragPosition({ x: e.clientX, y: e.clientY });\r\n    setIsDragging(true);\r\n\r\n    onDragStart?.(e);\r\n  };\r\n\r\n  const handleDragEnd = () => {\r\n    setIsDragging(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {variant === \"card\" ? (\r\n        <div ref={dragRef} className=\"relative group w-28 h-28\">\r\n          <div\r\n            className={`flex flex-col gap-1 p-0 h-auto w-full relative cursor-default ${className}`}\r\n          >\r\n            <AspectRatio\r\n              ratio={aspectRatio}\r\n              className={cn(\r\n                \"bg-panel-accent relative overflow-hidden\",\r\n                rounded && \"rounded-md\",\r\n                \"[&::-webkit-drag-ghost]:opacity-0\" // Webkit-specific ghost hiding\r\n              )}\r\n              draggable={true}\r\n              onDragStart={handleDragStart}\r\n              onDragEnd={handleDragEnd}\r\n            >\r\n              {preview}\r\n              {!isDragging && (\r\n                <PlusButton\r\n                  className=\"opacity-0 group-hover:opacity-100\"\r\n                  onClick={handleAddToTimeline}\r\n                />\r\n              )}\r\n            </AspectRatio>\r\n            {showLabel && (\r\n              <span\r\n                className=\"text-[0.7rem] text-muted-foreground truncate w-full text-left\"\r\n                aria-label={name}\r\n                title={name}\r\n              >\r\n                {name.length > 8\r\n                  ? `${name.slice(0, 16)}...${name.slice(-3)}`\r\n                  : name}\r\n              </span>\r\n            )}\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div ref={dragRef} className=\"relative group w-full\">\r\n          <div\r\n            className={cn(\r\n              \"h-10 flex items-center gap-3 cursor-default w-full\",\r\n              \"[&::-webkit-drag-ghost]:opacity-0\",\r\n              className\r\n            )}\r\n            draggable={true}\r\n            onDragStart={handleDragStart}\r\n            onDragEnd={handleDragEnd}\r\n          >\r\n            <div className=\"w-6 h-6 flex-shrink-0 rounded overflow-hidden\">\r\n              {preview}\r\n            </div>\r\n            <span className=\"text-sm truncate flex-1 w-full\">{name}</span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Custom drag preview */}\r\n      {isDragging &&\r\n        typeof document !== \"undefined\" &&\r\n        createPortal(\r\n          <div\r\n            className=\"fixed pointer-events-none z-9999\"\r\n            style={{\r\n              left: dragPosition.x - 40, // Center the preview (half of 80px)\r\n              top: dragPosition.y - 40, // Center the preview (half of 80px)\r\n            }}\r\n          >\r\n            <div className=\"w-[80px]\">\r\n              <AspectRatio\r\n                ratio={1}\r\n                className=\"relative rounded-md overflow-hidden shadow-2xl ring-3 ring-primary\"\r\n              >\r\n                <div className=\"w-full h-full [&_img]:w-full [&_img]:h-full [&_img]:object-cover [&_img]:rounded-none\">\r\n                  {preview}\r\n                </div>\r\n                {showPlusOnDrag && (\r\n                  <PlusButton\r\n                    onClick={handleAddToTimeline}\r\n                    tooltipText=\"Add to timeline or drag to position\"\r\n                  />\r\n                )}\r\n              </AspectRatio>\r\n            </div>\r\n          </div>,\r\n          document.body\r\n        )}\r\n    </>\r\n  );\r\n}\r\n\r\nfunction PlusButton({\r\n  className,\r\n  onClick,\r\n  tooltipText,\r\n}: {\r\n  className?: string;\r\n  onClick?: () => void;\r\n  tooltipText?: string;\r\n}) {\r\n  const button = (\r\n    <Button\r\n      size=\"icon\"\r\n      className={cn(\r\n        \"absolute bottom-2 right-2 size-4 bg-background text-foreground\",\r\n        className\r\n      )}\r\n      onClick={(e) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        onClick?.();\r\n      }}\r\n      title={tooltipText}\r\n    >\r\n      <Plus className=\"size-3!\" />\r\n    </Button>\r\n  );\r\n\r\n  if (tooltipText) {\r\n    return (\r\n      <Tooltip>\r\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\r\n        <TooltipContent>\r\n          <p>{tooltipText}</p>\r\n        </TooltipContent>\r\n      </Tooltip>\r\n    );\r\n  }\r\n\r\n  return button;\r\n}\r\n","\"use client\";\r\n\r\nimport { useDragDrop } from \"@/hooks/use-drag-drop\";\r\nimport { processMediaFiles } from \"@/lib/media-processing\";\r\nimport { useMediaStore, type MediaItem } from \"@/stores/media-store\";\r\nimport {\r\n  ArrowDown01,\r\n  CloudUpload,\r\n  Grid2X2,\r\n  Image,\r\n  List,\r\n  Loader2,\r\n  Music,\r\n  Search,\r\n  Video,\r\n} from \"lucide-react\";\r\nimport { useEffect, useRef, useState, useMemo } from \"react\";\r\nimport { toast } from \"sonner\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { MediaDragOverlay } from \"@/components/editor/media-panel/drag-overlay\";\r\nimport {\r\n  ContextMenu,\r\n  ContextMenuContent,\r\n  ContextMenuItem,\r\n  ContextMenuTrigger,\r\n} from \"@/components/ui/context-menu\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuTrigger,\r\n} from \"@/components/ui/dropdown-menu\";\r\nimport { DraggableMediaItem } from \"@/components/ui/draggable-item\";\r\nimport { useProjectStore } from \"@/stores/project-store\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport {\r\n  Tooltip,\r\n  TooltipContent,\r\n  TooltipProvider,\r\n  TooltipTrigger,\r\n} from \"@/components/ui/tooltip\";\r\nimport { usePanelStore } from \"@/stores/panel-store\";\r\n\r\nfunction MediaItemWithContextMenu({\r\n  item,\r\n  children,\r\n  onRemove,\r\n}: {\r\n  item: MediaItem;\r\n  children: React.ReactNode;\r\n  onRemove: (e: React.MouseEvent, id: string) => Promise<void>;\r\n}) {\r\n  return (\r\n    <ContextMenu>\r\n      <ContextMenuTrigger>{children}</ContextMenuTrigger>\r\n      <ContextMenuContent>\r\n        <ContextMenuItem>Export clips</ContextMenuItem>\r\n        <ContextMenuItem\r\n          variant=\"destructive\"\r\n          onClick={(e) => onRemove(e, item.id)}\r\n        >\r\n          Delete\r\n        </ContextMenuItem>\r\n      </ContextMenuContent>\r\n    </ContextMenu>\r\n  );\r\n}\r\n\r\nexport function MediaView() {\r\n  const { mediaItems, addMediaItem, removeMediaItem } = useMediaStore();\r\n  const { activeProject } = useProjectStore();\r\n  const { mediaViewMode, setMediaViewMode } = usePanelStore();\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [progress, setProgress] = useState(0);\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [mediaFilter, setMediaFilter] = useState(\"all\");\r\n  const [sortBy, setSortBy] = useState<\"name\" | \"type\" | \"duration\" | \"size\">(\r\n    \"name\"\r\n  );\r\n  const [sortOrder, setSortOrder] = useState<\"asc\" | \"desc\">(\"asc\");\r\n\r\n  const processFiles = async (files: FileList | File[]) => {\r\n    if (!files || files.length === 0) return;\r\n    if (!activeProject) {\r\n      toast.error(\"No active project\");\r\n      return;\r\n    }\r\n\r\n    setIsProcessing(true);\r\n    setProgress(0);\r\n    try {\r\n      // Process files (extract metadata, generate thumbnails, etc.)\r\n      const processedItems = await processMediaFiles(files, (p) =>\r\n        setProgress(p)\r\n      );\r\n      // Add each processed media item to the store\r\n      for (const item of processedItems) {\r\n        await addMediaItem(activeProject.id, item);\r\n      }\r\n    } catch (error) {\r\n      // Show error toast if processing fails\r\n      console.error(\"Error processing files:\", error);\r\n      toast.error(\"Failed to process files\");\r\n    } finally {\r\n      setIsProcessing(false);\r\n      setProgress(0);\r\n    }\r\n  };\r\n\r\n  const { isDragOver, dragProps } = useDragDrop({\r\n    // When files are dropped, process them\r\n    onDrop: processFiles,\r\n  });\r\n\r\n  const handleFileSelect = () => fileInputRef.current?.click(); // Open file picker\r\n\r\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    // When files are selected via file picker, process them\r\n    if (e.target.files) processFiles(e.target.files);\r\n    e.target.value = \"\"; // Reset input\r\n  };\r\n\r\n  const handleRemove = async (e: React.MouseEvent, id: string) => {\r\n    // Remove a media item from the store\r\n    e.stopPropagation();\r\n\r\n    if (!activeProject) {\r\n      toast.error(\"No active project\");\r\n      return;\r\n    }\r\n\r\n    // Media store now handles cascade deletion automatically\r\n    await removeMediaItem(activeProject.id, id);\r\n  };\r\n\r\n  const formatDuration = (duration: number) => {\r\n    // Format seconds as mm:ss\r\n    const min = Math.floor(duration / 60);\r\n    const sec = Math.floor(duration % 60);\r\n    return `${min}:${sec.toString().padStart(2, \"0\")}`;\r\n  };\r\n\r\n  const [filteredMediaItems, setFilteredMediaItems] = useState(mediaItems);\r\n\r\n  useEffect(() => {\r\n    let filtered = mediaItems.filter((item) => {\r\n      if (mediaFilter && mediaFilter !== \"all\" && item.type !== mediaFilter) {\r\n        return false;\r\n      }\r\n\r\n      if (\r\n        searchQuery &&\r\n        !item.name.toLowerCase().includes(searchQuery.toLowerCase())\r\n      ) {\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    });\r\n\r\n    filtered.sort((a, b) => {\r\n      let valueA: any;\r\n      let valueB: any;\r\n\r\n      switch (sortBy) {\r\n        case \"name\":\r\n          valueA = a.name.toLowerCase();\r\n          valueB = b.name.toLowerCase();\r\n          break;\r\n        case \"type\":\r\n          valueA = a.type;\r\n          valueB = b.type;\r\n          break;\r\n        case \"duration\":\r\n          valueA = a.duration || 0;\r\n          valueB = b.duration || 0;\r\n          break;\r\n        case \"size\":\r\n          valueA = a.file.size;\r\n          valueB = b.file.size;\r\n          break;\r\n        default:\r\n          return 0;\r\n      }\r\n\r\n      if (valueA < valueB) return sortOrder === \"asc\" ? -1 : 1;\r\n      if (valueA > valueB) return sortOrder === \"asc\" ? 1 : -1;\r\n      return 0;\r\n    });\r\n\r\n    setFilteredMediaItems(filtered);\r\n  }, [mediaItems, mediaFilter, searchQuery, sortBy, sortOrder]);\r\n\r\n  const previewComponents = useMemo(() => {\r\n    const previews = new Map<string, React.ReactNode>();\r\n\r\n    filteredMediaItems.forEach((item) => {\r\n      let preview: React.ReactNode;\r\n\r\n      if (item.type === \"image\") {\r\n        preview = (\r\n          <div className=\"w-full h-full flex items-center justify-center\">\r\n            <img\r\n              src={item.url}\r\n              alt={item.name}\r\n              className=\"max-w-full max-h-full object-contain\"\r\n              loading=\"lazy\"\r\n            />\r\n          </div>\r\n        );\r\n      } else if (item.type === \"video\") {\r\n        if (item.thumbnailUrl) {\r\n          preview = (\r\n            <div className=\"relative w-full h-full\">\r\n              <img\r\n                src={item.thumbnailUrl}\r\n                alt={item.name}\r\n                className=\"w-full h-full object-cover rounded\"\r\n                loading=\"lazy\"\r\n              />\r\n              <div className=\"absolute inset-0 flex items-center justify-center bg-black/20 rounded\">\r\n                <Video className=\"h-6 w-6 text-white drop-shadow-md\" />\r\n              </div>\r\n              {item.duration && (\r\n                <div className=\"absolute bottom-1 right-1 bg-black/70 text-white text-xs px-1 rounded\">\r\n                  {formatDuration(item.duration)}\r\n                </div>\r\n              )}\r\n            </div>\r\n          );\r\n        } else {\r\n          preview = (\r\n            <div className=\"w-full h-full bg-muted/30 flex flex-col items-center justify-center text-muted-foreground rounded\">\r\n              <Video className=\"h-6 w-6 mb-1\" />\r\n              <span className=\"text-xs\">Video</span>\r\n              {item.duration && (\r\n                <span className=\"text-xs opacity-70\">\r\n                  {formatDuration(item.duration)}\r\n                </span>\r\n              )}\r\n            </div>\r\n          );\r\n        }\r\n      } else if (item.type === \"audio\") {\r\n        preview = (\r\n          <div className=\"w-full h-full bg-linear-to-br from-green-500/20 to-emerald-500/20 flex flex-col items-center justify-center text-muted-foreground rounded border border-green-500/20\">\r\n            <Music className=\"h-6 w-6 mb-1\" />\r\n            <span className=\"text-xs\">Audio</span>\r\n            {item.duration && (\r\n              <span className=\"text-xs opacity-70\">\r\n                {formatDuration(item.duration)}\r\n              </span>\r\n            )}\r\n          </div>\r\n        );\r\n      } else {\r\n        preview = (\r\n          <div className=\"w-full h-full bg-muted/30 flex flex-col items-center justify-center text-muted-foreground rounded\">\r\n            <Image className=\"h-6 w-6\" />\r\n            <span className=\"text-xs mt-1\">Unknown</span>\r\n          </div>\r\n        );\r\n      }\r\n\r\n      previews.set(item.id, preview);\r\n    });\r\n\r\n    return previews;\r\n  }, [filteredMediaItems]);\r\n\r\n  const renderPreview = (item: MediaItem) => previewComponents.get(item.id);\r\n\r\n  return (\r\n    <>\r\n      {/* Hidden file input for uploading media */}\r\n      <input\r\n        ref={fileInputRef}\r\n        type=\"file\"\r\n        accept=\"image/*,video/*,audio/*\"\r\n        multiple\r\n        className=\"hidden\"\r\n        onChange={handleFileChange}\r\n      />\r\n\r\n      <div\r\n        className={`h-full flex flex-col gap-1 transition-colors relative ${isDragOver ? \"bg-accent/30\" : \"\"}`}\r\n        {...dragProps}\r\n      >\r\n        <div className=\"p-3 pb-2 bg-panel\">\r\n          {/* Search and filter controls */}\r\n          <div className=\"flex items-center gap-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"lg\"\r\n              onClick={handleFileSelect}\r\n              disabled={isProcessing}\r\n              className=\"!bg-background px-4 flex-1 justify-center items-center h-9 opacity-100 hover:opacity-75 transition-opacity\"\r\n            >\r\n              {isProcessing ? (\r\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n              ) : (\r\n                <CloudUpload className=\"h-4 w-4\" />\r\n              )}\r\n              <span>Upload</span>\r\n            </Button>\r\n            <div className=\"flex items-center gap-0\">\r\n              <TooltipProvider>\r\n                <Tooltip>\r\n                  <TooltipTrigger asChild>\r\n                    <Button\r\n                      size=\"icon\"\r\n                      variant=\"text\"\r\n                      onClick={() =>\r\n                        setMediaViewMode(\r\n                          mediaViewMode === \"grid\" ? \"list\" : \"grid\"\r\n                        )\r\n                      }\r\n                      disabled={isProcessing}\r\n                      className=\"justify-center items-center\"\r\n                    >\r\n                      {mediaViewMode === \"grid\" ? (\r\n                        <List strokeWidth={1.5} className=\"!size-[1.05rem]\" />\r\n                      ) : (\r\n                        <Grid2X2\r\n                          strokeWidth={1.5}\r\n                          className=\"!size-[1.05rem]\"\r\n                        />\r\n                      )}\r\n                    </Button>\r\n                  </TooltipTrigger>\r\n                  <TooltipContent>\r\n                    <p>\r\n                      {mediaViewMode === \"grid\"\r\n                        ? \"Switch to list view\"\r\n                        : \"Switch to grid view\"}\r\n                    </p>\r\n                  </TooltipContent>\r\n                  <Tooltip>\r\n                    <DropdownMenu>\r\n                      <TooltipTrigger asChild>\r\n                        <DropdownMenuTrigger asChild>\r\n                          <Button\r\n                            size=\"icon\"\r\n                            variant=\"text\"\r\n                            disabled={isProcessing}\r\n                            className=\"justify-center items-center\"\r\n                          >\r\n                            <ArrowDown01\r\n                              strokeWidth={1.5}\r\n                              className=\"!size-[1.05rem]\"\r\n                            />\r\n                          </Button>\r\n                        </DropdownMenuTrigger>\r\n                      </TooltipTrigger>\r\n                      <DropdownMenuContent align=\"end\">\r\n                        <DropdownMenuItem\r\n                          onClick={() => {\r\n                            if (sortBy === \"name\") {\r\n                              setSortOrder(\r\n                                sortOrder === \"asc\" ? \"desc\" : \"asc\"\r\n                              );\r\n                            } else {\r\n                              setSortBy(\"name\");\r\n                              setSortOrder(\"asc\");\r\n                            }\r\n                          }}\r\n                        >\r\n                          Name{\" \"}\r\n                          {sortBy === \"name\" &&\r\n                            (sortOrder === \"asc\" ? \"↑\" : \"↓\")}\r\n                        </DropdownMenuItem>\r\n                        <DropdownMenuItem\r\n                          onClick={() => {\r\n                            if (sortBy === \"type\") {\r\n                              setSortOrder(\r\n                                sortOrder === \"asc\" ? \"desc\" : \"asc\"\r\n                              );\r\n                            } else {\r\n                              setSortBy(\"type\");\r\n                              setSortOrder(\"asc\");\r\n                            }\r\n                          }}\r\n                        >\r\n                          Type{\" \"}\r\n                          {sortBy === \"type\" &&\r\n                            (sortOrder === \"asc\" ? \"↑\" : \"↓\")}\r\n                        </DropdownMenuItem>\r\n                        <DropdownMenuItem\r\n                          onClick={() => {\r\n                            if (sortBy === \"duration\") {\r\n                              setSortOrder(\r\n                                sortOrder === \"asc\" ? \"desc\" : \"asc\"\r\n                              );\r\n                            } else {\r\n                              setSortBy(\"duration\");\r\n                              setSortOrder(\"asc\");\r\n                            }\r\n                          }}\r\n                        >\r\n                          Duration{\" \"}\r\n                          {sortBy === \"duration\" &&\r\n                            (sortOrder === \"asc\" ? \"↑\" : \"↓\")}\r\n                        </DropdownMenuItem>\r\n                        <DropdownMenuItem\r\n                          onClick={() => {\r\n                            if (sortBy === \"size\") {\r\n                              setSortOrder(\r\n                                sortOrder === \"asc\" ? \"desc\" : \"asc\"\r\n                              );\r\n                            } else {\r\n                              setSortBy(\"size\");\r\n                              setSortOrder(\"asc\");\r\n                            }\r\n                          }}\r\n                        >\r\n                          File Size{\" \"}\r\n                          {sortBy === \"size\" &&\r\n                            (sortOrder === \"asc\" ? \"↑\" : \"↓\")}\r\n                        </DropdownMenuItem>\r\n                      </DropdownMenuContent>\r\n                    </DropdownMenu>\r\n                    <TooltipContent>\r\n                      <p>\r\n                        Sort by {sortBy} (\r\n                        {sortOrder === \"asc\" ? \"ascending\" : \"descending\"})\r\n                      </p>\r\n                    </TooltipContent>\r\n                  </Tooltip>\r\n                </Tooltip>\r\n              </TooltipProvider>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"h-full w-full overflow-y-auto scrollbar-thin\">\r\n          <div className=\"flex-1 p-3 pt-0 w-full\">\r\n            {isDragOver || filteredMediaItems.length === 0 ? (\r\n              <MediaDragOverlay\r\n                isVisible={true}\r\n                isProcessing={isProcessing}\r\n                progress={progress}\r\n                onClick={handleFileSelect}\r\n                isEmptyState={filteredMediaItems.length === 0 && !isDragOver}\r\n              />\r\n            ) : mediaViewMode === \"grid\" ? (\r\n              <GridView\r\n                filteredMediaItems={filteredMediaItems}\r\n                renderPreview={renderPreview}\r\n                handleRemove={handleRemove}\r\n              />\r\n            ) : (\r\n              <ListView\r\n                filteredMediaItems={filteredMediaItems}\r\n                renderPreview={renderPreview}\r\n                handleRemove={handleRemove}\r\n                formatDuration={formatDuration}\r\n              />\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction GridView({\r\n  filteredMediaItems,\r\n  renderPreview,\r\n  handleRemove,\r\n}: {\r\n  filteredMediaItems: MediaItem[];\r\n  renderPreview: (item: MediaItem) => React.ReactNode;\r\n  handleRemove: (e: React.MouseEvent, id: string) => Promise<void>;\r\n}) {\r\n  return (\r\n    <div\r\n      className=\"grid gap-2\"\r\n      style={{\r\n        gridTemplateColumns: \"repeat(auto-fill, 160px)\",\r\n      }}\r\n    >\r\n      {filteredMediaItems.map((item) => (\r\n        <MediaItemWithContextMenu\r\n          key={item.id}\r\n          item={item}\r\n          onRemove={handleRemove}\r\n        >\r\n          <DraggableMediaItem\r\n            name={item.name}\r\n            preview={renderPreview(item)}\r\n            dragData={{\r\n              id: item.id,\r\n              type: item.type,\r\n              name: item.name,\r\n            }}\r\n            showPlusOnDrag={false}\r\n            onAddToTimeline={(currentTime) =>\r\n              useTimelineStore.getState().addMediaAtTime(item, currentTime)\r\n            }\r\n            rounded={false}\r\n            variant=\"card\"\r\n          />\r\n        </MediaItemWithContextMenu>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ListView({\r\n  filteredMediaItems,\r\n  renderPreview,\r\n  handleRemove,\r\n  formatDuration,\r\n}: {\r\n  filteredMediaItems: MediaItem[];\r\n  renderPreview: (item: MediaItem) => React.ReactNode;\r\n  handleRemove: (e: React.MouseEvent, id: string) => Promise<void>;\r\n  formatDuration: (duration: number) => string;\r\n}) {\r\n  return (\r\n    <div className=\"space-y-1\">\r\n      {filteredMediaItems.map((item) => (\r\n        <MediaItemWithContextMenu\r\n          key={item.id}\r\n          item={item}\r\n          onRemove={handleRemove}\r\n        >\r\n          <DraggableMediaItem\r\n            name={item.name}\r\n            preview={renderPreview(item)}\r\n            dragData={{\r\n              id: item.id,\r\n              type: item.type,\r\n              name: item.name,\r\n            }}\r\n            showPlusOnDrag={false}\r\n            onAddToTimeline={(currentTime) =>\r\n              useTimelineStore.getState().addMediaAtTime(item, currentTime)\r\n            }\r\n            variant=\"compact\"\r\n          />\r\n        </MediaItemWithContextMenu>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { Tabs as TabsPrimitive } from \"radix-ui\";\r\n\r\nimport { cn } from \"../../lib/utils\";\r\n\r\nconst Tabs = TabsPrimitive.Root;\r\n\r\nconst TabsList = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.List\r\n    ref={ref}\r\n    className={cn(\r\n      \"inline-flex h-auto items-center justify-center gap-2 rounded-lg bg-transparent p-0 text-muted-foreground\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nTabsList.displayName = TabsPrimitive.List.displayName;\r\n\r\nconst TabsTrigger = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.Trigger\r\n    ref={ref}\r\n    className={cn(\r\n      \"inline-flex items-center cursor-pointer justify-center whitespace-nowrap rounded-lg px-3 py-1 text-sm font-medium ring-offset-background focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-card data-[state=active]:text-foreground\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName;\r\n\r\nconst TabsContent = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.Content\r\n    ref={ref}\r\n    className={cn(\r\n      \"mt-2 ring-offset-background focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nTabsContent.displayName = TabsPrimitive.Content.displayName;\r\n\r\nexport { Tabs, TabsList, TabsTrigger, TabsContent };\r\n","import { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\n\r\ninterface BaseViewProps {\r\n  children?: React.ReactNode;\r\n  defaultTab?: string;\r\n  tabs?: {\r\n    value: string;\r\n    label: string;\r\n    content: React.ReactNode;\r\n  }[];\r\n  className?: string;\r\n  ref?: React.RefObject<HTMLDivElement>;\r\n}\r\n\r\nfunction ViewContent({\r\n  children,\r\n  className,\r\n}: {\r\n  children: React.ReactNode;\r\n  className?: string;\r\n}) {\r\n  return (\r\n    <ScrollArea className=\"flex-1\">\r\n      <div className={`p-5 h-full ${className}`}>{children}</div>\r\n    </ScrollArea>\r\n  );\r\n}\r\n\r\nexport function BaseView({\r\n  children,\r\n  defaultTab,\r\n  tabs,\r\n  className = \"\",\r\n  ref,\r\n}: BaseViewProps) {\r\n  return (\r\n    <div className={`h-full flex flex-col ${className}`} ref={ref}>\r\n      {!tabs || tabs.length === 0 ? (\r\n        <ViewContent className={className}>{children}</ViewContent>\r\n      ) : (\r\n        <Tabs defaultValue={defaultTab} className=\"flex flex-col h-full\">\r\n          <div className=\"px-3 pt-4 pb-0\">\r\n            <TabsList>\r\n              {tabs.map((tab) => (\r\n                <TabsTrigger key={tab.value} value={tab.value}>\r\n                  {tab.label}\r\n                </TabsTrigger>\r\n              ))}\r\n            </TabsList>\r\n          </div>\r\n          <Separator className=\"mt-4\" />\r\n          {tabs.map((tab) => (\r\n            <TabsContent\r\n              key={tab.value}\r\n              value={tab.value}\r\n              className=\"mt-0 flex-1 flex flex-col min-h-0\"\r\n            >\r\n              <ViewContent>{tab.content}</ViewContent>\r\n            </TabsContent>\r\n          ))}\r\n        </Tabs>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import { DraggableMediaItem } from \"@/components/ui/draggable-item\";\r\nimport { BaseView } from \"./base-view\";\r\nimport { TIMELINE_CONSTANTS } from \"@/constants/timeline-constants\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { type TextElement } from \"@/types/timeline\";\r\n\r\nconst textData: TextElement = {\r\n  id: \"default-text\",\r\n  type: \"text\",\r\n  name: \"Default text\",\r\n  content: \"Default text\",\r\n  fontSize: 48,\r\n  fontFamily: \"Arial\",\r\n  color: \"#ffffff\",\r\n  backgroundColor: \"transparent\",\r\n  textAlign: \"center\" as const,\r\n  fontWeight: \"normal\" as const,\r\n  fontStyle: \"normal\" as const,\r\n  textDecoration: \"none\" as const,\r\n  x: 0,\r\n  y: 0,\r\n  rotation: 0,\r\n  opacity: 1,\r\n  duration: TIMELINE_CONSTANTS.DEFAULT_TEXT_DURATION,\r\n  startTime: 0,\r\n  trimStart: 0,\r\n  trimEnd: 0,\r\n};\r\n\r\nexport function TextView() {\r\n  return (\r\n    <BaseView>\r\n      <DraggableMediaItem\r\n        name=\"Default text\"\r\n        preview={\r\n          <div className=\"flex items-center justify-center w-full h-full bg-panel-accent rounded\">\r\n            <span className=\"text-xs select-none\">Default text</span>\r\n          </div>\r\n        }\r\n        dragData={{\r\n          id: textData.id,\r\n          type: textData.type,\r\n          name: textData.name,\r\n          content: textData.content,\r\n        }}\r\n        aspectRatio={1}\r\n        onAddToTimeline={(currentTime) =>\r\n          useTimelineStore.getState().addTextAtTime(textData, currentTime)\r\n        }\r\n        showLabel={false}\r\n      />\r\n    </BaseView>\r\n  );\r\n}\r\n","import { create } from \"zustand\";\r\nimport type { SoundEffect, SavedSound } from \"@/types/sounds\";\r\nimport { storageService } from \"@/lib/storage/storage-service\";\r\nimport { toast } from \"sonner\";\r\nimport { useMediaStore } from \"./media-store\";\r\nimport { useTimelineStore } from \"./timeline-store\";\r\nimport { useProjectStore } from \"./project-store\";\r\nimport { usePlaybackStore } from \"./playback-store\";\r\n\r\ninterface SoundsStore {\r\n  topSoundEffects: SoundEffect[];\r\n  isLoading: boolean;\r\n  error: string | null;\r\n  hasLoaded: boolean;\r\n\r\n  // Filter state\r\n  showCommercialOnly: boolean;\r\n  toggleCommercialFilter: () => void;\r\n\r\n  // Search state\r\n  searchQuery: string;\r\n  searchResults: SoundEffect[];\r\n  isSearching: boolean;\r\n  searchError: string | null;\r\n  lastSearchQuery: string;\r\n  scrollPosition: number;\r\n\r\n  // Pagination state\r\n  currentPage: number;\r\n  hasNextPage: boolean;\r\n  totalCount: number;\r\n  isLoadingMore: boolean;\r\n\r\n  // Saved sounds state\r\n  savedSounds: SavedSound[];\r\n  isSavedSoundsLoaded: boolean;\r\n  isLoadingSavedSounds: boolean;\r\n  savedSoundsError: string | null;\r\n\r\n  // Timeline integration\r\n  addSoundToTimeline: (sound: SoundEffect) => Promise<boolean>;\r\n\r\n  setTopSoundEffects: (sounds: SoundEffect[]) => void;\r\n  setLoading: (loading: boolean) => void;\r\n  setError: (error: string | null) => void;\r\n  setHasLoaded: (loaded: boolean) => void;\r\n\r\n  // Search actions\r\n  setSearchQuery: (query: string) => void;\r\n  setSearchResults: (results: SoundEffect[]) => void;\r\n  setSearching: (searching: boolean) => void;\r\n  setSearchError: (error: string | null) => void;\r\n  setLastSearchQuery: (query: string) => void;\r\n  setScrollPosition: (position: number) => void;\r\n\r\n  // Pagination actions\r\n  setCurrentPage: (page: number) => void;\r\n  setHasNextPage: (hasNext: boolean) => void;\r\n  setTotalCount: (count: number) => void;\r\n  setLoadingMore: (loading: boolean) => void;\r\n  appendSearchResults: (results: SoundEffect[]) => void;\r\n  appendTopSounds: (results: SoundEffect[]) => void;\r\n  resetPagination: () => void;\r\n\r\n  // Saved sounds actions\r\n  loadSavedSounds: () => Promise<void>;\r\n  saveSoundEffect: (soundEffect: SoundEffect) => Promise<void>;\r\n  removeSavedSound: (soundId: number) => Promise<void>;\r\n  isSoundSaved: (soundId: number) => boolean;\r\n  toggleSavedSound: (soundEffect: SoundEffect) => Promise<void>;\r\n  clearSavedSounds: () => Promise<void>;\r\n}\r\n\r\nexport const useSoundsStore = create<SoundsStore>((set, get) => ({\r\n  topSoundEffects: [],\r\n  isLoading: false,\r\n  error: null,\r\n  hasLoaded: false,\r\n  showCommercialOnly: true,\r\n\r\n  toggleCommercialFilter: () => {\r\n    set((state) => ({ showCommercialOnly: !state.showCommercialOnly }));\r\n  },\r\n\r\n  // Search state\r\n  searchQuery: \"\",\r\n  searchResults: [],\r\n  isSearching: false,\r\n  searchError: null,\r\n  lastSearchQuery: \"\",\r\n  scrollPosition: 0,\r\n\r\n  // Pagination state\r\n  currentPage: 1,\r\n  hasNextPage: false,\r\n  totalCount: 0,\r\n  isLoadingMore: false,\r\n\r\n  // Saved sounds state\r\n  savedSounds: [],\r\n  isSavedSoundsLoaded: false,\r\n  isLoadingSavedSounds: false,\r\n  savedSoundsError: null,\r\n\r\n  setTopSoundEffects: (sounds) => set({ topSoundEffects: sounds }),\r\n  setLoading: (loading) => set({ isLoading: loading }),\r\n  setError: (error) => set({ error }),\r\n  setHasLoaded: (loaded) => set({ hasLoaded: loaded }),\r\n\r\n  // Search actions\r\n  setSearchQuery: (query) => set({ searchQuery: query }),\r\n  setSearchResults: (results) =>\r\n    set({ searchResults: results, currentPage: 1 }),\r\n  setSearching: (searching) => set({ isSearching: searching }),\r\n  setSearchError: (error) => set({ searchError: error }),\r\n  setLastSearchQuery: (query) => set({ lastSearchQuery: query }),\r\n  setScrollPosition: (position) => set({ scrollPosition: position }),\r\n\r\n  // Pagination actions\r\n  setCurrentPage: (page) => set({ currentPage: page }),\r\n  setHasNextPage: (hasNext) => set({ hasNextPage: hasNext }),\r\n  setTotalCount: (count) => set({ totalCount: count }),\r\n  setLoadingMore: (loading) => set({ isLoadingMore: loading }),\r\n  appendSearchResults: (results) =>\r\n    set((state) => ({\r\n      searchResults: [...state.searchResults, ...results],\r\n    })),\r\n  appendTopSounds: (results) =>\r\n    set((state) => ({\r\n      topSoundEffects: [...state.topSoundEffects, ...results],\r\n    })),\r\n  resetPagination: () =>\r\n    set({\r\n      currentPage: 1,\r\n      hasNextPage: false,\r\n      totalCount: 0,\r\n      isLoadingMore: false,\r\n    }),\r\n\r\n  // Saved sounds actions\r\n  loadSavedSounds: async () => {\r\n    if (get().isSavedSoundsLoaded) return;\r\n\r\n    try {\r\n      set({ isLoadingSavedSounds: true, savedSoundsError: null });\r\n      const savedSoundsData = await storageService.loadSavedSounds();\r\n      set({\r\n        savedSounds: savedSoundsData.sounds,\r\n        isSavedSoundsLoaded: true,\r\n        isLoadingSavedSounds: false,\r\n      });\r\n    } catch (error) {\r\n      const errorMessage =\r\n        error instanceof Error ? error.message : \"Failed to load saved sounds\";\r\n      set({\r\n        savedSoundsError: errorMessage,\r\n        isLoadingSavedSounds: false,\r\n      });\r\n      console.error(\"Failed to load saved sounds:\", error);\r\n    }\r\n  },\r\n\r\n  saveSoundEffect: async (soundEffect: SoundEffect) => {\r\n    try {\r\n      await storageService.saveSoundEffect(soundEffect);\r\n\r\n      // Refresh saved sounds\r\n      const savedSoundsData = await storageService.loadSavedSounds();\r\n      set({ savedSounds: savedSoundsData.sounds });\r\n    } catch (error) {\r\n      const errorMessage =\r\n        error instanceof Error ? error.message : \"Failed to save sound\";\r\n      set({ savedSoundsError: errorMessage });\r\n      toast.error(\"Failed to save sound\");\r\n      console.error(\"Failed to save sound:\", error);\r\n    }\r\n  },\r\n\r\n  removeSavedSound: async (soundId: number) => {\r\n    try {\r\n      await storageService.removeSavedSound(soundId);\r\n\r\n      // Update local state immediately\r\n      set((state) => ({\r\n        savedSounds: state.savedSounds.filter((sound) => sound.id !== soundId),\r\n      }));\r\n    } catch (error) {\r\n      const errorMessage =\r\n        error instanceof Error ? error.message : \"Failed to remove sound\";\r\n      set({ savedSoundsError: errorMessage });\r\n      toast.error(\"Failed to remove sound\");\r\n      console.error(\"Failed to remove sound:\", error);\r\n    }\r\n  },\r\n\r\n  isSoundSaved: (soundId: number) => {\r\n    const { savedSounds } = get();\r\n    return savedSounds.some((sound) => sound.id === soundId);\r\n  },\r\n\r\n  toggleSavedSound: async (soundEffect: SoundEffect) => {\r\n    const { isSoundSaved, saveSoundEffect, removeSavedSound } = get();\r\n\r\n    if (isSoundSaved(soundEffect.id)) {\r\n      await removeSavedSound(soundEffect.id);\r\n    } else {\r\n      await saveSoundEffect(soundEffect);\r\n    }\r\n  },\r\n\r\n  clearSavedSounds: async () => {\r\n    try {\r\n      await storageService.clearSavedSounds();\r\n      set({\r\n        savedSounds: [],\r\n        savedSoundsError: null,\r\n      });\r\n    } catch (error) {\r\n      const errorMessage =\r\n        error instanceof Error ? error.message : \"Failed to clear saved sounds\";\r\n      set({ savedSoundsError: errorMessage });\r\n      toast.error(\"Failed to clear saved sounds\");\r\n      console.error(\"Failed to clear saved sounds:\", error);\r\n    }\r\n  },\r\n\r\n  addSoundToTimeline: async (sound) => {\r\n    const activeProject = useProjectStore.getState().activeProject;\r\n    if (!activeProject) {\r\n      toast.error(\"No active project\");\r\n      return false;\r\n    }\r\n\r\n    const audioUrl = sound.previewUrl;\r\n    if (!audioUrl) {\r\n      toast.error(\"Sound file not available\");\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(audioUrl);\r\n      if (!response.ok)\r\n        throw new Error(`Failed to download audio: ${response.statusText}`);\r\n\r\n      const blob = await response.blob();\r\n      const file = new File([blob], `${sound.name}.mp3`, {\r\n        type: \"audio/mpeg\",\r\n      });\r\n\r\n      await useMediaStore.getState().addMediaItem(activeProject.id, {\r\n        name: sound.name,\r\n        type: \"audio\",\r\n        file,\r\n        duration: sound.duration,\r\n        url: URL.createObjectURL(file),\r\n      });\r\n\r\n      const mediaItem = useMediaStore\r\n        .getState()\r\n        .mediaItems.find((item) => item.file === file);\r\n      if (!mediaItem) throw new Error(\"Failed to create media item\");\r\n\r\n      const success = useTimelineStore\r\n        .getState()\r\n        .addMediaAtTime(mediaItem, usePlaybackStore.getState().currentTime);\r\n\r\n      if (success) {\r\n        return true;\r\n      }\r\n      throw new Error(\"Failed to add to timeline - check for overlaps\");\r\n    } catch (error) {\r\n      console.error(\"Failed to add sound to timeline:\", error);\r\n      toast.error(\r\n        error instanceof Error\r\n          ? error.message\r\n          : \"Failed to add sound to timeline\",\r\n        { id: `sound-${sound.id}` }\r\n      );\r\n      return false;\r\n    }\r\n  },\r\n}));\r\n","import { useEffect } from \"react\";\r\nimport { useSoundsStore } from \"@/stores/sounds-store\";\r\n\r\n/**\r\n * Custom hook for searching sound effects with race condition protection.\r\n * Uses global Zustand store to persist search state across tab switches.\r\n * - Debounced search (300ms)\r\n * - Race condition protection with cleanup\r\n * - Proper error handling\r\n */\r\n\r\nexport function useSoundSearch(query: string, commercialOnly: boolean) {\r\n  const {\r\n    searchResults,\r\n    isSearching,\r\n    searchError,\r\n    lastSearchQuery,\r\n    currentPage,\r\n    hasNextPage,\r\n    isLoadingMore,\r\n    totalCount,\r\n    setSearchResults,\r\n    setSearching,\r\n    setSearchError,\r\n    setLastSearchQuery,\r\n    setCurrentPage,\r\n    setHasNextPage,\r\n    setTotalCount,\r\n    setLoadingMore,\r\n    appendSearchResults,\r\n    appendTopSounds,\r\n    resetPagination,\r\n  } = useSoundsStore();\r\n\r\n  // Load more function for infinite scroll\r\n  const loadMore = async () => {\r\n    if (isLoadingMore || !hasNextPage) return;\r\n\r\n    try {\r\n      setLoadingMore(true);\r\n      const nextPage = currentPage + 1;\r\n\r\n      const searchParams = new URLSearchParams({\r\n        page: nextPage.toString(),\r\n        type: \"effects\",\r\n      });\r\n\r\n      if (query.trim()) {\r\n        searchParams.set(\"q\", query);\r\n      }\r\n\r\n      searchParams.set(\"commercial_only\", commercialOnly.toString());\r\n      const response = await fetch(\r\n        `/api/sounds/search?${searchParams.toString()}`\r\n      );\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n\r\n        // Append to appropriate array based on whether we have a query\r\n        if (query.trim()) {\r\n          appendSearchResults(data.results);\r\n        } else {\r\n          appendTopSounds(data.results);\r\n        }\r\n\r\n        setCurrentPage(nextPage);\r\n        setHasNextPage(!!data.next);\r\n        setTotalCount(data.count);\r\n      } else {\r\n        setSearchError(`Load more failed: ${response.status}`);\r\n      }\r\n    } catch (err) {\r\n      setSearchError(err instanceof Error ? err.message : \"Load more failed\");\r\n    } finally {\r\n      setLoadingMore(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!query.trim()) {\r\n      setSearchResults([]);\r\n      setSearchError(null);\r\n      setLastSearchQuery(\"\");\r\n      // Don't reset pagination here - top sounds pagination is managed by prefetcher\r\n      return;\r\n    }\r\n\r\n    // If we already searched for this query and have results, don't search again\r\n    if (query === lastSearchQuery && searchResults.length > 0) {\r\n      return;\r\n    }\r\n\r\n    let ignore = false;\r\n\r\n    const timeoutId = setTimeout(async () => {\r\n      try {\r\n        setSearching(true);\r\n        setSearchError(null);\r\n        resetPagination();\r\n\r\n        const response = await fetch(\r\n          `/api/sounds/search?q=${encodeURIComponent(query)}&type=effects&page=1`\r\n        );\r\n\r\n        if (!ignore) {\r\n          if (response.ok) {\r\n            const data = await response.json();\r\n            setSearchResults(data.results);\r\n            setLastSearchQuery(query);\r\n            setHasNextPage(!!data.next);\r\n            setTotalCount(data.count);\r\n            setCurrentPage(1);\r\n          } else {\r\n            setSearchError(`Search failed: ${response.status}`);\r\n          }\r\n        }\r\n      } catch (err) {\r\n        if (!ignore) {\r\n          setSearchError(err instanceof Error ? err.message : \"Search failed\");\r\n        }\r\n      } finally {\r\n        if (!ignore) {\r\n          setSearching(false);\r\n        }\r\n      }\r\n    }, 300);\r\n\r\n    return () => {\r\n      clearTimeout(timeoutId);\r\n      ignore = true;\r\n    };\r\n  }, [\r\n    query,\r\n    lastSearchQuery,\r\n    searchResults.length,\r\n    setSearchResults,\r\n    setSearching,\r\n    setSearchError,\r\n    setLastSearchQuery,\r\n    setCurrentPage,\r\n    setHasNextPage,\r\n    setTotalCount,\r\n    resetPagination,\r\n  ]);\r\n\r\n  return {\r\n    results: searchResults,\r\n    isLoading: isSearching,\r\n    error: searchError,\r\n    loadMore,\r\n    hasNextPage,\r\n    isLoadingMore,\r\n    totalCount,\r\n  };\r\n}\r\n","\"use client\";\r\n\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { useState, useMemo, useRef, useEffect } from \"react\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport {\r\n  PlayIcon,\r\n  PauseIcon,\r\n  HeartIcon,\r\n  PlusIcon,\r\n  ListFilter,\r\n} from \"lucide-react\";\r\nimport { useSoundsStore } from \"@/stores/sounds-store\";\r\nimport { useSoundSearch } from \"@/hooks/use-sound-search\";\r\nimport type { SoundEffect, SavedSound } from \"@/types/sounds\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuTrigger,\r\n  DropdownMenuContent,\r\n  DropdownMenuCheckboxItem,\r\n} from \"@/components/ui/dropdown-menu\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nexport function SoundsView() {\r\n  return (\r\n    <div className=\"h-full flex flex-col\">\r\n      <Tabs defaultValue=\"sound-effects\" className=\"flex flex-col h-full\">\r\n        <div className=\"px-3 pt-4 pb-0\">\r\n          <TabsList>\r\n            <TabsTrigger value=\"sound-effects\">Sound effects</TabsTrigger>\r\n            <TabsTrigger value=\"songs\">Songs</TabsTrigger>\r\n            <TabsTrigger value=\"saved\">Saved</TabsTrigger>\r\n          </TabsList>\r\n        </div>\r\n        <Separator className=\"my-4\" />\r\n        <TabsContent\r\n          value=\"sound-effects\"\r\n          className=\"p-5 pt-0 mt-0 flex-1 flex flex-col min-h-0\"\r\n        >\r\n          <SoundEffectsView />\r\n        </TabsContent>\r\n        <TabsContent\r\n          value=\"saved\"\r\n          className=\"p-5 pt-0 mt-0 flex-1 flex flex-col min-h-0\"\r\n        >\r\n          <SavedSoundsView />\r\n        </TabsContent>\r\n        <TabsContent\r\n          value=\"songs\"\r\n          className=\"p-5 pt-0 mt-0 flex-1 flex flex-col min-h-0\"\r\n        >\r\n          <SongsView />\r\n        </TabsContent>\r\n      </Tabs>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction SoundEffectsView() {\r\n  const {\r\n    topSoundEffects,\r\n    isLoading,\r\n    searchQuery,\r\n    setSearchQuery,\r\n    scrollPosition,\r\n    setScrollPosition,\r\n    loadSavedSounds,\r\n    isSoundSaved,\r\n    toggleSavedSound,\r\n    showCommercialOnly,\r\n    toggleCommercialFilter,\r\n  } = useSoundsStore();\r\n  const {\r\n    results: searchResults,\r\n    isLoading: isSearching,\r\n    loadMore,\r\n    hasNextPage,\r\n    isLoadingMore,\r\n  } = useSoundSearch(searchQuery, showCommercialOnly);\r\n\r\n  // Audio playback state\r\n  const [playingId, setPlayingId] = useState<number | null>(null);\r\n  const [audioElement, setAudioElement] = useState<HTMLAudioElement | null>(\r\n    null\r\n  );\r\n\r\n  // Scroll position persistence\r\n  const scrollAreaRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Load saved sounds and restore scroll position when component mounts\r\n  useEffect(() => {\r\n    loadSavedSounds();\r\n\r\n    if (scrollAreaRef.current && scrollPosition > 0) {\r\n      const timeoutId = setTimeout(() => {\r\n        scrollAreaRef.current?.scrollTo({ top: scrollPosition });\r\n      }, 100); // Small delay to ensure content is rendered\r\n\r\n      return () => clearTimeout(timeoutId);\r\n    }\r\n  }, []); // Only run on mount\r\n\r\n  // Track scroll position changes and handle infinite scroll\r\n  const handleScroll = (event: React.UIEvent<HTMLDivElement>) => {\r\n    const { scrollTop, scrollHeight, clientHeight } = event.currentTarget;\r\n    setScrollPosition(scrollTop);\r\n\r\n    // Trigger loadMore when scrolled to within 200px of bottom\r\n    const nearBottom = scrollTop + clientHeight >= scrollHeight - 200;\r\n    if (nearBottom && hasNextPage && !isLoadingMore && !isSearching) {\r\n      loadMore();\r\n    }\r\n  };\r\n\r\n  // Use your existing design, just swap the data source\r\n  const displayedSounds = useMemo(() => {\r\n    const sounds = searchQuery ? searchResults : topSoundEffects;\r\n    return sounds;\r\n  }, [searchQuery, searchResults, topSoundEffects]);\r\n\r\n  const playSound = (sound: SoundEffect) => {\r\n    if (playingId === sound.id) {\r\n      audioElement?.pause();\r\n      setPlayingId(null);\r\n      return;\r\n    }\r\n\r\n    // Stop previous sound\r\n    audioElement?.pause();\r\n\r\n    if (sound.previewUrl) {\r\n      const audio = new Audio(sound.previewUrl);\r\n      audio.addEventListener(\"ended\", () => {\r\n        setPlayingId(null);\r\n      });\r\n      audio.addEventListener(\"error\", (e) => {\r\n        setPlayingId(null);\r\n      });\r\n      audio.play().catch((error) => {\r\n        setPlayingId(null);\r\n      });\r\n\r\n      setAudioElement(audio);\r\n      setPlayingId(sound.id);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-5 mt-1 h-full\">\r\n      <div className=\"flex items-center gap-3\">\r\n        <Input\r\n          placeholder=\"Search sound effects\"\r\n          className=\"bg-panel-accent w-full\"\r\n          containerClassName=\"w-full\"\r\n          value={searchQuery}\r\n          onChange={(e) => setSearchQuery(e.target.value)}\r\n          showClearIcon\r\n          onClear={() => setSearchQuery(\"\")}\r\n        />\r\n        <DropdownMenu>\r\n          <DropdownMenuTrigger asChild>\r\n            <Button\r\n              variant=\"text\"\r\n              size=\"icon\"\r\n              className={cn(showCommercialOnly && \"text-primary\")}\r\n            >\r\n              <ListFilter className=\"w-4 h-4\" />\r\n            </Button>\r\n          </DropdownMenuTrigger>\r\n          <DropdownMenuContent align=\"end\" className=\"w-56\">\r\n            <DropdownMenuCheckboxItem\r\n              checked={showCommercialOnly}\r\n              onCheckedChange={toggleCommercialFilter}\r\n            >\r\n              Show only commercially licensed\r\n            </DropdownMenuCheckboxItem>\r\n            <div className=\"px-2 py-1.5 text-xs text-muted-foreground\">\r\n              {showCommercialOnly\r\n                ? \"Only showing sounds licensed for commercial use\"\r\n                : \"Showing all sounds regardless of license\"}\r\n            </div>\r\n          </DropdownMenuContent>\r\n        </DropdownMenu>\r\n      </div>\r\n\r\n      <div className=\"relative h-full overflow-hidden\">\r\n        <ScrollArea\r\n          className=\"flex-1 h-full\"\r\n          ref={scrollAreaRef}\r\n          onScrollCapture={handleScroll}\r\n        >\r\n          <div className=\"flex flex-col gap-4\">\r\n            {isLoading && !searchQuery && (\r\n              <div className=\"text-muted-foreground text-sm\">\r\n                Loading sounds...\r\n              </div>\r\n            )}\r\n            {isSearching && searchQuery && (\r\n              <div className=\"text-muted-foreground text-sm\">Searching...</div>\r\n            )}\r\n            {displayedSounds.map((sound) => (\r\n              <AudioItem\r\n                key={sound.id}\r\n                sound={sound}\r\n                isPlaying={playingId === sound.id}\r\n                onPlay={() => playSound(sound)}\r\n                isSaved={isSoundSaved(sound.id)}\r\n                onToggleSaved={() => toggleSavedSound(sound)}\r\n              />\r\n            ))}\r\n            {!isLoading && !isSearching && displayedSounds.length === 0 && (\r\n              <div className=\"text-muted-foreground text-sm\">\r\n                {searchQuery ? \"No sounds found\" : \"No sounds available\"}\r\n              </div>\r\n            )}\r\n            {isLoadingMore && (\r\n              <div className=\"text-muted-foreground text-sm text-center py-4\">\r\n                Loading more sounds...\r\n              </div>\r\n            )}\r\n          </div>\r\n        </ScrollArea>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction SavedSoundsView() {\r\n  const {\r\n    savedSounds,\r\n    isLoadingSavedSounds,\r\n    savedSoundsError,\r\n    loadSavedSounds,\r\n    isSoundSaved,\r\n    toggleSavedSound,\r\n    clearSavedSounds,\r\n  } = useSoundsStore();\r\n\r\n  // Audio playback state\r\n  const [playingId, setPlayingId] = useState<number | null>(null);\r\n  const [audioElement, setAudioElement] = useState<HTMLAudioElement | null>(\r\n    null\r\n  );\r\n\r\n  // Clear confirmation dialog state\r\n  const [showClearDialog, setShowClearDialog] = useState(false);\r\n\r\n  // Load saved sounds when tab becomes active\r\n  useEffect(() => {\r\n    loadSavedSounds();\r\n  }, [loadSavedSounds]);\r\n\r\n  const playSound = (sound: SavedSound) => {\r\n    if (playingId === sound.id) {\r\n      audioElement?.pause();\r\n      setPlayingId(null);\r\n      return;\r\n    }\r\n\r\n    // Stop previous sound\r\n    audioElement?.pause();\r\n\r\n    if (sound.previewUrl) {\r\n      const audio = new Audio(sound.previewUrl);\r\n      audio.addEventListener(\"ended\", () => {\r\n        setPlayingId(null);\r\n      });\r\n      audio.addEventListener(\"error\", (e) => {\r\n        setPlayingId(null);\r\n      });\r\n      audio.play().catch((error) => {\r\n        setPlayingId(null);\r\n      });\r\n\r\n      setAudioElement(audio);\r\n      setPlayingId(sound.id);\r\n    }\r\n  };\r\n\r\n  // Convert SavedSound to SoundEffect for compatibility with AudioItem\r\n  const convertToSoundEffect = (savedSound: SavedSound): SoundEffect => ({\r\n    id: savedSound.id,\r\n    name: savedSound.name,\r\n    description: \"\",\r\n    url: \"\",\r\n    previewUrl: savedSound.previewUrl,\r\n    downloadUrl: savedSound.downloadUrl,\r\n    duration: savedSound.duration,\r\n    filesize: 0,\r\n    type: \"audio\",\r\n    channels: 0,\r\n    bitrate: 0,\r\n    bitdepth: 0,\r\n    samplerate: 0,\r\n    username: savedSound.username,\r\n    tags: savedSound.tags,\r\n    license: savedSound.license,\r\n    created: savedSound.savedAt,\r\n    downloads: 0,\r\n    rating: 0,\r\n    ratingCount: 0,\r\n  });\r\n\r\n  if (isLoadingSavedSounds) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-full\">\r\n        <div className=\"text-muted-foreground text-sm\">\r\n          Loading saved sounds...\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (savedSoundsError) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-full\">\r\n        <div className=\"text-destructive text-sm\">\r\n          Error: {savedSoundsError}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (savedSounds.length === 0) {\r\n    return (\r\n      <div className=\"bg-panel h-full p-4 flex flex-col items-center justify-center gap-3\">\r\n        <HeartIcon\r\n          className=\"w-10 h-10 text-muted-foreground\"\r\n          strokeWidth={1.5}\r\n        />\r\n        <div className=\"flex flex-col gap-2 text-center\">\r\n          <p className=\"text-lg font-medium\">No saved sounds</p>\r\n          <p className=\"text-sm text-muted-foreground text-balance\">\r\n            Click the heart icon on any sound to save it here\r\n          </p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-5 mt-1 h-full\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <p className=\"text-sm text-muted-foreground\">\r\n          {savedSounds.length} saved{\" \"}\r\n          {savedSounds.length === 1 ? \"sound\" : \"sounds\"}\r\n        </p>\r\n        <Dialog open={showClearDialog} onOpenChange={setShowClearDialog}>\r\n          <DialogTrigger asChild>\r\n            <Button\r\n              variant=\"text\"\r\n              size=\"sm\"\r\n              className=\"h-auto text-muted-foreground hover:text-destructive !opacity-100\"\r\n            >\r\n              Clear all\r\n            </Button>\r\n          </DialogTrigger>\r\n          <DialogContent>\r\n            <DialogHeader>\r\n              <DialogTitle>Clear all saved sounds?</DialogTitle>\r\n              <DialogDescription>\r\n                This will permanently remove all {savedSounds.length} saved\r\n                sounds from your collection. This action cannot be undone.\r\n              </DialogDescription>\r\n            </DialogHeader>\r\n            <DialogFooter>\r\n              <Button variant=\"text\" onClick={() => setShowClearDialog(false)}>\r\n                Cancel\r\n              </Button>\r\n              <Button\r\n                variant=\"destructive\"\r\n                onClick={async () => {\r\n                  await clearSavedSounds();\r\n                  setShowClearDialog(false);\r\n                }}\r\n              >\r\n                Clear all sounds\r\n              </Button>\r\n            </DialogFooter>\r\n          </DialogContent>\r\n        </Dialog>\r\n      </div>\r\n\r\n      <div className=\"relative h-full overflow-hidden\">\r\n        <ScrollArea className=\"flex-1 h-full\">\r\n          <div className=\"flex flex-col gap-4\">\r\n            {savedSounds.map((sound) => (\r\n              <AudioItem\r\n                key={sound.id}\r\n                sound={convertToSoundEffect(sound)}\r\n                isPlaying={playingId === sound.id}\r\n                onPlay={() => playSound(sound)}\r\n                isSaved={isSoundSaved(sound.id)}\r\n                onToggleSaved={() =>\r\n                  toggleSavedSound(convertToSoundEffect(sound))\r\n                }\r\n              />\r\n            ))}\r\n          </div>\r\n        </ScrollArea>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction SongsView() {\r\n  return <div>Songs</div>;\r\n}\r\n\r\ninterface AudioItemProps {\r\n  sound: SoundEffect;\r\n  isPlaying: boolean;\r\n  onPlay: () => void;\r\n  isSaved: boolean;\r\n  onToggleSaved: () => void;\r\n}\r\n\r\nfunction AudioItem({\r\n  sound,\r\n  isPlaying,\r\n  onPlay,\r\n  isSaved,\r\n  onToggleSaved,\r\n}: AudioItemProps) {\r\n  const { addSoundToTimeline } = useSoundsStore();\r\n\r\n  const handleClick = () => {\r\n    onPlay();\r\n  };\r\n\r\n  const handleSaveClick = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    onToggleSaved();\r\n  };\r\n\r\n  const handleAddToTimeline = async (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    await addSoundToTimeline(sound);\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className=\"group flex items-center gap-3 opacity-100 hover:opacity-75 transition-opacity cursor-pointer\"\r\n      onClick={handleClick}\r\n    >\r\n      <div className=\"relative w-12 h-12 bg-accent rounded-md flex items-center justify-center overflow-hidden shrink-0\">\r\n        <div className=\"absolute inset-0 bg-gradient-to-br from-primary/20 to-transparent\" />\r\n        {isPlaying ? (\r\n          <PauseIcon className=\"w-5 h-5\" />\r\n        ) : (\r\n          <PlayIcon className=\"w-5 h-5\" />\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"flex-1 min-w-0 overflow-hidden\">\r\n        <p className=\"font-medium truncate text-sm\">{sound.name}</p>\r\n        <span className=\"text-xs text-muted-foreground truncate block\">\r\n          {sound.username}\r\n        </span>\r\n      </div>\r\n\r\n      <div className=\"flex items-center gap-3 pr-2\">\r\n        <Button\r\n          variant=\"text\"\r\n          size=\"icon\"\r\n          className=\"text-muted-foreground hover:text-foreground !opacity-100 w-auto\"\r\n          onClick={handleAddToTimeline}\r\n          title=\"Add to timeline\"\r\n        >\r\n          <PlusIcon className=\"w-4 h-4\" />\r\n        </Button>\r\n        <Button\r\n          variant=\"text\"\r\n          size=\"icon\"\r\n          className={`hover:text-foreground !opacity-100 w-auto ${\r\n            isSaved\r\n              ? \"text-red-500 hover:text-red-600\"\r\n              : \"text-muted-foreground\"\r\n          }`}\r\n          onClick={handleSaveClick}\r\n          title={isSaved ? \"Remove from saved\" : \"Save sound\"}\r\n        >\r\n          <HeartIcon className={`w-4 h-4 ${isSaved ? \"fill-current\" : \"\"}`} />\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { useEditorStore } from \"@/stores/editor-store\";\r\nimport { useMediaStore, getMediaAspectRatio } from \"@/stores/media-store\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { DEFAULT_CANVAS_SIZE, useProjectStore } from \"@/stores/project-store\";\r\n\r\nexport function useAspectRatio() {\r\n  const { canvasPresets } = useEditorStore();\r\n  const { activeProject } = useProjectStore();\r\n  const { mediaItems } = useMediaStore();\r\n  const { tracks } = useTimelineStore();\r\n\r\n  const canvasSize = activeProject?.canvasSize || DEFAULT_CANVAS_SIZE;\r\n  const canvasMode = activeProject?.canvasMode || \"preset\";\r\n\r\n  // Find the current preset based on canvas size\r\n  const currentPreset = canvasPresets.find(\r\n    (preset) =>\r\n      preset.width === canvasSize.width && preset.height === canvasSize.height\r\n  );\r\n\r\n  // Get the original aspect ratio from the first video/image in timeline\r\n  const getOriginalAspectRatio = (): number => {\r\n    // Find first video or image in timeline\r\n    for (const track of tracks) {\r\n      for (const element of track.elements) {\r\n        if (element.type === \"media\") {\r\n          const mediaItem = mediaItems.find(\r\n            (item) => item.id === element.mediaId\r\n          );\r\n          if (\r\n            mediaItem &&\r\n            (mediaItem.type === \"video\" || mediaItem.type === \"image\")\r\n          ) {\r\n            return getMediaAspectRatio(mediaItem);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return 16 / 9; // Default aspect ratio\r\n  };\r\n\r\n  // Get current aspect ratio\r\n  const getCurrentAspectRatio = (): number => {\r\n    return canvasSize.width / canvasSize.height;\r\n  };\r\n\r\n  // Format aspect ratio as a readable string\r\n  const formatAspectRatio = (aspectRatio: number): string => {\r\n    // Check if it matches a common aspect ratio\r\n    const ratios = [\r\n      { ratio: 16 / 9, label: \"16:9\" },\r\n      { ratio: 9 / 16, label: \"9:16\" },\r\n      { ratio: 1, label: \"1:1\" },\r\n      { ratio: 4 / 3, label: \"4:3\" },\r\n      { ratio: 3 / 4, label: \"3:4\" },\r\n      { ratio: 21 / 9, label: \"21:9\" },\r\n    ];\r\n\r\n    for (const { ratio, label } of ratios) {\r\n      if (Math.abs(aspectRatio - ratio) < 0.01) {\r\n        return label;\r\n      }\r\n    }\r\n\r\n    // If not a common ratio, format as decimal\r\n    return aspectRatio.toFixed(2);\r\n  };\r\n\r\n  // Check if current mode is \"Original\"\r\n  const isOriginal = canvasMode === \"original\";\r\n\r\n  // Get display name for current aspect ratio\r\n  const getDisplayName = (): string => {\r\n    // If explicitly set to original mode, always show \"Original\"\r\n    if (canvasMode === \"original\") {\r\n      return \"Original\";\r\n    }\r\n\r\n    if (currentPreset) {\r\n      return currentPreset.name;\r\n    }\r\n\r\n    return formatAspectRatio(getCurrentAspectRatio());\r\n  };\r\n\r\n  return {\r\n    currentPreset,\r\n    canvasMode,\r\n    isOriginal,\r\n    getCurrentAspectRatio,\r\n    getOriginalAspectRatio,\r\n    formatAspectRatio,\r\n    getDisplayName,\r\n    canvasSize,\r\n    canvasPresets,\r\n  };\r\n}\r\n","export const colors = [\r\n  \"#ffffff\",\r\n  \"#000000\",\r\n  \"#ffe2e2\",\r\n  \"#ffc9c9\",\r\n  \"#ffa2a2\",\r\n  \"#ff6467\",\r\n  \"#fb2c36\",\r\n  \"#e7000b\",\r\n  \"#c10007\",\r\n  \"#9f0712\",\r\n  \"#82181a\",\r\n  \"#460809\",\r\n  \"#fff7ed\",\r\n  \"#ffedd4\",\r\n  \"#ffd6a7\",\r\n  \"#ffb86a\",\r\n  \"#ff8904\",\r\n  \"#ff6900\",\r\n  \"#f54900\",\r\n  \"#ca3500\",\r\n  \"#9f2d00\",\r\n  \"#7e2a0c\",\r\n  \"#441306\",\r\n  \"#fffbeb\",\r\n  \"#fef3c6\",\r\n  \"#fee685\",\r\n  \"#ffd230\",\r\n  \"#ffb900\",\r\n  \"#fe9a00\",\r\n  \"#e17100\",\r\n  \"#bb4d00\",\r\n  \"#973c00\",\r\n  \"#7b3306\",\r\n  \"#461901\",\r\n  \"#fefce8\",\r\n  \"#fef9c2\",\r\n  \"#fff085\",\r\n  \"#ffdf20\",\r\n  \"#fdc700\",\r\n  \"#f0b100\",\r\n  \"#d08700\",\r\n  \"#a65f00\",\r\n  \"#894b00\",\r\n  \"#733e0a\",\r\n  \"#432004\",\r\n  \"#f7fee7\",\r\n  \"#ecfcca\",\r\n  \"#d8f999\",\r\n  \"#bbf451\",\r\n  \"#9ae600\",\r\n  \"#7ccf00\",\r\n  \"#5ea500\",\r\n  \"#497d00\",\r\n  \"#3c6300\",\r\n  \"#35530e\",\r\n  \"#192e03\",\r\n  \"#f0fdf4\",\r\n  \"#dcfce7\",\r\n  \"#b9f8cf\",\r\n  \"#7bf1a8\",\r\n  \"#05df72\",\r\n  \"#00c950\",\r\n  \"#00a63e\",\r\n  \"#008236\",\r\n  \"#016630\",\r\n  \"#0d542b\",\r\n  \"#032e15\",\r\n  \"#ecfdf5\",\r\n  \"#d0fae5\",\r\n  \"#a4f4cf\",\r\n  \"#5ee9b5\",\r\n  \"#00d492\",\r\n  \"#00bc7d\",\r\n  \"#009966\",\r\n  \"#007a55\",\r\n  \"#006045\",\r\n  \"#004f3b\",\r\n  \"#002c22\",\r\n  \"#f0fdfa\",\r\n  \"#cbfbf1\",\r\n  \"#96f7e4\",\r\n  \"#46ecd5\",\r\n  \"#00d5be\",\r\n  \"#00bba7\",\r\n  \"#009689\",\r\n  \"#00786f\",\r\n  \"#005f5a\",\r\n  \"#0b4f4a\",\r\n  \"#022f2e\",\r\n  \"#ecfeff\",\r\n  \"#cefafe\",\r\n  \"#a2f4fd\",\r\n  \"#53eafd\",\r\n  \"#00d3f2\",\r\n  \"#00b8db\",\r\n  \"#0092b8\",\r\n  \"#007595\",\r\n  \"#005f78\",\r\n  \"#104e64\",\r\n  \"#053345\",\r\n  \"#f0f9ff\",\r\n  \"#dff2fe\",\r\n  \"#b8e6fe\",\r\n  \"#74d4ff\",\r\n  \"#00bcff\",\r\n  \"#00a6f4\",\r\n  \"#0084d1\",\r\n  \"#0069a8\",\r\n  \"#00598a\",\r\n  \"#024a70\",\r\n  \"#052f4a\",\r\n  \"#eff6ff\",\r\n  \"#dbeafe\",\r\n  \"#bedbff\",\r\n  \"#8ec5ff\",\r\n  \"#51a2ff\",\r\n  \"#2b7fff\",\r\n  \"#155dfc\",\r\n  \"#1447e6\",\r\n  \"#193cb8\",\r\n  \"#1c398e\",\r\n  \"#162456\",\r\n  \"#eef2ff\",\r\n  \"#e0e7ff\",\r\n  \"#c6d2ff\",\r\n  \"#a3b3ff\",\r\n  \"#7c86ff\",\r\n  \"#615fff\",\r\n  \"#4f39f6\",\r\n  \"#432dd7\",\r\n  \"#372aac\",\r\n  \"#312c85\",\r\n  \"#1e1a4d\",\r\n  \"#f5f3ff\",\r\n  \"#ede9fe\",\r\n  \"#ddd6ff\",\r\n  \"#c4b4ff\",\r\n  \"#a684ff\",\r\n  \"#8e51ff\",\r\n  \"#7f22fe\",\r\n  \"#7008e7\",\r\n  \"#5d0ec0\",\r\n  \"#4d179a\",\r\n  \"#2f0d68\",\r\n  \"#faf5ff\",\r\n  \"#f3e8ff\",\r\n  \"#e9d4ff\",\r\n  \"#dab2ff\",\r\n  \"#c27aff\",\r\n  \"#ad46ff\",\r\n  \"#9810fa\",\r\n  \"#8200db\",\r\n  \"#6e11b0\",\r\n  \"#59168b\",\r\n  \"#3c0366\",\r\n  \"#fdf4ff\",\r\n  \"#fae8ff\",\r\n  \"#f6cfff\",\r\n  \"#f4a8ff\",\r\n  \"#ed6aff\",\r\n  \"#e12afb\",\r\n  \"#c800de\",\r\n  \"#a800b7\",\r\n  \"#8a0194\",\r\n  \"#721378\",\r\n  \"#4b004f\",\r\n  \"#fdf2f8\",\r\n  \"#fce7f3\",\r\n  \"#fccee8\",\r\n  \"#fda5d5\",\r\n  \"#fb64b6\",\r\n  \"#f6339a\",\r\n  \"#e60076\",\r\n  \"#c6005c\",\r\n  \"#a3004c\",\r\n  \"#861043\",\r\n  \"#510424\",\r\n  \"#fff1f2\",\r\n  \"#ffe4e6\",\r\n  \"#ffccd3\",\r\n  \"#ffa1ad\",\r\n  \"#ff637e\",\r\n  \"#ff2056\",\r\n  \"#ec003f\",\r\n  \"#c70036\",\r\n  \"#a50036\",\r\n  \"#8b0836\",\r\n  \"#4d0218\",\r\n  \"#f8fafc\",\r\n  \"#f1f5f9\",\r\n  \"#e2e8f0\",\r\n  \"#cad5e2\",\r\n  \"#90a1b9\",\r\n  \"#62748e\",\r\n  \"#45556c\",\r\n  \"#314158\",\r\n  \"#1d293d\",\r\n  \"#0f172b\",\r\n  \"#020618\",\r\n  \"#f9fafb\",\r\n  \"#f3f4f6\",\r\n  \"#e5e7eb\",\r\n  \"#d1d5dc\",\r\n  \"#99a1af\",\r\n  \"#6a7282\",\r\n  \"#4a5565\",\r\n  \"#364153\",\r\n  \"#1e2939\",\r\n  \"#101828\",\r\n  \"#030712\",\r\n  \"#fafafa\",\r\n  \"#f4f4f5\",\r\n  \"#e4e4e7\",\r\n  \"#d4d4d8\",\r\n  \"#9f9fa9\",\r\n  \"#71717b\",\r\n  \"#52525c\",\r\n  \"#3f3f46\",\r\n  \"#27272a\",\r\n  \"#18181b\",\r\n  \"#09090b\",\r\n  \"#f5f5f5\",\r\n  \"#e5e5e5\",\r\n  \"#d4d4d4\",\r\n  \"#a1a1a1\",\r\n  \"#737373\",\r\n  \"#525252\",\r\n  \"#404040\",\r\n  \"#262626\",\r\n  \"#171717\",\r\n  \"#0a0a0a\",\r\n  \"#fafaf9\",\r\n  \"#f5f5f4\",\r\n  \"#e7e5e4\",\r\n  \"#d6d3d1\",\r\n  \"#a6a09b\",\r\n  \"#79716b\",\r\n  \"#57534d\",\r\n  \"#44403b\",\r\n  \"#292524\",\r\n  \"#1c1917\",\r\n  \"#0c0a09\",\r\n];\r\n","// These are the gradients from Pattern Craft (https://patterncraft.fun/)\r\n\r\nexport const patternCraftGradients = [\r\n  // Dreamy Sky Pink Glow\r\n  \"radial-gradient(circle at 30% 70%, rgba(173, 216, 230, 0.35), transparent 60%), radial-gradient(circle at 70% 30%, rgba(255, 182, 193, 0.4), transparent 60%)\",\r\n\r\n  // Soft Warm Pastel Texture\r\n  \"radial-gradient(circle at 20% 80%, rgba(255, 182, 153, 0.3) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(255, 244, 214, 0.5) 0%, transparent 50%), radial-gradient(circle at 40% 40%, rgba(255, 182, 153, 0.1) 0%, transparent 50%), #fff8f0\",\r\n\r\n  // Warm Soft Coral & Cream\r\n  \"radial-gradient(circle at 20% 80%, rgba(255, 160, 146, 0.25) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(255, 244, 228, 0.3) 0%, transparent 50%), radial-gradient(circle at 40% 40%, rgba(255, 160, 146, 0.15) 0%, transparent 50%), #fef9f7\",\r\n\r\n  // Soft Green Glow\r\n  \"radial-gradient(circle at center, #8FFFB0, transparent), white\",\r\n\r\n  // Purple Glow Right\r\n  \"radial-gradient(circle at top right, rgba(173, 109, 244, 0.5), transparent 70%)\",\r\n\r\n  // Teal Glow Right\r\n  \"radial-gradient(circle at top right, rgba(56, 193, 182, 0.5), transparent 70%)\",\r\n\r\n  // Warm Orange Glow Right\r\n  \"radial-gradient(circle at top right, rgba(255, 140, 60, 0.5), transparent 70%)\",\r\n\r\n  // Cool Blue Glow Right\r\n  \"radial-gradient(circle at top right, rgba(70, 130, 180, 0.5), transparent 70%)\",\r\n\r\n  // Purple Glow Left\r\n  \"radial-gradient(circle at top left, rgba(173, 109, 244, 0.5), transparent 70%)\",\r\n\r\n  // Pastel Wave\r\n  \"linear-gradient(120deg, #d5c5ff 0%, #a7f3d0 50%, #f0f0f0 100%)\",\r\n];\r\n","// These are the gradients from Syntax UI (https://syntaxui.com/effects/gradients)\r\n\r\nexport const syntaxUIGradients = [\r\n  // Cyan to Blue gradients\r\n  \"linear-gradient(to right, #22d3ee, #0ea5e9, #0284c7)\",\r\n  \"linear-gradient(to right, #bfdbfe, #a5f3fc)\",\r\n  \"linear-gradient(to right, #22d3ee, #0ea5e9, #0284c7)\",\r\n\r\n  // Purple gradients\r\n  \"linear-gradient(to right, #e9d5ff, #d8b4fe, #c084fc)\",\r\n  \"linear-gradient(to right, #c4b5fd, #a78bfa, #8b5cf6)\",\r\n\r\n  // Blue gradients\r\n  \"linear-gradient(to right, #93c5fd, #60a5fa, #3b82f6)\",\r\n  \"linear-gradient(to right, #93c5fd, #60a5fa, #3b82f6)\",\r\n\r\n  // Green gradients\r\n  \"linear-gradient(to right, #6ee7b7, #34d399, #10b981)\",\r\n  \"linear-gradient(to right, #d1fae5, #a7f3d0, #6ee7b7)\",\r\n\r\n  // Red gradient\r\n  \"linear-gradient(to right, #fca5a5, #f87171, #ef4444)\",\r\n\r\n  // Yellow/Orange gradient\r\n  \"linear-gradient(to right, #fde68a, #fbbf24, #f59e0b)\",\r\n\r\n  // Pink gradient\r\n  \"linear-gradient(to right, #fbcfe8, #f9a8d4, #f472b6)\",\r\n\r\n  // Neon radial gradient\r\n  \"radial-gradient(circle at bottom left, #ff00ff, #00ffff)\",\r\n];\r\n","\"use client\";\r\n\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { BaseView } from \"./base-view\";\r\nimport {\r\n  PropertyItem,\r\n  PropertyItemLabel,\r\n  PropertyItemValue,\r\n  PropertyGroup,\r\n} from \"../../properties-panel/property-item\";\r\nimport { FPS_PRESETS } from \"@/constants/timeline-constants\";\r\nimport { useProjectStore } from \"@/stores/project-store\";\r\nimport { useEditorStore } from \"@/stores/editor-store\";\r\nimport { useAspectRatio } from \"@/hooks/use-aspect-ratio\";\r\nimport Image from \"next/image\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { colors } from \"@/data/colors/solid\";\r\nimport { patternCraftGradients } from \"@/data/colors/pattern-craft\";\r\nimport { PipetteIcon } from \"lucide-react\";\r\nimport { useMemo, memo, useCallback } from \"react\";\r\nimport { syntaxUIGradients } from \"@/data/colors/syntax-ui\";\r\n\r\nexport function SettingsView() {\r\n  return <ProjectSettingsTabs />;\r\n}\r\n\r\nfunction ProjectSettingsTabs() {\r\n  return (\r\n    <BaseView\r\n      defaultTab=\"project-info\"\r\n      tabs={[\r\n        {\r\n          value: \"project-info\",\r\n          label: \"Project info\",\r\n          content: <ProjectInfoView />,\r\n        },\r\n        {\r\n          value: \"background\",\r\n          label: \"Background\",\r\n          content: <BackgroundView />,\r\n        },\r\n      ]}\r\n    />\r\n  );\r\n}\r\n\r\nfunction ProjectInfoView() {\r\n  const { activeProject, updateProjectFps, updateCanvasSize } =\r\n    useProjectStore();\r\n  const { canvasPresets } = useEditorStore();\r\n  const { getDisplayName } = useAspectRatio();\r\n\r\n  const handleAspectRatioChange = (value: string) => {\r\n    const preset = canvasPresets.find((p) => p.name === value);\r\n    if (preset) {\r\n      updateCanvasSize(\r\n        { width: preset.width, height: preset.height },\r\n        \"preset\"\r\n      );\r\n    }\r\n  };\r\n\r\n  const handleFpsChange = (value: string) => {\r\n    const fps = parseFloat(value);\r\n    updateProjectFps(fps);\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-4\">\r\n      <PropertyItem direction=\"column\">\r\n        <PropertyItemLabel>Name</PropertyItemLabel>\r\n        <PropertyItemValue>\r\n          {activeProject?.name || \"Untitled project\"}\r\n        </PropertyItemValue>\r\n      </PropertyItem>\r\n\r\n      <PropertyItem direction=\"column\">\r\n        <PropertyItemLabel>Aspect ratio</PropertyItemLabel>\r\n        <PropertyItemValue>\r\n          <Select\r\n            value={getDisplayName()}\r\n            onValueChange={handleAspectRatioChange}\r\n          >\r\n            <SelectTrigger className=\"bg-panel-accent\">\r\n              <SelectValue placeholder=\"Select an aspect ratio\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              {canvasPresets.map((preset) => (\r\n                <SelectItem key={preset.name} value={preset.name}>\r\n                  {preset.name}\r\n                </SelectItem>\r\n              ))}\r\n            </SelectContent>\r\n          </Select>\r\n        </PropertyItemValue>\r\n      </PropertyItem>\r\n\r\n      <PropertyItem direction=\"column\">\r\n        <PropertyItemLabel>Frame rate</PropertyItemLabel>\r\n        <PropertyItemValue>\r\n          <Select\r\n            value={(activeProject?.fps || 30).toString()}\r\n            onValueChange={handleFpsChange}\r\n          >\r\n            <SelectTrigger className=\"bg-panel-accent\">\r\n              <SelectValue placeholder=\"Select a frame rate\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              {FPS_PRESETS.map((preset) => (\r\n                <SelectItem key={preset.value} value={preset.value}>\r\n                  {preset.label}\r\n                </SelectItem>\r\n              ))}\r\n            </SelectContent>\r\n          </Select>\r\n        </PropertyItemValue>\r\n      </PropertyItem>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst BlurPreview = memo(\r\n  ({\r\n    blur,\r\n    isSelected,\r\n    onSelect,\r\n  }: {\r\n    blur: { label: string; value: number };\r\n    isSelected: boolean;\r\n    onSelect: () => void;\r\n  }) => (\r\n    <div\r\n      className={cn(\r\n        \"w-full aspect-square rounded-sm cursor-pointer border border-foreground/15 hover:border-primary relative overflow-hidden\",\r\n        isSelected && \"border-2 border-primary\"\r\n      )}\r\n      onClick={onSelect}\r\n    >\r\n      <Image\r\n        src=\"https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=1470&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D\"\r\n        alt={`Blur preview ${blur.label}`}\r\n        fill\r\n        className=\"object-cover\"\r\n        style={{ filter: `blur(${blur.value}px)` }}\r\n        loading=\"eager\"\r\n      />\r\n      <div className=\"absolute bottom-1 left-1 right-1 text-center\">\r\n        <span className=\"text-xs text-white bg-black/50 px-1 rounded\">\r\n          {blur.label}\r\n        </span>\r\n      </div>\r\n    </div>\r\n  )\r\n);\r\n\r\nBlurPreview.displayName = \"BlurPreview\";\r\n\r\nconst BackgroundPreviews = memo(\r\n  ({\r\n    backgrounds,\r\n    currentBackgroundColor,\r\n    isColorBackground,\r\n    handleColorSelect,\r\n    useBackgroundColor = false,\r\n  }: {\r\n    backgrounds: string[];\r\n    currentBackgroundColor: string;\r\n    isColorBackground: boolean;\r\n    handleColorSelect: (bg: string) => void;\r\n    useBackgroundColor?: boolean;\r\n  }) => {\r\n    return useMemo(\r\n      () =>\r\n        backgrounds.map((bg) => (\r\n          <div\r\n            key={bg}\r\n            className={cn(\r\n              \"w-full aspect-square rounded-sm cursor-pointer border border-foreground/15 hover:border-primary\",\r\n              isColorBackground &&\r\n                bg === currentBackgroundColor &&\r\n                \"border-2 border-primary\"\r\n            )}\r\n            style={\r\n              useBackgroundColor\r\n                ? { backgroundColor: bg }\r\n                : {\r\n                    background: bg,\r\n                    backgroundSize: \"cover\",\r\n                    backgroundPosition: \"center\",\r\n                    backgroundRepeat: \"no-repeat\",\r\n                  }\r\n            }\r\n            onClick={() => handleColorSelect(bg)}\r\n          />\r\n        )),\r\n      [\r\n        backgrounds,\r\n        isColorBackground,\r\n        currentBackgroundColor,\r\n        handleColorSelect,\r\n        useBackgroundColor,\r\n      ]\r\n    );\r\n  }\r\n);\r\n\r\nBackgroundPreviews.displayName = \"BackgroundPreviews\";\r\n\r\nfunction BackgroundView() {\r\n  const { activeProject, updateBackgroundType } = useProjectStore();\r\n\r\n  const blurLevels = useMemo(\r\n    () => [\r\n      { label: \"Light\", value: 4 },\r\n      { label: \"Medium\", value: 8 },\r\n      { label: \"Heavy\", value: 18 },\r\n    ],\r\n    []\r\n  );\r\n\r\n  const handleBlurSelect = useCallback(\r\n    async (blurIntensity: number) => {\r\n      await updateBackgroundType(\"blur\", { blurIntensity });\r\n    },\r\n    [updateBackgroundType]\r\n  );\r\n\r\n  const handleColorSelect = useCallback(\r\n    async (color: string) => {\r\n      await updateBackgroundType(\"color\", { backgroundColor: color });\r\n    },\r\n    [updateBackgroundType]\r\n  );\r\n\r\n  const currentBlurIntensity = activeProject?.blurIntensity || 8;\r\n  const isBlurBackground = activeProject?.backgroundType === \"blur\";\r\n  const currentBackgroundColor = activeProject?.backgroundColor || \"#000000\";\r\n  const isColorBackground = activeProject?.backgroundType === \"color\";\r\n\r\n  const blurPreviews = useMemo(\r\n    () =>\r\n      blurLevels.map((blur) => (\r\n        <BlurPreview\r\n          key={blur.value}\r\n          blur={blur}\r\n          isSelected={isBlurBackground && currentBlurIntensity === blur.value}\r\n          onSelect={() => handleBlurSelect(blur.value)}\r\n        />\r\n      )),\r\n    [blurLevels, isBlurBackground, currentBlurIntensity, handleBlurSelect]\r\n  );\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-4\">\r\n      <PropertyGroup title=\"Blur\" defaultExpanded={false}>\r\n        <div className=\"grid grid-cols-4 gap-2 w-full\">{blurPreviews}</div>\r\n      </PropertyGroup>\r\n\r\n      <PropertyGroup title=\"Colors\" defaultExpanded={false}>\r\n        <div className=\"grid grid-cols-4 gap-2 w-full\">\r\n          <div className=\"w-full aspect-square rounded-sm cursor-pointer border border-foreground/15 hover:border-primary flex items-center justify-center\">\r\n            <PipetteIcon className=\"size-4\" />\r\n          </div>\r\n          <BackgroundPreviews\r\n            backgrounds={colors}\r\n            currentBackgroundColor={currentBackgroundColor}\r\n            isColorBackground={isColorBackground}\r\n            handleColorSelect={handleColorSelect}\r\n            useBackgroundColor={true}\r\n          />\r\n        </div>\r\n      </PropertyGroup>\r\n\r\n      <PropertyGroup title=\"Pattern Craft\" defaultExpanded={false}>\r\n        <div className=\"grid grid-cols-4 gap-2 w-full\">\r\n          <BackgroundPreviews\r\n            backgrounds={patternCraftGradients}\r\n            currentBackgroundColor={currentBackgroundColor}\r\n            isColorBackground={isColorBackground}\r\n            handleColorSelect={handleColorSelect}\r\n          />\r\n        </div>\r\n      </PropertyGroup>\r\n\r\n      <PropertyGroup title=\"Syntax UI\" defaultExpanded={false}>\r\n        <div className=\"grid grid-cols-4 gap-2 w-full\">\r\n          <BackgroundPreviews\r\n            backgrounds={syntaxUIGradients}\r\n            currentBackgroundColor={currentBackgroundColor}\r\n            isColorBackground={isColorBackground}\r\n            handleColorSelect={handleColorSelect}\r\n          />\r\n        </div>\r\n      </PropertyGroup>\r\n    </div>\r\n  );\r\n}\r\n","import { useState, useRef, useEffect } from \"react\";\r\nimport { ChevronDown, Globe } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { motion } from \"framer-motion\";\r\nimport ReactCountryFlag from \"react-country-flag\";\r\n\r\nexport interface Language {\r\n  code: string;\r\n  name: string;\r\n  flag?: string;\r\n}\r\n\r\ninterface LanguageSelectProps {\r\n  selectedCountry: string;\r\n  onSelect: (country: string) => void;\r\n  containerRef: React.RefObject<HTMLDivElement>;\r\n  languages: Language[];\r\n}\r\n\r\nfunction FlagPreloader({ languages }: { languages: Language[] }) {\r\n  return (\r\n    <div className=\"absolute -top-[9999px] left-0 pointer-events-none\">\r\n      {languages.map((language) => (\r\n        <ReactCountryFlag\r\n          key={language.code}\r\n          countryCode={language.code}\r\n          svg\r\n          style={{ width: \"1.05rem\", height: \"1.05rem\" }}\r\n        />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function LanguageSelect({\r\n  selectedCountry,\r\n  onSelect,\r\n  containerRef,\r\n  languages,\r\n}: LanguageSelectProps) {\r\n  const [expanded, setExpanded] = useState(false);\r\n  const [isTapping, setIsTapping] = useState(false);\r\n  const [isClosing, setIsClosing] = useState(false);\r\n  const collapsedHeight = \"2.5rem\";\r\n  const expandHeight = \"12rem\";\r\n  const buttonRef = useRef<HTMLButtonElement>(null);\r\n\r\n  const expand = () => {\r\n    setIsTapping(true);\r\n    setTimeout(() => setIsTapping(false), 600);\r\n    setExpanded(true);\r\n    buttonRef.current?.focus();\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!expanded) return;\r\n\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (\r\n        buttonRef.current &&\r\n        !buttonRef.current.contains(event.target as Node)\r\n      ) {\r\n        setIsClosing(true);\r\n        setTimeout(() => setIsClosing(false), 600);\r\n        setExpanded(false);\r\n        buttonRef.current?.blur();\r\n      }\r\n    };\r\n\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    };\r\n  }, [expanded]);\r\n\r\n  const selectedLanguage = languages.find(\r\n    (lang) => lang.code === selectedCountry\r\n  );\r\n\r\n  const handleSelect = ({\r\n    code,\r\n    e,\r\n  }: {\r\n    code: string;\r\n    e: React.MouseEvent<HTMLButtonElement>;\r\n  }) => {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n    onSelect(code);\r\n    setExpanded(false);\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative w-full h-9\">\r\n      <FlagPreloader languages={languages} />\r\n      <motion.button\r\n        type=\"button\"\r\n        className={cn(\r\n          \"absolute w-full h-full flex flex-col overflow-hidden items-start justify-between z-10 rounded-lg px-3 cursor-pointer\",\r\n          \"!bg-foreground/10 backdrop-blur-md text-foreground py-0\",\r\n          \"transition-[color,box-shadow] focus:border-ring focus:ring-ring/50 focus:ring-[1px]\"\r\n        )}\r\n        initial={{\r\n          height: collapsedHeight,\r\n          scale: 1,\r\n        }}\r\n        animate={{\r\n          height: expanded ? expandHeight : collapsedHeight,\r\n          scale: isTapping ? [1, 0.985, 1] : 1,\r\n        }}\r\n        transition={{\r\n          height: { duration: 0.25, ease: [0.4, 0, 0.2, 1] },\r\n          scale: { duration: 0.6, ease: \"easeOut\" },\r\n        }}\r\n        onClick={expand}\r\n        ref={buttonRef}\r\n      >\r\n        {!expanded ? (\r\n          <div\r\n            className=\"flex items-center justify-between w-full\"\r\n            style={{\r\n              height: collapsedHeight,\r\n            }}\r\n          >\r\n            <div className=\"flex items-center gap-2\">\r\n              {selectedCountry === \"auto\" ? (\r\n                <Globe className=\"!size-[1.05rem]\" />\r\n              ) : (\r\n                <ReactCountryFlag\r\n                  countryCode={selectedCountry}\r\n                  svg\r\n                  style={{ width: \"1.05rem\", height: \"1.05rem\" }}\r\n                />\r\n              )}\r\n              <span className=\"pt-[0.05rem]\">\r\n                {selectedCountry === \"auto\" ? \"Auto\" : selectedLanguage?.name}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div className=\"flex flex-col gap-2 my-2.5 w-full overflow-y-auto scrollbar-hidden\">\r\n            <LanguageButton\r\n              language={{ code: \"auto\", name: \"Auto\" }}\r\n              onSelect={handleSelect}\r\n              selectedCountry={selectedCountry}\r\n            />\r\n            {languages.map((language) => (\r\n              <LanguageButton\r\n                key={language.code}\r\n                language={language}\r\n                onSelect={handleSelect}\r\n                selectedCountry={selectedCountry}\r\n              />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </motion.button>\r\n\r\n      <motion.div\r\n        className=\"absolute top-1/2 right-3 -translate-y-1/2 pointer-events-none z-20 mt-0.5\"\r\n        initial={{ opacity: 1 }}\r\n        animate={{ opacity: expanded ? 0 : 1 }}\r\n        transition={{ duration: 0.2, ease: \"easeInOut\" }}\r\n      >\r\n        <ChevronDown className=\"text-muted-foreground size-4\" />\r\n      </motion.div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction LanguageButton({\r\n  language,\r\n  onSelect,\r\n  selectedCountry,\r\n}: {\r\n  language: Language;\r\n  onSelect: ({\r\n    code,\r\n    e,\r\n  }: {\r\n    code: string;\r\n    e: React.MouseEvent<HTMLButtonElement>;\r\n  }) => void;\r\n  selectedCountry: string;\r\n}) {\r\n  return (\r\n    <button\r\n      type=\"button\"\r\n      className=\"flex items-center gap-2 cursor-pointer text-foreground hover:text-foreground/75\"\r\n      onClick={(e) => onSelect({ code: language.code, e })}\r\n    >\r\n      {language.code === \"auto\" ? (\r\n        <Globe className=\"!size-[1.0rem]\" />\r\n      ) : (\r\n        <ReactCountryFlag\r\n          countryCode={language.code}\r\n          svg\r\n          style={{ width: \"1.05rem\", height: \"1.05rem\" }}\r\n        />\r\n      )}\r\n      <span className=\"pt-[0.05rem]\">{language.name}</span>\r\n    </button>\r\n  );\r\n}\r\n","/**\r\n * True zero-knowledge encryption utilities\r\n * Keys are generated randomly in the browser and never derived from server secrets\r\n */\r\n\r\nexport interface ZeroKnowledgeEncryptionResult {\r\n  encryptedData: ArrayBuffer;\r\n  key: ArrayBuffer;\r\n  iv: ArrayBuffer;\r\n}\r\n\r\n/**\r\n * Encrypt data with a randomly generated key (true zero-knowledge)\r\n */\r\nexport async function encryptWithRandomKey(\r\n  data: ArrayBuffer\r\n): Promise<ZeroKnowledgeEncryptionResult> {\r\n  // Generate a truly random 256-bit key\r\n  const key = crypto.getRandomValues(new Uint8Array(32));\r\n\r\n  // Generate random IV\r\n  const iv = crypto.getRandomValues(new Uint8Array(12));\r\n\r\n  // Import the key for encryption\r\n  const cryptoKey = await crypto.subtle.importKey(\r\n    \"raw\",\r\n    key,\r\n    { name: \" \" },\r\n    false,\r\n    [\"encrypt\"]\r\n  );\r\n\r\n  // Encrypt the data\r\n  const encryptedResult = await crypto.subtle.encrypt(\r\n    { name: \"AES-GCM\", iv },\r\n    cryptoKey,\r\n    data\r\n  );\r\n\r\n  // For AES-GCM, we need to append the authentication tag\r\n  // The encrypted result contains both ciphertext and tag\r\n  return {\r\n    encryptedData: encryptedResult,\r\n    key: key.buffer,\r\n    iv: iv.buffer,\r\n  };\r\n}\r\n\r\n/**\r\n * Convert ArrayBuffer to base64 string for transmission\r\n */\r\nexport function arrayBufferToBase64(buffer: ArrayBuffer): string {\r\n  const bytes = new Uint8Array(buffer);\r\n  let binary = \"\";\r\n  for (let i = 0; i < bytes.byteLength; i++) {\r\n    binary += String.fromCharCode(bytes[i]);\r\n  }\r\n  return btoa(binary);\r\n}\r\n\r\n/**\r\n * Convert base64 string back to ArrayBuffer\r\n */\r\nexport function base64ToArrayBuffer(base64: string): ArrayBuffer {\r\n  const binary = atob(base64);\r\n  const bytes = new Uint8Array(binary.length);\r\n  for (let i = 0; i < binary.length; i++) {\r\n    bytes[i] = binary.charCodeAt(i);\r\n  }\r\n  return bytes.buffer;\r\n}\r\n","import { Button } from \"@/components/ui/button\";\r\nimport { PropertyGroup } from \"../../properties-panel/property-item\";\r\nimport { BaseView } from \"./base-view\";\r\nimport { Language, LanguageSelect } from \"@/components/language-select\";\r\nimport { useState, useRef, useEffect } from \"react\";\r\nimport { extractTimelineAudio } from \"@/lib/ffmpeg-utils\";\r\nimport { encryptWithRandomKey, arrayBufferToBase64 } from \"@/lib/zk-encryption\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { Loader2, Shield, Trash2, Upload } from \"lucide-react\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { TextElement } from \"@/types/timeline\";\r\n\r\nexport const languages: Language[] = [\r\n  { code: \"US\", name: \"English\" },\r\n  { code: \"ES\", name: \"Spanish\" },\r\n  { code: \"IT\", name: \"Italian\" },\r\n  { code: \"FR\", name: \"French\" },\r\n  { code: \"DE\", name: \"German\" },\r\n  { code: \"PT\", name: \"Portuguese\" },\r\n  { code: \"RU\", name: \"Russian\" },\r\n  { code: \"JP\", name: \"Japanese\" },\r\n  { code: \"CN\", name: \"Chinese\" },\r\n];\r\n\r\nconst PRIVACY_DIALOG_KEY = \"opencut-transcription-privacy-accepted\";\r\n\r\nexport function Captions() {\r\n  const [selectedCountry, setSelectedCountry] = useState(\"auto\");\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [processingStep, setProcessingStep] = useState<string>(\"\");\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [showPrivacyDialog, setShowPrivacyDialog] = useState(false);\r\n  const [hasAcceptedPrivacy, setHasAcceptedPrivacy] = useState(false);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const { insertTrackAt, addElementToTrack } = useTimelineStore();\r\n\r\n  // Check if user has already accepted privacy on mount\r\n  useEffect(() => {\r\n    const hasAccepted = localStorage.getItem(PRIVACY_DIALOG_KEY) === \"true\";\r\n    setHasAcceptedPrivacy(hasAccepted);\r\n  }, []);\r\n\r\n  const handleGenerateTranscript = async () => {\r\n    try {\r\n      setIsProcessing(true);\r\n      setError(null);\r\n      setProcessingStep(\"Extracting audio...\");\r\n\r\n      const audioBlob = await extractTimelineAudio();\r\n\r\n      setProcessingStep(\"Encrypting audio...\");\r\n\r\n      // Encrypt the audio with a random key (zero-knowledge)\r\n      const audioBuffer = await audioBlob.arrayBuffer();\r\n      const encryptionResult = await encryptWithRandomKey(audioBuffer);\r\n\r\n      // Convert encrypted data to blob for upload\r\n      const encryptedBlob = new Blob([encryptionResult.encryptedData]);\r\n\r\n      setProcessingStep(\"Uploading...\");\r\n      const uploadResponse = await fetch(\"/api/get-upload-url\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ fileExtension: \"wav\" }),\r\n      });\r\n\r\n      if (!uploadResponse.ok) {\r\n        const error = await uploadResponse.json();\r\n        throw new Error(error.message || \"Failed to get upload URL\");\r\n      }\r\n\r\n      const { uploadUrl, fileName } = await uploadResponse.json();\r\n\r\n      // Upload to R2\r\n      await fetch(uploadUrl, {\r\n        method: \"PUT\",\r\n        body: encryptedBlob,\r\n      });\r\n\r\n      setProcessingStep(\"Transcribing...\");\r\n\r\n      // Call Modal transcription API with encryption parameters\r\n      const transcriptionResponse = await fetch(\"/api/transcribe\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          filename: fileName,\r\n          language:\r\n            selectedCountry === \"auto\" ? \"auto\" : selectedCountry.toLowerCase(),\r\n          // Send the raw encryption key and IV (zero-knowledge)\r\n          decryptionKey: arrayBufferToBase64(encryptionResult.key),\r\n          iv: arrayBufferToBase64(encryptionResult.iv),\r\n        }),\r\n      });\r\n\r\n      if (!transcriptionResponse.ok) {\r\n        const error = await transcriptionResponse.json();\r\n        throw new Error(error.message || \"Transcription failed\");\r\n      }\r\n\r\n      const { text, segments } = await transcriptionResponse.json();\r\n\r\n      console.log(\"Transcription completed:\", { text, segments });\r\n\r\n      const shortCaptions: Array<{\r\n        text: string;\r\n        startTime: number;\r\n        duration: number;\r\n      }> = [];\r\n\r\n      let globalEndTime = 0; // Track the end time of the last caption globally\r\n\r\n      segments.forEach((segment: any) => {\r\n        const words = segment.text.trim().split(/\\s+/);\r\n        const segmentDuration = segment.end - segment.start;\r\n        const wordsPerSecond = words.length / segmentDuration;\r\n\r\n        // Split into chunks of 2-4 words\r\n        const chunks: string[] = [];\r\n        for (let i = 0; i < words.length; i += 3) {\r\n          chunks.push(words.slice(i, i + 3).join(\" \"));\r\n        }\r\n\r\n        // Calculate timing for each chunk to place them sequentially\r\n        let chunkStartTime = segment.start;\r\n        chunks.forEach((chunk) => {\r\n          const chunkWords = chunk.split(/\\s+/).length;\r\n          const chunkDuration = Math.max(0.8, chunkWords / wordsPerSecond); // Minimum 0.8s per chunk\r\n\r\n          let adjustedStartTime = chunkStartTime;\r\n\r\n          // Prevent overlapping: if this caption would start before the last one ends,\r\n          // start it right after the last one ends\r\n          if (adjustedStartTime < globalEndTime) {\r\n            adjustedStartTime = globalEndTime;\r\n          }\r\n\r\n          shortCaptions.push({\r\n            text: chunk,\r\n            startTime: adjustedStartTime,\r\n            duration: chunkDuration,\r\n          });\r\n\r\n          // Update global end time\r\n          globalEndTime = adjustedStartTime + chunkDuration;\r\n\r\n          // Next chunk starts when this one ends (for within-segment timing)\r\n          chunkStartTime += chunkDuration;\r\n        });\r\n      });\r\n\r\n      // Create a single track for all captions\r\n      const captionTrackId = insertTrackAt(\"text\", 0);\r\n\r\n      // Add all caption elements to the same track\r\n      shortCaptions.forEach((caption, index) => {\r\n        addElementToTrack(captionTrackId, {\r\n          type: \"text\",\r\n          name: `Caption ${index + 1}`,\r\n          content: caption.text,\r\n          duration: caption.duration,\r\n          startTime: caption.startTime,\r\n          trimStart: 0,\r\n          trimEnd: 0,\r\n          fontSize: 65,\r\n          fontFamily: \"Arial\",\r\n          color: \"#ffffff\",\r\n          textAlign: \"center\",\r\n          fontWeight: \"bold\",\r\n          fontStyle: \"normal\",\r\n          textDecoration: \"none\",\r\n          x: 0,\r\n          y: 0,\r\n          rotation: 0,\r\n          opacity: 1,\r\n        } as TextElement);\r\n      });\r\n\r\n      console.log(\r\n        `✅ ${shortCaptions.length} short-form caption chunks added to timeline!`\r\n      );\r\n    } catch (error) {\r\n      console.error(\"Transcription failed:\", error);\r\n      setError(\r\n        error instanceof Error ? error.message : \"An unexpected error occurred\"\r\n      );\r\n    } finally {\r\n      setIsProcessing(false);\r\n      setProcessingStep(\"\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <BaseView ref={containerRef} className=\"flex flex-col justify-between\">\r\n      <PropertyGroup title=\"Language\">\r\n        <LanguageSelect\r\n          selectedCountry={selectedCountry}\r\n          onSelect={setSelectedCountry}\r\n          containerRef={containerRef}\r\n          languages={languages}\r\n        />\r\n      </PropertyGroup>\r\n\r\n      <div className=\"flex flex-col gap-4\">\r\n        {error && (\r\n          <div className=\"p-3 bg-destructive/10 border border-destructive/20 rounded-md\">\r\n            <p className=\"text-sm text-destructive\">{error}</p>\r\n          </div>\r\n        )}\r\n\r\n        <Button\r\n          className=\"w-full\"\r\n          onClick={() => {\r\n            if (hasAcceptedPrivacy) {\r\n              handleGenerateTranscript();\r\n            } else {\r\n              setShowPrivacyDialog(true);\r\n            }\r\n          }}\r\n          disabled={isProcessing}\r\n        >\r\n          {isProcessing && <Loader2 className=\"mr-1 h-4 w-4 animate-spin\" />}\r\n          {isProcessing ? processingStep : \"Generate transcript\"}\r\n        </Button>\r\n\r\n        <Dialog open={showPrivacyDialog} onOpenChange={setShowPrivacyDialog}>\r\n          <DialogContent className=\"sm:max-w-md\">\r\n            <DialogHeader>\r\n              <DialogTitle className=\"flex items-center gap-2\">\r\n                <Shield className=\"h-5 w-5\" />\r\n                Audio Processing Notice\r\n              </DialogTitle>\r\n              <DialogDescription className=\"space-y-3\">\r\n                <p>\r\n                  To generate captions, we need to process your timeline audio\r\n                  using speech-to-text technology.\r\n                </p>\r\n\r\n                <div className=\"space-y-2 pt-2\">\r\n                  <div className=\"flex items-start gap-2\">\r\n                    <Shield className=\"h-4 w-4 flex-shrink-0\" />\r\n                    <span className=\"text-sm\">\r\n                      Zero-knowledge encryption - we cannot decrypt your files\r\n                      even if we wanted to\r\n                    </span>\r\n                  </div>\r\n\r\n                  <div className=\"flex items-start gap-2\">\r\n                    <Shield className=\"h-4 w-4 flex-shrink-0\" />\r\n                    <span className=\"text-sm\">\r\n                      Encryption keys generated randomly in your browser, never\r\n                      stored anywhere\r\n                    </span>\r\n                  </div>\r\n\r\n                  <div className=\"flex items-start gap-2\">\r\n                    <Upload className=\"h-4 w-4 flex-shrink-0\" />\r\n                    <span className=\"text-sm\">\r\n                      Audio encrypted before upload - raw audio never leaves\r\n                      your device\r\n                    </span>\r\n                  </div>\r\n\r\n                  <div className=\"flex items-start gap-2\">\r\n                    <Trash2 className=\"h-4 w-4 flex-shrink-0\" />\r\n                    <span className=\"text-sm\">\r\n                      Everything permanently deleted within seconds after\r\n                      transcription\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n\r\n                <p className=\"text-xs text-muted-foreground\">\r\n                  <strong>True zero-knowledge privacy:</strong> Encryption keys\r\n                  are generated randomly in your browser and never stored\r\n                  anywhere. It's cryptographically impossible for us, our cloud\r\n                  providers, or anyone else to decrypt your audio files.\r\n                </p>\r\n              </DialogDescription>\r\n            </DialogHeader>\r\n            <DialogFooter className=\"gap-2\">\r\n              <Button\r\n                variant=\"outline\"\r\n                onClick={() => setShowPrivacyDialog(false)}\r\n                disabled={isProcessing}\r\n              >\r\n                Cancel\r\n              </Button>\r\n              <Button\r\n                onClick={() => {\r\n                  localStorage.setItem(PRIVACY_DIALOG_KEY, \"true\");\r\n                  setHasAcceptedPrivacy(true);\r\n                  setShowPrivacyDialog(false);\r\n                  handleGenerateTranscript();\r\n                }}\r\n                disabled={isProcessing}\r\n              >\r\n                Continue & Generate Captions\r\n              </Button>\r\n            </DialogFooter>\r\n          </DialogContent>\r\n        </Dialog>\r\n      </div>\r\n    </BaseView>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { TabBar } from \"./tabbar\";\r\nimport { MediaView } from \"./views/media\";\r\nimport { useMediaPanelStore, Tab } from \"./store\";\r\nimport { TextView } from \"./views/text\";\r\nimport { SoundsView } from \"./views/sounds\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { SettingsView } from \"./views/settings\";\r\nimport { Captions } from \"./views/captions\";\r\n\r\nexport function MediaPanel() {\r\n  const { activeTab } = useMediaPanelStore();\r\n\r\n  const viewMap: Record<Tab, React.ReactNode> = {\r\n    media: <MediaView />,\r\n    sounds: <SoundsView />,\r\n    text: <TextView />,\r\n    stickers: (\r\n      <div className=\"p-4 text-muted-foreground\">\r\n        Stickers view coming soon...\r\n      </div>\r\n    ),\r\n    effects: (\r\n      <div className=\"p-4 text-muted-foreground\">\r\n        Effects view coming soon...\r\n      </div>\r\n    ),\r\n    transitions: (\r\n      <div className=\"p-4 text-muted-foreground\">\r\n        Transitions view coming soon...\r\n      </div>\r\n    ),\r\n    captions: <Captions />,\r\n    filters: (\r\n      <div className=\"p-4 text-muted-foreground\">\r\n        Filters view coming soon...\r\n      </div>\r\n    ),\r\n    adjustment: (\r\n      <div className=\"p-4 text-muted-foreground\">\r\n        Adjustment view coming soon...\r\n      </div>\r\n    ),\r\n    settings: <SettingsView />,\r\n  };\r\n\r\n  return (\r\n    <div className=\"h-full flex bg-panel\">\r\n      <TabBar />\r\n      <Separator orientation=\"vertical\" />\r\n      <div className=\"flex-1 overflow-hidden\">{viewMap[activeTab]}</div>\r\n    </div>\r\n  );\r\n}\r\n","import { MediaElement } from \"@/types/timeline\";\r\n\r\nexport function AudioProperties({ element }: { element: MediaElement }) {\r\n  return <div className=\"space-y-4 p-5\">Audio properties</div>;\r\n}\r\n","import { MediaElement } from \"@/types/timeline\";\r\n\r\nexport function MediaProperties({ element }: { element: MediaElement }) {\r\n  return <div className=\"space-y-4 p-5\">Media properties</div>;\r\n}\r\n","import * as React from \"react\";\r\n\r\nimport { cn } from \"../../lib/utils\";\r\n\r\nconst Textarea = React.forwardRef<\r\n  HTMLTextAreaElement,\r\n  React.ComponentProps<\"textarea\">\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <textarea\r\n      className={cn(\r\n        \"flex min-h-[60px] w-full rounded-md border border-input bg-background px-3 py-2 text-base shadow-xs placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-0 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-xs\",\r\n        className\r\n      )}\r\n      ref={ref}\r\n      {...props}\r\n    />\r\n  );\r\n});\r\nTextarea.displayName = \"Textarea\";\r\n\r\nexport { Textarea };\r\n","export interface FontOption {\r\n  value: string;\r\n  label: string;\r\n  category: \"system\" | \"google\" | \"custom\";\r\n  weights?: number[];\r\n  hasClassName?: boolean;\r\n}\r\n\r\nexport const FONT_OPTIONS: FontOption[] = [\r\n  // System fonts (always available)\r\n  { value: \"Arial\", label: \"Arial\", category: \"system\", hasClassName: false },\r\n  {\r\n    value: \"Helvetica\",\r\n    label: \"Helvetica\",\r\n    category: \"system\",\r\n    hasClassName: false,\r\n  },\r\n  {\r\n    value: \"Times New Roman\",\r\n    label: \"Times New Roman\",\r\n    category: \"system\",\r\n    hasClassName: false,\r\n  },\r\n  {\r\n    value: \"Georgia\",\r\n    label: \"Georgia\",\r\n    category: \"system\",\r\n    hasClassName: false,\r\n  },\r\n\r\n  // Google Fonts (loaded in layout.tsx)\r\n  {\r\n    value: \"Inter\",\r\n    label: \"Inter\",\r\n    category: \"google\",\r\n    weights: [400, 700],\r\n    hasClassName: true,\r\n  },\r\n  {\r\n    value: \"Roboto\",\r\n    label: \"Roboto\",\r\n    category: \"google\",\r\n    weights: [400, 700],\r\n    hasClassName: true,\r\n  },\r\n  {\r\n    value: \"Open Sans\",\r\n    label: \"Open Sans\",\r\n    category: \"google\",\r\n    hasClassName: true,\r\n  },\r\n  {\r\n    value: \"Playfair Display\",\r\n    label: \"Playfair Display\",\r\n    category: \"google\",\r\n    hasClassName: true,\r\n  },\r\n  {\r\n    value: \"Comic Neue\",\r\n    label: \"Comic Neue\",\r\n    category: \"google\",\r\n    hasClassName: false,\r\n  },\r\n] as const;\r\n\r\nexport const DEFAULT_FONT = \"Arial\";\r\n\r\n// Type-safe font family union\r\nexport type FontFamily = (typeof FONT_OPTIONS)[number][\"value\"];\r\n\r\n// Helper functions\r\nexport const getFontByValue = (value: string): FontOption | undefined =>\r\n  FONT_OPTIONS.find((font) => font.value === value);\r\n\r\nexport const getGoogleFonts = (): FontOption[] =>\r\n  FONT_OPTIONS.filter((font) => font.category === \"google\");\r\n\r\nexport const getSystemFonts = (): FontOption[] =>\r\n  FONT_OPTIONS.filter((font) => font.category === \"system\");\r\n","import {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { FONT_OPTIONS, FontFamily } from \"@/constants/font-constants\";\r\n\r\ninterface FontPickerProps {\r\n  defaultValue?: FontFamily;\r\n  onValueChange?: (value: FontFamily) => void;\r\n  className?: string;\r\n}\r\n\r\nexport function FontPicker({\r\n  defaultValue,\r\n  onValueChange,\r\n  className,\r\n}: FontPickerProps) {\r\n  return (\r\n    <Select defaultValue={defaultValue} onValueChange={onValueChange}>\r\n      <SelectTrigger className={`w-full text-xs ${className || \"\"}`}>\r\n        <SelectValue placeholder=\"Select a font\" />\r\n      </SelectTrigger>\r\n      <SelectContent>\r\n        {FONT_OPTIONS.map((font) => (\r\n          <SelectItem\r\n            key={font.value}\r\n            value={font.value}\r\n            className=\"text-xs\"\r\n            style={{ fontFamily: font.value }}\r\n          >\r\n            {font.label}\r\n          </SelectItem>\r\n        ))}\r\n      </SelectContent>\r\n    </Select>\r\n  );\r\n}\r\n","import { Textarea } from \"@/components/ui/textarea\";\r\nimport { FontPicker } from \"@/components/ui/font-picker\";\r\nimport { FontFamily } from \"@/constants/font-constants\";\r\nimport { TextElement } from \"@/types/timeline\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { Slider } from \"@/components/ui/slider\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { useState } from \"react\";\r\nimport {\r\n  PropertyItem,\r\n  PropertyItemLabel,\r\n  PropertyItemValue,\r\n} from \"./property-item\";\r\n\r\nexport function TextProperties({\r\n  element,\r\n  trackId,\r\n}: {\r\n  element: TextElement;\r\n  trackId: string;\r\n}) {\r\n  const { updateTextElement } = useTimelineStore();\r\n\r\n  // Local state for input values to allow temporary empty/invalid states\r\n  const [fontSizeInput, setFontSizeInput] = useState(\r\n    element.fontSize.toString()\r\n  );\r\n  const [opacityInput, setOpacityInput] = useState(\r\n    Math.round(element.opacity * 100).toString()\r\n  );\r\n\r\n  const parseAndValidateNumber = (\r\n    value: string,\r\n    min: number,\r\n    max: number,\r\n    fallback: number\r\n  ): number => {\r\n    const parsed = parseInt(value, 10);\r\n    if (isNaN(parsed)) return fallback;\r\n    return Math.max(min, Math.min(max, parsed));\r\n  };\r\n\r\n  const handleFontSizeChange = (value: string) => {\r\n    setFontSizeInput(value);\r\n\r\n    if (value.trim() !== \"\") {\r\n      const fontSize = parseAndValidateNumber(value, 8, 300, element.fontSize);\r\n      updateTextElement(trackId, element.id, { fontSize });\r\n    }\r\n  };\r\n\r\n  const handleFontSizeBlur = () => {\r\n    const fontSize = parseAndValidateNumber(\r\n      fontSizeInput,\r\n      8,\r\n      300,\r\n      element.fontSize\r\n    );\r\n    setFontSizeInput(fontSize.toString());\r\n    updateTextElement(trackId, element.id, { fontSize });\r\n  };\r\n\r\n  const handleOpacityChange = (value: string) => {\r\n    setOpacityInput(value);\r\n\r\n    if (value.trim() !== \"\") {\r\n      const opacityPercent = parseAndValidateNumber(\r\n        value,\r\n        0,\r\n        100,\r\n        Math.round(element.opacity * 100)\r\n      );\r\n      updateTextElement(trackId, element.id, { opacity: opacityPercent / 100 });\r\n    }\r\n  };\r\n\r\n  const handleOpacityBlur = () => {\r\n    const opacityPercent = parseAndValidateNumber(\r\n      opacityInput,\r\n      0,\r\n      100,\r\n      Math.round(element.opacity * 100)\r\n    );\r\n    setOpacityInput(opacityPercent.toString());\r\n    updateTextElement(trackId, element.id, { opacity: opacityPercent / 100 });\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6 p-5\">\r\n      <Textarea\r\n        placeholder=\"Name\"\r\n        defaultValue={element.content}\r\n        className=\"min-h-18 resize-none bg-background/50\"\r\n        onChange={(e) =>\r\n          updateTextElement(trackId, element.id, { content: e.target.value })\r\n        }\r\n      />\r\n      <PropertyItem direction=\"row\">\r\n        <PropertyItemLabel>Font</PropertyItemLabel>\r\n        <PropertyItemValue>\r\n          <FontPicker\r\n            defaultValue={element.fontFamily}\r\n            onValueChange={(value: FontFamily) =>\r\n              updateTextElement(trackId, element.id, { fontFamily: value })\r\n            }\r\n          />\r\n        </PropertyItemValue>\r\n      </PropertyItem>\r\n      <PropertyItem direction=\"column\">\r\n        <PropertyItem direction=\"row\">\r\n          <PropertyItemLabel>Style</PropertyItemLabel>\r\n          <PropertyItemValue>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Button\r\n                variant={element.fontWeight === \"bold\" ? \"default\" : \"outline\"}\r\n                size=\"sm\"\r\n                onClick={() =>\r\n                  updateTextElement(trackId, element.id, {\r\n                    fontWeight:\r\n                      element.fontWeight === \"bold\" ? \"normal\" : \"bold\",\r\n                  })\r\n                }\r\n                className=\"h-8 px-3 font-bold\"\r\n              >\r\n                B\r\n              </Button>\r\n              <Button\r\n                variant={element.fontStyle === \"italic\" ? \"default\" : \"outline\"}\r\n                size=\"sm\"\r\n                onClick={() =>\r\n                  updateTextElement(trackId, element.id, {\r\n                    fontStyle:\r\n                      element.fontStyle === \"italic\" ? \"normal\" : \"italic\",\r\n                  })\r\n                }\r\n                className=\"h-8 px-3 italic\"\r\n              >\r\n                I\r\n              </Button>\r\n              <Button\r\n                variant={\r\n                  element.textDecoration === \"underline\" ? \"default\" : \"outline\"\r\n                }\r\n                size=\"sm\"\r\n                onClick={() =>\r\n                  updateTextElement(trackId, element.id, {\r\n                    textDecoration:\r\n                      element.textDecoration === \"underline\"\r\n                        ? \"none\"\r\n                        : \"underline\",\r\n                  })\r\n                }\r\n                className=\"h-8 px-3 underline\"\r\n              >\r\n                U\r\n              </Button>\r\n              <Button\r\n                variant={\r\n                  element.textDecoration === \"line-through\"\r\n                    ? \"default\"\r\n                    : \"outline\"\r\n                }\r\n                size=\"sm\"\r\n                onClick={() =>\r\n                  updateTextElement(trackId, element.id, {\r\n                    textDecoration:\r\n                      element.textDecoration === \"line-through\"\r\n                        ? \"none\"\r\n                        : \"line-through\",\r\n                  })\r\n                }\r\n                className=\"h-8 px-3 line-through\"\r\n              >\r\n                S\r\n              </Button>\r\n            </div>\r\n          </PropertyItemValue>\r\n        </PropertyItem>\r\n        <PropertyItemLabel>Font size</PropertyItemLabel>\r\n        <PropertyItemValue>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Slider\r\n              value={[element.fontSize]}\r\n              min={8}\r\n              max={300}\r\n              step={1}\r\n              onValueChange={([value]) => {\r\n                updateTextElement(trackId, element.id, { fontSize: value });\r\n                setFontSizeInput(value.toString());\r\n              }}\r\n              className=\"w-full\"\r\n            />\r\n            <Input\r\n              type=\"number\"\r\n              value={fontSizeInput}\r\n              min={8}\r\n              max={300}\r\n              onChange={(e) => handleFontSizeChange(e.target.value)}\r\n              onBlur={handleFontSizeBlur}\r\n              className=\"w-12 !text-xs h-7 rounded-sm text-center\r\n               [appearance:textfield]\r\n               [&::-webkit-outer-spin-button]:appearance-none\r\n               [&::-webkit-inner-spin-button]:appearance-none\"\r\n            />\r\n          </div>\r\n        </PropertyItemValue>\r\n      </PropertyItem>\r\n      <PropertyItem direction=\"row\">\r\n        <PropertyItemLabel>Color</PropertyItemLabel>\r\n        <PropertyItemValue>\r\n          <Input\r\n            type=\"color\"\r\n            value={element.color || \"#ffffff\"}\r\n            onChange={(e) => {\r\n              const color = e.target.value;\r\n              updateTextElement(trackId, element.id, { color });\r\n            }}\r\n            className=\"w-full cursor-pointer rounded-full\"\r\n          />\r\n        </PropertyItemValue>\r\n      </PropertyItem>\r\n      <PropertyItem direction=\"row\">\r\n        <PropertyItemLabel>Background</PropertyItemLabel>\r\n        <PropertyItemValue>\r\n          <Input\r\n            type=\"color\"\r\n            value={\r\n              element.backgroundColor === \"transparent\"\r\n                ? \"#000000\"\r\n                : element.backgroundColor || \"#000000\"\r\n            }\r\n            onChange={(e) => {\r\n              const backgroundColor = e.target.value;\r\n              updateTextElement(trackId, element.id, { backgroundColor });\r\n            }}\r\n            className=\"w-full cursor-pointer rounded-full\"\r\n          />\r\n        </PropertyItemValue>\r\n      </PropertyItem>\r\n      <PropertyItem direction=\"column\">\r\n        <PropertyItemLabel>Opacity</PropertyItemLabel>\r\n        <PropertyItemValue>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Slider\r\n              value={[element.opacity * 100]}\r\n              min={0}\r\n              max={100}\r\n              step={1}\r\n              onValueChange={([value]) => {\r\n                updateTextElement(trackId, element.id, {\r\n                  opacity: value / 100,\r\n                });\r\n                setOpacityInput(value.toString());\r\n              }}\r\n              className=\"w-full\"\r\n            />\r\n            <Input\r\n              type=\"number\"\r\n              value={opacityInput}\r\n              min={0}\r\n              max={100}\r\n              onChange={(e) => handleOpacityChange(e.target.value)}\r\n              onBlur={handleOpacityBlur}\r\n              className=\"w-12 !text-xs h-7 rounded-sm text-center\r\n               [appearance:textfield]\r\n               [&::-webkit-outer-spin-button]:appearance-none\r\n               [&::-webkit-inner-spin-button]:appearance-none\"\r\n            />\r\n          </div>\r\n        </PropertyItemValue>\r\n      </PropertyItem>\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { useMediaStore } from \"@/stores/media-store\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { ScrollArea } from \"../../ui/scroll-area\";\r\nimport { AudioProperties } from \"./audio-properties\";\r\nimport { MediaProperties } from \"./media-properties\";\r\nimport { TextProperties } from \"./text-properties\";\r\nimport { SquareSlashIcon } from \"lucide-react\";\r\n\r\nexport function PropertiesPanel() {\r\n  const { selectedElements, tracks } = useTimelineStore();\r\n  const { mediaItems } = useMediaStore();\r\n\r\n  return (\r\n    <>\r\n      {selectedElements.length > 0 ? (\r\n        <ScrollArea className=\"h-full bg-panel rounded-sm\">\r\n          {selectedElements.map(({ trackId, elementId }) => {\r\n            const track = tracks.find((t) => t.id === trackId);\r\n            const element = track?.elements.find((e) => e.id === elementId);\r\n\r\n            if (element?.type === \"text\") {\r\n              return (\r\n                <div key={elementId}>\r\n                  <TextProperties element={element} trackId={trackId} />\r\n                </div>\r\n              );\r\n            }\r\n            if (element?.type === \"media\") {\r\n              const mediaItem = mediaItems.find(\r\n                (item) => item.id === element.mediaId\r\n              );\r\n\r\n              if (mediaItem?.type === \"audio\") {\r\n                return <AudioProperties key={elementId} element={element} />;\r\n              }\r\n\r\n              return (\r\n                <div key={elementId}>\r\n                  <MediaProperties element={element} />\r\n                </div>\r\n              );\r\n            }\r\n            return null;\r\n          })}\r\n        </ScrollArea>\r\n      ) : (\r\n        <EmptyView />\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\nfunction EmptyView() {\r\n  return (\r\n    <div className=\"bg-panel h-full p-4 flex flex-col items-center justify-center gap-3\">\r\n      <SquareSlashIcon\r\n        className=\"w-10 h-10 text-muted-foreground\"\r\n        strokeWidth={1.5}\r\n      />\r\n      <div className=\"flex flex-col gap-2 text-center\">\r\n        <p className=\"text-lg font-medium\">It’s empty here</p>\r\n        <p className=\"text-sm text-muted-foreground text-balance\">\r\n          Click an element on the timeline to edit its properties\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { cn } from \"@/lib/utils\";\r\nimport { ChevronDown } from \"lucide-react\";\r\nimport { useState } from \"react\";\r\n\r\ninterface PropertyItemProps {\r\n  direction?: \"row\" | \"column\";\r\n  children: React.ReactNode;\r\n  className?: string;\r\n}\r\n\r\nexport function PropertyItem({\r\n  direction = \"row\",\r\n  children,\r\n  className,\r\n}: PropertyItemProps) {\r\n  return (\r\n    <div\r\n      className={cn(\r\n        \"flex gap-2\",\r\n        direction === \"row\"\r\n          ? \"items-center justify-between gap-6\"\r\n          : \"flex-col gap-1.5\",\r\n        className\r\n      )}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function PropertyItemLabel({\r\n  children,\r\n  className,\r\n}: {\r\n  children: React.ReactNode;\r\n  className?: string;\r\n}) {\r\n  return (\r\n    <label className={cn(\"text-xs text-muted-foreground\", className)}>\r\n      {children}\r\n    </label>\r\n  );\r\n}\r\n\r\nexport function PropertyItemValue({\r\n  children,\r\n  className,\r\n}: {\r\n  children: React.ReactNode;\r\n  className?: string;\r\n}) {\r\n  return <div className={cn(\"flex-1 text-sm\", className)}>{children}</div>;\r\n}\r\n\r\ninterface PropertyGroupProps {\r\n  title: string;\r\n  children: React.ReactNode;\r\n  defaultExpanded?: boolean;\r\n  className?: string;\r\n}\r\n\r\nexport function PropertyGroup({\r\n  title,\r\n  children,\r\n  defaultExpanded = true,\r\n  className,\r\n}: PropertyGroupProps) {\r\n  const [isExpanded, setIsExpanded] = useState(defaultExpanded);\r\n\r\n  return (\r\n    <PropertyItem direction=\"column\" className={cn(\"gap-3\", className)}>\r\n      <div\r\n        className=\"flex items-center gap-1.5 cursor-pointer\"\r\n        onClick={() => setIsExpanded(!isExpanded)}\r\n      >\r\n        <PropertyItemLabel className=\"cursor-pointer\">\r\n          {title}\r\n        </PropertyItemLabel>\r\n        <ChevronDown className={cn(\"size-3\", !isExpanded && \"-rotate-90\")} />\r\n      </div>\r\n      {isExpanded && <PropertyItemValue>{children}</PropertyItemValue>}\r\n    </PropertyItem>\r\n  );\r\n}\r\n","import { cva, type VariantProps } from 'class-variance-authority';\r\nimport { Tooltip as TooltipPrimitive } from 'radix-ui';\r\nimport * as React from 'react';\r\n\r\nimport { cn } from '@/lib/utils';\r\n\r\nconst TooltipProvider = TooltipPrimitive.Provider;\r\n\r\nconst Tooltip = TooltipPrimitive.Root;\r\n\r\nconst TooltipTrigger = TooltipPrimitive.Trigger;\r\n\r\nconst tooltipVariants = cva(\r\n  'z-50 overflow-visible rounded-sm text-sm shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: 'bg-popover text-popover-foreground border px-3 py-1.5',\r\n        destructive:\r\n          'bg-destructive/10 text-destructive dark:bg-destructive/20 border-destructive [border-width:0.5px]',\r\n        outline: 'border-border',\r\n        important:\r\n          'bg-amber-100/90 text-amber-900 dark:bg-amber-900/20 dark:text-amber-300 border-amber-900 [border-width:0.5px]',\r\n        promotions:\r\n          'bg-red-100/90 text-red-900 dark:bg-red-900/20 dark:text-red-300 border-red-900 [border-width:0.5px]',\r\n        personal:\r\n          'bg-green-100/90 text-green-900 dark:bg-green-900/20 dark:text-green-300 border-green-900 [border-width:0.5px]',\r\n        updates:\r\n          'bg-purple-100/90 text-purple-900 dark:bg-purple-900/20 dark:text-purple-300 border-purple-900 [border-width:0.5px]',\r\n        forums:\r\n          'bg-blue-100/90 text-blue-900 dark:bg-blue-900/20 dark:text-blue-300 border-blue-900 [border-width:0.5px]',\r\n        sidebar: 'bg-white dark:bg-[#413F3E] p-2.5 flex flex-col gap-2',\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: 'default',\r\n    },\r\n  },\r\n);\r\n\r\ninterface TooltipContentProps\r\n  extends React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>,\r\n    VariantProps<typeof tooltipVariants> {}\r\n\r\nconst TooltipContent = React.forwardRef<\r\n  React.ElementRef<typeof TooltipPrimitive.Content>,\r\n  TooltipContentProps\r\n>(({ className, sideOffset = 4, variant, ...props }, ref) => (\r\n  <TooltipPrimitive.Content\r\n    ref={ref}\r\n    sideOffset={sideOffset}\r\n    className={cn(tooltipVariants({ variant }), className)}\r\n    {...props}\r\n  >\r\n    {variant === 'sidebar' && (\r\n      <svg\r\n        width=\"6\"\r\n        height=\"10\"\r\n        viewBox=\"0 0 6 10\"\r\n        fill=\"none\"\r\n        xmlns=\"http://www.w3.org/2000/svg\"\r\n        className=\"absolute left-[-6px] top-1/2 -translate-y-1/2\"\r\n      >\r\n        <path d=\"M6 0L0 5L6 10V0Z\" className=\"fill-white/80 dark:fill-[#413F3E]\" />\r\n      </svg>\r\n    )}\r\n    {props.children}\r\n  </TooltipPrimitive.Content>\r\n));\r\nTooltipContent.displayName = TooltipPrimitive.Content.displayName;\r\n\r\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider };","import { toast } from \"sonner\";\r\nimport {\r\n  getFileType,\r\n  generateVideoThumbnail,\r\n  getMediaDuration,\r\n  getImageDimensions,\r\n  type MediaItem,\r\n} from \"@/stores/media-store\";\r\nimport { generateThumbnail, getVideoInfo } from \"./ffmpeg-utils\";\r\n\r\nexport interface ProcessedMediaItem extends Omit<MediaItem, \"id\"> {}\r\n\r\nexport async function processMediaFiles(\r\n  files: FileList | File[],\r\n  onProgress?: (progress: number) => void\r\n): Promise<ProcessedMediaItem[]> {\r\n  const fileArray = Array.from(files);\r\n  const processedItems: ProcessedMediaItem[] = [];\r\n\r\n  const total = fileArray.length;\r\n  let completed = 0;\r\n\r\n  for (const file of fileArray) {\r\n    const fileType = getFileType(file);\r\n\r\n    if (!fileType) {\r\n      toast.error(`Unsupported file type: ${file.name}`);\r\n      continue;\r\n    }\r\n\r\n    const url = URL.createObjectURL(file);\r\n    let thumbnailUrl: string | undefined;\r\n    let duration: number | undefined;\r\n    let width: number | undefined;\r\n    let height: number | undefined;\r\n    let fps: number | undefined;\r\n\r\n    try {\r\n      if (fileType === \"image\") {\r\n        // Get image dimensions\r\n        const dimensions = await getImageDimensions(file);\r\n        width = dimensions.width;\r\n        height = dimensions.height;\r\n      } else if (fileType === \"video\") {\r\n        try {\r\n          // Use FFmpeg for comprehensive video info extraction\r\n          const videoInfo = await getVideoInfo(file);\r\n          duration = videoInfo.duration;\r\n          width = videoInfo.width;\r\n          height = videoInfo.height;\r\n          fps = videoInfo.fps;\r\n\r\n          // Generate thumbnail using FFmpeg\r\n          thumbnailUrl = await generateThumbnail(file, 1);\r\n        } catch (error) {\r\n          console.warn(\r\n            \"FFmpeg processing failed, falling back to basic processing:\",\r\n            error\r\n          );\r\n          // Fallback to basic processing\r\n          const videoResult = await generateVideoThumbnail(file);\r\n          thumbnailUrl = videoResult.thumbnailUrl;\r\n          width = videoResult.width;\r\n          height = videoResult.height;\r\n          duration = await getMediaDuration(file);\r\n          // FPS will remain undefined for fallback\r\n        }\r\n      } else if (fileType === \"audio\") {\r\n        // For audio, we don't set width/height/fps (they'll be undefined)\r\n        duration = await getMediaDuration(file);\r\n      }\r\n\r\n      processedItems.push({\r\n        name: file.name,\r\n        type: fileType,\r\n        file,\r\n        url,\r\n        thumbnailUrl,\r\n        duration,\r\n        width,\r\n        height,\r\n        fps,\r\n      });\r\n\r\n      // Yield back to the event loop to keep the UI responsive\r\n      await new Promise((resolve) => setTimeout(resolve, 0));\r\n\r\n      completed += 1;\r\n      if (onProgress) {\r\n        const percent = Math.round((completed / total) * 100);\r\n        onProgress(percent);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error processing file:\", file.name, error);\r\n      toast.error(`Failed to process ${file.name}`);\r\n      URL.revokeObjectURL(url); // Clean up on error\r\n    }\r\n  }\r\n\r\n  return processedItems;\r\n}\r\n","\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nconst Separator = React.forwardRef<\r\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\r\n>(\r\n  (\r\n    { className, orientation = \"horizontal\", decorative = true, ...props },\r\n    ref\r\n  ) => (\r\n    <SeparatorPrimitive.Root\r\n      ref={ref}\r\n      decorative={decorative}\r\n      orientation={orientation}\r\n      className={cn(\r\n        \"shrink-0 bg-border\",\r\n        orientation === \"horizontal\" ? \"h-px w-full\" : \"h-full w-px\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n);\r\nSeparator.displayName = SeparatorPrimitive.Root.displayName;\r\n\r\nexport { Separator };\r\n","\"use client\";\r\n\r\nimport * as ResizablePrimitive from \"react-resizable-panels\";\r\n\r\nimport { cn } from \"../../lib/utils\";\r\n\r\nconst ResizablePanelGroup = ({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\r\n  <ResizablePrimitive.PanelGroup\r\n    className={cn(\r\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n);\r\n\r\nconst ResizablePanel = ResizablePrimitive.Panel;\r\n\r\nconst ResizableHandle = ({\r\n  withHandle,\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\r\n  withHandle?: boolean;\r\n}) => (\r\n  <ResizablePrimitive.PanelResizeHandle\r\n    className={cn(\r\n      \"relative flex w-px items-center justify-center bg-transparent after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n);\r\n\r\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle };\r\n","import { FFmpeg } from \"@ffmpeg/ffmpeg\";\r\nimport { toBlobURL } from \"@ffmpeg/util\";\r\nimport { basePath } from \"./base-path\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { useMediaStore } from \"@/stores/media-store\";\r\n\r\nlet ffmpeg: FFmpeg | null = null;\r\n\r\nexport const initFFmpeg = async (): Promise<FFmpeg> => {\r\n  if (ffmpeg) return ffmpeg;\r\n\r\n  ffmpeg = new FFmpeg();\r\n\r\n  // Use locally hosted files instead of CDN\r\n  const baseURL = `${basePath}/ffmpeg`;\r\n\r\n  await ffmpeg.load({\r\n    coreURL: await toBlobURL(`${baseURL}/ffmpeg-core.js`, \"text/javascript\"),\r\n    wasmURL: await toBlobURL(`${baseURL}/ffmpeg-core.wasm`, \"application/wasm\"),\r\n  });\r\n\r\n  return ffmpeg;\r\n};\r\n\r\nexport const generateThumbnail = async (\r\n  videoFile: File,\r\n  timeInSeconds = 1\r\n): Promise<string> => {\r\n  const ffmpeg = await initFFmpeg();\r\n\r\n  const inputName = \"input.mp4\";\r\n  const outputName = \"thumbnail.jpg\";\r\n\r\n  // Write input file\r\n  await ffmpeg.writeFile(\r\n    inputName,\r\n    new Uint8Array(await videoFile.arrayBuffer())\r\n  );\r\n\r\n  // Generate thumbnail at specific time\r\n  await ffmpeg.exec([\r\n    \"-i\",\r\n    inputName,\r\n    \"-ss\",\r\n    timeInSeconds.toString(),\r\n    \"-vframes\",\r\n    \"1\",\r\n    \"-vf\",\r\n    \"scale=320:240\",\r\n    \"-q:v\",\r\n    \"2\",\r\n    outputName,\r\n  ]);\r\n\r\n  // Read output file\r\n  const data = await ffmpeg.readFile(outputName);\r\n  const blob = new Blob([data], { type: \"image/jpeg\" });\r\n\r\n  // Cleanup\r\n  await ffmpeg.deleteFile(inputName);\r\n  await ffmpeg.deleteFile(outputName);\r\n\r\n  return URL.createObjectURL(blob);\r\n};\r\n\r\nexport const trimVideo = async (\r\n  videoFile: File,\r\n  startTime: number,\r\n  endTime: number,\r\n  onProgress?: (progress: number) => void\r\n): Promise<Blob> => {\r\n  const ffmpeg = await initFFmpeg();\r\n\r\n  const inputName = \"input.mp4\";\r\n  const outputName = \"output.mp4\";\r\n\r\n  // Set up progress callback\r\n  if (onProgress) {\r\n    ffmpeg.on(\"progress\", ({ progress }) => {\r\n      onProgress(progress * 100);\r\n    });\r\n  }\r\n\r\n  // Write input file\r\n  await ffmpeg.writeFile(\r\n    inputName,\r\n    new Uint8Array(await videoFile.arrayBuffer())\r\n  );\r\n\r\n  const duration = endTime - startTime;\r\n\r\n  // Trim video\r\n  await ffmpeg.exec([\r\n    \"-i\",\r\n    inputName,\r\n    \"-ss\",\r\n    startTime.toString(),\r\n    \"-t\",\r\n    duration.toString(),\r\n    \"-c\",\r\n    \"copy\", // Use stream copy for faster processing\r\n    outputName,\r\n  ]);\r\n\r\n  // Read output file\r\n  const data = await ffmpeg.readFile(outputName);\r\n  const blob = new Blob([data], { type: \"video/mp4\" });\r\n\r\n  // Cleanup\r\n  await ffmpeg.deleteFile(inputName);\r\n  await ffmpeg.deleteFile(outputName);\r\n\r\n  return blob;\r\n};\r\n\r\nexport const getVideoInfo = async (\r\n  videoFile: File\r\n): Promise<{\r\n  duration: number;\r\n  width: number;\r\n  height: number;\r\n  fps: number;\r\n}> => {\r\n  const ffmpeg = await initFFmpeg();\r\n\r\n  const inputName = \"input.mp4\";\r\n\r\n  // Write input file\r\n  await ffmpeg.writeFile(\r\n    inputName,\r\n    new Uint8Array(await videoFile.arrayBuffer())\r\n  );\r\n\r\n  // Capture FFmpeg stderr output with a one-time listener pattern\r\n  let ffmpegOutput = \"\";\r\n  let listening = true;\r\n  const listener = (data: string) => {\r\n    if (listening) ffmpegOutput += data;\r\n  };\r\n  ffmpeg.on(\"log\", ({ message }) => listener(message));\r\n\r\n  // Run ffmpeg to get info (stderr will contain the info)\r\n  try {\r\n    await ffmpeg.exec([\"-i\", inputName, \"-f\", \"null\", \"-\"]);\r\n  } catch (error) {\r\n    listening = false;\r\n    await ffmpeg.deleteFile(inputName);\r\n    console.error(\"FFmpeg execution failed:\", error);\r\n    throw new Error(\r\n      \"Failed to extract video info. The file may be corrupted or in an unsupported format.\"\r\n    );\r\n  }\r\n\r\n  // Disable listener after exec completes\r\n  listening = false;\r\n\r\n  // Cleanup\r\n  await ffmpeg.deleteFile(inputName);\r\n\r\n  // Parse output for duration, resolution, and fps\r\n  // Example: Duration: 00:00:10.00, start: 0.000000, bitrate: 1234 kb/s\r\n  // Example: Stream #0:0: Video: h264 (High), yuv420p(progressive), 1920x1080 [SAR 1:1 DAR 16:9], 30 fps, 30 tbr, 90k tbn, 60 tbc\r\n\r\n  const durationMatch = ffmpegOutput.match(/Duration: (\\d+):(\\d+):([\\d.]+)/);\r\n  let duration = 0;\r\n  if (durationMatch) {\r\n    const [, h, m, s] = durationMatch;\r\n    duration = parseInt(h) * 3600 + parseInt(m) * 60 + parseFloat(s);\r\n  }\r\n\r\n  const videoStreamMatch = ffmpegOutput.match(\r\n    /Video:.* (\\d+)x(\\d+)[^,]*, ([\\d.]+) fps/\r\n  );\r\n  let width = 0,\r\n    height = 0,\r\n    fps = 0;\r\n  if (videoStreamMatch) {\r\n    width = parseInt(videoStreamMatch[1]);\r\n    height = parseInt(videoStreamMatch[2]);\r\n    fps = parseFloat(videoStreamMatch[3]);\r\n  }\r\n\r\n  return {\r\n    duration,\r\n    width,\r\n    height,\r\n    fps,\r\n  };\r\n};\r\n\r\nexport const convertToWebM = async (\r\n  videoFile: File,\r\n  onProgress?: (progress: number) => void\r\n): Promise<Blob> => {\r\n  const ffmpeg = await initFFmpeg();\r\n\r\n  const inputName = \"input.mp4\";\r\n  const outputName = \"output.webm\";\r\n\r\n  // Set up progress callback\r\n  if (onProgress) {\r\n    ffmpeg.on(\"progress\", ({ progress }) => {\r\n      onProgress(progress * 100);\r\n    });\r\n  }\r\n\r\n  // Write input file\r\n  await ffmpeg.writeFile(\r\n    inputName,\r\n    new Uint8Array(await videoFile.arrayBuffer())\r\n  );\r\n\r\n  // Convert to WebM\r\n  await ffmpeg.exec([\r\n    \"-i\",\r\n    inputName,\r\n    \"-c:v\",\r\n    \"libvpx-vp9\",\r\n    \"-crf\",\r\n    \"30\",\r\n    \"-b:v\",\r\n    \"0\",\r\n    \"-c:a\",\r\n    \"libopus\",\r\n    outputName,\r\n  ]);\r\n\r\n  // Read output file\r\n  const data = await ffmpeg.readFile(outputName);\r\n  const blob = new Blob([data], { type: \"video/webm\" });\r\n\r\n  // Cleanup\r\n  await ffmpeg.deleteFile(inputName);\r\n  await ffmpeg.deleteFile(outputName);\r\n\r\n  return blob;\r\n};\r\n\r\nexport const extractAudio = async (\r\n  videoFile: File,\r\n  format: \"mp3\" | \"wav\" = \"mp3\"\r\n): Promise<Blob> => {\r\n  const ffmpeg = await initFFmpeg();\r\n\r\n  const inputName = \"input.mp4\";\r\n  const outputName = `output.${format}`;\r\n\r\n  // Write input file\r\n  await ffmpeg.writeFile(\r\n    inputName,\r\n    new Uint8Array(await videoFile.arrayBuffer())\r\n  );\r\n\r\n  // Extract audio\r\n  await ffmpeg.exec([\r\n    \"-i\",\r\n    inputName,\r\n    \"-vn\", // Disable video\r\n    \"-acodec\",\r\n    format === \"mp3\" ? \"libmp3lame\" : \"pcm_s16le\",\r\n    outputName,\r\n  ]);\r\n\r\n  // Read output file\r\n  const data = await ffmpeg.readFile(outputName);\r\n  const blob = new Blob([data], { type: `audio/${format}` });\r\n\r\n  // Cleanup\r\n  await ffmpeg.deleteFile(inputName);\r\n  await ffmpeg.deleteFile(outputName);\r\n\r\n  return blob;\r\n};\r\n\r\nexport const extractTimelineAudio = async (\r\n  onProgress?: (progress: number) => void\r\n): Promise<Blob> => {\r\n  // Create fresh FFmpeg instance for this operation\r\n  const ffmpeg = new FFmpeg();\r\n\r\n  try {\r\n    await ffmpeg.load();\r\n  } catch (error) {\r\n    console.error(\"Failed to load fresh FFmpeg instance:\", error);\r\n    throw new Error(\"Unable to initialize audio processing. Please try again.\");\r\n  }\r\n\r\n  const timeline = useTimelineStore.getState();\r\n  const mediaStore = useMediaStore.getState();\r\n\r\n  const tracks = timeline.tracks;\r\n  const totalDuration = timeline.getTotalDuration();\r\n\r\n  if (totalDuration === 0) {\r\n    const emptyAudioData = new ArrayBuffer(44);\r\n    return new Blob([emptyAudioData], { type: \"audio/wav\" });\r\n  }\r\n\r\n  if (onProgress) {\r\n    ffmpeg.on(\"progress\", ({ progress }) => {\r\n      onProgress(progress * 100);\r\n    });\r\n  }\r\n\r\n  const audioElements: Array<{\r\n    file: File;\r\n    startTime: number;\r\n    duration: number;\r\n    trimStart: number;\r\n    trimEnd: number;\r\n    trackMuted: boolean;\r\n  }> = [];\r\n\r\n  for (const track of tracks) {\r\n    if (track.muted) continue;\r\n\r\n    for (const element of track.elements) {\r\n      if (element.type === \"media\") {\r\n        const mediaItem = mediaStore.mediaItems.find(\r\n          (m) => m.id === element.mediaId\r\n        );\r\n        if (!mediaItem) continue;\r\n\r\n        if (mediaItem.type === \"video\" || mediaItem.type === \"audio\") {\r\n          audioElements.push({\r\n            file: mediaItem.file,\r\n            startTime: element.startTime,\r\n            duration: element.duration,\r\n            trimStart: element.trimStart,\r\n            trimEnd: element.trimEnd,\r\n            trackMuted: track.muted || false,\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (audioElements.length === 0) {\r\n    // Return silent audio if no audio elements\r\n    const silentDuration = Math.max(1, totalDuration); // At least 1 second\r\n    try {\r\n      const silentAudio = await generateSilentAudio(silentDuration);\r\n      return silentAudio;\r\n    } catch (error) {\r\n      console.error(\"Failed to generate silent audio:\", error);\r\n      throw new Error(\"Unable to generate audio for empty timeline.\");\r\n    }\r\n  }\r\n\r\n  // Create a complex filter to mix all audio sources\r\n  const inputFiles: string[] = [];\r\n  const filterInputs: string[] = [];\r\n\r\n  try {\r\n    for (let i = 0; i < audioElements.length; i++) {\r\n      const element = audioElements[i];\r\n      const inputName = `input_${i}.${element.file.name.split(\".\").pop()}`;\r\n      inputFiles.push(inputName);\r\n\r\n      try {\r\n        await ffmpeg.writeFile(\r\n          inputName,\r\n          new Uint8Array(await element.file.arrayBuffer())\r\n        );\r\n      } catch (error) {\r\n        console.error(`Failed to write file ${element.file.name}:`, error);\r\n        throw new Error(\r\n          `Unable to process file: ${element.file.name}. The file may be corrupted or in an unsupported format.`\r\n        );\r\n      }\r\n\r\n      const actualStart = element.trimStart;\r\n      const actualDuration =\r\n        element.duration - element.trimStart - element.trimEnd;\r\n\r\n      const filterName = `audio_${i}`;\r\n      filterInputs.push(\r\n        `[${i}:a]atrim=start=${actualStart}:duration=${actualDuration},asetpts=PTS-STARTPTS,adelay=${element.startTime * 1000}|${element.startTime * 1000}[${filterName}]`\r\n      );\r\n    }\r\n\r\n    const mixFilter =\r\n      audioElements.length === 1\r\n        ? `[audio_0]aresample=44100,aformat=sample_fmts=s16:channel_layouts=stereo[out]`\r\n        : `${filterInputs.map((_, i) => `[audio_${i}]`).join(\"\")}amix=inputs=${audioElements.length}:duration=longest:dropout_transition=2,aresample=44100,aformat=sample_fmts=s16:channel_layouts=stereo[out]`;\r\n\r\n    const complexFilter = [...filterInputs, mixFilter].join(\";\");\r\n    const outputName = \"timeline_audio.wav\";\r\n\r\n    const ffmpegArgs = [\r\n      ...inputFiles.flatMap((name) => [\"-i\", name]),\r\n      \"-filter_complex\",\r\n      complexFilter,\r\n      \"-map\",\r\n      \"[out]\",\r\n      \"-t\",\r\n      totalDuration.toString(),\r\n      \"-c:a\",\r\n      \"pcm_s16le\",\r\n      \"-ar\",\r\n      \"44100\",\r\n      outputName,\r\n    ];\r\n\r\n    try {\r\n      await ffmpeg.exec(ffmpegArgs);\r\n    } catch (error) {\r\n      console.error(\"FFmpeg execution failed:\", error);\r\n      throw new Error(\r\n        \"Audio processing failed. Some audio files may be corrupted or incompatible.\"\r\n      );\r\n    }\r\n\r\n    const data = await ffmpeg.readFile(outputName);\r\n    const blob = new Blob([data], { type: \"audio/wav\" });\r\n\r\n    return blob;\r\n  } catch (error) {\r\n    for (const inputFile of inputFiles) {\r\n      try {\r\n        await ffmpeg.deleteFile(inputFile);\r\n      } catch (cleanupError) {\r\n        console.warn(`Failed to cleanup file ${inputFile}:`, cleanupError);\r\n      }\r\n    }\r\n    try {\r\n      await ffmpeg.deleteFile(\"timeline_audio.wav\");\r\n    } catch (cleanupError) {\r\n      console.warn(\"Failed to cleanup output file:\", cleanupError);\r\n    }\r\n\r\n    throw error;\r\n  } finally {\r\n    for (const inputFile of inputFiles) {\r\n      try {\r\n        await ffmpeg.deleteFile(inputFile);\r\n      } catch (cleanupError) {}\r\n    }\r\n    try {\r\n      await ffmpeg.deleteFile(\"timeline_audio.wav\");\r\n    } catch (cleanupError) {}\r\n  }\r\n};\r\n\r\nconst generateSilentAudio = async (durationSeconds: number): Promise<Blob> => {\r\n  const ffmpeg = await initFFmpeg();\r\n  const outputName = \"silent.wav\";\r\n\r\n  try {\r\n    await ffmpeg.exec([\r\n      \"-f\",\r\n      \"lavfi\",\r\n      \"-i\",\r\n      `anullsrc=channel_layout=stereo:sample_rate=44100`,\r\n      \"-t\",\r\n      durationSeconds.toString(),\r\n      \"-c:a\",\r\n      \"pcm_s16le\",\r\n      outputName,\r\n    ]);\r\n\r\n    const data = await ffmpeg.readFile(outputName);\r\n    const blob = new Blob([data], { type: \"audio/wav\" });\r\n\r\n    return blob;\r\n  } catch (error) {\r\n    console.error(\"Failed to generate silent audio:\", error);\r\n    throw error;\r\n  } finally {\r\n    try {\r\n      await ffmpeg.deleteFile(outputName);\r\n    } catch (cleanupError) {\r\n      // Silent cleanup\r\n    }\r\n  }\r\n};\r\n","import { create } from \"zustand\";\r\nimport { persist } from \"zustand/middleware\";\r\nimport { CanvasPreset } from \"@/types/editor\";\r\n\r\nexport type PlatformLayout = \"tiktok\";\r\n\r\nexport const PLATFORM_LAYOUTS: Record<PlatformLayout, string> = {\r\n  tiktok: \"TikTok\",\r\n};\r\n\r\ninterface LayoutGuideSettings {\r\n  platform: PlatformLayout | null;\r\n}\r\n\r\ninterface EditorState {\r\n  // Loading states\r\n  isInitializing: boolean;\r\n  isPanelsReady: boolean;\r\n\r\n  // Editor UI settings\r\n  canvasPresets: CanvasPreset[];\r\n  layoutGuide: LayoutGuideSettings;\r\n\r\n  // Actions\r\n  setInitializing: (loading: boolean) => void;\r\n  setPanelsReady: (ready: boolean) => void;\r\n  initializeApp: () => Promise<void>;\r\n  setLayoutGuide: (settings: Partial<LayoutGuideSettings>) => void;\r\n  toggleLayoutGuide: (platform: PlatformLayout) => void;\r\n}\r\n\r\nconst DEFAULT_CANVAS_PRESETS: CanvasPreset[] = [\r\n  { name: \"16:9\", width: 1920, height: 1080 },\r\n  { name: \"9:16\", width: 1080, height: 1920 },\r\n  { name: \"1:1\", width: 1080, height: 1080 },\r\n  { name: \"4:3\", width: 1440, height: 1080 },\r\n];\r\n\r\nexport const useEditorStore = create<EditorState>()(\r\n  persist(\r\n    (set) => ({\r\n      // Initial states\r\n      isInitializing: true,\r\n      isPanelsReady: false,\r\n      canvasPresets: DEFAULT_CANVAS_PRESETS,\r\n      layoutGuide: {\r\n        platform: null,\r\n      },\r\n\r\n      // Actions\r\n      setInitializing: (loading) => {\r\n        set({ isInitializing: loading });\r\n      },\r\n\r\n      setPanelsReady: (ready) => {\r\n        set({ isPanelsReady: ready });\r\n      },\r\n\r\n      initializeApp: async () => {\r\n        console.log(\"Initializing video editor...\");\r\n        set({ isInitializing: true, isPanelsReady: false });\r\n\r\n        set({ isPanelsReady: true, isInitializing: false });\r\n        console.log(\"Video editor ready\");\r\n      },\r\n\r\n      setLayoutGuide: (settings) => {\r\n        set((state) => ({\r\n          layoutGuide: {\r\n            ...state.layoutGuide,\r\n            ...settings,\r\n          },\r\n        }));\r\n      },\r\n\r\n      toggleLayoutGuide: (platform) => {\r\n        set((state) => ({\r\n          layoutGuide: {\r\n            platform: state.layoutGuide.platform === platform ? null : platform,\r\n          },\r\n        }));\r\n      },\r\n    }),\r\n    {\r\n      name: \"editor-settings\",\r\n      partialize: (state) => ({\r\n        layoutGuide: state.layoutGuide,\r\n      }),\r\n    }\r\n  )\r\n);\r\n","export function GoogleIcon({ className }: { className?: string }) {\r\n  return (\r\n    <svg className={className} viewBox=\"0 0 24 24\">\r\n      <path\r\n        fill=\"#4285F4\"\r\n        d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"\r\n      />\r\n      <path\r\n        fill=\"#34A853\"\r\n        d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"\r\n      />\r\n      <path\r\n        fill=\"#FBBC05\"\r\n        d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"\r\n      />\r\n      <path\r\n        fill=\"#EA4335\"\r\n        d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"\r\n      />\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport function GithubIcon({ className }: { className?: string }) {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      className={className}\r\n      viewBox=\"0 -3.5 256 256\"\r\n      preserveAspectRatio=\"xMinYMin meet\"\r\n    >\r\n      <g fill=\"currentColor\">\r\n        <path d=\"M127.505 0C57.095 0 0 57.085 0 127.505c0 56.336 36.534 104.13 87.196 120.99 6.372 1.18 8.712-2.766 8.712-6.134 0-3.04-.119-13.085-.173-23.739-35.473 7.713-42.958-15.044-42.958-15.044-5.8-14.738-14.157-18.656-14.157-18.656-11.568-7.914.872-7.752.872-7.752 12.804.9 19.546 13.14 19.546 13.14 11.372 19.493 29.828 13.857 37.104 10.6 1.144-8.242 4.449-13.866 8.095-17.05-28.32-3.225-58.092-14.158-58.092-63.014 0-13.92 4.981-25.295 13.138-34.224-1.324-3.212-5.688-16.18 1.235-33.743 0 0 10.707-3.427 35.073 13.07 10.17-2.826 21.078-4.242 31.914-4.29 10.836.048 21.752 1.464 31.942 4.29 24.337-16.497 35.029-13.07 35.029-13.07 6.94 17.563 2.574 30.531 1.25 33.743 8.175 8.929 13.122 20.303 13.122 34.224 0 48.972-29.828 59.756-58.22 62.912 4.573 3.957 8.648 11.717 8.648 23.612 0 17.06-.148 30.791-.148 34.991 0 3.393 2.295 7.369 8.759 6.117 50.634-16.879 87.122-64.656 87.122-120.973C255.009 57.085 197.922 0 127.505 0\" />\r\n\r\n        <path d=\"M47.755 181.634c-.28.633-1.278.823-2.185.389-.925-.416-1.445-1.28-1.145-1.916.275-.652 1.273-.834 2.196-.396.927.415 1.455 1.287 1.134 1.923M54.027 187.23c-.608.564-1.797.302-2.604-.589-.834-.889-.99-2.077-.373-2.65.627-.563 1.78-.3 2.616.59.834.899.996 2.08.36 2.65M58.33 194.39c-.782.543-2.06.034-2.849-1.1-.781-1.133-.781-2.493.017-3.038.792-.545 2.05-.055 2.85 1.07.78 1.153.78 2.513-.019 3.069M65.606 202.683c-.699.77-2.187.564-3.277-.488-1.114-1.028-1.425-2.487-.724-3.258.707-.772 2.204-.555 3.302.488 1.107 1.026 1.445 2.496.7 3.258M75.01 205.483c-.307.998-1.741 1.452-3.185 1.028-1.442-.437-2.386-1.607-2.095-2.616.3-1.005 1.74-1.478 3.195-1.024 1.44.435 2.386 1.596 2.086 2.612M85.714 206.67c.036 1.052-1.189 1.924-2.705 1.943-1.525.033-2.758-.818-2.774-1.852 0-1.062 1.197-1.926 2.721-1.951 1.516-.03 2.758.815 2.758 1.86M96.228 206.267c.182 1.026-.872 2.08-2.377 2.36-1.48.27-2.85-.363-3.039-1.38-.184-1.052.89-2.105 2.367-2.378 1.508-.262 2.857.355 3.049 1.398\" />\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport function VercelIcon({ className }: { className?: string }) {\r\n  return (\r\n    <svg\r\n      className={className}\r\n      width=\"20\"\r\n      height=\"18\"\r\n      viewBox=\"0 0 76 65\"\r\n      fill=\"none\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n    >\r\n      <path d=\"M37.5274 0L75.0548 65H0L37.5274 0Z\" fill=\"currentColor\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport function BackgroundIcon({ className }: { className?: string }) {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      width=\"353\"\r\n      height=\"353\"\r\n      viewBox=\"0 0 353 353\"\r\n      fill=\"none\"\r\n      className={className}\r\n    >\r\n      <g clipPath=\"url(#clip0_1_3)\">\r\n        <rect\r\n          x=\"-241.816\"\r\n          y=\"233.387\"\r\n          width=\"592.187\"\r\n          height=\"17.765\"\r\n          transform=\"rotate(-37 -241.816 233.387)\"\r\n          fill=\"white\"\r\n        />\r\n        <rect\r\n          x=\"-189.907\"\r\n          y=\"306.804\"\r\n          width=\"592.187\"\r\n          height=\"17.765\"\r\n          transform=\"rotate(-37 -189.907 306.804)\"\r\n          fill=\"white\"\r\n        />\r\n        <rect\r\n          x=\"-146.928\"\r\n          y=\"389.501\"\r\n          width=\"592.187\"\r\n          height=\"17.765\"\r\n          transform=\"rotate(-37 -146.928 389.501)\"\r\n          fill=\"white\"\r\n        />\r\n        <rect\r\n          x=\"-103.144\"\r\n          y=\"477.904\"\r\n          width=\"592.187\"\r\n          height=\"17.765\"\r\n          transform=\"rotate(-37 -103.144 477.904)\"\r\n          fill=\"white\"\r\n        />\r\n        <rect\r\n          x=\"-57.169\"\r\n          y=\"570.714\"\r\n          width=\"592.187\"\r\n          height=\"17.765\"\r\n          transform=\"rotate(-37 -57.169 570.714)\"\r\n          fill=\"white\"\r\n        />\r\n      </g>\r\n      <defs>\r\n        <clipPath id=\"clip0_1_3\">\r\n          <rect width=\"353\" height=\"353\" fill=\"white\" />\r\n        </clipPath>\r\n      </defs>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport function MarbleIcon({\r\n  className = \"\",\r\n  size = 32,\r\n}: {\r\n  className?: string;\r\n  size?: number;\r\n}) {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      width={size}\r\n      height={size}\r\n      className={className}\r\n      fill=\"none\"\r\n      viewBox=\"0 0 256 256\"\r\n    >\r\n      <path fill=\"#202027\" d=\"M0 0h256v256H0z\" />\r\n      <path\r\n        fill=\"#fff\"\r\n        d=\"M116.032 94.016q1.408.256 6.272 9.856 4.856 9.472 11.904 24.576l4.096 8.576a42.4 42.4 0 0 0 4.992-6.784q2.304-3.96 5.76-10.624 3.96-7.56 5.504-9.728 6.144-9.344 13.312-19.84.896-1.408 3.2-1.92a4.8 4.8 0 0 1 1.28-.128q3.072 0 6.784 2.56 3.84 2.56 4.992 5.248a4.8 4.8 0 0 1 .256 1.92q0 1.28-.128 1.92l-.64 2.944q-.256 1.664-.512 3.968a3200 3200 0 0 0-5.888 46.848 56 56 0 0 0-.512 8.064l-.256 4.096a32 32 0 0 0-.128 2.944q0 1.672-.384 2.304-.384.64-1.408.64-.768 0-2.304-.384-4.096-.896-6.272-3.2-2.176-2.432-2.432-6.656-.128-2.176-.128-6.784 0-4.736.256-14.464l.128-7.04.256-10.112q-1.152 1.024-5.888 8.064a328 328 0 0 0-9.088 14.464q-4.48 7.56-5.888 11.648-1.28 3.2-2.56 4.736-1.152 1.536-2.816 1.536-1.536 0-3.968-1.408-6.912-4.224-8.448-11.648a336 336 0 0 0-6.016-23.68 40 40 0 0 0-2.56-6.272q-1.792-3.968-2.304-4.992l-1.664-3.328q-18.68 24.832-25.344 45.568-1.28 4.352-2.432 6.272-1.152 1.792-2.688 1.792-2.432 0-6.912-4.352Q72 158.144 72 154.304q0-2.04.768-4.096a108 108 0 0 1 16-30.08l3.968-5.248a432 432 0 0 0 12.16-16.64q3.072-4.48 8.192-4.48.896 0 2.944.256\"\r\n      />\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport function DataBuddyIcon({\r\n  className = \"\",\r\n  size = 32,\r\n}: {\r\n  className?: string;\r\n  size?: number;\r\n}) {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      width={size}\r\n      height={size}\r\n      className={className}\r\n      viewBox=\"0 0 8 8\"\r\n      shapeRendering=\"crispEdges\"\r\n    >\r\n      <path d=\"M0 0h8v8H0z\" />\r\n      <path\r\n        fill=\"#fff\"\r\n        d=\"M1 1h1v6H1zm1 0h4v1H2zm4 1h1v1H6zm0 1h1v1H6zm0 1h1v1H6zm0 1h1v1H6zM2 6h4v1H2zm1-3h1v1H3zm1 1h1v1H4z\"\r\n      />\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport function SocialsIcon({\r\n  className = \"\",\r\n  size = 32,\r\n}: {\r\n  className?: string;\r\n  size?: number;\r\n}) {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      width={size}\r\n      height={size}\r\n      viewBox=\"0 0 345 243\"\r\n      fill=\"none\"\r\n      className={className}\r\n    >\r\n      <g opacity=\"0.5\">\r\n        <path d=\"M203.75 4H39.25C19.782 4 4 19.782 4 39.25V203.75C4 223.218 19.782 239 39.25 239H203.75C223.218 239 239 223.218 239 203.75V39.25C239 19.782 223.218 4 203.75 4Z\" fill=\"#FFFC00\"/>\r\n        <path d=\"M97.1738 194.02C88.9121 188.053 82.4863 184.84 66.8809 187.594C64.5859 188.053 60.4551 189.43 59.9961 185.299C59.0781 182.086 59.0781 177.037 56.7832 176.578C42.5547 174.742 37.5059 171.988 35.2109 169.234C34.293 168.316 33.834 166.021 35.6699 165.562C59.9961 160.973 71.4707 137.564 73.7656 132.975C76.5195 126.09 71.9297 121.959 63.209 119.205C59.0781 117.828 52.1934 115.992 52.1934 111.402C52.1934 109.107 54.4883 107.73 56.7832 106.812C58.6191 106.354 60.4551 105.895 62.291 106.812C67.7988 109.107 72.8477 110.025 75.6016 107.73C75.6016 95.3379 72.3887 79.7324 77.4375 66.8809C83.4043 52.6523 98.0918 39.8008 121.5 39.8008C144.908 39.8008 159.596 52.6523 165.562 66.8809C170.611 79.7324 167.398 95.3379 167.398 107.73C170.152 110.025 175.201 109.107 180.709 106.812C182.545 105.895 184.381 106.354 186.217 106.812C188.512 107.73 190.807 109.107 190.807 111.402C190.807 115.992 183.922 117.828 179.791 119.205C171.07 121.959 166.48 126.09 169.234 132.975C171.529 137.564 183.004 160.973 207.33 165.562C209.166 166.021 208.707 168.316 207.789 169.234C205.494 171.988 200.445 174.742 186.217 176.578C183.922 177.037 183.922 182.086 183.004 185.299C182.545 189.43 178.414 188.053 176.119 187.594C160.514 184.84 154.088 188.053 145.826 194.02C139.065 199.872 130.442 203.126 121.5 203.199C111.861 203.658 104.059 199.527 97.1738 194.02Z\" fill=\"white\"/>\r\n        <path d=\"M203.75 4H39.25C19.782 4 4 19.782 4 39.25V203.75C4 223.218 19.782 239 39.25 239H203.75C223.218 239 239 223.218 239 203.75V39.25C239 19.782 223.218 4 203.75 4Z\" stroke=\"black\" strokeWidth=\"7\"/>\r\n        <path d=\"M97.1738 194.02C88.9121 188.053 82.4863 184.84 66.8809 187.594C64.5859 188.053 60.4551 189.43 59.9961 185.299C59.0781 182.086 59.0781 177.037 56.7832 176.578C42.5547 174.742 37.5059 171.988 35.2109 169.234C34.293 168.316 33.834 166.021 35.6699 165.562C59.9961 160.973 71.4707 137.564 73.7656 132.975C76.5195 126.09 71.9297 121.959 63.209 119.205C59.0781 117.828 52.1934 115.992 52.1934 111.402C52.1934 109.107 54.4883 107.73 56.7832 106.812C58.6191 106.354 60.4551 105.895 62.291 106.812C67.7988 109.107 72.8477 110.025 75.6016 107.73C75.6016 95.3379 72.3887 79.7324 77.4375 66.8809C83.4043 52.6523 98.0918 39.8008 121.5 39.8008C144.908 39.8008 159.596 52.6523 165.562 66.8809C170.611 79.7324 167.398 95.3379 167.398 107.73C170.152 110.025 175.201 109.107 180.709 106.812C182.545 105.895 184.381 106.354 186.217 106.812C188.512 107.73 190.807 109.107 190.807 111.402C190.807 115.992 183.922 117.828 179.791 119.205C171.07 121.959 166.48 126.09 169.234 132.975C171.529 137.564 183.004 160.973 207.33 165.562C209.166 166.021 208.707 168.316 207.789 169.234C205.494 171.988 200.445 174.742 186.217 176.578C183.922 177.037 183.922 182.086 183.004 185.299C182.545 189.43 178.414 188.053 176.119 187.594C160.514 184.84 154.088 188.053 145.826 194.02C139.065 199.872 130.442 203.126 121.5 203.199C111.861 203.658 104.059 199.527 97.1738 194.02Z\" stroke=\"black\" strokeWidth=\"7\"/>\r\n      </g>\r\n      <path fillRule=\"evenodd\" clipRule=\"evenodd\" d=\"M133.5 4H321.5C334.48 4 345 14.5205 345 27.5V215.5C345 228.48 334.48 239 321.5 239H133.5C120.52 239 110 228.48 110 215.5V27.5C110 14.5205 120.52 4 133.5 4Z\" fill=\"#010101\"/>\r\n      <path fillRule=\"evenodd\" clipRule=\"evenodd\" d=\"M261.497 99.4086C271.784 106.758 284.388 111.083 297.999 111.083V84.9035C295.423 84.9045 292.854 84.6357 290.333 84.1016V104.709C276.723 104.709 264.121 100.384 253.831 93.0345V146.459C253.831 173.185 232.155 194.85 205.417 194.85C195.44 194.85 186.167 191.835 178.464 186.665C187.256 195.65 199.516 201.224 213.08 201.224C239.821 201.224 261.498 179.56 261.498 152.833L261.497 99.4086ZM270.953 72.9965C265.696 67.2559 262.244 59.8365 261.497 51.634V48.267H254.233C256.061 58.6916 262.298 67.5981 270.953 72.9965ZM195.376 166.157C192.438 162.308 190.851 157.598 190.858 152.756C190.858 140.533 200.773 130.622 213.005 130.622C215.285 130.621 217.551 130.97 219.723 131.659V104.894C217.185 104.547 214.622 104.399 212.061 104.454V125.286C209.887 124.597 207.62 124.247 205.34 124.249C193.107 124.249 183.193 134.159 183.193 146.384C183.193 155.027 188.149 162.512 195.376 166.157Z\" fill=\"#EE1D52\"/>\r\n      <path fillRule=\"evenodd\" clipRule=\"evenodd\" d=\"M253.831 93.0345C264.121 100.384 276.723 104.709 290.333 104.709V84.1016C282.736 82.4848 276.011 78.5162 270.953 72.9965C262.298 67.5981 256.061 58.6916 254.233 48.267H235.152V152.832C235.108 165.022 225.21 174.892 213.004 174.892C205.811 174.892 199.422 171.465 195.376 166.157C188.149 162.512 183.193 155.027 183.193 146.384C183.193 134.159 193.107 124.249 205.34 124.249C207.683 124.249 209.942 124.614 212.061 125.286V104.454C185.792 104.996 164.665 126.449 164.665 152.833C164.665 166.003 169.926 177.942 178.464 186.665C186.167 191.835 195.44 194.85 205.417 194.85C232.155 194.85 253.831 173.185 253.831 146.459V93.0345Z\" fill=\"white\"/>\r\n      <path fillRule=\"evenodd\" clipRule=\"evenodd\" d=\"M290.333 84.1016V78.5293C283.482 78.5396 276.766 76.6229 270.953 72.9965C276.099 78.6269 282.874 82.5087 290.333 84.1016ZM254.233 48.267C254.058 47.2708 253.924 46.2679 253.831 45.2608V41.8938H227.485V146.459C227.443 158.648 217.545 168.518 205.339 168.518C201.754 168.518 198.372 167.669 195.376 166.157C199.422 171.465 205.811 174.892 213.004 174.892C225.21 174.892 235.108 165.022 235.152 152.832V48.267H254.233ZM212.061 104.454L212.061 98.5212C209.859 98.2202 207.64 98.0698 205.418 98.071C178.676 98.071 157 119.736 157 146.459C157 163.214 165.518 177.979 178.464 186.665C169.926 177.942 164.666 166.002 164.666 152.832C164.666 126.449 185.791 104.996 212.061 104.454Z\" fill=\"#69C9D0\"/>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport function TransitionUpIcon({\r\n  className = \"\",\r\n  size = 16,\r\n}: {\r\n  className?: string;\r\n  size?: number;\r\n}) {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      width={size}\r\n      height={size}\r\n      viewBox=\"0 0 16 16\"\r\n      fill=\"none\"\r\n      className={className}\r\n    >\r\n      <path\r\n        fillRule=\"evenodd\"\r\n        clipRule=\"evenodd\"\r\n        d=\"M2.5 12.6667C2.5 13.4951 3.17157 14.1667 4 14.1667H12C12.8284 14.1667 13.5 13.4951 13.5 12.6667V11.3333C13.5 10.5049 12.8284 9.83333 12 9.83333H4C3.17157 9.83333 2.5 10.5049 2.5 11.3333V12.6667ZM4 15.1667C2.61929 15.1667 1.5 14.0474 1.5 12.6667V11.3333C1.5 9.95262 2.61929 8.83333 4 8.83333H12C13.3807 8.83333 14.5 9.95262 14.5 11.3333V12.6667C14.5 14.0474 13.3807 15.1667 12 15.1667H4Z\"\r\n        fill=\"white\"\r\n      />\r\n      <path\r\n        fillRule=\"evenodd\"\r\n        clipRule=\"evenodd\"\r\n        d=\"M2 5.83333C1.72386 5.83333 1.5 5.60947 1.5 5.33333L1.5 4C1.5 2.2511 2.91777 0.833332 4.66667 0.833332L11.3333 0.833332C13.0822 0.833332 14.5 2.2511 14.5 4V5.33333C14.5 5.60947 14.2761 5.83333 14 5.83333C13.7239 5.83333 13.5 5.60947 13.5 5.33333V4C13.5 2.80338 12.53 1.83333 11.3333 1.83333L4.66667 1.83333C3.47005 1.83333 2.5 2.80338 2.5 4V5.33333C2.5 5.60947 2.27614 5.83333 2 5.83333Z\"\r\n        fill=\"white\"\r\n      />\r\n      <path\r\n        fillRule=\"evenodd\"\r\n        clipRule=\"evenodd\"\r\n        d=\"M8.35355 3.64645C8.15829 3.45118 7.84171 3.45118 7.64645 3.64645L5.64645 5.64645C5.45118 5.84171 5.45118 6.15829 5.64645 6.35355C5.84171 6.54882 6.15829 6.54882 6.35355 6.35355L7.5 5.20711L7.5 9.33333C7.5 9.60948 7.72386 9.83333 8 9.83333C8.27614 9.83333 8.5 9.60948 8.5 9.33333V5.20711L9.64645 6.35355C9.84171 6.54882 10.1583 6.54882 10.3536 6.35355C10.5488 6.15829 10.5488 5.84171 10.3536 5.64645L8.35355 3.64645Z\"\r\n        fill=\"white\"\r\n      />\r\n    </svg>\r\n  );\r\n}","import { create } from \"zustand\";\r\nimport type { PlaybackState, PlaybackControls } from \"@/types/playback\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { useProjectStore } from \"./project-store\";\r\n\r\ninterface PlaybackStore extends PlaybackState, PlaybackControls {\r\n  setDuration: (duration: number) => void;\r\n  setCurrentTime: (time: number) => void;\r\n}\r\n\r\nlet playbackTimer: number | null = null;\r\n\r\nconst startTimer = (store: () => PlaybackStore) => {\r\n  if (playbackTimer) cancelAnimationFrame(playbackTimer);\r\n\r\n  // Use requestAnimationFrame for smoother updates\r\n  const updateTime = () => {\r\n    const state = store();\r\n    if (state.isPlaying && state.currentTime < state.duration) {\r\n      const now = performance.now();\r\n      const delta = (now - lastUpdate) / 1000; // Convert to seconds\r\n      lastUpdate = now;\r\n\r\n      const newTime = state.currentTime + delta * state.speed;\r\n\r\n      // Get actual content duration from timeline store\r\n      const actualContentDuration = useTimelineStore\r\n        .getState()\r\n        .getTotalDuration();\r\n\r\n      // Stop at actual content end, not timeline duration (which has 10s minimum)\r\n      // It was either this or reducing default min timeline to 1 second\r\n      const effectiveDuration =\r\n        actualContentDuration > 0 ? actualContentDuration : state.duration;\r\n\r\n      if (newTime >= effectiveDuration) {\r\n        // When content completes, pause just before the end so we can see the last frame\r\n        const projectFps = useProjectStore.getState().activeProject?.fps;\r\n        if (!projectFps)\r\n          console.error(\"Project FPS is not set, assuming 30fps\");\r\n\r\n        const frameOffset = 1 / (projectFps ?? 30); // Stop 1 frame before end based on project FPS\r\n        const stopTime = Math.max(0, effectiveDuration - frameOffset);\r\n\r\n        state.pause();\r\n        state.setCurrentTime(stopTime);\r\n        // Notify video elements to sync with end position\r\n        window.dispatchEvent(\r\n          new CustomEvent(\"playback-seek\", {\r\n            detail: { time: stopTime },\r\n          })\r\n        );\r\n      } else {\r\n        state.setCurrentTime(newTime);\r\n        // Notify video elements to sync\r\n        window.dispatchEvent(\r\n          new CustomEvent(\"playback-update\", { detail: { time: newTime } })\r\n        );\r\n      }\r\n    }\r\n    playbackTimer = requestAnimationFrame(updateTime);\r\n  };\r\n\r\n  let lastUpdate = performance.now();\r\n  playbackTimer = requestAnimationFrame(updateTime);\r\n};\r\n\r\nconst stopTimer = () => {\r\n  if (playbackTimer) {\r\n    cancelAnimationFrame(playbackTimer);\r\n    playbackTimer = null;\r\n  }\r\n};\r\n\r\nexport const usePlaybackStore = create<PlaybackStore>((set, get) => ({\r\n  isPlaying: false,\r\n  currentTime: 0,\r\n  duration: 0,\r\n  volume: 1,\r\n  muted: false,\r\n  previousVolume: 1,\r\n  speed: 1.0,\r\n\r\n  play: () => {\r\n    const state = get();\r\n\r\n    const actualContentDuration = useTimelineStore\r\n      .getState()\r\n      .getTotalDuration();\r\n    const effectiveDuration =\r\n      actualContentDuration > 0 ? actualContentDuration : state.duration;\r\n\r\n    if (effectiveDuration > 0) {\r\n      const fps = useProjectStore.getState().activeProject?.fps ?? 30;\r\n      const frameOffset = 1 / fps;\r\n      const endThreshold = Math.max(0, effectiveDuration - frameOffset);\r\n\r\n      if (state.currentTime >= endThreshold) {\r\n        get().seek(0);\r\n      }\r\n    }\r\n\r\n    set({ isPlaying: true });\r\n    startTimer(get);\r\n  },\r\n\r\n  pause: () => {\r\n    set({ isPlaying: false });\r\n    stopTimer();\r\n  },\r\n\r\n  toggle: () => {\r\n    const { isPlaying } = get();\r\n    if (isPlaying) {\r\n      get().pause();\r\n    } else {\r\n      get().play();\r\n    }\r\n  },\r\n\r\n  seek: (time: number) => {\r\n    const { duration } = get();\r\n    const clampedTime = Math.max(0, Math.min(duration, time));\r\n    set({ currentTime: clampedTime });\r\n\r\n    const event = new CustomEvent(\"playback-seek\", {\r\n      detail: { time: clampedTime },\r\n    });\r\n    window.dispatchEvent(event);\r\n  },\r\n\r\n  setVolume: (volume: number) =>\r\n    set((state) => ({\r\n      volume: Math.max(0, Math.min(1, volume)),\r\n      muted: volume === 0,\r\n      previousVolume: volume > 0 ? volume : state.previousVolume,\r\n    })),\r\n\r\n  setSpeed: (speed: number) => {\r\n    const newSpeed = Math.max(0.1, Math.min(2.0, speed));\r\n    set({ speed: newSpeed });\r\n\r\n    const event = new CustomEvent(\"playback-speed\", {\r\n      detail: { speed: newSpeed },\r\n    });\r\n    window.dispatchEvent(event);\r\n  },\r\n\r\n  setDuration: (duration: number) => set({ duration }),\r\n  setCurrentTime: (time: number) => set({ currentTime: time }),\r\n\r\n  mute: () => {\r\n    const { volume, previousVolume } = get();\r\n    set({\r\n      muted: true,\r\n      previousVolume: volume > 0 ? volume : previousVolume,\r\n      volume: 0,\r\n    });\r\n  },\r\n\r\n  unmute: () => {\r\n    const { previousVolume } = get();\r\n    set({ muted: false, volume: previousVolume ?? 1 });\r\n  },\r\n\r\n  toggleMute: () => {\r\n    const { muted } = get();\r\n    if (muted) {\r\n      get().unmute();\r\n    } else {\r\n      get().mute();\r\n    }\r\n  },\r\n}));\r\n","\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { ContextMenu as ContextMenuPrimitive } from \"radix-ui\";\r\nimport { Check, ChevronRight, Circle } from \"lucide-react\";\r\nimport { cva, type VariantProps } from \"class-variance-authority\";\r\n\r\nimport { cn } from \"../../lib/utils\";\r\n\r\nconst ContextMenu = ContextMenuPrimitive.Root;\r\n\r\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger;\r\n\r\nconst ContextMenuGroup = ContextMenuPrimitive.Group;\r\n\r\nconst ContextMenuPortal = ContextMenuPrimitive.Portal;\r\n\r\nconst ContextMenuSub = ContextMenuPrimitive.Sub;\r\n\r\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup;\r\n\r\nconst contextMenuItemVariants = cva(\r\n  \"relative flex cursor-pointer select-none items-center gap-2 px-2 py-1.5 text-sm outline-hidden transition-opacity data-disabled:pointer-events-none data-disabled:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"focus:opacity-65 focus:text-accent-foreground\",\r\n        destructive: \"text-destructive focus:text-destructive/80\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n    },\r\n  }\r\n);\r\n\r\nconst ContextMenuSubTrigger = React.forwardRef<\r\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\r\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\r\n    inset?: boolean;\r\n    variant?: VariantProps<typeof contextMenuItemVariants>[\"variant\"];\r\n  }\r\n>(({ className, inset, children, variant = \"default\", ...props }, ref) => (\r\n  <ContextMenuPrimitive.SubTrigger\r\n    ref={ref}\r\n    className={cn(\r\n      contextMenuItemVariants({ variant }),\r\n      \"data-[state=open]:bg-accent data-[state=open]:opacity-65\",\r\n      inset && \"pl-8\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    {children}\r\n    <ChevronRight className=\"ml-auto\" />\r\n  </ContextMenuPrimitive.SubTrigger>\r\n));\r\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName;\r\n\r\nconst ContextMenuSubContent = React.forwardRef<\r\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\r\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\r\n>(({ className, ...props }, ref) => (\r\n  <ContextMenuPrimitive.SubContent\r\n    ref={ref}\r\n    className={cn(\r\n      \"z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName;\r\n\r\nconst ContextMenuContent = React.forwardRef<\r\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\r\n>(({ className, ...props }, ref) => (\r\n  <ContextMenuPrimitive.Portal>\r\n    <ContextMenuPrimitive.Content\r\n      ref={ref}\r\n      className={cn(\r\n        \"z-50 min-w-32 overflow-hidden rounded-md border p-1 bg-popover text-popover-foreground shadow-md\",\r\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  </ContextMenuPrimitive.Portal>\r\n));\r\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName;\r\n\r\nconst ContextMenuItem = React.forwardRef<\r\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\r\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\r\n    inset?: boolean;\r\n    variant?: VariantProps<typeof contextMenuItemVariants>[\"variant\"];\r\n  }\r\n>(({ className, inset, variant = \"default\", ...props }, ref) => (\r\n  <ContextMenuPrimitive.Item\r\n    ref={ref}\r\n    className={cn(\r\n      contextMenuItemVariants({ variant }),\r\n      inset && \"pl-8\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName;\r\n\r\nconst ContextMenuCheckboxItem = React.forwardRef<\r\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\r\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem> & {\r\n    variant?: VariantProps<typeof contextMenuItemVariants>[\"variant\"];\r\n  }\r\n>(({ className, children, checked, variant = \"default\", ...props }, ref) => (\r\n  <ContextMenuPrimitive.CheckboxItem\r\n    ref={ref}\r\n    className={cn(contextMenuItemVariants({ variant }), \"pl-8 pr-2\", className)}\r\n    checked={checked}\r\n    {...props}\r\n  >\r\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\r\n      <ContextMenuPrimitive.ItemIndicator>\r\n        <Check className=\"h-4 w-4\" />\r\n      </ContextMenuPrimitive.ItemIndicator>\r\n    </span>\r\n    {children}\r\n  </ContextMenuPrimitive.CheckboxItem>\r\n));\r\nContextMenuCheckboxItem.displayName =\r\n  ContextMenuPrimitive.CheckboxItem.displayName;\r\n\r\nconst ContextMenuRadioItem = React.forwardRef<\r\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\r\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem> & {\r\n    variant?: VariantProps<typeof contextMenuItemVariants>[\"variant\"];\r\n  }\r\n>(({ className, children, variant = \"default\", ...props }, ref) => (\r\n  <ContextMenuPrimitive.RadioItem\r\n    ref={ref}\r\n    className={cn(contextMenuItemVariants({ variant }), \"pl-8 pr-2\", className)}\r\n    {...props}\r\n  >\r\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\r\n      <ContextMenuPrimitive.ItemIndicator>\r\n        <Circle className=\"h-2 w-2 fill-current\" />\r\n      </ContextMenuPrimitive.ItemIndicator>\r\n    </span>\r\n    {children}\r\n  </ContextMenuPrimitive.RadioItem>\r\n));\r\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName;\r\n\r\nconst ContextMenuLabel = React.forwardRef<\r\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\r\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\r\n    inset?: boolean;\r\n  }\r\n>(({ className, inset, ...props }, ref) => (\r\n  <ContextMenuPrimitive.Label\r\n    ref={ref}\r\n    className={cn(\r\n      \"px-2 py-1.5 text-sm font-semibold\",\r\n      inset && \"pl-8\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName;\r\n\r\nconst ContextMenuSeparator = React.forwardRef<\r\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\r\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\r\n>(({ className, ...props }, ref) => (\r\n  <ContextMenuPrimitive.Separator\r\n    ref={ref}\r\n    className={cn(\"-mx-1 my-1 h-px bg-foreground/10\", className)}\r\n    {...props}\r\n  />\r\n));\r\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName;\r\n\r\nconst ContextMenuShortcut = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLSpanElement>) => {\r\n  return (\r\n    <span\r\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n};\r\nContextMenuShortcut.displayName = \"ContextMenuShortcut\";\r\n\r\nexport {\r\n  ContextMenu,\r\n  ContextMenuTrigger,\r\n  ContextMenuContent,\r\n  ContextMenuItem,\r\n  ContextMenuCheckboxItem,\r\n  ContextMenuRadioItem,\r\n  ContextMenuLabel,\r\n  ContextMenuSeparator,\r\n  ContextMenuShortcut,\r\n  ContextMenuGroup,\r\n  ContextMenuPortal,\r\n  ContextMenuSub,\r\n  ContextMenuSubContent,\r\n  ContextMenuSubTrigger,\r\n  ContextMenuRadioGroup,\r\n};\r\n","\"use client\";\r\n\r\nimport { useRef, useEffect } from \"react\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\n\r\ninterface VideoPlayerProps {\r\n  src: string;\r\n  poster?: string;\r\n  className?: string;\r\n  clipStartTime: number;\r\n  trimStart: number;\r\n  trimEnd: number;\r\n  clipDuration: number;\r\n  trackMuted?: boolean;\r\n}\r\n\r\nexport function VideoPlayer({\r\n  src,\r\n  poster,\r\n  className = \"\",\r\n  clipStartTime,\r\n  trimStart,\r\n  trimEnd,\r\n  clipDuration,\r\n  trackMuted = false,\r\n}: VideoPlayerProps) {\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const { isPlaying, currentTime, volume, speed, muted } = usePlaybackStore();\r\n\r\n  // Calculate if we're within this clip's timeline range\r\n  const clipEndTime = clipStartTime + (clipDuration - trimStart - trimEnd);\r\n  const isInClipRange =\r\n    currentTime >= clipStartTime && currentTime < clipEndTime;\r\n\r\n  // Sync playback events\r\n  useEffect(() => {\r\n    const video = videoRef.current;\r\n    if (!video || !isInClipRange) return;\r\n\r\n    const handleSeekEvent = (e: CustomEvent) => {\r\n      // Always update video time, even if outside clip range\r\n      const timelineTime = e.detail.time;\r\n      const videoTime = Math.max(\r\n        trimStart,\r\n        Math.min(\r\n          clipDuration - trimEnd,\r\n          timelineTime - clipStartTime + trimStart\r\n        )\r\n      );\r\n      video.currentTime = videoTime;\r\n    };\r\n\r\n    const handleUpdateEvent = (e: CustomEvent) => {\r\n      // Always update video time, even if outside clip range\r\n      const timelineTime = e.detail.time;\r\n      const targetTime = Math.max(\r\n        trimStart,\r\n        Math.min(\r\n          clipDuration - trimEnd,\r\n          timelineTime - clipStartTime + trimStart\r\n        )\r\n      );\r\n\r\n      if (Math.abs(video.currentTime - targetTime) > 0.5) {\r\n        video.currentTime = targetTime;\r\n      }\r\n    };\r\n\r\n    const handleSpeed = (e: CustomEvent) => {\r\n      video.playbackRate = e.detail.speed;\r\n    };\r\n\r\n    window.addEventListener(\"playback-seek\", handleSeekEvent as EventListener);\r\n    window.addEventListener(\r\n      \"playback-update\",\r\n      handleUpdateEvent as EventListener\r\n    );\r\n    window.addEventListener(\"playback-speed\", handleSpeed as EventListener);\r\n\r\n    return () => {\r\n      window.removeEventListener(\r\n        \"playback-seek\",\r\n        handleSeekEvent as EventListener\r\n      );\r\n      window.removeEventListener(\r\n        \"playback-update\",\r\n        handleUpdateEvent as EventListener\r\n      );\r\n      window.removeEventListener(\r\n        \"playback-speed\",\r\n        handleSpeed as EventListener\r\n      );\r\n    };\r\n  }, [clipStartTime, trimStart, trimEnd, clipDuration, isInClipRange]);\r\n\r\n  // Sync playback state\r\n  useEffect(() => {\r\n    const video = videoRef.current;\r\n    if (!video) return;\r\n\r\n    if (isPlaying && isInClipRange) {\r\n      video.play().catch(() => {});\r\n    } else {\r\n      video.pause();\r\n    }\r\n  }, [isPlaying, isInClipRange]);\r\n\r\n  // Sync volume and speed\r\n  useEffect(() => {\r\n    const video = videoRef.current;\r\n    if (!video) return;\r\n\r\n    video.volume = volume;\r\n    video.muted = muted || trackMuted;\r\n    video.playbackRate = speed;\r\n  }, [volume, speed, muted, trackMuted]);\r\n\r\n  return (\r\n    <video\r\n      ref={videoRef}\r\n      src={src}\r\n      poster={poster}\r\n      className={`max-w-full max-h-full object-contain ${className}`}\r\n      playsInline\r\n      preload=\"auto\"\r\n      controls={false}\r\n      disablePictureInPicture\r\n      disableRemotePlayback\r\n      style={{ pointerEvents: \"none\" }}\r\n      onContextMenu={(e) => e.preventDefault()}\r\n    />\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { useRef, useEffect } from \"react\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\n\r\ninterface AudioPlayerProps {\r\n  src: string;\r\n  className?: string;\r\n  clipStartTime: number;\r\n  trimStart: number;\r\n  trimEnd: number;\r\n  clipDuration: number;\r\n  trackMuted?: boolean;\r\n}\r\n\r\nexport function AudioPlayer({\r\n  src,\r\n  className = \"\",\r\n  clipStartTime,\r\n  trimStart,\r\n  trimEnd,\r\n  clipDuration,\r\n  trackMuted = false,\r\n}: AudioPlayerProps) {\r\n  const audioRef = useRef<HTMLAudioElement>(null);\r\n  const { isPlaying, currentTime, volume, speed, muted } = usePlaybackStore();\r\n\r\n  // Calculate if we're within this clip's timeline range\r\n  const clipEndTime = clipStartTime + (clipDuration - trimStart - trimEnd);\r\n  const isInClipRange =\r\n    currentTime >= clipStartTime && currentTime < clipEndTime;\r\n\r\n  // Sync playback events\r\n  useEffect(() => {\r\n    const audio = audioRef.current;\r\n    if (!audio || !isInClipRange) return;\r\n\r\n    const handleSeekEvent = (e: CustomEvent) => {\r\n      // Always update audio time, even if outside clip range\r\n      const timelineTime = e.detail.time;\r\n      const audioTime = Math.max(\r\n        trimStart,\r\n        Math.min(\r\n          clipDuration - trimEnd,\r\n          timelineTime - clipStartTime + trimStart\r\n        )\r\n      );\r\n      audio.currentTime = audioTime;\r\n    };\r\n\r\n    const handleUpdateEvent = (e: CustomEvent) => {\r\n      // Always update audio time, even if outside clip range\r\n      const timelineTime = e.detail.time;\r\n      const targetTime = Math.max(\r\n        trimStart,\r\n        Math.min(\r\n          clipDuration - trimEnd,\r\n          timelineTime - clipStartTime + trimStart\r\n        )\r\n      );\r\n\r\n      if (Math.abs(audio.currentTime - targetTime) > 0.5) {\r\n        audio.currentTime = targetTime;\r\n      }\r\n    };\r\n\r\n    const handleSpeed = (e: CustomEvent) => {\r\n      audio.playbackRate = e.detail.speed;\r\n    };\r\n\r\n    window.addEventListener(\"playback-seek\", handleSeekEvent as EventListener);\r\n    window.addEventListener(\r\n      \"playback-update\",\r\n      handleUpdateEvent as EventListener\r\n    );\r\n    window.addEventListener(\"playback-speed\", handleSpeed as EventListener);\r\n\r\n    return () => {\r\n      window.removeEventListener(\r\n        \"playback-seek\",\r\n        handleSeekEvent as EventListener\r\n      );\r\n      window.removeEventListener(\r\n        \"playback-update\",\r\n        handleUpdateEvent as EventListener\r\n      );\r\n      window.removeEventListener(\r\n        \"playback-speed\",\r\n        handleSpeed as EventListener\r\n      );\r\n    };\r\n  }, [clipStartTime, trimStart, trimEnd, clipDuration, isInClipRange]);\r\n\r\n  // Sync playback state\r\n  useEffect(() => {\r\n    const audio = audioRef.current;\r\n    if (!audio) return;\r\n\r\n    if (isPlaying && isInClipRange && !trackMuted) {\r\n      audio.play().catch(() => {});\r\n    } else {\r\n      audio.pause();\r\n    }\r\n  }, [isPlaying, isInClipRange, trackMuted]);\r\n\r\n  // Sync volume and speed\r\n  useEffect(() => {\r\n    const audio = audioRef.current;\r\n    if (!audio) return;\r\n\r\n    audio.volume = volume;\r\n    audio.muted = muted || trackMuted;\r\n    audio.playbackRate = speed;\r\n  }, [volume, speed, muted, trackMuted]);\r\n\r\n  return (\r\n    <audio\r\n      ref={audioRef}\r\n      src={src}\r\n      className={className}\r\n      preload=\"auto\"\r\n      controls={false}\r\n      style={{ display: \"none\" }} // Audio elements don't need visual representation\r\n      onContextMenu={(e) => e.preventDefault()}\r\n    />\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { useState, useRef, useEffect } from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { formatTimeCode, parseTimeCode } from \"@/lib/time\";\r\n\r\ninterface EditableTimecodeProps {\r\n  time: number;\r\n  duration?: number;\r\n  format?: \"MM:SS\" | \"HH:MM:SS\" | \"HH:MM:SS:CS\" | \"HH:MM:SS:FF\";\r\n  fps?: number;\r\n  onTimeChange?: (time: number) => void;\r\n  className?: string;\r\n  disabled?: boolean;\r\n}\r\n\r\nexport function EditableTimecode({\r\n  time,\r\n  duration,\r\n  format = \"HH:MM:SS:FF\",\r\n  fps = 30,\r\n  onTimeChange,\r\n  className,\r\n  disabled = false,\r\n}: EditableTimecodeProps) {\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [inputValue, setInputValue] = useState(\"\");\r\n  const [hasError, setHasError] = useState(false);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n  const enterPressedRef = useRef(false);\r\n\r\n  const formattedTime = formatTimeCode(time, format, fps);\r\n\r\n  const startEditing = () => {\r\n    if (disabled) return;\r\n    setIsEditing(true);\r\n    setInputValue(formattedTime);\r\n    setHasError(false);\r\n    enterPressedRef.current = false;\r\n  };\r\n\r\n  const cancelEditing = () => {\r\n    setIsEditing(false);\r\n    setInputValue(\"\");\r\n    setHasError(false);\r\n    enterPressedRef.current = false;\r\n  };\r\n\r\n  const applyEdit = () => {\r\n    const parsedTime = parseTimeCode(inputValue, format, fps);\r\n\r\n    if (parsedTime === null) {\r\n      setHasError(true);\r\n      return;\r\n    }\r\n\r\n    // Clamp time to valid range\r\n    const clampedTime = Math.max(\r\n      0,\r\n      duration ? Math.min(duration, parsedTime) : parsedTime\r\n    );\r\n\r\n    onTimeChange?.(clampedTime);\r\n    setIsEditing(false);\r\n    setInputValue(\"\");\r\n    setHasError(false);\r\n    enterPressedRef.current = false;\r\n  };\r\n\r\n  const handleKeyDown = (e: React.KeyboardEvent) => {\r\n    if (e.key === \"Enter\") {\r\n      e.preventDefault();\r\n      enterPressedRef.current = true;\r\n      applyEdit();\r\n    } else if (e.key === \"Escape\") {\r\n      e.preventDefault();\r\n      cancelEditing();\r\n    }\r\n  };\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    setInputValue(e.target.value);\r\n    setHasError(false);\r\n  };\r\n\r\n  const handleBlur = () => {\r\n    // Only apply edit if Enter wasn't pressed (to avoid double processing)\r\n    if (!enterPressedRef.current && isEditing) {\r\n      applyEdit();\r\n    }\r\n  };\r\n\r\n  // Focus input when entering edit mode\r\n  useEffect(() => {\r\n    if (isEditing && inputRef.current) {\r\n      inputRef.current.focus();\r\n      inputRef.current.select();\r\n    }\r\n  }, [isEditing]);\r\n\r\n  if (isEditing) {\r\n    return (\r\n      <input\r\n        ref={inputRef}\r\n        type=\"text\"\r\n        value={inputValue}\r\n        onChange={handleInputChange}\r\n        onKeyDown={handleKeyDown}\r\n        onBlur={handleBlur}\r\n        className={cn(\r\n          \"text-xs font-mono bg-transparent border-none outline-none\",\r\n          \"focus:bg-background focus:border focus:border-primary focus:px-1 focus:rounded\",\r\n          \"tabular-nums text-primary\",\r\n          hasError && \"text-destructive focus:border-destructive\",\r\n          className\r\n        )}\r\n        style={{ width: `${formattedTime.length + 1}ch` }}\r\n        placeholder={formattedTime}\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <span\r\n      onClick={startEditing}\r\n      className={cn(\r\n        \"text-xs font-mono tabular-nums text-primary cursor-pointer\",\r\n        \"hover:bg-muted/50 hover:rounded px-1 -mx-1 transition-colors\",\r\n        disabled && \"cursor-default hover:bg-transparent\",\r\n        className\r\n      )}\r\n      title={disabled ? undefined : \"Click to edit time\"}\r\n    >\r\n      {formattedTime}\r\n    </span>\r\n  );\r\n}\r\n","import {\r\n  Inter,\r\n  Roboto,\r\n  Open_Sans,\r\n  Playfair_Display,\r\n  Comic_Neue,\r\n} from \"next/font/google\";\r\n\r\n// Configure all fonts\r\nconst inter = Inter({ subsets: [\"latin\"] });\r\nconst roboto = Roboto({ subsets: [\"latin\"], weight: [\"400\", \"700\"] });\r\nconst openSans = Open_Sans({ subsets: [\"latin\"] });\r\nconst playfairDisplay = Playfair_Display({ subsets: [\"latin\"] });\r\nconst comicNeue = Comic_Neue({ subsets: [\"latin\"], weight: [\"400\", \"700\"] });\r\n\r\n// Export font class mapping for use in components\r\nexport const FONT_CLASS_MAP = {\r\n  Inter: inter.className,\r\n  Roboto: roboto.className,\r\n  \"Open Sans\": openSans.className,\r\n  \"Playfair Display\": playfairDisplay.className,\r\n  \"Comic Neue\": comicNeue.className,\r\n  Arial: \"\",\r\n  Helvetica: \"\",\r\n  \"Times New Roman\": \"\",\r\n  Georgia: \"\",\r\n} as const;\r\n\r\n// Export individual fonts for use in layout\r\nexport const fonts = {\r\n  inter,\r\n  roboto,\r\n  openSans,\r\n  playfairDisplay,\r\n  comicNeue,\r\n};\r\n\r\n// Default font for the body\r\nexport const defaultFont = inter;\r\n","\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { Popover as PopoverPrimitive } from \"radix-ui\";\r\n\r\nimport { cn } from \"../../lib/utils\";\r\n\r\nconst Popover = PopoverPrimitive.Root;\r\n\r\nconst PopoverTrigger = PopoverPrimitive.Trigger;\r\n\r\nconst PopoverAnchor = PopoverPrimitive.Anchor;\r\n\r\nconst PopoverContent = React.forwardRef<\r\n  React.ElementRef<typeof PopoverPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\r\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\r\n  <PopoverPrimitive.Portal>\r\n    <PopoverPrimitive.Content\r\n      ref={ref}\r\n      align={align}\r\n      sideOffset={sideOffset}\r\n      className={cn(\r\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-hidden data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  </PopoverPrimitive.Portal>\r\n));\r\nPopoverContent.displayName = PopoverPrimitive.Content.displayName;\r\n\r\nexport { Popover, PopoverTrigger, PopoverContent, PopoverAnchor };\r\n","\"use client\";\r\n\r\nimport { useEditorStore } from \"@/stores/editor-store\";\r\nimport Image from \"next/image\";\r\n\r\nfunction TikTokGuide() {\r\n  return (\r\n    <div className=\"absolute inset-0 pointer-events-none\">\r\n      <Image\r\n        src=\"/opencut/platform-guides/tiktok-blueprint.png\"\r\n        alt=\"TikTok layout guide\"\r\n        className=\"absolute inset-0 w-full h-full object-contain\"\r\n        draggable={false}\r\n        fill\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function LayoutGuideOverlay() {\r\n  const { layoutGuide } = useEditorStore();\r\n\r\n  if (layoutGuide.platform === null) return null;\r\n  if (layoutGuide.platform === \"tiktok\") return <TikTokGuide />;\r\n\r\n  return null;\r\n}\r\n","\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { Label as LabelPrimitive } from \"radix-ui\";\r\nimport { cva, type VariantProps } from \"class-variance-authority\";\r\n\r\nimport { cn } from \"../../lib/utils\";\r\n\r\nconst labelVariants = cva(\r\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\r\n);\r\n\r\nconst Label = React.forwardRef<\r\n  React.ElementRef<typeof LabelPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\r\n    VariantProps<typeof labelVariants>\r\n>(({ className, ...props }, ref) => (\r\n  <LabelPrimitive.Root\r\n    ref={ref}\r\n    className={cn(labelVariants(), className)}\r\n    {...props}\r\n  />\r\n));\r\nLabel.displayName = LabelPrimitive.Root.displayName;\r\n\r\nexport { Label };\r\n","\"use client\";\r\n\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { TimelineElement, TimelineTrack } from \"@/types/timeline\";\r\nimport { useMediaStore, type MediaItem } from \"@/stores/media-store\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\nimport { useEditorStore } from \"@/stores/editor-store\";\r\nimport { VideoPlayer } from \"@/components/ui/video-player\";\r\nimport { AudioPlayer } from \"@/components/ui/audio-player\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Play, Pause, Expand, SkipBack, SkipForward } from \"lucide-react\";\r\nimport { useState, useRef, useEffect, useCallback } from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { formatTimeCode } from \"@/lib/time\";\r\nimport { EditableTimecode } from \"@/components/ui/editable-timecode\";\r\nimport { FONT_CLASS_MAP } from \"@/lib/font-config\";\r\nimport { DEFAULT_CANVAS_SIZE, useProjectStore } from \"@/stores/project-store\";\r\nimport { TextElementDragState } from \"@/types/editor\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { LayoutGuideOverlay } from \"./layout-guide-overlay\";\r\nimport { Label } from \"../ui/label\";\r\nimport { SocialsIcon } from \"../icons\";\r\nimport { PLATFORM_LAYOUTS, type PlatformLayout } from \"@/stores/editor-store\";\r\n\r\ninterface ActiveElement {\r\n  element: TimelineElement;\r\n  track: TimelineTrack;\r\n  mediaItem: MediaItem | null;\r\n}\r\n\r\nexport function PreviewPanel() {\r\n  const { tracks, getTotalDuration, updateTextElement } = useTimelineStore();\r\n  const { mediaItems } = useMediaStore();\r\n  const { currentTime, toggle, setCurrentTime } = usePlaybackStore();\r\n  const { activeProject } = useProjectStore();\r\n  const previewRef = useRef<HTMLDivElement>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const [previewDimensions, setPreviewDimensions] = useState({\r\n    width: 0,\r\n    height: 0,\r\n  });\r\n  const [isExpanded, setIsExpanded] = useState(false);\r\n\r\n  const canvasSize = activeProject?.canvasSize || DEFAULT_CANVAS_SIZE;\r\n  const [dragState, setDragState] = useState<TextElementDragState>({\r\n    isDragging: false,\r\n    elementId: null,\r\n    trackId: null,\r\n    startX: 0,\r\n    startY: 0,\r\n    initialElementX: 0,\r\n    initialElementY: 0,\r\n    currentX: 0,\r\n    currentY: 0,\r\n    elementWidth: 0,\r\n    elementHeight: 0,\r\n  });\r\n\r\n  useEffect(() => {\r\n    const updatePreviewSize = () => {\r\n      if (!containerRef.current) return;\r\n\r\n      let availableWidth, availableHeight;\r\n\r\n      if (isExpanded) {\r\n        const controlsHeight = 80;\r\n        const marginSpace = 24;\r\n        availableWidth = window.innerWidth - marginSpace;\r\n        availableHeight = window.innerHeight - controlsHeight - marginSpace;\r\n      } else {\r\n        const container = containerRef.current.getBoundingClientRect();\r\n        const computedStyle = getComputedStyle(containerRef.current);\r\n        const paddingTop = parseFloat(computedStyle.paddingTop);\r\n        const paddingBottom = parseFloat(computedStyle.paddingBottom);\r\n        const paddingLeft = parseFloat(computedStyle.paddingLeft);\r\n        const paddingRight = parseFloat(computedStyle.paddingRight);\r\n        const gap = parseFloat(computedStyle.gap) || 16;\r\n        const toolbar = containerRef.current.querySelector(\"[data-toolbar]\");\r\n        const toolbarHeight = toolbar\r\n          ? toolbar.getBoundingClientRect().height\r\n          : 0;\r\n\r\n        availableWidth = container.width - paddingLeft - paddingRight;\r\n        availableHeight =\r\n          container.height -\r\n          paddingTop -\r\n          paddingBottom -\r\n          toolbarHeight -\r\n          (toolbarHeight > 0 ? gap : 0);\r\n      }\r\n\r\n      const targetRatio = canvasSize.width / canvasSize.height;\r\n      const containerRatio = availableWidth / availableHeight;\r\n      let width, height;\r\n\r\n      if (containerRatio > targetRatio) {\r\n        height = availableHeight * (isExpanded ? 0.95 : 1);\r\n        width = height * targetRatio;\r\n      } else {\r\n        width = availableWidth * (isExpanded ? 0.95 : 1);\r\n        height = width / targetRatio;\r\n      }\r\n\r\n      setPreviewDimensions({ width, height });\r\n    };\r\n\r\n    updatePreviewSize();\r\n    const resizeObserver = new ResizeObserver(updatePreviewSize);\r\n    if (containerRef.current) {\r\n      resizeObserver.observe(containerRef.current);\r\n    }\r\n    if (isExpanded) {\r\n      window.addEventListener(\"resize\", updatePreviewSize);\r\n    }\r\n\r\n    return () => {\r\n      resizeObserver.disconnect();\r\n      if (isExpanded) {\r\n        window.removeEventListener(\"resize\", updatePreviewSize);\r\n      }\r\n    };\r\n  }, [canvasSize.width, canvasSize.height, isExpanded]);\r\n\r\n  useEffect(() => {\r\n    const handleEscapeKey = (event: KeyboardEvent) => {\r\n      if (event.key === \"Escape\" && isExpanded) {\r\n        setIsExpanded(false);\r\n      }\r\n    };\r\n\r\n    if (isExpanded) {\r\n      document.addEventListener(\"keydown\", handleEscapeKey);\r\n      document.body.style.overflow = \"hidden\";\r\n    } else {\r\n      document.body.style.overflow = \"\";\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener(\"keydown\", handleEscapeKey);\r\n      document.body.style.overflow = \"\";\r\n    };\r\n  }, [isExpanded]);\r\n\r\n  useEffect(() => {\r\n    const handleMouseMove = (e: MouseEvent) => {\r\n      if (!dragState.isDragging) return;\r\n\r\n      const deltaX = e.clientX - dragState.startX;\r\n      const deltaY = e.clientY - dragState.startY;\r\n\r\n      const scaleRatio = previewDimensions.width / canvasSize.width;\r\n      const newX = dragState.initialElementX + deltaX / scaleRatio;\r\n      const newY = dragState.initialElementY + deltaY / scaleRatio;\r\n\r\n      const halfWidth = dragState.elementWidth / scaleRatio / 2;\r\n      const halfHeight = dragState.elementHeight / scaleRatio / 2;\r\n\r\n      const constrainedX = Math.max(\r\n        -canvasSize.width / 2 + halfWidth,\r\n        Math.min(canvasSize.width / 2 - halfWidth, newX)\r\n      );\r\n      const constrainedY = Math.max(\r\n        -canvasSize.height / 2 + halfHeight,\r\n        Math.min(canvasSize.height / 2 - halfHeight, newY)\r\n      );\r\n\r\n      setDragState((prev) => ({\r\n        ...prev,\r\n        currentX: constrainedX,\r\n        currentY: constrainedY,\r\n      }));\r\n    };\r\n\r\n    const handleMouseUp = () => {\r\n      if (dragState.isDragging && dragState.trackId && dragState.elementId) {\r\n        updateTextElement(dragState.trackId, dragState.elementId, {\r\n          x: dragState.currentX,\r\n          y: dragState.currentY,\r\n        });\r\n      }\r\n      setDragState((prev) => ({ ...prev, isDragging: false }));\r\n    };\r\n\r\n    if (dragState.isDragging) {\r\n      document.addEventListener(\"mousemove\", handleMouseMove);\r\n      document.addEventListener(\"mouseup\", handleMouseUp);\r\n      document.body.style.cursor = \"grabbing\";\r\n      document.body.style.userSelect = \"none\";\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener(\"mousemove\", handleMouseMove);\r\n      document.removeEventListener(\"mouseup\", handleMouseUp);\r\n      document.body.style.cursor = \"\";\r\n      document.body.style.userSelect = \"\";\r\n    };\r\n  }, [dragState, previewDimensions, canvasSize, updateTextElement]);\r\n\r\n  const handleTextMouseDown = (\r\n    e: React.MouseEvent<HTMLDivElement>,\r\n    element: any,\r\n    trackId: string\r\n  ) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    const rect = e.currentTarget.getBoundingClientRect();\r\n\r\n    setDragState({\r\n      isDragging: true,\r\n      elementId: element.id,\r\n      trackId,\r\n      startX: e.clientX,\r\n      startY: e.clientY,\r\n      initialElementX: element.x,\r\n      initialElementY: element.y,\r\n      currentX: element.x,\r\n      currentY: element.y,\r\n      elementWidth: rect.width,\r\n      elementHeight: rect.height,\r\n    });\r\n  };\r\n\r\n  const toggleExpanded = useCallback(() => {\r\n    setIsExpanded((prev) => !prev);\r\n  }, []);\r\n\r\n  const hasAnyElements = tracks.some((track) => track.elements.length > 0);\r\n  const getActiveElements = (): ActiveElement[] => {\r\n    const activeElements: ActiveElement[] = [];\r\n\r\n    // Iterate tracks from bottom to top so topmost track renders last (on top)\r\n    ;[...tracks].reverse().forEach((track) => {\r\n      track.elements.forEach((element) => {\r\n        if (element.hidden) return;\r\n        const elementStart = element.startTime;\r\n        const elementEnd =\r\n          element.startTime +\r\n          (element.duration - element.trimStart - element.trimEnd);\r\n\r\n        if (currentTime >= elementStart && currentTime < elementEnd) {\r\n          let mediaItem = null;\r\n          if (element.type === \"media\") {\r\n            mediaItem =\r\n              element.mediaId === \"test\"\r\n                ? null\r\n                : mediaItems.find((item) => item.id === element.mediaId) ||\r\n                  null;\r\n          }\r\n          activeElements.push({ element, track, mediaItem });\r\n        }\r\n      });\r\n    });\r\n\r\n    return activeElements;\r\n  };\r\n\r\n  const activeElements = getActiveElements();\r\n\r\n  // Get media elements for blur background (video/image only)\r\n  const getBlurBackgroundElements = (): ActiveElement[] => {\r\n    return activeElements.filter(\r\n      ({ element, mediaItem }) =>\r\n        element.type === \"media\" &&\r\n        mediaItem &&\r\n        (mediaItem.type === \"video\" || mediaItem.type === \"image\") &&\r\n        element.mediaId !== \"test\" // Exclude test elements\r\n    );\r\n  };\r\n\r\n  const blurBackgroundElements = getBlurBackgroundElements();\r\n\r\n  // Render blur background layer\r\n  const renderBlurBackground = () => {\r\n    if (\r\n      !activeProject?.backgroundType ||\r\n      activeProject.backgroundType !== \"blur\" ||\r\n      blurBackgroundElements.length === 0\r\n    ) {\r\n      return null;\r\n    }\r\n\r\n    // Use the first media element for background (could be enhanced to use primary/focused element)\r\n    const backgroundElement = blurBackgroundElements[0];\r\n    const { element, mediaItem } = backgroundElement;\r\n\r\n    if (!mediaItem) return null;\r\n\r\n    const blurIntensity = activeProject.blurIntensity || 8;\r\n\r\n    if (mediaItem.type === \"video\") {\r\n      return (\r\n        <div\r\n          key={`blur-${element.id}`}\r\n          className=\"absolute inset-0 overflow-hidden\"\r\n          style={{\r\n            filter: `blur(${blurIntensity}px)`,\r\n            transform: \"scale(1.1)\", // Slightly zoom to avoid blur edge artifacts\r\n            transformOrigin: \"center\",\r\n          }}\r\n        >\r\n          <VideoPlayer\r\n            src={mediaItem.url!}\r\n            poster={mediaItem.thumbnailUrl}\r\n            clipStartTime={element.startTime}\r\n            trimStart={element.trimStart}\r\n            trimEnd={element.trimEnd}\r\n            clipDuration={element.duration}\r\n            className=\"w-full h-full object-cover\"\r\n            trackMuted={true}\r\n          />\r\n        </div>\r\n      );\r\n    }\r\n\r\n    if (mediaItem.type === \"image\") {\r\n      return (\r\n        <div\r\n          key={`blur-${element.id}`}\r\n          className=\"absolute inset-0 overflow-hidden\"\r\n          style={{\r\n            filter: `blur(${blurIntensity}px)`,\r\n            transform: \"scale(1.1)\", // Slightly zoom to avoid blur edge artifacts\r\n            transformOrigin: \"center\",\r\n          }}\r\n        >\r\n          <img\r\n            src={mediaItem.url!}\r\n            alt={mediaItem.name}\r\n            className=\"w-full h-full object-cover\"\r\n            draggable={false}\r\n          />\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  // Render an element\r\n  const renderElement = (elementData: ActiveElement, index: number) => {\r\n    const { element, mediaItem } = elementData;\r\n\r\n    // Text elements\r\n    if (element.type === \"text\") {\r\n      const fontClassName =\r\n        FONT_CLASS_MAP[element.fontFamily as keyof typeof FONT_CLASS_MAP] || \"\";\r\n\r\n      const scaleRatio = previewDimensions.width / canvasSize.width;\r\n\r\n      return (\r\n        <div\r\n          key={element.id}\r\n          className=\"absolute cursor-grab\"\r\n          onMouseDown={(e) =>\r\n            handleTextMouseDown(e, element, elementData.track.id)\r\n          }\r\n          style={{\r\n            left: `${\r\n              50 +\r\n              ((dragState.isDragging && dragState.elementId === element.id\r\n                ? dragState.currentX\r\n                : element.x) /\r\n                canvasSize.width) *\r\n                100\r\n            }%`,\r\n            top: `${\r\n              50 +\r\n              ((dragState.isDragging && dragState.elementId === element.id\r\n                ? dragState.currentY\r\n                : element.y) /\r\n                canvasSize.height) *\r\n                100\r\n            }%`,\r\n            transform: `translate(-50%, -50%) rotate(${element.rotation}deg)`,\r\n            opacity: element.opacity,\r\n            zIndex: 100 + index, // Text elements on top\r\n          }}\r\n        >\r\n          <div\r\n            className={fontClassName}\r\n            style={{\r\n              fontSize: `${element.fontSize * scaleRatio}px`,\r\n              color: element.color,\r\n              backgroundColor: element.backgroundColor,\r\n              textAlign: element.textAlign,\r\n              fontWeight: element.fontWeight,\r\n              fontStyle: element.fontStyle,\r\n              textDecoration: element.textDecoration,\r\n              padding: `${4 * scaleRatio}px ${8 * scaleRatio}px`,\r\n              borderRadius: `${2 * scaleRatio}px`,\r\n              whiteSpace: \"nowrap\",\r\n              // Fallback for system fonts that don't have classes\r\n              ...(fontClassName === \"\" && { fontFamily: element.fontFamily }),\r\n            }}\r\n          >\r\n            {element.content}\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    // Media elements\r\n    if (element.type === \"media\") {\r\n      // Test elements\r\n      if (!mediaItem || element.mediaId === \"test\") {\r\n        return (\r\n          <div\r\n            key={element.id}\r\n            className=\"absolute inset-0 bg-linear-to-br from-blue-500/20 to-purple-500/20 flex items-center justify-center\"\r\n          >\r\n            <div className=\"text-center\">\r\n              <div className=\"text-2xl mb-2\">🎬</div>\r\n              <p className=\"text-xs text-foreground\">{element.name}</p>\r\n            </div>\r\n          </div>\r\n        );\r\n      }\r\n\r\n      // Video elements\r\n      if (mediaItem.type === \"video\") {\r\n        return (\r\n          <div\r\n            key={element.id}\r\n            className=\"absolute inset-0 flex items-center justify-center\"\r\n          >\r\n            <VideoPlayer\r\n              src={mediaItem.url!}\r\n              poster={mediaItem.thumbnailUrl}\r\n              clipStartTime={element.startTime}\r\n              trimStart={element.trimStart}\r\n              trimEnd={element.trimEnd}\r\n              clipDuration={element.duration}\r\n              trackMuted={elementData.track.muted}\r\n            />\r\n          </div>\r\n        );\r\n      }\r\n\r\n      // Image elements\r\n      if (mediaItem.type === \"image\") {\r\n        return (\r\n          <div\r\n            key={element.id}\r\n            className=\"absolute inset-0 flex items-center justify-center\"\r\n          >\r\n            <img\r\n              src={mediaItem.url!}\r\n              alt={mediaItem.name}\r\n              className=\"max-w-full max-h-full object-contain\"\r\n              draggable={false}\r\n            />\r\n          </div>\r\n        );\r\n      }\r\n\r\n      // Audio elements (no visual representation)\r\n      if (mediaItem.type === \"audio\") {\r\n        return (\r\n          <div key={element.id} className=\"absolute inset-0\" style={{ pointerEvents: \"none\" }}>\r\n            <AudioPlayer\r\n              src={mediaItem.url!}\r\n              clipStartTime={element.startTime}\r\n              trimStart={element.trimStart}\r\n              trimEnd={element.trimEnd}\r\n              clipDuration={element.duration}\r\n              trackMuted={elementData.track.muted}\r\n            />\r\n          </div>\r\n        );\r\n      }\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"h-full w-full flex flex-col min-h-0 min-w-0 bg-panel rounded-sm relative\">\r\n        <div\r\n          ref={containerRef}\r\n          className=\"flex-1 flex flex-col items-center justify-center min-h-0 min-w-0\"\r\n        >\r\n          <div className=\"flex-1\" />\r\n          {hasAnyElements ? (\r\n            <div\r\n              ref={previewRef}\r\n              className=\"relative overflow-hidden border\"\r\n              style={{\r\n                width: previewDimensions.width,\r\n                height: previewDimensions.height,\r\n                background:\r\n                  activeProject?.backgroundType === \"blur\"\r\n                    ? \"transparent\"\r\n                    : activeProject?.backgroundColor || \"#000000\",\r\n              }}\r\n            >\r\n              {renderBlurBackground()}\r\n              {activeElements.length === 0 ? (\r\n                <div className=\"absolute inset-0 flex items-center justify-center text-muted-foreground\">\r\n                  No elements at current time\r\n                </div>\r\n              ) : (\r\n                activeElements.map((elementData, index) =>\r\n                  renderElement(elementData, index)\r\n                )\r\n              )}\r\n              <LayoutGuideOverlay />\r\n            </div>\r\n          ) : null}\r\n\r\n          <div className=\"flex-1\" />\r\n\r\n          <PreviewToolbar\r\n            hasAnyElements={hasAnyElements}\r\n            onToggleExpanded={toggleExpanded}\r\n            isExpanded={isExpanded}\r\n            currentTime={currentTime}\r\n            setCurrentTime={setCurrentTime}\r\n            toggle={toggle}\r\n            getTotalDuration={getTotalDuration}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {isExpanded && (\r\n        <FullscreenPreview\r\n          previewDimensions={previewDimensions}\r\n          activeProject={activeProject}\r\n          renderBlurBackground={renderBlurBackground}\r\n          activeElements={activeElements}\r\n          renderElement={renderElement}\r\n          blurBackgroundElements={blurBackgroundElements}\r\n          hasAnyElements={hasAnyElements}\r\n          toggleExpanded={toggleExpanded}\r\n          currentTime={currentTime}\r\n          setCurrentTime={setCurrentTime}\r\n          toggle={toggle}\r\n          getTotalDuration={getTotalDuration}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\nfunction FullscreenToolbar({\r\n  hasAnyElements,\r\n  onToggleExpanded,\r\n  currentTime,\r\n  setCurrentTime,\r\n  toggle,\r\n  getTotalDuration,\r\n}: {\r\n  hasAnyElements: boolean;\r\n  onToggleExpanded: () => void;\r\n  currentTime: number;\r\n  setCurrentTime: (time: number) => void;\r\n  toggle: () => void;\r\n  getTotalDuration: () => number;\r\n}) {\r\n  const { isPlaying, seek } = usePlaybackStore();\r\n  const { activeProject } = useProjectStore();\r\n  const [isDragging, setIsDragging] = useState(false);\r\n\r\n  const totalDuration = getTotalDuration();\r\n  const progress = totalDuration > 0 ? (currentTime / totalDuration) * 100 : 0;\r\n\r\n  const handleTimelineClick = (e: React.MouseEvent<HTMLDivElement>) => {\r\n    if (!hasAnyElements) return;\r\n    const rect = e.currentTarget.getBoundingClientRect();\r\n    const clickX = e.clientX - rect.left;\r\n    const percentage = Math.max(0, Math.min(1, clickX / rect.width));\r\n    const newTime = percentage * totalDuration;\r\n    setCurrentTime(Math.max(0, Math.min(newTime, totalDuration)));\r\n  };\r\n\r\n  const handleTimelineDrag = (e: React.MouseEvent<HTMLDivElement>) => {\r\n    if (!hasAnyElements) return;\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    const rect = e.currentTarget.getBoundingClientRect();\r\n    setIsDragging(true);\r\n\r\n    const handleMouseMove = (moveEvent: MouseEvent) => {\r\n      moveEvent.preventDefault();\r\n      const dragX = moveEvent.clientX - rect.left;\r\n      const percentage = Math.max(0, Math.min(1, dragX / rect.width));\r\n      const newTime = percentage * totalDuration;\r\n      setCurrentTime(Math.max(0, Math.min(newTime, totalDuration)));\r\n    };\r\n\r\n    const handleMouseUp = () => {\r\n      setIsDragging(false);\r\n      document.removeEventListener(\"mousemove\", handleMouseMove);\r\n      document.removeEventListener(\"mouseup\", handleMouseUp);\r\n      document.body.style.userSelect = \"\";\r\n    };\r\n\r\n    document.body.style.userSelect = \"none\";\r\n    document.addEventListener(\"mousemove\", handleMouseMove);\r\n    document.addEventListener(\"mouseup\", handleMouseUp);\r\n    handleMouseMove(e.nativeEvent);\r\n  };\r\n\r\n  const skipBackward = () => {\r\n    const newTime = Math.max(0, currentTime - 1);\r\n    setCurrentTime(newTime);\r\n  };\r\n\r\n  const skipForward = () => {\r\n    const newTime = Math.min(totalDuration, currentTime + 1);\r\n    setCurrentTime(newTime);\r\n  };\r\n\r\n  return (\r\n    <div\r\n      data-toolbar\r\n      className=\"flex items-center gap-2 p-1 pt-2 w-full text-foreground relative\"\r\n    >\r\n      <div className=\"flex items-center gap-1 text-[0.70rem] tabular-nums text-foreground/90\">\r\n        <EditableTimecode\r\n          time={currentTime}\r\n          duration={totalDuration}\r\n          format=\"HH:MM:SS:FF\"\r\n          fps={activeProject?.fps || 30}\r\n          onTimeChange={seek}\r\n          disabled={!hasAnyElements}\r\n          className=\"text-foreground/90 hover:bg-white/10\"\r\n        />\r\n        <span className=\"opacity-50\">/</span>\r\n        <span>\r\n          {formatTimeCode(\r\n            totalDuration,\r\n            \"HH:MM:SS:FF\",\r\n            activeProject?.fps || 30\r\n          )}\r\n        </span>\r\n      </div>\r\n\r\n      <div className=\"flex items-center gap-1\">\r\n        <Button\r\n          variant=\"text\"\r\n          size=\"icon\"\r\n          onClick={skipBackward}\r\n          disabled={!hasAnyElements}\r\n          className=\"h-auto p-0 text-foreground\"\r\n          title=\"Skip backward 1s\"\r\n        >\r\n          <SkipBack className=\"h-3 w-3\" />\r\n        </Button>\r\n        <Button\r\n          variant=\"text\"\r\n          size=\"icon\"\r\n          onClick={toggle}\r\n          disabled={!hasAnyElements}\r\n          className=\"h-auto p-0 text-foreground hover:text-foreground/80\"\r\n        >\r\n          {isPlaying ? (\r\n            <Pause className=\"h-3 w-3\" />\r\n          ) : (\r\n            <Play className=\"h-3 w-3\" />\r\n          )}\r\n        </Button>\r\n        <Button\r\n          variant=\"text\"\r\n          size=\"icon\"\r\n          onClick={skipForward}\r\n          disabled={!hasAnyElements}\r\n          className=\"h-auto p-0 text-foreground hover:text-foreground/80\"\r\n          title=\"Skip forward 1s\"\r\n        >\r\n          <SkipForward className=\"h-3 w-3\" />\r\n        </Button>\r\n      </div>\r\n\r\n      <div className=\"flex-1 flex items-center gap-2\">\r\n        <div\r\n          className={cn(\r\n            \"relative h-1 rounded-full cursor-pointer flex-1 bg-foreground/20\",\r\n            !hasAnyElements && \"opacity-50 cursor-not-allowed\"\r\n          )}\r\n          onClick={hasAnyElements ? handleTimelineClick : undefined}\r\n          onMouseDown={hasAnyElements ? handleTimelineDrag : undefined}\r\n          style={{ userSelect: \"none\" }}\r\n        >\r\n          <div\r\n            className={cn(\r\n              \"absolute top-0 left-0 h-full rounded-full bg-foreground\",\r\n              !isDragging && \"duration-100\"\r\n            )}\r\n            style={{ width: `${progress}%` }}\r\n          />\r\n          <div\r\n            className=\"absolute top-1/2 w-3 h-3 rounded-full -translate-y-1/2 -translate-x-1/2 shadow-xs bg-foreground border border-black/20\"\r\n            style={{ left: `${progress}%` }}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <Button\r\n        variant=\"text\"\r\n        size=\"icon\"\r\n        className=\"size-4! text-foreground/80 hover:text-foreground\"\r\n        onClick={onToggleExpanded}\r\n        title=\"Exit fullscreen (Esc)\"\r\n      >\r\n        <Expand className=\"size-4!\" />\r\n      </Button>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction FullscreenPreview({\r\n  previewDimensions,\r\n  activeProject,\r\n  renderBlurBackground,\r\n  activeElements,\r\n  renderElement,\r\n  blurBackgroundElements,\r\n  hasAnyElements,\r\n  toggleExpanded,\r\n  currentTime,\r\n  setCurrentTime,\r\n  toggle,\r\n  getTotalDuration,\r\n}: {\r\n  previewDimensions: { width: number; height: number };\r\n  activeProject: any;\r\n  renderBlurBackground: () => React.ReactNode;\r\n  activeElements: ActiveElement[];\r\n  renderElement: (elementData: ActiveElement, index: number) => React.ReactNode;\r\n  blurBackgroundElements: ActiveElement[];\r\n  hasAnyElements: boolean;\r\n  toggleExpanded: () => void;\r\n  currentTime: number;\r\n  setCurrentTime: (time: number) => void;\r\n  toggle: () => void;\r\n  getTotalDuration: () => number;\r\n}) {\r\n  return (\r\n    <div className=\"fixed inset-0 z-9999 flex flex-col\">\r\n      <div className=\"flex-1 flex items-center justify-center bg-background\">\r\n        <div\r\n          className=\"relative overflow-hidden border border-border m-3\"\r\n          style={{\r\n            width: previewDimensions.width,\r\n            height: previewDimensions.height,\r\n            background:\r\n              activeProject?.backgroundType === \"blur\"\r\n                ? \"#1a1a1a\"\r\n                : activeProject?.backgroundColor || \"#1a1a1a\",\r\n          }}\r\n        >\r\n          {renderBlurBackground()}\r\n          {activeElements.length === 0 ? (\r\n            <div className=\"absolute inset-0 flex items-center justify-center text-white/60\">\r\n              No elements at current time\r\n            </div>\r\n          ) : (\r\n            activeElements.map((elementData, index) =>\r\n              renderElement(elementData, index)\r\n            )\r\n          )}\r\n          <LayoutGuideOverlay />\r\n        </div>\r\n      </div>\r\n      <div className=\"p-4 bg-background\">\r\n        <FullscreenToolbar\r\n          hasAnyElements={hasAnyElements}\r\n          onToggleExpanded={toggleExpanded}\r\n          currentTime={currentTime}\r\n          setCurrentTime={setCurrentTime}\r\n          toggle={toggle}\r\n          getTotalDuration={getTotalDuration}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction PreviewToolbar({\r\n  hasAnyElements,\r\n  onToggleExpanded,\r\n  isExpanded,\r\n  currentTime,\r\n  setCurrentTime,\r\n  toggle,\r\n  getTotalDuration,\r\n}: {\r\n  hasAnyElements: boolean;\r\n  onToggleExpanded: () => void;\r\n  isExpanded: boolean;\r\n  currentTime: number;\r\n  setCurrentTime: (time: number) => void;\r\n  toggle: () => void;\r\n  getTotalDuration: () => number;\r\n}) {\r\n  const { isPlaying } = usePlaybackStore();\r\n  const { layoutGuide, toggleLayoutGuide } = useEditorStore();\r\n\r\n  if (isExpanded) {\r\n    return (\r\n      <FullscreenToolbar\r\n        {...{\r\n          hasAnyElements,\r\n          onToggleExpanded,\r\n          currentTime,\r\n          setCurrentTime,\r\n          toggle,\r\n          getTotalDuration,\r\n        }}\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div\r\n      data-toolbar\r\n      className=\"flex justify-end gap-2 h-auto pb-5 pr-5 pt-4 w-full\"\r\n    >\r\n      <div className=\"flex items-center gap-2\">\r\n        <Button\r\n          variant=\"text\"\r\n          size=\"icon\"\r\n          onClick={toggle}\r\n          disabled={!hasAnyElements}\r\n          className=\"h-auto p-0\"\r\n        >\r\n          {isPlaying ? (\r\n            <Pause className=\"h-3 w-3\" />\r\n          ) : (\r\n            <Play className=\"h-3 w-3\" />\r\n          )}\r\n        </Button>\r\n        <Popover>\r\n          <PopoverTrigger asChild>\r\n            <Button\r\n              variant=\"text\"\r\n              size=\"icon\"\r\n              className=\"h-auto p-0 mr-1\"\r\n              title=\"Toggle layout guide\"\r\n            >\r\n              <SocialsIcon className=\"!size-6\" />\r\n            </Button>\r\n          </PopoverTrigger>\r\n          <PopoverContent className=\"w-80\">\r\n            <div className=\"grid gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <h4 className=\"font-medium leading-none\">Layout guide</h4>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  Show platform-specific layout guides to help align your\r\n                  content with interface elements like profile pictures,\r\n                  usernames, and interaction buttons.\r\n                </p>\r\n              </div>\r\n              <div className=\"grid gap-2\">\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Checkbox\r\n                    id=\"none\"\r\n                    checked={layoutGuide.platform === null}\r\n                    onCheckedChange={() =>\r\n                      toggleLayoutGuide(layoutGuide.platform || \"tiktok\")\r\n                    }\r\n                  />\r\n                  <Label htmlFor=\"none\">None</Label>\r\n                </div>\r\n                {Object.entries(PLATFORM_LAYOUTS).map(([platform, label]) => (\r\n                  <div key={platform} className=\"flex items-center space-x-2\">\r\n                    <Checkbox\r\n                      id={platform}\r\n                      checked={layoutGuide.platform === platform}\r\n                      onCheckedChange={() =>\r\n                        toggleLayoutGuide(platform as PlatformLayout)\r\n                      }\r\n                    />\r\n                    <Label htmlFor={platform}>{label}</Label>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          </PopoverContent>\r\n        </Popover>\r\n        <Button\r\n          variant=\"text\"\r\n          size=\"icon\"\r\n          className=\"size-4!\"\r\n          onClick={onToggleExpanded}\r\n          title=\"Enter fullscreen\"\r\n        >\r\n          <Expand className=\"size-4!\" />\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { Dialog, DialogContent, DialogTitle } from \"./ui/dialog\";\r\nimport { Button } from \"./ui/button\";\r\nimport { ArrowRightIcon } from \"lucide-react\";\r\nimport { useState, useEffect } from \"react\";\r\nimport ReactMarkdown from \"react-markdown\";\r\n\r\nexport function Onboarding() {\r\n  const [step, setStep] = useState(0);\r\n  const [isOpen, setIsOpen] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const hasSeenOnboarding = localStorage.getItem(\"hasSeenOnboarding\");\r\n    if (!hasSeenOnboarding) {\r\n      setIsOpen(true);\r\n    }\r\n  }, []);\r\n\r\n  const handleNext = () => {\r\n    setStep(step + 1);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setIsOpen(false);\r\n    localStorage.setItem(\"hasSeenOnboarding\", \"true\");\r\n  };\r\n\r\n  const getStepTitle = () => {\r\n    switch (step) {\r\n      case 0:\r\n        return \"Welcome to OpenCut Beta! 🎉\";\r\n      case 1:\r\n        return \"⚠️ This is a super early beta!\";\r\n      case 2:\r\n        return \"🦋 Have fun testing!\";\r\n      default:\r\n        return \"OpenCut Onboarding\";\r\n    }\r\n  };\r\n\r\n  const renderStepContent = () => {\r\n    switch (step) {\r\n      case 0:\r\n        return (\r\n          <div className=\"space-y-5\">\r\n            <div className=\"space-y-3\">\r\n              <Title title=\"Welcome to OpenCut Beta! 🎉\" />\r\n              <Description description=\"You're among the first to try OpenCut - the fully open source CapCut alternative.\" />\r\n            </div>\r\n            <NextButton onClick={handleNext}>Next</NextButton>\r\n          </div>\r\n        );\r\n      case 1:\r\n        return (\r\n          <div className=\"space-y-5\">\r\n            <div className=\"space-y-3\">\r\n              <Title title={getStepTitle()} />\r\n              <Description description=\"OpenCut started just one month ago. There's still a ton of things to do to make this editor amazing.\" />\r\n              <Description description=\"If you're curious, check out our roadmap [here](https://opencut.app/roadmap)\" />\r\n            </div>\r\n            <NextButton onClick={handleNext}>Next</NextButton>\r\n          </div>\r\n        );\r\n      case 2:\r\n        return (\r\n          <div className=\"space-y-5\">\r\n            <div className=\"space-y-3\">\r\n              <Title title={getStepTitle()} />\r\n              <Description description=\"Join our [Discord](https://discord.gg/zmR9N35cjK), chat with cool people and share feedback to help make OpenCut the best editor ever.\" />\r\n            </div>\r\n            <NextButton onClick={handleClose}>Finish</NextButton>\r\n          </div>\r\n        );\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-[425px] !outline-none\">\r\n        <DialogTitle>\r\n          <span className=\"sr-only\">{getStepTitle()}</span>\r\n        </DialogTitle>\r\n        {renderStepContent()}\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\nfunction Title({ title }: { title: string }) {\r\n  return <h2 className=\"text-lg md:text-xl font-bold\">{title}</h2>;\r\n}\r\n\r\nfunction Subtitle({ subtitle }: { subtitle: string }) {\r\n  return <h3 className=\"text-lg font-medium\">{subtitle}</h3>;\r\n}\r\n\r\nfunction Description({ description }: { description: string }) {\r\n  return (\r\n    <div className=\"text-muted-foreground\">\r\n      <ReactMarkdown\r\n        components={{\r\n          p: ({ children }) => <p className=\"mb-0\">{children}</p>,\r\n          a: ({ href, children }) => (\r\n            <a\r\n              href={href}\r\n              target=\"_blank\"\r\n              rel=\"noopener noreferrer\"\r\n              className=\"text-foreground hover:text-foreground/80 underline\"\r\n            >\r\n              {children}\r\n            </a>\r\n          ),\r\n        }}\r\n      >\r\n        {description}\r\n      </ReactMarkdown>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction NextButton({\r\n  children,\r\n  onClick,\r\n}: {\r\n  children: React.ReactNode;\r\n  onClick: () => void;\r\n}) {\r\n  return (\r\n    <Button onClick={onClick} variant=\"default\" className=\"w-full\">\r\n      {children}\r\n      <ArrowRightIcon className=\"w-4 h-4\" />\r\n    </Button>\r\n  );\r\n}\r\n","import { useEffect, useCallback } from \"react\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { toast } from \"sonner\";\r\n\r\nexport const usePlaybackControls = () => {\r\n  const { isPlaying, currentTime, play, pause, seek } = usePlaybackStore();\r\n\r\n  const {\r\n    selectedElements,\r\n    tracks,\r\n    splitElement,\r\n    splitAndKeepLeft,\r\n    splitAndKeepRight,\r\n    separateAudio,\r\n  } = useTimelineStore();\r\n\r\n  const handleSplitSelectedElement = useCallback(() => {\r\n    if (selectedElements.length !== 1) {\r\n      toast.error(\"Select exactly one element to split\");\r\n      return;\r\n    }\r\n\r\n    const { trackId, elementId } = selectedElements[0];\r\n    const track = tracks.find((t) => t.id === trackId);\r\n    const element = track?.elements.find((e) => e.id === elementId);\r\n\r\n    if (!element) return;\r\n\r\n    const effectiveStart = element.startTime;\r\n    const effectiveEnd =\r\n      element.startTime +\r\n      (element.duration - element.trimStart - element.trimEnd);\r\n\r\n    if (currentTime <= effectiveStart || currentTime >= effectiveEnd) {\r\n      toast.error(\"Playhead must be within selected element\");\r\n      return;\r\n    }\r\n\r\n    splitElement(trackId, elementId, currentTime);\r\n  }, [selectedElements, tracks, currentTime, splitElement]);\r\n\r\n  const handleSplitAndKeepLeftCallback = useCallback(() => {\r\n    if (selectedElements.length !== 1) {\r\n      toast.error(\"Select exactly one element\");\r\n      return;\r\n    }\r\n\r\n    const { trackId, elementId } = selectedElements[0];\r\n    const track = tracks.find((t) => t.id === trackId);\r\n    const element = track?.elements.find((e) => e.id === elementId);\r\n\r\n    if (!element) return;\r\n\r\n    const effectiveStart = element.startTime;\r\n    const effectiveEnd =\r\n      element.startTime +\r\n      (element.duration - element.trimStart - element.trimEnd);\r\n\r\n    if (currentTime <= effectiveStart || currentTime >= effectiveEnd) {\r\n      toast.error(\"Playhead must be within selected element\");\r\n      return;\r\n    }\r\n\r\n    splitAndKeepLeft(trackId, elementId, currentTime);\r\n  }, [selectedElements, tracks, currentTime, splitAndKeepLeft]);\r\n\r\n  const handleSplitAndKeepRightCallback = useCallback(() => {\r\n    if (selectedElements.length !== 1) {\r\n      toast.error(\"Select exactly one element\");\r\n      return;\r\n    }\r\n\r\n    const { trackId, elementId } = selectedElements[0];\r\n    const track = tracks.find((t) => t.id === trackId);\r\n    const element = track?.elements.find((e) => e.id === elementId);\r\n\r\n    if (!element) return;\r\n\r\n    const effectiveStart = element.startTime;\r\n    const effectiveEnd =\r\n      element.startTime +\r\n      (element.duration - element.trimStart - element.trimEnd);\r\n\r\n    if (currentTime <= effectiveStart || currentTime >= effectiveEnd) {\r\n      toast.error(\"Playhead must be within selected element\");\r\n      return;\r\n    }\r\n\r\n    splitAndKeepRight(trackId, elementId, currentTime);\r\n  }, [selectedElements, tracks, currentTime, splitAndKeepRight]);\r\n\r\n  const handleSeparateAudioCallback = useCallback(() => {\r\n    if (selectedElements.length !== 1) {\r\n      toast.error(\"Select exactly one media element to separate audio\");\r\n      return;\r\n    }\r\n\r\n    const { trackId, elementId } = selectedElements[0];\r\n    const track = tracks.find((t) => t.id === trackId);\r\n\r\n    if (!track || track.type !== \"media\") {\r\n      toast.error(\"Select a media element to separate audio\");\r\n      return;\r\n    }\r\n\r\n    separateAudio(trackId, elementId);\r\n  }, [selectedElements, tracks, separateAudio]);\r\n};\r\n","\"use client\";\r\n\r\nimport { useMemo } from \"react\";\r\nimport { useKeybindingsStore } from \"@/stores/keybindings-store\";\r\nimport { Action } from \"@/constants/actions\";\r\nimport { getPlatformAlternateKey, getPlatformSpecialKey } from \"@/lib/utils\";\r\n\r\nexport interface KeyboardShortcut {\r\n  id: string;\r\n  keys: string[];\r\n  description: string;\r\n  category: string;\r\n  action: Action;\r\n  icon?: React.ReactNode;\r\n}\r\n\r\n// Map actions to their descriptions and categories\r\nconst actionDescriptions: Record<\r\n  Action,\r\n  { description: string; category: string }\r\n> = {\r\n  \"toggle-play\": { description: \"Play/Pause\", category: \"Playback\" },\r\n  \"stop-playback\": { description: \"Stop playback\", category: \"Playback\" },\r\n  \"seek-forward\": {\r\n    description: \"Seek forward 1 second\",\r\n    category: \"Playback\",\r\n  },\r\n  \"seek-backward\": {\r\n    description: \"Seek backward 1 second\",\r\n    category: \"Playback\",\r\n  },\r\n  \"frame-step-forward\": {\r\n    description: \"Frame step forward\",\r\n    category: \"Navigation\",\r\n  },\r\n  \"frame-step-backward\": {\r\n    description: \"Frame step backward\",\r\n    category: \"Navigation\",\r\n  },\r\n  \"jump-forward\": {\r\n    description: \"Jump forward 5 seconds\",\r\n    category: \"Navigation\",\r\n  },\r\n  \"jump-backward\": {\r\n    description: \"Jump backward 5 seconds\",\r\n    category: \"Navigation\",\r\n  },\r\n  \"goto-start\": { description: \"Go to timeline start\", category: \"Navigation\" },\r\n  \"goto-end\": { description: \"Go to timeline end\", category: \"Navigation\" },\r\n  \"split-element\": {\r\n    description: \"Split element at playhead\",\r\n    category: \"Editing\",\r\n  },\r\n  \"delete-selected\": {\r\n    description: \"Delete selected elements\",\r\n    category: \"Editing\",\r\n  },\r\n  \"select-all\": { description: \"Select all elements\", category: \"Selection\" },\r\n  \"duplicate-selected\": {\r\n    description: \"Duplicate selected element\",\r\n    category: \"Selection\",\r\n  },\r\n  \"toggle-snapping\": { description: \"Toggle snapping\", category: \"Editing\" },\r\n  undo: { description: \"Undo\", category: \"History\" },\r\n  redo: { description: \"Redo\", category: \"History\" },\r\n};\r\n\r\n// Convert key binding format to display format\r\nconst formatKey = (key: string): string => {\r\n  return key\r\n    .replace(\"ctrl\", getPlatformSpecialKey())\r\n    .replace(\"alt\", getPlatformAlternateKey())\r\n    .replace(\"shift\", \"Shift\")\r\n    .replace(\"left\", \"←\")\r\n    .replace(\"right\", \"→\")\r\n    .replace(\"up\", \"↑\")\r\n    .replace(\"down\", \"↓\")\r\n    .replace(\"space\", \"Space\")\r\n    .replace(\"home\", \"Home\")\r\n    .replace(\"end\", \"End\")\r\n    .replace(\"delete\", \"Delete\")\r\n    .replace(\"backspace\", \"Backspace\")\r\n    .replace(\"-\", \"+\");\r\n};\r\n\r\nexport const useKeyboardShortcutsHelp = () => {\r\n  const { keybindings } = useKeybindingsStore();\r\n\r\n  const shortcuts = useMemo(() => {\r\n    const result: KeyboardShortcut[] = [];\r\n\r\n    // Group keybindings by action\r\n    const actionToKeys: Record<Action, string[]> = {} as any;\r\n\r\n    Object.entries(keybindings).forEach(([key, action]) => {\r\n      if (action) {\r\n        if (!actionToKeys[action]) {\r\n          actionToKeys[action] = [];\r\n        }\r\n        actionToKeys[action].push(formatKey(key));\r\n      }\r\n    });\r\n\r\n    // Convert to shortcuts format\r\n    Object.entries(actionToKeys).forEach(([action, keys]) => {\r\n      const actionInfo = actionDescriptions[action as Action];\r\n      if (actionInfo) {\r\n        result.push({\r\n          id: action,\r\n          keys,\r\n          description: actionInfo.description,\r\n          category: actionInfo.category,\r\n          action: action as Action,\r\n        });\r\n      }\r\n    });\r\n\r\n    // Sort shortcuts by category first, then by description to ensure consistent ordering\r\n    return result.sort((a, b) => {\r\n      if (a.category !== b.category) {\r\n        return a.category.localeCompare(b.category);\r\n      }\r\n      return a.description.localeCompare(b.description);\r\n    });\r\n  }, [keybindings]);\r\n\r\n  return {\r\n    shortcuts,\r\n  };\r\n};\r\n","\"use client\";\r\n\r\nimport { Keyboard } from \"lucide-react\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { toast } from \"sonner\";\r\nimport {\r\n  type KeyboardShortcut,\r\n  useKeyboardShortcutsHelp,\r\n} from \"@/hooks/use-keyboard-shortcuts-help\";\r\nimport { useKeybindingsStore } from \"@/stores/keybindings-store\";\r\nimport { Button } from \"./ui/button\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"./ui/dialog\";\r\n\r\nconst ShortcutItem = ({\r\n  shortcut,\r\n  isRecording,\r\n  onStartRecording,\r\n}: {\r\n  shortcut: KeyboardShortcut;\r\n  isRecording: boolean;\r\n  onStartRecording: (shortcut: KeyboardShortcut) => void;\r\n}) => {\r\n  // Filter out lowercase duplicates for display - if both \"j\" and \"J\" exist, only show \"J\"\r\n  const displayKeys = shortcut.keys.filter((key: string) => {\r\n    if (\r\n      key.includes(\"Cmd\") &&\r\n      shortcut.keys.includes(key.replace(\"Cmd\", \"Ctrl\"))\r\n    )\r\n      return false;\r\n\r\n    return true;\r\n  });\r\n\r\n  return (\r\n    <div className=\"flex items-center justify-between\">\r\n      <div className=\"flex items-center gap-3\">\r\n        {shortcut.icon && (\r\n          <div className=\"text-muted-foreground\">{shortcut.icon}</div>\r\n        )}\r\n        <span className=\"text-sm\">{shortcut.description}</span>\r\n      </div>\r\n      <div className=\"flex items-center gap-1\">\r\n        {displayKeys.map((key: string, index: number) => (\r\n          <div key={key} className=\"flex items-center gap-1\">\r\n            <div className=\"flex items-center\">\r\n              {key.split(\"+\").map((keyPart: string, partIndex: number) => {\r\n                const keyId = `${shortcut.id}-${index}-${partIndex}`;\r\n                return (\r\n                  <EditableShortcutKey\r\n                    key={keyId}\r\n                    isRecording={isRecording}\r\n                    onStartRecording={() => onStartRecording(shortcut)}\r\n                  >\r\n                    {keyPart}\r\n                  </EditableShortcutKey>\r\n                );\r\n              })}\r\n            </div>\r\n            {index < displayKeys.length - 1 && (\r\n              <span className=\"text-xs text-muted-foreground\">or</span>\r\n            )}\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst EditableShortcutKey = ({\r\n  children,\r\n  isRecording,\r\n  onStartRecording,\r\n}: {\r\n  children: React.ReactNode;\r\n  isRecording: boolean;\r\n  onStartRecording: () => void;\r\n}) => {\r\n  const handleClick = (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    onStartRecording();\r\n  };\r\n\r\n  return (\r\n    <Button\r\n      variant=\"text\"\r\n      size=\"sm\"\r\n      className={`inline-flex font-sans text-xs rounded px-2 min-w-6 min-h-6 leading-none items-center justify-center shadow-xs border mr-1 cursor-pointer hover:bg-opacity-80 ${\r\n        isRecording\r\n          ? \"border-primary bg-primary/10\"\r\n          : \"border bg-accent\"\r\n      }`}\r\n      onClick={handleClick}\r\n      title={\r\n        isRecording ? \"Press any key combination...\" : \"Click to edit shortcut\"\r\n      }\r\n    >\r\n      {children}\r\n    </Button>\r\n  );\r\n};\r\n\r\nexport const KeyboardShortcutsHelp = () => {\r\n  const [open, setOpen] = useState(false);\r\n  const [recordingShortcut, setRecordingShortcut] =\r\n    useState<KeyboardShortcut | null>(null);\r\n\r\n  const {\r\n    updateKeybinding,\r\n    removeKeybinding,\r\n    getKeybindingString,\r\n    validateKeybinding,\r\n    getKeybindingsForAction,\r\n    setIsRecording,\r\n    resetToDefaults,\r\n    isRecording,\r\n  } = useKeybindingsStore();\r\n\r\n  // Get shortcuts from centralized hook\r\n  const { shortcuts } = useKeyboardShortcutsHelp();\r\n\r\n  const categories = Array.from(new Set(shortcuts.map((s) => s.category)));\r\n\r\n  useEffect(() => {\r\n    if (!isRecording || !recordingShortcut) return;\r\n\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      const keyString = getKeybindingString(e);\r\n      if (keyString) {\r\n        // Auto-save the new keybinding\r\n        const conflict = validateKeybinding(\r\n          keyString,\r\n          recordingShortcut.action\r\n        );\r\n        if (conflict) {\r\n          toast.error(\r\n            `Key \"${keyString}\" is already bound to \"${conflict.existingAction}\"`\r\n          );\r\n          setRecordingShortcut(null);\r\n          return;\r\n        }\r\n\r\n        // Remove old keybindings for this action\r\n        const oldKeys = getKeybindingsForAction(recordingShortcut.action);\r\n        oldKeys.forEach((key) => removeKeybinding(key));\r\n\r\n        // Add new keybinding\r\n        updateKeybinding(keyString, recordingShortcut.action);\r\n\r\n        setIsRecording(false);\r\n        setRecordingShortcut(null);\r\n      }\r\n    };\r\n\r\n    const handleClickOutside = () => {\r\n      setRecordingShortcut(null);\r\n      setIsRecording(false);\r\n    };\r\n\r\n    document.addEventListener(\"keydown\", handleKeyDown);\r\n    document.addEventListener(\"click\", handleClickOutside);\r\n\r\n    return () => {\r\n      document.removeEventListener(\"keydown\", handleKeyDown);\r\n      document.removeEventListener(\"click\", handleClickOutside);\r\n    };\r\n  }, [\r\n    recordingShortcut,\r\n    getKeybindingString,\r\n    updateKeybinding,\r\n    removeKeybinding,\r\n    validateKeybinding,\r\n    getKeybindingsForAction,\r\n    setIsRecording,\r\n    isRecording,\r\n  ]);\r\n\r\n  const handleStartRecording = (shortcut: KeyboardShortcut) => {\r\n    setRecordingShortcut(shortcut);\r\n    setIsRecording(true);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={setOpen}>\r\n      <DialogTrigger asChild>\r\n        <Button variant=\"text\" size=\"sm\" className=\"gap-2\">\r\n          <Keyboard className=\"w-4 h-4\" />\r\n          Shortcuts\r\n        </Button>\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-2xl overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <Keyboard className=\"w-5 h-5\" />\r\n            Keyboard Shortcuts\r\n          </DialogTitle>\r\n          <DialogDescription>\r\n            Speed up your video editing workflow with these keyboard shortcuts.\r\n            Click any shortcut key to edit it.\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-6\">\r\n          {categories.map((category) => (\r\n            <div key={category} className=\"flex flex-col gap-1\">\r\n              <h3 className=\"text-xs text-muted-foreground uppercase tracking-wide font-medium\">\r\n                {category}\r\n              </h3>\r\n              <div className=\"space-y-0.5\">\r\n                {shortcuts\r\n                  .filter((shortcut) => shortcut.category === category)\r\n                  .map((shortcut) => (\r\n                    <ShortcutItem\r\n                      key={shortcut.action}\r\n                      shortcut={shortcut}\r\n                      isRecording={\r\n                        shortcut.action === recordingShortcut?.action\r\n                      }\r\n                      onStartRecording={handleStartRecording}\r\n                    />\r\n                  ))}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <DialogFooter>\r\n          <Button\r\n            size=\"sm\"\r\n            className=\"mt-4\"\r\n            variant=\"destructive\"\r\n            onClick={resetToDefaults}\r\n          >\r\n            Reset to Default\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n","\"use client\";\r\n\r\nimport { Button } from \"./ui/button\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuTrigger,\r\n} from \"./ui/dropdown-menu\";\r\nimport { ChevronDown, RotateCcw, LayoutPanelTop } from \"lucide-react\";\r\nimport { usePanelStore, type PanelPreset } from \"@/stores/panel-store\";\r\n\r\nconst PRESET_LABELS: Record<PanelPreset, string> = {\r\n  default: \"Default\",\r\n  media: \"Media\",\r\n  inspector: \"Inspector\",\r\n  \"vertical-preview\": \"Vertical Preview\",\r\n};\r\n\r\nconst PRESET_DESCRIPTIONS: Record<PanelPreset, string> = {\r\n  default: \"Media, preview, and inspector on top row, timeline on bottom\",\r\n  media: \"Full height media on left, preview and inspector on top row\",\r\n  inspector: \"Full height inspector on right, media and preview on top row\",\r\n  \"vertical-preview\": \"Full height preview on right for vertical videos\",\r\n};\r\n\r\nexport function PanelPresetSelector() {\r\n  const { activePreset, setActivePreset, resetPreset } = usePanelStore();\r\n\r\n  const handlePresetChange = (preset: PanelPreset) => {\r\n    setActivePreset(preset);\r\n  };\r\n\r\n  const handleResetPreset = (preset: PanelPreset, event: React.MouseEvent) => {\r\n    event.stopPropagation();\r\n    resetPreset(preset);\r\n  };\r\n\r\n  return (\r\n    <DropdownMenu>\r\n      <DropdownMenuTrigger asChild>\r\n        <Button\r\n          variant=\"secondary\"\r\n          size=\"sm\"\r\n          className=\"h-8 px-2 flex items-center gap-1 text-xs\"\r\n          title=\"Panel Presets\"\r\n        >\r\n          <LayoutPanelTop className=\"h-4 w-4\" />\r\n          <ChevronDown className=\"h-3 w-3\" />\r\n        </Button>\r\n      </DropdownMenuTrigger>\r\n      <DropdownMenuContent align=\"start\" className=\"w-64\">\r\n        <div className=\"px-2 py-1.5 text-xs font-medium text-muted-foreground\">\r\n          Panel Presets\r\n        </div>\r\n        <DropdownMenuSeparator />\r\n        {(Object.keys(PRESET_LABELS) as PanelPreset[]).map((preset) => (\r\n          <DropdownMenuItem\r\n            key={preset}\r\n            onClick={() => handlePresetChange(preset)}\r\n            className=\"flex items-start justify-between gap-2 py-2 cursor-pointer\"\r\n          >\r\n            <div className=\"flex-1 min-w-0\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <span className=\"font-medium text-sm\">\r\n                  {PRESET_LABELS[preset]}\r\n                </span>\r\n                {activePreset === preset && (\r\n                  <div className=\"h-2 w-2 rounded-full bg-primary\" />\r\n                )}\r\n              </div>\r\n              <p className=\"text-xs text-muted-foreground mt-0.5 leading-tight\">\r\n                {PRESET_DESCRIPTIONS[preset]}\r\n              </p>\r\n            </div>\r\n            <Button\r\n              variant=\"secondary\"\r\n              size=\"icon\"\r\n              className=\"h-6 w-6 shrink-0 opacity-60 hover:opacity-100\"\r\n              onClick={(e) => handleResetPreset(preset, e)}\r\n              title={`Reset ${PRESET_LABELS[preset]} preset`}\r\n            >\r\n              <RotateCcw className=\"h-3 w-3\" />\r\n            </Button>\r\n          </DropdownMenuItem>\r\n        ))}\r\n      </DropdownMenuContent>\r\n    </DropdownMenu>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { Button } from \"./ui/button\";\r\nimport {\r\n  ChevronDown,\r\n  ArrowLeft,\r\n  Download,\r\n  SquarePen,\r\n  Trash,\r\n  Sun,\r\n} from \"lucide-react\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { HeaderBase } from \"./header-base\";\r\nimport { formatTimeCode } from \"@/lib/time\";\r\nimport { useProjectStore } from \"@/stores/project-store\";\r\nimport { KeyboardShortcutsHelp } from \"./keyboard-shortcuts-help\";\r\nimport { useState } from \"react\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuTrigger,\r\n} from \"./ui/dropdown-menu\";\r\nimport Link from \"next/link\";\r\nimport { navigateToProjects, navigateToHome } from \"@/lib/navigation\";\r\nimport { RenameProjectDialog } from \"./rename-project-dialog\";\r\nimport { DeleteProjectDialog } from \"./delete-project-dialog\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { FaDiscord } from \"react-icons/fa6\";\r\nimport { useTheme } from \"next-themes\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\nimport { TransitionUpIcon } from \"./icons\";\r\nimport { PanelPresetSelector } from \"./panel-preset-selector\";\r\n\r\nexport function EditorHeader() {\r\n  const { getTotalDuration } = useTimelineStore();\r\n  const { currentTime } = usePlaybackStore();\r\n  const { activeProject, renameProject, deleteProject } = useProjectStore();\r\n  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\r\n  const [isRenameDialogOpen, setIsRenameDialogOpen] = useState(false);\r\n  const router = useRouter();\r\n  const { theme, setTheme } = useTheme();\r\n\r\n  const handleNameSave = async (newName: string) => {\r\n    console.log(\"handleNameSave\", newName);\r\n    if (activeProject && newName.trim() && newName !== activeProject.name) {\r\n      try {\r\n        await renameProject(activeProject.id, newName.trim());\r\n        setIsRenameDialogOpen(false);\r\n      } catch (error) {\r\n        console.error(\"Failed to rename project:\", error);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    if (activeProject) {\r\n      deleteProject(activeProject.id);\r\n      setIsDeleteDialogOpen(false);\r\n      navigateToProjects();\r\n    }\r\n  };\r\n\r\n  const leftContent = (\r\n    <div className=\"flex items-center gap-2\">\r\n      <DropdownMenu>\r\n        <DropdownMenuTrigger asChild>\r\n          <Button\r\n            variant=\"secondary\"\r\n            className=\"h-auto py-1.5 px-2.5 flex items-center justify-center\"\r\n          >\r\n            <ChevronDown className=\"text-muted-foreground\" />\r\n            <span className=\"text-[0.85rem] mr-2\">{activeProject?.name}</span>\r\n          </Button>\r\n        </DropdownMenuTrigger>\r\n        <DropdownMenuContent align=\"start\" className=\"w-40 z-100\">\r\n          <DropdownMenuItem\r\n            className=\"flex items-center gap-1.5\"\r\n            onClick={() => navigateToProjects()}\r\n          >\r\n            <ArrowLeft className=\"h-4 w-4\" />\r\n            Projects\r\n          </DropdownMenuItem>\r\n          <DropdownMenuItem\r\n            className=\"flex items-center gap-1.5\"\r\n            onClick={() => setIsRenameDialogOpen(true)}\r\n          >\r\n            <SquarePen className=\"h-4 w-4\" />\r\n            Rename project\r\n          </DropdownMenuItem>\r\n          <DropdownMenuItem\r\n            variant=\"destructive\"\r\n            className=\"flex items-center gap-1.5\"\r\n            onClick={() => setIsDeleteDialogOpen(true)}\r\n          >\r\n            <Trash className=\"h-4 w-4\" />\r\n            Delete Project\r\n          </DropdownMenuItem>\r\n          <DropdownMenuSeparator />\r\n          <DropdownMenuItem asChild>\r\n            <Link\r\n              href=\"https://discord.gg/zmR9N35cjK\"\r\n              target=\"_blank\"\r\n              rel=\"noopener noreferrer\"\r\n              className=\"flex items-center gap-1.5\"\r\n            >\r\n              <FaDiscord className=\"h-4 w-4\" />\r\n              Discord\r\n            </Link>\r\n          </DropdownMenuItem>\r\n        </DropdownMenuContent>\r\n      </DropdownMenu>\r\n      <RenameProjectDialog\r\n        isOpen={isRenameDialogOpen}\r\n        onOpenChange={setIsRenameDialogOpen}\r\n        onConfirm={handleNameSave}\r\n        projectName={activeProject?.name || \"\"}\r\n      />\r\n      <DeleteProjectDialog\r\n        isOpen={isDeleteDialogOpen}\r\n        onOpenChange={setIsDeleteDialogOpen}\r\n        onConfirm={handleDelete}\r\n        projectName={activeProject?.name || \"\"}\r\n      />\r\n    </div>\r\n  );\r\n\r\n  const centerContent = (\r\n    <div className=\"flex items-center gap-2 text-xs\">\r\n      <span className=\"text-foreground tabular-nums\">\r\n        {formatTimeCode(currentTime, \"HH:MM:SS:FF\", activeProject?.fps || 30)}\r\n      </span>\r\n      <span className=\"text-foreground/50\">/</span>\r\n      <span className=\"text-foreground/50 tabular-nums\">\r\n        {formatTimeCode(\r\n          getTotalDuration(),\r\n          \"HH:MM:SS:FF\",\r\n          activeProject?.fps || 30\r\n        )}\r\n      </span>\r\n    </div>\r\n  );\r\n\r\n  const rightContent = (\r\n    <nav className=\"flex items-center gap-2\">\r\n      <PanelPresetSelector />\r\n      <KeyboardShortcutsHelp />\r\n      <ExportButton />\r\n      <Button\r\n        size=\"icon\"\r\n        variant=\"text\"\r\n        className=\"h-7\"\r\n        onClick={() => setTheme(theme === \"dark\" ? \"light\" : \"dark\")}\r\n      >\r\n        <Sun className=\"!size-[1.1rem]\" />\r\n        <span className=\"sr-only\">{theme === \"dark\" ? \"Light\" : \"Dark\"}</span>\r\n      </Button>\r\n    </nav>\r\n  );\r\n\r\n  return (\r\n    <HeaderBase\r\n      leftContent={leftContent}\r\n      centerContent={centerContent}\r\n      rightContent={rightContent}\r\n      className=\"bg-background h-[3.2rem] px-3 items-center mt-0.5\"\r\n    />\r\n  );\r\n}\r\n\r\nfunction ExportButton() {\r\n  const handleExport = () => {\r\n    // TODO: Implement export functionality\r\n    // NOTE: This is already being worked on\r\n    console.log(\"Export project\");\r\n    window.open(\"https://youtube.com/watch?v=dQw4w9WgXcQ\", \"_blank\");\r\n  };\r\n\r\n  return (\r\n    <button\r\n      className=\"flex items-center gap-1.5 bg-[#38BDF8] text-white rounded-md px-[0.1rem] py-[0.1rem] cursor-pointer hover:brightness-95 transition-all duration-200\"\r\n      onClick={handleExport}\r\n    >\r\n            <div className=\"flex items-center gap-1.5 bg-linear-270 from-[#2567EC] to-[#37B6F7] rounded-[0.8rem] px-4 py-1 relative shadow-[0_1px_3px_0px_rgba(0,0,0,0.45)]\">\r\n        <TransitionUpIcon className=\"z-50\" />\r\n        <span className=\"text-[0.875rem] z-50\">Export</span>\r\n        <div className=\"absolute w-full h-full left-0 top-0 bg-linear-to-t from-white/0 to-white/50 z-10 rounded-[0.8rem] flex items-center justify-center\">\r\n          <div className=\"absolute w-[calc(100%-4px)] h-[calc(100%-4px)] top-[0.12rem] bg-linear-270 from-[#2567EC] to-[#37B6F7] z-50 rounded-lg\"></div>\r\n        </div>\r\n      </div>\r\n    </button>\r\n  );\r\n}\r\n"],"names":["formatTimeCode","timeInSeconds","format","fps","hours","Math","floor","minutes","seconds","centiseconds","frames","toString","padStart","timeCode","cleanTimeCode","trim","parts","split","length","map","parseInt","part","isNaN","AudioWaveform","audioUrl","height","className","waveformRef","useRef","wavesurfer","isLoading","setIsLoading","useState","error","setError","useEffect","mounted","ws","current","initWaveSurfer","newWaveSurfer","WaveSurfer","create","container","waveColor","progressColor","cursorColor","barWidth","barGap","normalize","interact","destroy","e","on","load","err","requestAnimationFrame","wsToDestroy","div","style","span","ref","TimelineElement","element","track","zoomLevel","isSelected","onElementMouseDown","onElementClick","mediaItems","useMediaStore","updateElementTrim","updateElementDuration","removeElementFromTrack","removeElementFromTrackWithRipple","dragState","splitElement","addElementToTrack","replaceElementMedia","rippleEditingEnabled","toggleElementHidden","useTimelineStore","currentTime","usePlaybackStore","mediaItem","type","find","item","id","mediaId","isAudio","resizing","handleResizeStart","handleResizeMove","handleResizeEnd","useTimelineElementResize","onUpdateTrim","onUpdateDuration","setResizing","updateElementStartTime","pushHistory","handleDocumentMouseMove","updateTrimFromMouseMove","clientX","handleDocumentMouseUp","document","addEventListener","removeEventListener","canExtendElementDuration","projectStore","deltaTime","deltaX","startX","projectFps","useProjectStore","getState","activeProject","side","maxAllowed","duration","initialTrimEnd","calculated","initialTrimStart","newTrimStart","snapTimeToFrame","min","trimDelta","newStartTime","startTime","actualExtension","abs","maxExtension","newDuration","extensionNeeded","newTrimEnd","currentEndTime","trimStart","trimEnd","snappedEndTime","max","finalTrimEnd","isResizing","elementId","stopPropagation","preventDefault","effectiveDuration","elementWidth","TIMELINE_CONSTANTS","ELEMENT_MIN_WIDTH","PIXELS_PER_SECOND","isBeingDragged","elementLeft","isDragging","ContextMenu","ContextMenuTrigger","asChild","left","width","data-element-id","data-track-id","onMouseMove","undefined","onMouseUp","onMouseLeave","getTrackElementClasses","hidden","onClick","onMouseDown","handleElementMouseDown","onContextMenu","renderElementContent","content","name","thumbnailUrl","trackHeight","getTrackHeight","tileWidth","tileHeight","imageUrl","TILE_ASPECT_RATIO","url","isImage","backgroundImage","backgroundRepeat","backgroundSize","backgroundPosition","pointerEvents","aria-label","VolumeX","EyeOff","ContextMenuContent","ContextMenuItem","handleElementSplitContext","effectiveStart","effectiveEnd","secondElementId","toast","Scissors","handleToggleElementHidden","Volume2","Eye","handleElementDuplicateContext","elementWithoutId","Copy","handleReplaceClip","input","createElement","accept","onchange","file","target","files","result","success","Error","message","click","RefreshCw","ContextMenuSeparator","handleElementDeleteContext","Trash2","TimelineTrackContent","onSnapPointChange","tracks","addTrack","moveElementToTrack","updateElementStartTimeWithRipple","selectedElements","selectElement","startDrag","startDragAction","updateDragTime","endDrag","endDragAction","clearSelectedElements","insertTrackAt","snappingEnabled","snapElementPosition","snapElementEdge","useTimelineSnapping","snapThreshold","enableElementSnapping","enablePlayheadSnapping","findSnapPoints","useCallback","playheadTime","excludeElementId","snapPoints","forEach","elements","elementStart","elementEnd","push","time","trackId","snapToNearestPoint","targetTime","thresholdInSeconds","pixelsPerSecond","closestSnapPoint","closestDistance","Infinity","snapPoint","distance","snappedTime","snapDistance","elementDuration","snapToStart","snapResult","effectiveTargetTime","getDropSnappedTime","dropTime","finalTime","startSnapResult","endSnapResult","bestSnapResult","timelineRef","isDropping","setIsDropping","dropPosition","setDropPosition","wouldOverlap","setWouldOverlap","dragCounterRef","mouseDownLocation","setMouseDownLocation","handleMouseMove","some","c","timelineRect","getBoundingClientRect","adjustedTime","mouseX","clickOffsetTime","sourceTrack","t","handleMouseUp","isTrackThatStartedDrag","isMouseOverThisTrack","clientY","top","bottom","movingElement","movingElementEnd","movingElementDuration","targetTrack","existingElement","existingStart","existingEnd","x","y","isRightClick","button","isMultiSelect","metaKey","ctrlKey","shiftKey","elementRect","elementElement","currentTarget","handleElementClick","deltaY","closest","onDragOver","handleTrackDragOver","hasTimelineElement","dataTransfer","types","includes","hasMediaItem","trackContainer","querySelector","rect","mediaItemData","getData","dragData","JSON","parse","newElementEnd","newElementDuration","timelineElementData","fromTrackId","dropEffect","onDragEnter","handleTrackDragEnter","onDragLeave","handleTrackDragLeave","onDrop","handleTrackDrop","hasFiles","mouseY","currentTrackIndex","findIndex","adjustedStartTime","snappedStartTime","finalStartTime","hasOverlap","targetTrackId","insertIndex","mainTrack","getMainTrack","newTargetTrack","textSnappedTime","DEFAULT_TEXT_DURATION","fontSize","fontFamily","color","backgroundColor","textAlign","fontWeight","fontStyle","textDecoration","rotation","opacity","isVideoOrImage","isCompatible","canElementGoOnTrack","updatedTracks","mainTrackIndex","mediaSnappedTime","addMediaItem","processMediaFiles","then","processedItems","processedItem","addedItem","trackType","catch","useTimelinePlayhead","seek","rulerRef","rulerScrollRef","tracksScrollRef","playheadRef","isScrubbing","setIsScrubbing","scrubTime","setScrubTime","isDraggingRuler","setIsDraggingRuler","hasDraggedRuler","setHasDraggedRuler","autoScrollRef","lastMouseXRef","playheadPosition","handlePlayheadMouseDown","handleScrub","handleRulerMouseDown","contains","ruler","rawX","rawTime","performAutoScroll","rulerViewport","tracksViewport","viewportRect","mouseXRelative","viewportWidth","clientWidth","scrollMax","timelineContentWidth","scrollSpeed","scrollLeft","edgeThreshold","maxScrollSpeed","intensity","edgeDistance","newScrollLeft","cancelAnimationFrame","window","isPlaying","playheadPx","scrollWidth","desiredScroll","scrollMin","TimelinePlayhead","trackLabelsRef","externalPlayheadRef","isSnappingToPlayhead","internalPlayheadRef","setScrollLeft","handleScroll","timelineContainerHeight","offsetHeight","trackLabelsWidth","offsetWidth","rawLeftPosition","timelinePosition","rightBoundary","leftPosition","leftBoundary","totalHeight","SelectionBox","startPos","currentPos","containerRef","isActive","selectionBoxRef","containerRect","startY","currentX","currentY","SnapIndicator","isVisible","Timeline","getTotalDuration","setSelectedElements","toggleTrackMute","setDuration","toggle","isDragOver","setIsDragOver","isProcessing","setIsProcessing","progress","setProgress","isInTimeline","setIsInTimeline","mouseTrackingRef","isMouseDown","downX","downY","downTime","setZoomLevel","handleWheel","useTimelineZoom","delta","prev","preventZoom","passive","dynamicTimelineWidth","trackLabelsScrollRef","isUpdatingRef","lastRulerSync","lastTracksSync","lastVerticalSync","useTimelinePlayheadRuler","tracksContainerRef","selectionBox","handleMouseDown","handleSelectionMouseDown","isSelecting","justFinishedSelecting","useSelectionBox","onSelectionComplete","isEnabled","setSelectionBox","setJustFinishedSelecting","selectElementsInBox","endPos","timelineElements","querySelectorAll","elementAbsolute","right","selectionAbsolute","normalizedSelection","getAttribute","newSelectionBox","setTimeout","currentSnapPoint","setCurrentSnapPoint","showSnapIndicator","handleSnapPointChange","handleTimelineMouseDown","timeStamp","handleTimelineContentClick","isRulerClick","rulerContent","tracksContent","handleDrop","itemData","addTextToNewTrack","addMediaToNewTrack","p","currentMediaItems","trackLabelsViewport","handleRulerScroll","now","Date","handleTracksScroll","handleTrackLabelsScroll","scrollTop","handleTracksVerticalScroll","handleDragEnter","handleDragOver","handleDragLeave","onMouseEnter","dragProps","TimelineToolbar","onWheel","data-ruler-area","ScrollArea","interval","getTimeInterval","zoom","Array","from","markerCount","ceil","_","i","isMainMarker","secs","toFixed","filter","Boolean","bookmarks","bookmarkTime","Bookmark","data-track-labels","muted","MicOff","Mic","TrackIcon","getTotalTracksHeight","index","getCumulativeHeightBefore","Video","TypeIcon","Music","splitAndKeepLeft","splitAndKeepRight","separateAudio","toggleSnapping","toggleRippleEditing","toggleBookmark","isBookmarked","handleToggleBookmark","currentBookmarked","TooltipProvider","delayDuration","Tooltip","TooltipTrigger","Button","variant","size","Pause","Play","TooltipContent","minWidth","handleSplitSelected","splitCount","handleSplitAndKeepLeft","ArrowLeftToLine","handleSplitAndKeepRight","ArrowRightToLine","handleSeparateAudio","SplitSquareHorizontal","handleDuplicateSelected","el","handleFreezeSelected","info","Snowflake","handleDeleteSelected","Magnet","Link","handleZoomOut","ZoomOut","Slider","value","onValueChange","handleZoomSliderChange","values","step","handleZoomIn","ZoomIn","ActionEmitter","subscribe","listener","listeners","l","emit","actions","actionEmitter","boundActions","updateActiveActions","newActions","Object","keys","bindAction","action","handler","unbindAction","useActionHandler","handlerRef","isBound","setIsBound","stableHandler","args","trigger","shouldBind","setInterval","clearInterval","EditorProvider","children","isInitializing","isPanelsReady","initializeApp","useEditorStore","disableKeybindings","enableKeybindings","useKeybindingDisabler","useKeybindingsStore","undo","redo","flatMap","allElements","keybindings","getKeybindingString","keybindingsEnabled","isRecording","handleKeyDown","actionArgs","ev","binding","boundAction","activeElement","isTextInput","tagName","isContentEditable","Loader2","PRESET_CONFIGS","default","toolsPanel","previewPanel","propertiesPanel","mainContent","timeline","media","inspector","persist","set","get","activePreset","presetCustomSizes","resetCounter","mediaViewMode","setToolsPanel","setPreviewPanel","setPropertiesPanel","setMainContent","setTimeline","setMediaViewMode","mode","setActivePreset","currentPreset","updatedPresetCustomSizes","defaultSizes","preset","customSizes","resetPreset","updates","assign","getCurrentPresetSizes","defaultKeybindings","space","j","k","home","end","s","n","delete","backspace","isCustomized","updateKeybinding","key","newKeybindings","state","removeKeybinding","resetToDefaults","importKeybindings","entries","config","exportKeybindings","validateKeybinding","existingAction","newAction","setIsRecording","getKeybindingsForAction","generateKeybindingString","modifierKey","getActiveModifier","modifierKeys","ctrl","isAppleDevice","alt","altKey","shift","activeModifier","join","toLowerCase","code","startsWith","slice","letter","digit","isDOMElement","isTypableElement","version","React","props","SliderPrimitive","cn","displayName","HeaderBase","leftContent","centerContent","rightContent","header","tabs","icon","VideoIcon","label","sounds","MusicIcon","text","stickers","StickerIcon","effects","SparklesIcon","transitions","ArrowLeftRightIcon","captions","CaptionsIcon","filters","BlendIcon","adjustment","SlidersHorizontalIcon","settings","SettingsIcon","activeTab","setActiveTab","tab","TabBar","useMediaPanelStore","tabKey","align","sideOffset","containsFiles","MediaDragOverlay","isEmptyState","handleClick","Upload","AspectRatio","AspectRatioPrimitive","DraggableMediaItem","preview","onDragStart","onAddToTimeline","aspectRatio","showPlusOnDrag","showLabel","rounded","setIsDragging","dragPosition","setDragPosition","dragRef","handleAddToTimeline","emptyImg","Image","src","handleDragStart","setDragImage","setData","stringify","effectAllowed","handleDragEnd","ratio","draggable","onDragEnd","PlusButton","title","createPortal","tooltipText","body","Plus","MediaItemWithContextMenu","onRemove","MediaView","removeMediaItem","usePanelStore","fileInputRef","searchQuery","setSearchQuery","mediaFilter","setMediaFilter","sortBy","setSortBy","sortOrder","setSortOrder","processFiles","useDragDrop","options","handleFileSelect","handleRemove","formatDuration","sec","filteredMediaItems","setFilteredMediaItems","filtered","sort","a","b","valueA","valueB","previewComponents","useMemo","previews","Map","img","loading","renderPreview","multiple","onChange","handleFileChange","disabled","CloudUpload","List","strokeWidth","Grid2X2","DropdownMenu","DropdownMenuTrigger","ArrowDown01","DropdownMenuContent","DropdownMenuItem","GridView","ListView","gridTemplateColumns","addMediaAtTime","Tabs","TabsPrimitive","TabsList","TabsTrigger","TabsContent","ViewContent","BaseView","defaultTab","defaultValue","Separator","textData","TextView","addTextAtTime","useSoundsStore","hasLoaded","showCommercialOnly","toggleCommercialFilter","searchResults","isSearching","searchError","lastSearchQuery","scrollPosition","currentPage","hasNextPage","totalCount","isLoadingMore","savedSounds","isSavedSoundsLoaded","isLoadingSavedSounds","savedSoundsError","setTopSoundEffects","topSoundEffects","setLoading","setHasLoaded","loaded","query","setSearchResults","results","setSearching","searching","setSearchError","setLastSearchQuery","setScrollPosition","position","setCurrentPage","page","setHasNextPage","hasNext","setTotalCount","count","setLoadingMore","appendSearchResults","appendTopSounds","resetPagination","loadSavedSounds","savedSoundsData","storageService","errorMessage","saveSoundEffect","soundEffect","removeSavedSound","soundId","sound","isSoundSaved","toggleSavedSound","clearSavedSounds","addSoundToTimeline","previewUrl","response","fetch","ok","statusText","blob","File","URL","createObjectURL","SoundsView","SoundEffectsView","SavedSoundsView","SongsView","loadMore","useSoundSearch","commercialOnly","nextPage","searchParams","URLSearchParams","data","json","next","status","ignore","timeoutId","encodeURIComponent","clearTimeout","playingId","setPlayingId","audioElement","setAudioElement","scrollAreaRef","scrollTo","displayedSounds","Input","placeholder","containerClassName","showClearIcon","onClear","ListFilter","DropdownMenuCheckboxItem","checked","onCheckedChange","onScrollCapture","scrollHeight","clientHeight","event","AudioItem","onPlay","playSound","pause","audio","Audio","play","isSaved","onToggleSaved","showClearDialog","setShowClearDialog","convertToSoundEffect","savedSound","description","downloadUrl","filesize","channels","bitrate","bitdepth","samplerate","username","tags","license","created","savedAt","downloads","rating","ratingCount","HeartIcon","Dialog","open","onOpenChange","DialogTrigger","DialogContent","DialogHeader","DialogTitle","DialogDescription","DialogFooter","PauseIcon","PlayIcon","PlusIcon","handleSaveClick","colors","syntaxUIGradients","SettingsView","ProjectSettingsTabs","ProjectInfoView","BackgroundView","updateProjectFps","updateCanvasSize","canvasPresets","getDisplayName","useAspectRatio","canvasSize","DEFAULT_CANVAS_SIZE","canvasMode","getCurrentAspectRatio","formatAspectRatio","isOriginal","getOriginalAspectRatio","getMediaAspectRatio","PropertyItem","direction","PropertyItemLabel","PropertyItemValue","Select","handleAspectRatioChange","SelectTrigger","SelectValue","SelectContent","SelectItem","handleFpsChange","parseFloat","FPS_PRESETS","BlurPreview","memo","blur","onSelect","fill","BackgroundPreviews","backgrounds","currentBackgroundColor","isColorBackground","handleColorSelect","useBackgroundColor","bg","background","updateBackgroundType","blurLevels","handleBlurSelect","blurIntensity","currentBlurIntensity","isBlurBackground","backgroundType","blurPreviews","PropertyGroup","defaultExpanded","PipetteIcon","patternCraftGradients","FlagPreloader","languages","ReactCountryFlag","countryCode","language","svg","LanguageSelect","selectedCountry","expanded","setExpanded","isTapping","setIsTapping","isClosing","setIsClosing","collapsedHeight","buttonRef","handleClickOutside","selectedLanguage","lang","handleSelect","motion","initial","scale","animate","expandHeight","transition","ease","expand","focus","LanguageButton","Globe","ChevronDown","encryptWithRandomKey","crypto","getRandomValues","Uint8Array","iv","cryptoKey","subtle","importKey","encryptedData","encryptedResult","encrypt","buffer","arrayBufferToBase64","bytes","binary","byteLength","String","fromCharCode","btoa","Captions","setSelectedCountry","processingStep","setProcessingStep","showPrivacyDialog","setShowPrivacyDialog","hasAcceptedPrivacy","setHasAcceptedPrivacy","localStorage","hasAccepted","getItem","PRIVACY_DIALOG_KEY","handleGenerateTranscript","audioBlob","extractTimelineAudio","audioBuffer","arrayBuffer","encryptionResult","encryptedBlob","Blob","uploadResponse","method","headers","fileExtension","uploadUrl","fileName","transcriptionResponse","filename","decryptionKey","segments","shortCaptions","globalEndTime","words","segment","segmentDuration","start","wordsPerSecond","chunks","chunkStartTime","chunkWords","chunk","chunkDuration","captionTrackId","caption","Shield","strong","setItem","MediaPanel","viewMap","orientation","AudioProperties","MediaProperties","Textarea","textarea","FONT_OPTIONS","category","hasClassName","weights","FontPicker","font","TextProperties","updateTextElement","fontSizeInput","setFontSizeInput","opacityInput","setOpacityInput","round","parseAndValidateNumber","fallback","parsed","handleFontSizeChange","onBlur","handleFontSizeBlur","handleOpacityChange","opacityPercent","handleOpacityBlur","PropertiesPanel","EmptyView","SquareSlashIcon","isExpanded","setIsExpanded","TooltipPrimitive","tooltipVariants","cva","variants","destructive","outline","important","promotions","personal","forums","sidebar","defaultVariants","viewBox","xmlns","path","d","onProgress","fileArray","total","completed","fileType","getFileType","dimensions","getImageDimensions","videoInfo","getVideoInfo","generateThumbnail","videoResult","generateVideoThumbnail","getMediaDuration","Promise","resolve","percent","revokeObjectURL","decorative","SeparatorPrimitive","ResizablePanelGroup","ResizablePrimitive","ResizablePanel","ResizableHandle","withHandle","ffmpeg","initFFmpeg","FFmpeg","baseURL","basePath","coreURL","toBlobURL","wasmURL","videoFile","inputName","outputName","writeFile","exec","readFile","deleteFile","ffmpegOutput","listening","durationMatch","match","h","m","videoStreamMatch","mediaStore","totalDuration","ArrayBuffer","audioElements","trackMuted","silentDuration","generateSilentAudio","inputFiles","filterInputs","pop","actualStart","actualDuration","filterName","mixFilter","complexFilter","ffmpegArgs","inputFile","cleanupError","durationSeconds","PLATFORM_LAYOUTS","tiktok","DEFAULT_CANVAS_PRESETS","layoutGuide","platform","setInitializing","setPanelsReady","ready","setLayoutGuide","toggleLayoutGuide","partialize","VercelIcon","SocialsIcon","g","stroke","fillRule","clipRule","TransitionUpIcon","playbackTimer","volume","previousVolume","speed","actualContentDuration","endThreshold","frameOffset","startTimer","store","updateTime","performance","lastUpdate","newTime","stopTime","setCurrentTime","dispatchEvent","CustomEvent","detail","clampedTime","setVolume","setSpeed","newSpeed","mute","unmute","toggleMute","ContextMenuPrimitive","contextMenuItemVariants","ContextMenuSubTrigger","inset","ChevronRight","Check","ContextMenuRadioItem","Circle","VideoPlayer","poster","clipStartTime","clipDuration","videoRef","clipEndTime","isInClipRange","video","handleSeekEvent","videoTime","timelineTime","handleUpdateEvent","handleSpeed","playbackRate","playsInline","preload","controls","disablePictureInPicture","disableRemotePlayback","AudioPlayer","audioRef","audioTime","display","EditableTimecode","onTimeChange","isEditing","setIsEditing","inputValue","setInputValue","hasError","setHasError","inputRef","enterPressedRef","formattedTime","applyEdit","parsedTime","parseTimeCode","select","handleInputChange","onKeyDown","handleBlur","startEditing","FONT_CLASS_MAP","Inter","inter","Roboto","roboto","openSans","playfairDisplay","comicNeue","Arial","Helvetica","Georgia","Popover","PopoverPrimitive","PopoverTrigger","PopoverContent","TikTokGuide","LayoutGuideOverlay","labelVariants","Label","LabelPrimitive","PreviewPanel","previewRef","previewDimensions","setPreviewDimensions","setDragState","initialElementX","initialElementY","elementHeight","updatePreviewSize","availableWidth","availableHeight","innerWidth","marginSpace","innerHeight","controlsHeight","computedStyle","getComputedStyle","paddingTop","paddingBottom","paddingLeft","paddingRight","gap","toolbar","toolbarHeight","targetRatio","resizeObserver","ResizeObserver","observe","disconnect","handleEscapeKey","overflow","scaleRatio","newX","newY","halfWidth","halfHeight","constrainedX","constrainedY","cursor","userSelect","toggleExpanded","hasAnyElements","activeElements","getActiveElements","reverse","blurBackgroundElements","getBlurBackgroundElements","renderBlurBackground","transform","transformOrigin","renderElement","elementData","fontClassName","handleTextMouseDown","zIndex","padding","borderRadius","whiteSpace","PreviewToolbar","onToggleExpanded","FullscreenPreview","FullscreenToolbar","data-toolbar","skipBackward","SkipBack","skipForward","SkipForward","handleTimelineClick","clickX","handleTimelineDrag","moveEvent","percentage","dragX","nativeEvent","Expand","h4","Checkbox","htmlFor","Onboarding","setStep","isOpen","setIsOpen","hasSeenOnboarding","handleNext","handleClose","getStepTitle","renderStepContent","Title","Description","NextButton","h2","ReactMarkdown","components","href","rel","ArrowRightIcon","usePlaybackControls","actionDescriptions","ShortcutItem","shortcut","onStartRecording","displayKeys","replace","keyPart","partIndex","keyId","EditableShortcutKey","KeyboardShortcutsHelp","setOpen","recordingShortcut","setRecordingShortcut","shortcuts","useKeyboardShortcutsHelp","actionToKeys","getPlatformSpecialKey","getPlatformAlternateKey","actionInfo","localeCompare","categories","Set","keyString","conflict","handleStartRecording","Keyboard","h3","PRESET_LABELS","PRESET_DESCRIPTIONS","PanelPresetSelector","LayoutPanelTop","DropdownMenuSeparator","handlePresetChange","RotateCcw","EditorHeader","renameProject","deleteProject","isDeleteDialogOpen","setIsDeleteDialogOpen","isRenameDialogOpen","setIsRenameDialogOpen","useRouter","theme","setTheme","useTheme","handleNameSave","newName","navigateToProjects","ArrowLeft","SquarePen","Trash","FaDiscord","RenameProjectDialog","onConfirm","projectName","DeleteProjectDialog","handleDelete","nav","ExportButton","Sun","handleExport"],"sourceRoot":"","ignoreList":[]}