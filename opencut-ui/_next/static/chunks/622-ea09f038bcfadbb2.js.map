{"version":3,"file":"static/chunks/622-ea09f038bcfadbb2.js","mappings":"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AAAA,CAASA,CAAAA,CAACt0C,UAAW,WAAyC,OAA9BkzC,EAAU,eAAiB,aAKtE,qDEnfO,IAAMyB,GAAS,CACpB,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UAC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","sources":["webpack://_N_E/./src/components/ui/video-player.tsx","webpack://_N_E/./src/components/ui/audio-player.tsx","webpack://_N_E/./src/components/ui/editable-timecode.tsx","webpack://_N_E/./src/lib/font-config.ts","webpack://_N_E/./src/components/editor/preview-panel.tsx","webpack://_N_E/./src/lib/time.ts","webpack://_N_E/./src/hooks/use-timeline-zoom.ts","webpack://_N_E/./src/components/editor/audio-waveform.tsx","webpack://_N_E/./src/hooks/use-timeline-element-resize.ts","webpack://_N_E/./src/components/editor/timeline/timeline-element.tsx","webpack://_N_E/./src/hooks/use-timeline-snapping.ts","webpack://_N_E/./src/components/editor/timeline/timeline-track.tsx","webpack://_N_E/./src/hooks/use-timeline-playhead.ts","webpack://_N_E/./src/components/editor/timeline/timeline-playhead.tsx","webpack://_N_E/./src/components/editor/selection-box.tsx","webpack://_N_E/./src/hooks/use-selection-box.ts","webpack://_N_E/./src/components/editor/snap-indicator.tsx","webpack://_N_E/./src/components/editor/timeline/index.tsx","webpack://_N_E/./src/constants/actions.ts","webpack://_N_E/./src/hooks/use-keybindings.ts","webpack://_N_E/./src/hooks/use-editor-actions.ts","webpack://_N_E/./src/components/editor-provider.tsx","webpack://_N_E/./src/stores/panel-store.ts","webpack://_N_E/./src/stores/keybindings-store.ts","webpack://_N_E/./src/components/ui/slider.tsx","webpack://_N_E/./src/components/header-base.tsx","webpack://_N_E/./src/hooks/use-keyboard-shortcuts-help.ts","webpack://_N_E/./src/components/keyboard-shortcuts-help.tsx","webpack://_N_E/./src/components/editor-header.tsx","webpack://_N_E/./src/components/editor/properties-panel/audio-properties.tsx","webpack://_N_E/./src/components/editor/properties-panel/media-properties.tsx","webpack://_N_E/./src/components/ui/textarea.tsx","webpack://_N_E/./src/constants/font-constants.ts","webpack://_N_E/./src/components/ui/font-picker.tsx","webpack://_N_E/./src/components/editor/properties-panel/text-properties.tsx","webpack://_N_E/./src/components/editor/properties-panel/index.tsx","webpack://_N_E/./src/components/editor/properties-panel/property-item.tsx","webpack://_N_E/./src/lib/ffmpeg-utils.ts","webpack://_N_E/./src/lib/media-processing.ts","webpack://_N_E/./src/components/ui/tooltip.tsx","webpack://_N_E/./src/components/ui/separator.tsx","webpack://_N_E/./src/components/ui/resizable.tsx","webpack://_N_E/./src/stores/playback-store.ts","webpack://_N_E/./src/components/editor/media-panel/store.ts","webpack://_N_E/./src/components/editor/media-panel/tabbar.tsx","webpack://_N_E/./src/hooks/use-drag-drop.ts","webpack://_N_E/./src/components/editor/media-panel/drag-overlay.tsx","webpack://_N_E/./src/components/ui/aspect-ratio.tsx","webpack://_N_E/./src/components/ui/draggable-item.tsx","webpack://_N_E/./src/components/editor/media-panel/views/media.tsx","webpack://_N_E/./src/components/editor/media-panel/views/text.tsx","webpack://_N_E/./src/components/ui/tabs.tsx","webpack://_N_E/./src/stores/sounds-store.ts","webpack://_N_E/./src/hooks/use-sound-search.ts","webpack://_N_E/./src/components/editor/media-panel/views/sounds.tsx","webpack://_N_E/./src/hooks/use-aspect-ratio.ts","webpack://_N_E/./src/data/colors/solid.ts","webpack://_N_E/./src/data/colors/pattern-craft.ts","webpack://_N_E/./src/data/colors/syntax-ui.tsx","webpack://_N_E/./src/components/editor/media-panel/views/settings.tsx","webpack://_N_E/./src/components/editor/media-panel/index.tsx","webpack://_N_E/./src/components/ui/context-menu.tsx","webpack://_N_E/./src/components/onboarding.tsx","webpack://_N_E/./src/hooks/use-playback-controls.ts"],"sourcesContent":["\"use client\";\r\n\r\nimport { useRef, useEffect } from \"react\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\n\r\ninterface VideoPlayerProps {\r\n  src: string;\r\n  poster?: string;\r\n  className?: string;\r\n  clipStartTime: number;\r\n  trimStart: number;\r\n  trimEnd: number;\r\n  clipDuration: number;\r\n}\r\n\r\nexport function VideoPlayer({\r\n  src,\r\n  poster,\r\n  className = \"\",\r\n  clipStartTime,\r\n  trimStart,\r\n  trimEnd,\r\n  clipDuration,\r\n}: VideoPlayerProps) {\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const { isPlaying, currentTime, volume, speed, muted } = usePlaybackStore();\r\n\r\n  // Calculate if we're within this clip's timeline range\r\n  const clipEndTime = clipStartTime + (clipDuration - trimStart - trimEnd);\r\n  const isInClipRange =\r\n    currentTime >= clipStartTime && currentTime < clipEndTime;\r\n\r\n  // Sync playback events\r\n  useEffect(() => {\r\n    const video = videoRef.current;\r\n    if (!video || !isInClipRange) return;\r\n\r\n    const handleSeekEvent = (e: CustomEvent) => {\r\n      // Always update video time, even if outside clip range\r\n      const timelineTime = e.detail.time;\r\n      const videoTime = Math.max(\r\n        trimStart,\r\n        Math.min(\r\n          clipDuration - trimEnd,\r\n          timelineTime - clipStartTime + trimStart\r\n        )\r\n      );\r\n      video.currentTime = videoTime;\r\n    };\r\n\r\n    const handleUpdateEvent = (e: CustomEvent) => {\r\n      // Always update video time, even if outside clip range\r\n      const timelineTime = e.detail.time;\r\n      const targetTime = Math.max(\r\n        trimStart,\r\n        Math.min(\r\n          clipDuration - trimEnd,\r\n          timelineTime - clipStartTime + trimStart\r\n        )\r\n      );\r\n\r\n      if (Math.abs(video.currentTime - targetTime) > 0.5) {\r\n        video.currentTime = targetTime;\r\n      }\r\n    };\r\n\r\n    const handleSpeed = (e: CustomEvent) => {\r\n      video.playbackRate = e.detail.speed;\r\n    };\r\n\r\n    window.addEventListener(\"playback-seek\", handleSeekEvent as EventListener);\r\n    window.addEventListener(\r\n      \"playback-update\",\r\n      handleUpdateEvent as EventListener\r\n    );\r\n    window.addEventListener(\"playback-speed\", handleSpeed as EventListener);\r\n\r\n    return () => {\r\n      window.removeEventListener(\r\n        \"playback-seek\",\r\n        handleSeekEvent as EventListener\r\n      );\r\n      window.removeEventListener(\r\n        \"playback-update\",\r\n        handleUpdateEvent as EventListener\r\n      );\r\n      window.removeEventListener(\r\n        \"playback-speed\",\r\n        handleSpeed as EventListener\r\n      );\r\n    };\r\n  }, [clipStartTime, trimStart, trimEnd, clipDuration, isInClipRange]);\r\n\r\n  // Sync playback state\r\n  useEffect(() => {\r\n    const video = videoRef.current;\r\n    if (!video) return;\r\n\r\n    if (isPlaying && isInClipRange) {\r\n      video.play().catch(() => {});\r\n    } else {\r\n      video.pause();\r\n    }\r\n  }, [isPlaying, isInClipRange]);\r\n\r\n  // Sync volume and speed\r\n  useEffect(() => {\r\n    const video = videoRef.current;\r\n    if (!video) return;\r\n\r\n    video.volume = volume;\r\n    video.muted = muted;\r\n    video.playbackRate = speed;\r\n  }, [volume, speed, muted]);\r\n\r\n  return (\r\n    <video\r\n      ref={videoRef}\r\n      src={src}\r\n      poster={poster}\r\n      className={`max-w-full max-h-full object-contain ${className}`}\r\n      playsInline\r\n      preload=\"auto\"\r\n      controls={false}\r\n      disablePictureInPicture\r\n      disableRemotePlayback\r\n      style={{ pointerEvents: \"none\" }}\r\n      onContextMenu={(e) => e.preventDefault()}\r\n    />\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { useRef, useEffect } from \"react\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\n\r\ninterface AudioPlayerProps {\r\n  src: string;\r\n  className?: string;\r\n  clipStartTime: number;\r\n  trimStart: number;\r\n  trimEnd: number;\r\n  clipDuration: number;\r\n  trackMuted?: boolean;\r\n}\r\n\r\nexport function AudioPlayer({\r\n  src,\r\n  className = \"\",\r\n  clipStartTime,\r\n  trimStart,\r\n  trimEnd,\r\n  clipDuration,\r\n  trackMuted = false,\r\n}: AudioPlayerProps) {\r\n  const audioRef = useRef<HTMLAudioElement>(null);\r\n  const { isPlaying, currentTime, volume, speed, muted } = usePlaybackStore();\r\n\r\n  // Calculate if we're within this clip's timeline range\r\n  const clipEndTime = clipStartTime + (clipDuration - trimStart - trimEnd);\r\n  const isInClipRange =\r\n    currentTime >= clipStartTime && currentTime < clipEndTime;\r\n\r\n  // Sync playback events\r\n  useEffect(() => {\r\n    const audio = audioRef.current;\r\n    if (!audio || !isInClipRange) return;\r\n\r\n    const handleSeekEvent = (e: CustomEvent) => {\r\n      // Always update audio time, even if outside clip range\r\n      const timelineTime = e.detail.time;\r\n      const audioTime = Math.max(\r\n        trimStart,\r\n        Math.min(\r\n          clipDuration - trimEnd,\r\n          timelineTime - clipStartTime + trimStart\r\n        )\r\n      );\r\n      audio.currentTime = audioTime;\r\n    };\r\n\r\n    const handleUpdateEvent = (e: CustomEvent) => {\r\n      // Always update audio time, even if outside clip range\r\n      const timelineTime = e.detail.time;\r\n      const targetTime = Math.max(\r\n        trimStart,\r\n        Math.min(\r\n          clipDuration - trimEnd,\r\n          timelineTime - clipStartTime + trimStart\r\n        )\r\n      );\r\n\r\n      if (Math.abs(audio.currentTime - targetTime) > 0.5) {\r\n        audio.currentTime = targetTime;\r\n      }\r\n    };\r\n\r\n    const handleSpeed = (e: CustomEvent) => {\r\n      audio.playbackRate = e.detail.speed;\r\n    };\r\n\r\n    window.addEventListener(\"playback-seek\", handleSeekEvent as EventListener);\r\n    window.addEventListener(\r\n      \"playback-update\",\r\n      handleUpdateEvent as EventListener\r\n    );\r\n    window.addEventListener(\"playback-speed\", handleSpeed as EventListener);\r\n\r\n    return () => {\r\n      window.removeEventListener(\r\n        \"playback-seek\",\r\n        handleSeekEvent as EventListener\r\n      );\r\n      window.removeEventListener(\r\n        \"playback-update\",\r\n        handleUpdateEvent as EventListener\r\n      );\r\n      window.removeEventListener(\r\n        \"playback-speed\",\r\n        handleSpeed as EventListener\r\n      );\r\n    };\r\n  }, [clipStartTime, trimStart, trimEnd, clipDuration, isInClipRange]);\r\n\r\n  // Sync playback state\r\n  useEffect(() => {\r\n    const audio = audioRef.current;\r\n    if (!audio) return;\r\n\r\n    if (isPlaying && isInClipRange && !trackMuted) {\r\n      audio.play().catch(() => {});\r\n    } else {\r\n      audio.pause();\r\n    }\r\n  }, [isPlaying, isInClipRange, trackMuted]);\r\n\r\n  // Sync volume and speed\r\n  useEffect(() => {\r\n    const audio = audioRef.current;\r\n    if (!audio) return;\r\n\r\n    audio.volume = volume;\r\n    audio.muted = muted || trackMuted;\r\n    audio.playbackRate = speed;\r\n  }, [volume, speed, muted, trackMuted]);\r\n\r\n  return (\r\n    <audio\r\n      ref={audioRef}\r\n      src={src}\r\n      className={className}\r\n      preload=\"auto\"\r\n      controls={false}\r\n      style={{ display: \"none\" }} // Audio elements don't need visual representation\r\n      onContextMenu={(e) => e.preventDefault()}\r\n    />\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { useState, useRef, useEffect } from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { formatTimeCode, parseTimeCode } from \"@/lib/time\";\r\n\r\ninterface EditableTimecodeProps {\r\n  time: number;\r\n  duration?: number;\r\n  format?: \"MM:SS\" | \"HH:MM:SS\" | \"HH:MM:SS:CS\" | \"HH:MM:SS:FF\";\r\n  fps?: number;\r\n  onTimeChange?: (time: number) => void;\r\n  className?: string;\r\n  disabled?: boolean;\r\n}\r\n\r\nexport function EditableTimecode({\r\n  time,\r\n  duration,\r\n  format = \"HH:MM:SS:FF\",\r\n  fps = 30,\r\n  onTimeChange,\r\n  className,\r\n  disabled = false,\r\n}: EditableTimecodeProps) {\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [inputValue, setInputValue] = useState(\"\");\r\n  const [hasError, setHasError] = useState(false);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n  const enterPressedRef = useRef(false);\r\n\r\n  const formattedTime = formatTimeCode(time, format, fps);\r\n\r\n  const startEditing = () => {\r\n    if (disabled) return;\r\n    setIsEditing(true);\r\n    setInputValue(formattedTime);\r\n    setHasError(false);\r\n    enterPressedRef.current = false;\r\n  };\r\n\r\n  const cancelEditing = () => {\r\n    setIsEditing(false);\r\n    setInputValue(\"\");\r\n    setHasError(false);\r\n    enterPressedRef.current = false;\r\n  };\r\n\r\n  const applyEdit = () => {\r\n    const parsedTime = parseTimeCode(inputValue, format, fps);\r\n\r\n    if (parsedTime === null) {\r\n      setHasError(true);\r\n      return;\r\n    }\r\n\r\n    // Clamp time to valid range\r\n    const clampedTime = Math.max(\r\n      0,\r\n      duration ? Math.min(duration, parsedTime) : parsedTime\r\n    );\r\n\r\n    onTimeChange?.(clampedTime);\r\n    setIsEditing(false);\r\n    setInputValue(\"\");\r\n    setHasError(false);\r\n    enterPressedRef.current = false;\r\n  };\r\n\r\n  const handleKeyDown = (e: React.KeyboardEvent) => {\r\n    if (e.key === \"Enter\") {\r\n      e.preventDefault();\r\n      enterPressedRef.current = true;\r\n      applyEdit();\r\n    } else if (e.key === \"Escape\") {\r\n      e.preventDefault();\r\n      cancelEditing();\r\n    }\r\n  };\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    setInputValue(e.target.value);\r\n    setHasError(false);\r\n  };\r\n\r\n  const handleBlur = () => {\r\n    // Only apply edit if Enter wasn't pressed (to avoid double processing)\r\n    if (!enterPressedRef.current && isEditing) {\r\n      applyEdit();\r\n    }\r\n  };\r\n\r\n  // Focus input when entering edit mode\r\n  useEffect(() => {\r\n    if (isEditing && inputRef.current) {\r\n      inputRef.current.focus();\r\n      inputRef.current.select();\r\n    }\r\n  }, [isEditing]);\r\n\r\n  if (isEditing) {\r\n    return (\r\n      <input\r\n        ref={inputRef}\r\n        type=\"text\"\r\n        value={inputValue}\r\n        onChange={handleInputChange}\r\n        onKeyDown={handleKeyDown}\r\n        onBlur={handleBlur}\r\n        className={cn(\r\n          \"text-xs font-mono bg-transparent border-none outline-none\",\r\n          \"focus:bg-background focus:border focus:border-primary focus:px-1 focus:rounded\",\r\n          \"tabular-nums text-primary\",\r\n          hasError && \"text-destructive focus:border-destructive\",\r\n          className\r\n        )}\r\n        style={{ width: `${formattedTime.length + 1}ch` }}\r\n        placeholder={formattedTime}\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <span\r\n      onClick={startEditing}\r\n      className={cn(\r\n        \"text-xs font-mono tabular-nums text-primary cursor-pointer\",\r\n        \"hover:bg-muted/50 hover:rounded px-1 -mx-1 transition-colors\",\r\n        disabled && \"cursor-default hover:bg-transparent\",\r\n        className\r\n      )}\r\n      title={disabled ? undefined : \"Click to edit time\"}\r\n    >\r\n      {formattedTime}\r\n    </span>\r\n  );\r\n}\r\n","import {\r\n  Inter,\r\n  Roboto,\r\n  Open_Sans,\r\n  Playfair_Display,\r\n  Comic_Neue,\r\n} from \"next/font/google\";\r\n\r\n// Configure all fonts\r\nconst inter = Inter({ subsets: [\"latin\"] });\r\nconst roboto = Roboto({ subsets: [\"latin\"], weight: [\"400\", \"700\"] });\r\nconst openSans = Open_Sans({ subsets: [\"latin\"] });\r\nconst playfairDisplay = Playfair_Display({ subsets: [\"latin\"] });\r\nconst comicNeue = Comic_Neue({ subsets: [\"latin\"], weight: [\"400\", \"700\"] });\r\n\r\n// Export font class mapping for use in components\r\nexport const FONT_CLASS_MAP = {\r\n  Inter: inter.className,\r\n  Roboto: roboto.className,\r\n  \"Open Sans\": openSans.className,\r\n  \"Playfair Display\": playfairDisplay.className,\r\n  \"Comic Neue\": comicNeue.className,\r\n  Arial: \"\",\r\n  Helvetica: \"\",\r\n  \"Times New Roman\": \"\",\r\n  Georgia: \"\",\r\n} as const;\r\n\r\n// Export individual fonts for use in layout\r\nexport const fonts = {\r\n  inter,\r\n  roboto,\r\n  openSans,\r\n  playfairDisplay,\r\n  comicNeue,\r\n};\r\n\r\n// Default font for the body\r\nexport const defaultFont = inter;\r\n","\"use client\";\r\n\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { TimelineElement, TimelineTrack } from \"@/types/timeline\";\r\nimport { useMediaStore, type MediaItem } from \"@/stores/media-store\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\nimport { useEditorStore } from \"@/stores/editor-store\";\r\nimport { VideoPlayer } from \"@/components/ui/video-player\";\r\nimport { AudioPlayer } from \"@/components/ui/audio-player\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Play, Pause, Expand, SkipBack, SkipForward } from \"lucide-react\";\r\nimport { useState, useRef, useEffect, useCallback } from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { formatTimeCode } from \"@/lib/time\";\r\nimport { EditableTimecode } from \"@/components/ui/editable-timecode\";\r\nimport { FONT_CLASS_MAP } from \"@/lib/font-config\";\r\nimport { useProjectStore } from \"@/stores/project-store\";\r\nimport { TextElementDragState } from \"@/types/editor\";\r\n\r\ninterface ActiveElement {\r\n  element: TimelineElement;\r\n  track: TimelineTrack;\r\n  mediaItem: MediaItem | null;\r\n}\r\n\r\nexport function PreviewPanel() {\r\n  const { tracks, getTotalDuration, updateTextElement } = useTimelineStore();\r\n  const { mediaItems } = useMediaStore();\r\n  const { currentTime, toggle, setCurrentTime, isPlaying } = usePlaybackStore();\r\n  const { canvasSize } = useEditorStore();\r\n  const previewRef = useRef<HTMLDivElement>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const [previewDimensions, setPreviewDimensions] = useState({\r\n    width: 0,\r\n    height: 0,\r\n  });\r\n  const [isExpanded, setIsExpanded] = useState(false);\r\n  const { activeProject } = useProjectStore();\r\n  const [dragState, setDragState] = useState<TextElementDragState>({\r\n    isDragging: false,\r\n    elementId: null,\r\n    trackId: null,\r\n    startX: 0,\r\n    startY: 0,\r\n    initialElementX: 0,\r\n    initialElementY: 0,\r\n    currentX: 0,\r\n    currentY: 0,\r\n    elementWidth: 0,\r\n    elementHeight: 0,\r\n  });\r\n\r\n  useEffect(() => {\r\n    const updatePreviewSize = () => {\r\n      if (!containerRef.current) return;\r\n\r\n      let availableWidth, availableHeight;\r\n\r\n      if (isExpanded) {\r\n        const controlsHeight = 80;\r\n        const marginSpace = 24;\r\n        availableWidth = window.innerWidth - marginSpace;\r\n        availableHeight = window.innerHeight - controlsHeight - marginSpace;\r\n      } else {\r\n        const container = containerRef.current.getBoundingClientRect();\r\n        const computedStyle = getComputedStyle(containerRef.current);\r\n        const paddingTop = parseFloat(computedStyle.paddingTop);\r\n        const paddingBottom = parseFloat(computedStyle.paddingBottom);\r\n        const paddingLeft = parseFloat(computedStyle.paddingLeft);\r\n        const paddingRight = parseFloat(computedStyle.paddingRight);\r\n        const gap = parseFloat(computedStyle.gap) || 16;\r\n        const toolbar = containerRef.current.querySelector(\"[data-toolbar]\");\r\n        const toolbarHeight = toolbar\r\n          ? toolbar.getBoundingClientRect().height\r\n          : 0;\r\n\r\n        availableWidth = container.width - paddingLeft - paddingRight;\r\n        availableHeight =\r\n          container.height -\r\n          paddingTop -\r\n          paddingBottom -\r\n          toolbarHeight -\r\n          (toolbarHeight > 0 ? gap : 0);\r\n      }\r\n\r\n      const targetRatio = canvasSize.width / canvasSize.height;\r\n      const containerRatio = availableWidth / availableHeight;\r\n      let width, height;\r\n\r\n      if (containerRatio > targetRatio) {\r\n        height = availableHeight * (isExpanded ? 0.95 : 1);\r\n        width = height * targetRatio;\r\n      } else {\r\n        width = availableWidth * (isExpanded ? 0.95 : 1);\r\n        height = width / targetRatio;\r\n      }\r\n\r\n      setPreviewDimensions({ width, height });\r\n    };\r\n\r\n    updatePreviewSize();\r\n    const resizeObserver = new ResizeObserver(updatePreviewSize);\r\n    if (containerRef.current) {\r\n      resizeObserver.observe(containerRef.current);\r\n    }\r\n    if (isExpanded) {\r\n      window.addEventListener(\"resize\", updatePreviewSize);\r\n    }\r\n\r\n    return () => {\r\n      resizeObserver.disconnect();\r\n      if (isExpanded) {\r\n        window.removeEventListener(\"resize\", updatePreviewSize);\r\n      }\r\n    };\r\n  }, [canvasSize.width, canvasSize.height, isExpanded]);\r\n\r\n  useEffect(() => {\r\n    const handleEscapeKey = (event: KeyboardEvent) => {\r\n      if (event.key === \"Escape\" && isExpanded) {\r\n        setIsExpanded(false);\r\n      }\r\n    };\r\n\r\n    if (isExpanded) {\r\n      document.addEventListener(\"keydown\", handleEscapeKey);\r\n      document.body.style.overflow = \"hidden\";\r\n    } else {\r\n      document.body.style.overflow = \"\";\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener(\"keydown\", handleEscapeKey);\r\n      document.body.style.overflow = \"\";\r\n    };\r\n  }, [isExpanded]);\r\n\r\n  useEffect(() => {\r\n    const handleMouseMove = (e: MouseEvent) => {\r\n      if (!dragState.isDragging) return;\r\n\r\n      const deltaX = e.clientX - dragState.startX;\r\n      const deltaY = e.clientY - dragState.startY;\r\n\r\n      const scaleRatio = previewDimensions.width / canvasSize.width;\r\n      const newX = dragState.initialElementX + deltaX / scaleRatio;\r\n      const newY = dragState.initialElementY + deltaY / scaleRatio;\r\n\r\n      const halfWidth = dragState.elementWidth / scaleRatio / 2;\r\n      const halfHeight = dragState.elementHeight / scaleRatio / 2;\r\n\r\n      const constrainedX = Math.max(\r\n        -canvasSize.width / 2 + halfWidth,\r\n        Math.min(canvasSize.width / 2 - halfWidth, newX)\r\n      );\r\n      const constrainedY = Math.max(\r\n        -canvasSize.height / 2 + halfHeight,\r\n        Math.min(canvasSize.height / 2 - halfHeight, newY)\r\n      );\r\n\r\n      setDragState((prev) => ({\r\n        ...prev,\r\n        currentX: constrainedX,\r\n        currentY: constrainedY,\r\n      }));\r\n    };\r\n\r\n    const handleMouseUp = () => {\r\n      if (dragState.isDragging && dragState.trackId && dragState.elementId) {\r\n        updateTextElement(dragState.trackId, dragState.elementId, {\r\n          x: dragState.currentX,\r\n          y: dragState.currentY,\r\n        });\r\n      }\r\n      setDragState((prev) => ({ ...prev, isDragging: false }));\r\n    };\r\n\r\n    if (dragState.isDragging) {\r\n      document.addEventListener(\"mousemove\", handleMouseMove);\r\n      document.addEventListener(\"mouseup\", handleMouseUp);\r\n      document.body.style.cursor = \"grabbing\";\r\n      document.body.style.userSelect = \"none\";\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener(\"mousemove\", handleMouseMove);\r\n      document.removeEventListener(\"mouseup\", handleMouseUp);\r\n      document.body.style.cursor = \"\";\r\n      document.body.style.userSelect = \"\";\r\n    };\r\n  }, [dragState, previewDimensions, canvasSize, updateTextElement]);\r\n\r\n  const handleTextMouseDown = (\r\n    e: React.MouseEvent<HTMLDivElement>,\r\n    element: any,\r\n    trackId: string\r\n  ) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    const rect = e.currentTarget.getBoundingClientRect();\r\n\r\n    setDragState({\r\n      isDragging: true,\r\n      elementId: element.id,\r\n      trackId,\r\n      startX: e.clientX,\r\n      startY: e.clientY,\r\n      initialElementX: element.x,\r\n      initialElementY: element.y,\r\n      currentX: element.x,\r\n      currentY: element.y,\r\n      elementWidth: rect.width,\r\n      elementHeight: rect.height,\r\n    });\r\n  };\r\n\r\n  const toggleExpanded = useCallback(() => {\r\n    setIsExpanded((prev) => !prev);\r\n  }, []);\r\n\r\n  const hasAnyElements = tracks.some((track) => track.elements.length > 0);\r\n  const getActiveElements = (): ActiveElement[] => {\r\n    const activeElements: ActiveElement[] = [];\r\n\r\n    tracks.forEach((track) => {\r\n      track.elements.forEach((element) => {\r\n        if (element.hidden) return;\r\n        const elementStart = element.startTime;\r\n        const elementEnd =\r\n          element.startTime +\r\n          (element.duration - element.trimStart - element.trimEnd);\r\n\r\n        if (currentTime >= elementStart && currentTime < elementEnd) {\r\n          let mediaItem = null;\r\n          if (element.type === \"media\") {\r\n            mediaItem =\r\n              element.mediaId === \"test\"\r\n                ? null\r\n                : mediaItems.find((item) => item.id === element.mediaId) ||\r\n                  null;\r\n          }\r\n          activeElements.push({ element, track, mediaItem });\r\n        }\r\n      });\r\n    });\r\n\r\n    return activeElements;\r\n  };\r\n\r\n  const activeElements = getActiveElements();\r\n\r\n  // Get media elements for blur background (video/image only)\r\n  const getBlurBackgroundElements = (): ActiveElement[] => {\r\n    return activeElements.filter(\r\n      ({ element, mediaItem }) =>\r\n        element.type === \"media\" &&\r\n        mediaItem &&\r\n        (mediaItem.type === \"video\" || mediaItem.type === \"image\") &&\r\n        element.mediaId !== \"test\" // Exclude test elements\r\n    );\r\n  };\r\n\r\n  const blurBackgroundElements = getBlurBackgroundElements();\r\n\r\n  // Render blur background layer\r\n  const renderBlurBackground = () => {\r\n    if (\r\n      !activeProject?.backgroundType ||\r\n      activeProject.backgroundType !== \"blur\" ||\r\n      blurBackgroundElements.length === 0\r\n    ) {\r\n      return null;\r\n    }\r\n\r\n    // Use the first media element for background (could be enhanced to use primary/focused element)\r\n    const backgroundElement = blurBackgroundElements[0];\r\n    const { element, mediaItem } = backgroundElement;\r\n\r\n    if (!mediaItem) return null;\r\n\r\n    const blurIntensity = activeProject.blurIntensity || 8;\r\n\r\n    if (mediaItem.type === \"video\") {\r\n      return (\r\n        <div\r\n          key={`blur-${element.id}`}\r\n          className=\"absolute inset-0 overflow-hidden\"\r\n          style={{\r\n            filter: `blur(${blurIntensity}px)`,\r\n            transform: \"scale(1.1)\", // Slightly zoom to avoid blur edge artifacts\r\n            transformOrigin: \"center\",\r\n          }}\r\n        >\r\n          <VideoPlayer\r\n            src={mediaItem.url!}\r\n            poster={mediaItem.thumbnailUrl}\r\n            clipStartTime={element.startTime}\r\n            trimStart={element.trimStart}\r\n            trimEnd={element.trimEnd}\r\n            clipDuration={element.duration}\r\n            className=\"w-full h-full object-cover\"\r\n          />\r\n        </div>\r\n      );\r\n    }\r\n\r\n    if (mediaItem.type === \"image\") {\r\n      return (\r\n        <div\r\n          key={`blur-${element.id}`}\r\n          className=\"absolute inset-0 overflow-hidden\"\r\n          style={{\r\n            filter: `blur(${blurIntensity}px)`,\r\n            transform: \"scale(1.1)\", // Slightly zoom to avoid blur edge artifacts\r\n            transformOrigin: \"center\",\r\n          }}\r\n        >\r\n          <img\r\n            src={mediaItem.url!}\r\n            alt={mediaItem.name}\r\n            className=\"w-full h-full object-cover\"\r\n            draggable={false}\r\n          />\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  // Render an element\r\n  const renderElement = (elementData: ActiveElement, index: number) => {\r\n    const { element, mediaItem } = elementData;\r\n\r\n    // Text elements\r\n    if (element.type === \"text\") {\r\n      const fontClassName =\r\n        FONT_CLASS_MAP[element.fontFamily as keyof typeof FONT_CLASS_MAP] || \"\";\r\n\r\n      const scaleRatio = previewDimensions.width / canvasSize.width;\r\n\r\n      return (\r\n        <div\r\n          key={element.id}\r\n          className=\"absolute flex items-center justify-center cursor-grab\"\r\n          onMouseDown={(e) =>\r\n            handleTextMouseDown(e, element, elementData.track.id)\r\n          }\r\n          style={{\r\n            left: `${\r\n              50 +\r\n              ((dragState.isDragging && dragState.elementId === element.id\r\n                ? dragState.currentX\r\n                : element.x) /\r\n                canvasSize.width) *\r\n                100\r\n            }%`,\r\n            top: `${\r\n              50 +\r\n              ((dragState.isDragging && dragState.elementId === element.id\r\n                ? dragState.currentY\r\n                : element.y) /\r\n                canvasSize.height) *\r\n                100\r\n            }%`,\r\n            transform: `translate(-50%, -50%) rotate(${element.rotation}deg) scale(${scaleRatio})`,\r\n            opacity: element.opacity,\r\n            zIndex: 100 + index, // Text elements on top\r\n          }}\r\n        >\r\n          <div\r\n            className={fontClassName}\r\n            style={{\r\n              fontSize: `${element.fontSize}px`,\r\n              color: element.color,\r\n              backgroundColor: element.backgroundColor,\r\n              textAlign: element.textAlign,\r\n              fontWeight: element.fontWeight,\r\n              fontStyle: element.fontStyle,\r\n              textDecoration: element.textDecoration,\r\n              padding: \"4px 8px\",\r\n              borderRadius: \"2px\",\r\n              whiteSpace: \"pre-wrap\",\r\n              // Fallback for system fonts that don't have classes\r\n              ...(fontClassName === \"\" && { fontFamily: element.fontFamily }),\r\n            }}\r\n          >\r\n            {element.content}\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    // Media elements\r\n    if (element.type === \"media\") {\r\n      // Test elements\r\n      if (!mediaItem || element.mediaId === \"test\") {\r\n        return (\r\n          <div\r\n            key={element.id}\r\n            className=\"absolute inset-0 bg-linear-to-br from-blue-500/20 to-purple-500/20 flex items-center justify-center\"\r\n          >\r\n            <div className=\"text-center\">\r\n              <div className=\"text-2xl mb-2\">🎬</div>\r\n              <p className=\"text-xs text-foreground\">{element.name}</p>\r\n            </div>\r\n          </div>\r\n        );\r\n      }\r\n\r\n      // Video elements\r\n      if (mediaItem.type === \"video\") {\r\n        return (\r\n          <div\r\n            key={element.id}\r\n            className=\"absolute inset-0 flex items-center justify-center\"\r\n          >\r\n            <VideoPlayer\r\n              src={mediaItem.url!}\r\n              poster={mediaItem.thumbnailUrl}\r\n              clipStartTime={element.startTime}\r\n              trimStart={element.trimStart}\r\n              trimEnd={element.trimEnd}\r\n              clipDuration={element.duration}\r\n            />\r\n          </div>\r\n        );\r\n      }\r\n\r\n      // Image elements\r\n      if (mediaItem.type === \"image\") {\r\n        return (\r\n          <div\r\n            key={element.id}\r\n            className=\"absolute inset-0 flex items-center justify-center\"\r\n          >\r\n            <img\r\n              src={mediaItem.url!}\r\n              alt={mediaItem.name}\r\n              className=\"max-w-full max-h-full object-contain\"\r\n              draggable={false}\r\n            />\r\n          </div>\r\n        );\r\n      }\r\n\r\n      // Audio elements (no visual representation)\r\n      if (mediaItem.type === \"audio\") {\r\n        return (\r\n          <div key={element.id} className=\"absolute inset-0\">\r\n            <AudioPlayer\r\n              src={mediaItem.url!}\r\n              clipStartTime={element.startTime}\r\n              trimStart={element.trimStart}\r\n              trimEnd={element.trimEnd}\r\n              clipDuration={element.duration}\r\n              trackMuted={elementData.track.muted}\r\n            />\r\n          </div>\r\n        );\r\n      }\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"h-full w-full flex flex-col min-h-0 min-w-0 bg-panel rounded-sm relative\">\r\n        <div\r\n          ref={containerRef}\r\n          className=\"flex-1 flex flex-col items-center justify-center min-h-0 min-w-0\"\r\n        >\r\n          <div className=\"flex-1\" />\r\n          {hasAnyElements ? (\r\n            <div\r\n              ref={previewRef}\r\n              className=\"relative overflow-hidden border\"\r\n              style={{\r\n                width: previewDimensions.width,\r\n                height: previewDimensions.height,\r\n                background:\r\n                  activeProject?.backgroundType === \"blur\"\r\n                    ? \"transparent\"\r\n                    : activeProject?.backgroundColor || \"#000000\",\r\n              }}\r\n            >\r\n              {renderBlurBackground()}\r\n              {activeElements.length === 0 ? (\r\n                <div className=\"absolute inset-0 flex items-center justify-center text-muted-foreground\">\r\n                  No elements at current time\r\n                </div>\r\n              ) : (\r\n                activeElements.map((elementData, index) =>\r\n                  renderElement(elementData, index)\r\n                )\r\n              )}\r\n              {activeProject?.backgroundType === \"blur\" &&\r\n                blurBackgroundElements.length === 0 &&\r\n                activeElements.length > 0 && (\r\n                  <div className=\"absolute bottom-2 left-2 right-2 bg-black/70 text-white text-xs p-2 rounded\">\r\n                    Add a video or image to use blur background\r\n                  </div>\r\n                )}\r\n            </div>\r\n          ) : null}\r\n\r\n          <div className=\"flex-1\" />\r\n\r\n          <PreviewToolbar\r\n            hasAnyElements={hasAnyElements}\r\n            onToggleExpanded={toggleExpanded}\r\n            isExpanded={isExpanded}\r\n            currentTime={currentTime}\r\n            setCurrentTime={setCurrentTime}\r\n            toggle={toggle}\r\n            getTotalDuration={getTotalDuration}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {isExpanded && (\r\n        <FullscreenPreview\r\n          previewDimensions={previewDimensions}\r\n          activeProject={activeProject}\r\n          renderBlurBackground={renderBlurBackground}\r\n          activeElements={activeElements}\r\n          renderElement={renderElement}\r\n          blurBackgroundElements={blurBackgroundElements}\r\n          hasAnyElements={hasAnyElements}\r\n          toggleExpanded={toggleExpanded}\r\n          currentTime={currentTime}\r\n          setCurrentTime={setCurrentTime}\r\n          toggle={toggle}\r\n          getTotalDuration={getTotalDuration}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\nfunction FullscreenToolbar({\r\n  hasAnyElements,\r\n  onToggleExpanded,\r\n  currentTime,\r\n  setCurrentTime,\r\n  toggle,\r\n  getTotalDuration,\r\n}: {\r\n  hasAnyElements: boolean;\r\n  onToggleExpanded: () => void;\r\n  currentTime: number;\r\n  setCurrentTime: (time: number) => void;\r\n  toggle: () => void;\r\n  getTotalDuration: () => number;\r\n}) {\r\n  const { isPlaying, seek } = usePlaybackStore();\r\n  const { activeProject } = useProjectStore();\r\n  const [isDragging, setIsDragging] = useState(false);\r\n\r\n  const totalDuration = getTotalDuration();\r\n  const progress = totalDuration > 0 ? (currentTime / totalDuration) * 100 : 0;\r\n\r\n  const handleTimelineClick = (e: React.MouseEvent<HTMLDivElement>) => {\r\n    if (!hasAnyElements) return;\r\n    const rect = e.currentTarget.getBoundingClientRect();\r\n    const clickX = e.clientX - rect.left;\r\n    const percentage = Math.max(0, Math.min(1, clickX / rect.width));\r\n    const newTime = percentage * totalDuration;\r\n    setCurrentTime(Math.max(0, Math.min(newTime, totalDuration)));\r\n  };\r\n\r\n  const handleTimelineDrag = (e: React.MouseEvent<HTMLDivElement>) => {\r\n    if (!hasAnyElements) return;\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    const rect = e.currentTarget.getBoundingClientRect();\r\n    setIsDragging(true);\r\n\r\n    const handleMouseMove = (moveEvent: MouseEvent) => {\r\n      moveEvent.preventDefault();\r\n      const dragX = moveEvent.clientX - rect.left;\r\n      const percentage = Math.max(0, Math.min(1, dragX / rect.width));\r\n      const newTime = percentage * totalDuration;\r\n      setCurrentTime(Math.max(0, Math.min(newTime, totalDuration)));\r\n    };\r\n\r\n    const handleMouseUp = () => {\r\n      setIsDragging(false);\r\n      document.removeEventListener(\"mousemove\", handleMouseMove);\r\n      document.removeEventListener(\"mouseup\", handleMouseUp);\r\n      document.body.style.userSelect = \"\";\r\n    };\r\n\r\n    document.body.style.userSelect = \"none\";\r\n    document.addEventListener(\"mousemove\", handleMouseMove);\r\n    document.addEventListener(\"mouseup\", handleMouseUp);\r\n    handleMouseMove(e.nativeEvent);\r\n  };\r\n\r\n  const skipBackward = () => {\r\n    const newTime = Math.max(0, currentTime - 1);\r\n    setCurrentTime(newTime);\r\n  };\r\n\r\n  const skipForward = () => {\r\n    const newTime = Math.min(totalDuration, currentTime + 1);\r\n    setCurrentTime(newTime);\r\n  };\r\n\r\n  return (\r\n    <div\r\n      data-toolbar\r\n      className=\"flex items-center gap-2 p-1 pt-2 w-full text-foreground relative\"\r\n    >\r\n      <div className=\"flex items-center gap-1 text-[0.70rem] tabular-nums text-foreground/90\">\r\n        <EditableTimecode\r\n          time={currentTime}\r\n          duration={totalDuration}\r\n          format=\"HH:MM:SS:FF\"\r\n          fps={activeProject?.fps || 30}\r\n          onTimeChange={seek}\r\n          disabled={!hasAnyElements}\r\n          className=\"text-foreground/90 hover:bg-white/10\"\r\n        />\r\n        <span className=\"opacity-50\">/</span>\r\n        <span>\r\n          {formatTimeCode(\r\n            totalDuration,\r\n            \"HH:MM:SS:FF\",\r\n            activeProject?.fps || 30\r\n          )}\r\n        </span>\r\n      </div>\r\n\r\n      <div className=\"flex items-center gap-1\">\r\n        <Button\r\n          variant=\"text\"\r\n          size=\"icon\"\r\n          onClick={skipBackward}\r\n          disabled={!hasAnyElements}\r\n          className=\"h-auto p-0 text-foreground\"\r\n          title=\"Skip backward 1s\"\r\n        >\r\n          <SkipBack className=\"h-3 w-3\" />\r\n        </Button>\r\n        <Button\r\n          variant=\"text\"\r\n          size=\"icon\"\r\n          onClick={toggle}\r\n          disabled={!hasAnyElements}\r\n          className=\"h-auto p-0 text-foreground hover:text-foreground/80\"\r\n        >\r\n          {isPlaying ? (\r\n            <Pause className=\"h-3 w-3\" />\r\n          ) : (\r\n            <Play className=\"h-3 w-3\" />\r\n          )}\r\n        </Button>\r\n        <Button\r\n          variant=\"text\"\r\n          size=\"icon\"\r\n          onClick={skipForward}\r\n          disabled={!hasAnyElements}\r\n          className=\"h-auto p-0 text-foreground hover:text-foreground/80\"\r\n          title=\"Skip forward 1s\"\r\n        >\r\n          <SkipForward className=\"h-3 w-3\" />\r\n        </Button>\r\n      </div>\r\n\r\n      <div className=\"flex-1 flex items-center gap-2\">\r\n        <div\r\n          className={cn(\r\n            \"relative h-1 rounded-full cursor-pointer flex-1 bg-foreground/20\",\r\n            !hasAnyElements && \"opacity-50 cursor-not-allowed\"\r\n          )}\r\n          onClick={hasAnyElements ? handleTimelineClick : undefined}\r\n          onMouseDown={hasAnyElements ? handleTimelineDrag : undefined}\r\n          style={{ userSelect: \"none\" }}\r\n        >\r\n          <div\r\n            className={cn(\r\n              \"absolute top-0 left-0 h-full rounded-full bg-foreground\",\r\n              !isDragging && \"duration-100\"\r\n            )}\r\n            style={{ width: `${progress}%` }}\r\n          />\r\n          <div\r\n            className=\"absolute top-1/2 w-3 h-3 rounded-full -translate-y-1/2 -translate-x-1/2 shadow-xs bg-foreground border border-black/20\"\r\n            style={{ left: `${progress}%` }}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <Button\r\n        variant=\"text\"\r\n        size=\"icon\"\r\n        className=\"size-4! text-foreground/80 hover:text-foreground\"\r\n        onClick={onToggleExpanded}\r\n        title=\"Exit fullscreen (Esc)\"\r\n      >\r\n        <Expand className=\"size-4!\" />\r\n      </Button>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction FullscreenPreview({\r\n  previewDimensions,\r\n  activeProject,\r\n  renderBlurBackground,\r\n  activeElements,\r\n  renderElement,\r\n  blurBackgroundElements,\r\n  hasAnyElements,\r\n  toggleExpanded,\r\n  currentTime,\r\n  setCurrentTime,\r\n  toggle,\r\n  getTotalDuration,\r\n}: {\r\n  previewDimensions: { width: number; height: number };\r\n  activeProject: any;\r\n  renderBlurBackground: () => React.ReactNode;\r\n  activeElements: ActiveElement[];\r\n  renderElement: (elementData: ActiveElement, index: number) => React.ReactNode;\r\n  blurBackgroundElements: ActiveElement[];\r\n  hasAnyElements: boolean;\r\n  toggleExpanded: () => void;\r\n  currentTime: number;\r\n  setCurrentTime: (time: number) => void;\r\n  toggle: () => void;\r\n  getTotalDuration: () => number;\r\n}) {\r\n  return (\r\n    <div className=\"fixed inset-0 z-9999 flex flex-col\">\r\n      <div className=\"flex-1 flex items-center justify-center bg-background\">\r\n        <div\r\n          className=\"relative overflow-hidden border border-border m-3\"\r\n          style={{\r\n            width: previewDimensions.width,\r\n            height: previewDimensions.height,\r\n            background:\r\n              activeProject?.backgroundType === \"blur\"\r\n                ? \"#1a1a1a\"\r\n                : activeProject?.backgroundColor || \"#1a1a1a\",\r\n          }}\r\n        >\r\n          {renderBlurBackground()}\r\n          {activeElements.length === 0 ? (\r\n            <div className=\"absolute inset-0 flex items-center justify-center text-white/60\">\r\n              No elements at current time\r\n            </div>\r\n          ) : (\r\n            activeElements.map((elementData, index) =>\r\n              renderElement(elementData, index)\r\n            )\r\n          )}\r\n          {activeProject?.backgroundType === \"blur\" &&\r\n            blurBackgroundElements.length === 0 &&\r\n            activeElements.length > 0 && (\r\n              <div className=\"absolute bottom-2 left-2 right-2 bg-black/70 text-white text-xs p-2 rounded\">\r\n                Add a video or image to use blur background\r\n              </div>\r\n            )}\r\n        </div>\r\n      </div>\r\n      <div className=\"p-4 bg-background\">\r\n        <FullscreenToolbar\r\n          hasAnyElements={hasAnyElements}\r\n          onToggleExpanded={toggleExpanded}\r\n          currentTime={currentTime}\r\n          setCurrentTime={setCurrentTime}\r\n          toggle={toggle}\r\n          getTotalDuration={getTotalDuration}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction PreviewToolbar({\r\n  hasAnyElements,\r\n  onToggleExpanded,\r\n  isExpanded,\r\n  currentTime,\r\n  setCurrentTime,\r\n  toggle,\r\n  getTotalDuration,\r\n}: {\r\n  hasAnyElements: boolean;\r\n  onToggleExpanded: () => void;\r\n  isExpanded: boolean;\r\n  currentTime: number;\r\n  setCurrentTime: (time: number) => void;\r\n  toggle: () => void;\r\n  getTotalDuration: () => number;\r\n}) {\r\n  const { isPlaying } = usePlaybackStore();\r\n\r\n  if (isExpanded) {\r\n    return (\r\n      <FullscreenToolbar\r\n        {...{\r\n          hasAnyElements,\r\n          onToggleExpanded,\r\n          currentTime,\r\n          setCurrentTime,\r\n          toggle,\r\n          getTotalDuration,\r\n        }}\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div\r\n      data-toolbar\r\n      className=\"flex justify-between gap-2 px-1.5 pr-4 py-1.5 border border-border/50 w-auto absolute bottom-4 right-4 bg-black/20 rounded-full backdrop-blur-l text-white\"\r\n    >\r\n      <div className=\"flex items-center gap-2\">\r\n        <Button\r\n          variant=\"text\"\r\n          size=\"icon\"\r\n          onClick={toggle}\r\n          disabled={!hasAnyElements}\r\n          className=\"h-auto p-0\"\r\n        >\r\n          {isPlaying ? (\r\n            <Pause className=\"h-3 w-3\" />\r\n          ) : (\r\n            <Play className=\"h-3 w-3\" />\r\n          )}\r\n        </Button>\r\n        <Button\r\n          variant=\"text\"\r\n          size=\"icon\"\r\n          className=\"size-4!\"\r\n          onClick={onToggleExpanded}\r\n          title=\"Enter fullscreen\"\r\n        >\r\n          <Expand className=\"size-4!\" />\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","// Time-related utility functions\r\n\r\n// Helper function to format time in various formats (MM:SS, HH:MM:SS, HH:MM:SS:CS, HH:MM:SS:FF)\r\nexport const formatTimeCode = (\r\n  timeInSeconds: number,\r\n  format: \"MM:SS\" | \"HH:MM:SS\" | \"HH:MM:SS:CS\" | \"HH:MM:SS:FF\" = \"HH:MM:SS:CS\",\r\n  fps = 30\r\n): string => {\r\n  const hours = Math.floor(timeInSeconds / 3600);\r\n  const minutes = Math.floor((timeInSeconds % 3600) / 60);\r\n  const seconds = Math.floor(timeInSeconds % 60);\r\n  const centiseconds = Math.floor((timeInSeconds % 1) * 100);\r\n  const frames = Math.floor((timeInSeconds % 1) * fps);\r\n\r\n  switch (format) {\r\n    case \"MM:SS\":\r\n      return `${minutes.toString().padStart(2, \"0\")}:${seconds.toString().padStart(2, \"0\")}`;\r\n    case \"HH:MM:SS\":\r\n      return `${hours.toString().padStart(2, \"0\")}:${minutes.toString().padStart(2, \"0\")}:${seconds.toString().padStart(2, \"0\")}`;\r\n    case \"HH:MM:SS:CS\":\r\n      return `${hours.toString().padStart(2, \"0\")}:${minutes.toString().padStart(2, \"0\")}:${seconds.toString().padStart(2, \"0\")}:${centiseconds.toString().padStart(2, \"0\")}`;\r\n    case \"HH:MM:SS:FF\":\r\n      return `${hours.toString().padStart(2, \"0\")}:${minutes.toString().padStart(2, \"0\")}:${seconds.toString().padStart(2, \"0\")}:${frames.toString().padStart(2, \"0\")}`;\r\n  }\r\n};\r\n\r\nexport const parseTimeCode = (\r\n  timeCode: string,\r\n  format: \"MM:SS\" | \"HH:MM:SS\" | \"HH:MM:SS:CS\" | \"HH:MM:SS:FF\" = \"HH:MM:SS:CS\",\r\n  fps = 30\r\n): number | null => {\r\n  if (!timeCode || typeof timeCode !== \"string\") return null;\r\n\r\n  // Remove any extra whitespace\r\n  const cleanTimeCode = timeCode.trim();\r\n\r\n  try {\r\n    switch (format) {\r\n      case \"MM:SS\": {\r\n        const parts = cleanTimeCode.split(\":\");\r\n        if (parts.length !== 2) return null;\r\n        const [minutes, seconds] = parts.map((part) => parseInt(part, 10));\r\n        if (isNaN(minutes) || isNaN(seconds)) return null;\r\n        if (minutes < 0 || seconds < 0 || seconds >= 60) return null;\r\n        return minutes * 60 + seconds;\r\n      }\r\n\r\n      case \"HH:MM:SS\": {\r\n        const parts = cleanTimeCode.split(\":\");\r\n        if (parts.length !== 3) return null;\r\n        const [hours, minutes, seconds] = parts.map((part) =>\r\n          parseInt(part, 10)\r\n        );\r\n        if (isNaN(hours) || isNaN(minutes) || isNaN(seconds)) return null;\r\n        if (\r\n          hours < 0 ||\r\n          minutes < 0 ||\r\n          seconds < 0 ||\r\n          minutes >= 60 ||\r\n          seconds >= 60\r\n        )\r\n          return null;\r\n        return hours * 3600 + minutes * 60 + seconds;\r\n      }\r\n\r\n      case \"HH:MM:SS:CS\": {\r\n        const parts = cleanTimeCode.split(\":\");\r\n        if (parts.length !== 4) return null;\r\n        const [hours, minutes, seconds, centiseconds] = parts.map((part) =>\r\n          parseInt(part, 10)\r\n        );\r\n        if (\r\n          isNaN(hours) ||\r\n          isNaN(minutes) ||\r\n          isNaN(seconds) ||\r\n          isNaN(centiseconds)\r\n        )\r\n          return null;\r\n        if (\r\n          hours < 0 ||\r\n          minutes < 0 ||\r\n          seconds < 0 ||\r\n          centiseconds < 0 ||\r\n          minutes >= 60 ||\r\n          seconds >= 60 ||\r\n          centiseconds >= 100\r\n        )\r\n          return null;\r\n        return hours * 3600 + minutes * 60 + seconds + centiseconds / 100;\r\n      }\r\n\r\n      case \"HH:MM:SS:FF\": {\r\n        const parts = cleanTimeCode.split(\":\");\r\n        if (parts.length !== 4) return null;\r\n        const [hours, minutes, seconds, frames] = parts.map((part) =>\r\n          parseInt(part, 10)\r\n        );\r\n        if (isNaN(hours) || isNaN(minutes) || isNaN(seconds) || isNaN(frames))\r\n          return null;\r\n        if (\r\n          hours < 0 ||\r\n          minutes < 0 ||\r\n          seconds < 0 ||\r\n          frames < 0 ||\r\n          minutes >= 60 ||\r\n          seconds >= 60 ||\r\n          frames >= fps\r\n        )\r\n          return null;\r\n        return hours * 3600 + minutes * 60 + seconds + frames / fps;\r\n      }\r\n    }\r\n  } catch {\r\n    return null;\r\n  }\r\n\r\n  return null;\r\n};\r\n","import { useState, useCallback, useEffect, RefObject } from \"react\";\r\n\r\ninterface UseTimelineZoomProps {\r\n  containerRef: RefObject<HTMLDivElement>;\r\n  isInTimeline?: boolean;\r\n}\r\n\r\ninterface UseTimelineZoomReturn {\r\n  zoomLevel: number;\r\n  setZoomLevel: (zoomLevel: number | ((prev: number) => number)) => void;\r\n  handleWheel: (e: React.WheelEvent) => void;\r\n}\r\n\r\nexport function useTimelineZoom({\r\n  containerRef,\r\n  isInTimeline = false,\r\n}: UseTimelineZoomProps): UseTimelineZoomReturn {\r\n  const [zoomLevel, setZoomLevel] = useState(1);\r\n\r\n  const handleWheel = useCallback((e: React.WheelEvent) => {\r\n    // Only zoom if user is using pinch gesture (ctrlKey or metaKey is true)\r\n    if (e.ctrlKey || e.metaKey) {\r\n      e.preventDefault();\r\n      const delta = e.deltaY > 0 ? -0.15 : 0.15;\r\n      setZoomLevel((prev) => Math.max(0.1, Math.min(10, prev + delta)));\r\n    }\r\n    // For horizontal scrolling (when shift is held or horizontal wheel movement),\r\n    // let the event bubble up to allow ScrollArea to handle it\r\n    else if (e.shiftKey || Math.abs(e.deltaX) > Math.abs(e.deltaY)) {\r\n      // Don't prevent default - let ScrollArea handle horizontal scrolling\r\n      return;\r\n    }\r\n    // Otherwise, allow normal scrolling\r\n  }, []);\r\n\r\n  // Prevent browser zooming in/out when in timeline\r\n  useEffect(() => {\r\n    const preventZoom = (e: WheelEvent) => {\r\n      if (\r\n        isInTimeline &&\r\n        (e.ctrlKey || e.metaKey) &&\r\n        containerRef.current?.contains(e.target as Node)\r\n      ) {\r\n        e.preventDefault();\r\n      }\r\n    };\r\n\r\n    document.addEventListener(\"wheel\", preventZoom, { passive: false });\r\n\r\n    return () => {\r\n      document.removeEventListener(\"wheel\", preventZoom);\r\n    };\r\n  }, [isInTimeline, containerRef]);\r\n\r\n  return {\r\n    zoomLevel,\r\n    setZoomLevel,\r\n    handleWheel,\r\n  };\r\n}\r\n","import React, { useEffect, useRef, useState } from \"react\";\r\nimport WaveSurfer from \"wavesurfer.js\";\r\n\r\ninterface AudioWaveformProps {\r\n  audioUrl: string;\r\n  height?: number;\r\n  className?: string;\r\n}\r\n\r\nconst AudioWaveform: React.FC<AudioWaveformProps> = ({\r\n  audioUrl,\r\n  height = 32,\r\n  className = \"\",\r\n}) => {\r\n  const waveformRef = useRef<HTMLDivElement>(null);\r\n  const wavesurfer = useRef<WaveSurfer | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState(false);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    let ws = wavesurfer.current;\r\n    \r\n    const initWaveSurfer = async () => {\r\n      if (!waveformRef.current || !audioUrl) return;\r\n\r\n      try {\r\n        // Clear any existing instance safely\r\n        if (ws) {\r\n          // Instead of immediately destroying, just set to null\r\n          // We'll destroy it outside this function\r\n          wavesurfer.current = null;\r\n        }\r\n\r\n        // Create a fresh instance\r\n        const newWaveSurfer = WaveSurfer.create({\r\n          container: waveformRef.current,\r\n          waveColor: \"rgba(255, 255, 255, 0.6)\",\r\n          progressColor: \"rgba(255, 255, 255, 0.9)\",\r\n          cursorColor: \"transparent\",\r\n          barWidth: 2,\r\n          barGap: 1,\r\n          height,\r\n          normalize: true,\r\n          interact: false,\r\n        });\r\n\r\n        // Assign to ref only if component is still mounted\r\n        if (mounted) {\r\n          wavesurfer.current = newWaveSurfer;\r\n        } else {\r\n          // Component unmounted during initialization, clean up\r\n          try {\r\n            newWaveSurfer.destroy();\r\n          } catch (e) {\r\n            // Ignore destroy errors\r\n          }\r\n          return;\r\n        }\r\n\r\n        // Event listeners\r\n        newWaveSurfer.on(\"ready\", () => {\r\n          if (mounted) {\r\n            setIsLoading(false);\r\n            setError(false);\r\n          }\r\n        });\r\n\r\n        newWaveSurfer.on(\"error\", (err) => {\r\n          console.error(\"WaveSurfer error:\", err);\r\n          if (mounted) {\r\n            setError(true);\r\n            setIsLoading(false);\r\n          }\r\n        });\r\n\r\n        await newWaveSurfer.load(audioUrl);\r\n      } catch (err) {\r\n        console.error(\"Failed to initialize WaveSurfer:\", err);\r\n        if (mounted) {\r\n          setError(true);\r\n          setIsLoading(false);\r\n        }\r\n      }\r\n    };\r\n\r\n    // First safely destroy previous instance if it exists\r\n    if (ws) {\r\n      // Use this pattern to safely destroy the previous instance\r\n      const wsToDestroy = ws;\r\n      // Detach from ref immediately\r\n      wavesurfer.current = null;\r\n      \r\n      // Wait a tick to destroy so any pending operations can complete\r\n      requestAnimationFrame(() => {\r\n        try {\r\n          wsToDestroy.destroy();\r\n        } catch (e) {\r\n          // Ignore errors during destroy\r\n        }\r\n        // Only initialize new instance after destroying the old one\r\n        if (mounted) {\r\n          initWaveSurfer();\r\n        }\r\n      });\r\n    } else {\r\n      // No previous instance to clean up, initialize directly\r\n      initWaveSurfer();\r\n    }\r\n\r\n    return () => {\r\n      // Mark component as unmounted\r\n      mounted = false;\r\n      \r\n      // Store reference to current wavesurfer instance\r\n      const wsToDestroy = wavesurfer.current;\r\n      \r\n      // Immediately clear the ref to prevent accessing it after unmount\r\n      wavesurfer.current = null;\r\n      \r\n      // If we have an instance to clean up, do it safely\r\n      if (wsToDestroy) {\r\n        // Delay destruction to avoid race conditions\r\n        requestAnimationFrame(() => {\r\n          try {\r\n            wsToDestroy.destroy();\r\n          } catch (e) {\r\n            // Ignore destroy errors - they're expected\r\n          }\r\n        });\r\n      }\r\n    };\r\n  }, [audioUrl, height]);\r\n\r\n  if (error) {\r\n    return (\r\n      <div\r\n        className={`flex items-center justify-center ${className}`}\r\n        style={{ height }}\r\n      >\r\n        <span className=\"text-xs text-foreground/60\">Audio unavailable</span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={`relative ${className}`}>\r\n      {isLoading && (\r\n        <div className=\"absolute inset-0 flex items-center justify-center\">\r\n          <span className=\"text-xs text-foreground/60\">Loading...</span>\r\n        </div>\r\n      )}\r\n      <div\r\n        ref={waveformRef}\r\n        className={`w-full transition-opacity duration-200 ${isLoading ? \"opacity-0\" : \"opacity-100\"}`}\r\n        style={{ height }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AudioWaveform;\r\n","import { useState, useEffect } from \"react\";\r\nimport { ResizeState, TimelineElement, TimelineTrack } from \"@/types/timeline\";\r\nimport { useMediaStore } from \"@/stores/media-store\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { useProjectStore } from \"@/stores/project-store\";\r\nimport { snapTimeToFrame } from \"@/constants/timeline-constants\";\r\n\r\ninterface UseTimelineElementResizeProps {\r\n  element: TimelineElement;\r\n  track: TimelineTrack;\r\n  zoomLevel: number;\r\n  onUpdateTrim: (\r\n    trackId: string,\r\n    elementId: string,\r\n    trimStart: number,\r\n    trimEnd: number\r\n  ) => void;\r\n  onUpdateDuration: (\r\n    trackId: string,\r\n    elementId: string,\r\n    duration: number\r\n  ) => void;\r\n}\r\n\r\nexport function useTimelineElementResize({\r\n  element,\r\n  track,\r\n  zoomLevel,\r\n  onUpdateTrim,\r\n  onUpdateDuration,\r\n}: UseTimelineElementResizeProps) {\r\n  const [resizing, setResizing] = useState<ResizeState | null>(null);\r\n  const { mediaItems } = useMediaStore();\r\n  const {\r\n    updateElementStartTime,\r\n    updateElementTrim,\r\n    updateElementDuration,\r\n    pushHistory,\r\n  } = useTimelineStore();\r\n\r\n  // Set up document-level mouse listeners during resize (like proper drag behavior)\r\n  useEffect(() => {\r\n    if (!resizing) return;\r\n\r\n    const handleDocumentMouseMove = (e: MouseEvent) => {\r\n      updateTrimFromMouseMove({ clientX: e.clientX });\r\n    };\r\n\r\n    const handleDocumentMouseUp = () => {\r\n      handleResizeEnd();\r\n    };\r\n\r\n    // Add document-level listeners for proper drag behavior\r\n    document.addEventListener(\"mousemove\", handleDocumentMouseMove);\r\n    document.addEventListener(\"mouseup\", handleDocumentMouseUp);\r\n\r\n    return () => {\r\n      document.removeEventListener(\"mousemove\", handleDocumentMouseMove);\r\n      document.removeEventListener(\"mouseup\", handleDocumentMouseUp);\r\n    };\r\n  }, [resizing]); // Re-run when resizing state changes\r\n\r\n  const handleResizeStart = (\r\n    e: React.MouseEvent,\r\n    elementId: string,\r\n    side: \"left\" | \"right\"\r\n  ) => {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n\r\n    // Push history once at the start of the resize operation\r\n    pushHistory();\r\n\r\n    setResizing({\r\n      elementId,\r\n      side,\r\n      startX: e.clientX,\r\n      initialTrimStart: element.trimStart,\r\n      initialTrimEnd: element.trimEnd,\r\n    });\r\n  };\r\n\r\n  const canExtendElementDuration = () => {\r\n    // Text elements can always be extended\r\n    if (element.type === \"text\") {\r\n      return true;\r\n    }\r\n\r\n    // Media elements - check the media type\r\n    if (element.type === \"media\") {\r\n      const mediaItem = mediaItems.find((item) => item.id === element.mediaId);\r\n      if (!mediaItem) return false;\r\n\r\n      // Images can be extended (static content)\r\n      if (mediaItem.type === \"image\") {\r\n        return true;\r\n      }\r\n\r\n      // Videos and audio cannot be extended beyond their natural duration\r\n      // (no additional content exists)\r\n      return false;\r\n    }\r\n\r\n    return false;\r\n  };\r\n\r\n  const updateTrimFromMouseMove = (e: { clientX: number }) => {\r\n    if (!resizing) return;\r\n\r\n    const deltaX = e.clientX - resizing.startX;\r\n    // Reasonable sensitivity for resize operations - similar to timeline scale\r\n    const deltaTime = deltaX / (50 * zoomLevel);\r\n\r\n    // Get project FPS for frame snapping\r\n    const projectStore = useProjectStore.getState();\r\n    const projectFps = projectStore.activeProject?.fps || 30;\r\n\r\n    if (resizing.side === \"left\") {\r\n      // Left resize - different behavior for media vs text/image elements\r\n      const maxAllowed = element.duration - resizing.initialTrimEnd - 0.1;\r\n      const calculated = resizing.initialTrimStart + deltaTime;\r\n\r\n      if (calculated >= 0) {\r\n        // Normal trimming within available content\r\n        const newTrimStart = snapTimeToFrame(\r\n          Math.min(maxAllowed, calculated),\r\n          projectFps\r\n        );\r\n        const trimDelta = newTrimStart - resizing.initialTrimStart;\r\n        const newStartTime = snapTimeToFrame(\r\n          element.startTime + trimDelta,\r\n          projectFps\r\n        );\r\n\r\n        updateElementTrim(\r\n          track.id,\r\n          element.id,\r\n          newTrimStart,\r\n          resizing.initialTrimEnd,\r\n          false\r\n        );\r\n        updateElementStartTime(track.id, element.id, newStartTime, false);\r\n      } else {\r\n        // Trying to extend beyond trimStart = 0\r\n        if (canExtendElementDuration()) {\r\n          // Text/Image: extend element to the left by moving startTime and increasing duration\r\n          const extensionAmount = Math.abs(calculated);\r\n          const maxExtension = element.startTime;\r\n          const actualExtension = Math.min(extensionAmount, maxExtension);\r\n          const newStartTime = snapTimeToFrame(\r\n            element.startTime - actualExtension,\r\n            projectFps\r\n          );\r\n          const newDuration = snapTimeToFrame(\r\n            element.duration + actualExtension,\r\n            projectFps\r\n          );\r\n\r\n          // Keep trimStart at 0 and extend the element\r\n          updateElementTrim(\r\n            track.id,\r\n            element.id,\r\n            0,\r\n            resizing.initialTrimEnd,\r\n            false\r\n          );\r\n          updateElementDuration(track.id, element.id, newDuration, false);\r\n          updateElementStartTime(track.id, element.id, newStartTime, false);\r\n        } else {\r\n          // Video/Audio: can't extend beyond original content - limit to trimStart = 0\r\n          const newTrimStart = 0;\r\n          const trimDelta = newTrimStart - resizing.initialTrimStart;\r\n          const newStartTime = snapTimeToFrame(\r\n            element.startTime + trimDelta,\r\n            projectFps\r\n          );\r\n\r\n          updateElementTrim(\r\n            track.id,\r\n            element.id,\r\n            newTrimStart,\r\n            resizing.initialTrimEnd,\r\n            false\r\n          );\r\n          updateElementStartTime(track.id, element.id, newStartTime, false);\r\n        }\r\n      }\r\n    } else {\r\n      // Right resize - can extend duration for supported element types\r\n      const calculated = resizing.initialTrimEnd - deltaTime;\r\n\r\n      if (calculated < 0) {\r\n        // We're trying to extend beyond original duration\r\n        if (canExtendElementDuration()) {\r\n          // Extend the duration instead of reducing trimEnd further\r\n          const extensionNeeded = Math.abs(calculated);\r\n          const newDuration = snapTimeToFrame(\r\n            element.duration + extensionNeeded,\r\n            projectFps\r\n          );\r\n          const newTrimEnd = 0; // Reset trimEnd to 0 since we're extending\r\n\r\n          // Update duration first, then trim\r\n          updateElementDuration(track.id, element.id, newDuration, false);\r\n          updateElementTrim(\r\n            track.id,\r\n            element.id,\r\n            resizing.initialTrimStart,\r\n            newTrimEnd,\r\n            false\r\n          );\r\n        } else {\r\n          // Can't extend - just set trimEnd to 0 (maximum possible extension)\r\n          updateElementTrim(\r\n            track.id,\r\n            element.id,\r\n            resizing.initialTrimStart,\r\n            0,\r\n            false\r\n          );\r\n        }\r\n      } else {\r\n        // Normal trimming within original duration\r\n        // Calculate the desired end time based on mouse movement\r\n        const currentEndTime =\r\n          element.startTime +\r\n          element.duration -\r\n          element.trimStart -\r\n          element.trimEnd;\r\n        const desiredEndTime = currentEndTime + deltaTime;\r\n\r\n        // Snap the desired end time to frame\r\n        const snappedEndTime = snapTimeToFrame(desiredEndTime, projectFps);\r\n\r\n        // Calculate what trimEnd should be to achieve this snapped end time\r\n        const newTrimEnd = Math.max(\r\n          0,\r\n          element.duration -\r\n            element.trimStart -\r\n            (snappedEndTime - element.startTime)\r\n        );\r\n\r\n        // Ensure we don't trim more than available content (leave at least 0.1s visible)\r\n        const maxTrimEnd = element.duration - element.trimStart - 0.1;\r\n        const finalTrimEnd = Math.min(maxTrimEnd, newTrimEnd);\r\n\r\n        updateElementTrim(\r\n          track.id,\r\n          element.id,\r\n          element.trimStart,\r\n          finalTrimEnd,\r\n          false\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleResizeEnd = () => {\r\n    setResizing(null);\r\n  };\r\n\r\n  return {\r\n    resizing,\r\n    isResizing: resizing !== null,\r\n    handleResizeStart,\r\n    // Return empty handlers since we use document listeners now\r\n    handleResizeMove: () => {}, // Not used anymore\r\n    handleResizeEnd: () => {}, // Not used anymore\r\n  };\r\n}\r\n","\"use client\";\r\n\r\nimport {\r\n  Scissors,\r\n  Trash2,\r\n  Copy,\r\n  RefreshCw,\r\n  EyeOff,\r\n  Eye,\r\n  Volume2,\r\n  VolumeX,\r\n} from \"lucide-react\";\r\nimport { useMediaStore } from \"@/stores/media-store\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\nimport AudioWaveform from \"../audio-waveform\";\r\nimport { toast } from \"sonner\";\r\nimport { TimelineElementProps } from \"@/types/timeline\";\r\nimport { useTimelineElementResize } from \"@/hooks/use-timeline-element-resize\";\r\nimport {\r\n  getTrackElementClasses,\r\n  TIMELINE_CONSTANTS,\r\n  getTrackHeight,\r\n} from \"@/constants/timeline-constants\";\r\nimport {\r\n  ContextMenu,\r\n  ContextMenuContent,\r\n  ContextMenuItem,\r\n  ContextMenuSeparator,\r\n  ContextMenuTrigger,\r\n} from \"../../ui/context-menu\";\r\n\r\nexport function TimelineElement({\r\n  element,\r\n  track,\r\n  zoomLevel,\r\n  isSelected,\r\n  onElementMouseDown,\r\n  onElementClick,\r\n}: TimelineElementProps) {\r\n  const { mediaItems } = useMediaStore();\r\n  const {\r\n    updateElementTrim,\r\n    updateElementDuration,\r\n    removeElementFromTrack,\r\n    removeElementFromTrackWithRipple,\r\n    dragState,\r\n    splitElement,\r\n    addElementToTrack,\r\n    replaceElementMedia,\r\n    rippleEditingEnabled,\r\n    toggleElementHidden,\r\n  } = useTimelineStore();\r\n  const { currentTime } = usePlaybackStore();\r\n\r\n  const mediaItem =\r\n    element.type === \"media\"\r\n      ? mediaItems.find((item) => item.id === element.mediaId)\r\n      : null;\r\n  const isAudio = mediaItem?.type === \"audio\";\r\n\r\n  const { resizing, handleResizeStart, handleResizeMove, handleResizeEnd } =\r\n    useTimelineElementResize({\r\n      element,\r\n      track,\r\n      zoomLevel,\r\n      onUpdateTrim: updateElementTrim,\r\n      onUpdateDuration: updateElementDuration,\r\n    });\r\n\r\n  const effectiveDuration =\r\n    element.duration - element.trimStart - element.trimEnd;\r\n  const elementWidth = Math.max(\r\n    TIMELINE_CONSTANTS.ELEMENT_MIN_WIDTH,\r\n    effectiveDuration * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel\r\n  );\r\n\r\n  // Use real-time position during drag, otherwise use stored position\r\n  const isBeingDragged = dragState.elementId === element.id;\r\n  const elementStartTime =\r\n    isBeingDragged && dragState.isDragging\r\n      ? dragState.currentTime\r\n      : element.startTime;\r\n\r\n  // Element should always be positioned at startTime - trimStart only affects content, not position\r\n  const elementLeft = elementStartTime * 50 * zoomLevel;\r\n\r\n  const handleElementSplitContext = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    const effectiveStart = element.startTime;\r\n    const effectiveEnd =\r\n      element.startTime +\r\n      (element.duration - element.trimStart - element.trimEnd);\r\n\r\n    if (currentTime > effectiveStart && currentTime < effectiveEnd) {\r\n      const secondElementId = splitElement(track.id, element.id, currentTime);\r\n      if (!secondElementId) {\r\n        toast.error(\"Failed to split element\");\r\n      }\r\n    } else {\r\n      toast.error(\"Playhead must be within element to split\");\r\n    }\r\n  };\r\n\r\n  const handleElementDuplicateContext = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    const { id, ...elementWithoutId } = element;\r\n    addElementToTrack(track.id, {\r\n      ...elementWithoutId,\r\n      name: element.name + \" (copy)\",\r\n      startTime:\r\n        element.startTime +\r\n        (element.duration - element.trimStart - element.trimEnd) +\r\n        0.1,\r\n    });\r\n  };\r\n\r\n  const handleElementDeleteContext = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    if (rippleEditingEnabled) {\r\n      removeElementFromTrackWithRipple(track.id, element.id);\r\n    } else {\r\n      removeElementFromTrack(track.id, element.id);\r\n    }\r\n  };\r\n\r\n  const handleToggleElementHidden = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    toggleElementHidden(track.id, element.id);\r\n  };\r\n\r\n  const handleReplaceClip = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    if (element.type !== \"media\") {\r\n      toast.error(\"Replace is only available for media clips\");\r\n      return;\r\n    }\r\n\r\n    // Create a file input to select replacement media\r\n    const input = document.createElement(\"input\");\r\n    input.type = \"file\";\r\n    input.accept = \"video/*,audio/*,image/*\";\r\n    input.onchange = async (e) => {\r\n      const file = (e.target as HTMLInputElement).files?.[0];\r\n      if (!file) return;\r\n\r\n      try {\r\n        const result = await replaceElementMedia(track.id, element.id, file);\r\n        if (result.success) {\r\n          toast.success(\"Clip replaced successfully\");\r\n        } else {\r\n          toast.error(result.error || \"Failed to replace clip\");\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Unexpected error replacing clip:\", error);\r\n        toast.error(\r\n          `Unexpected error: ${error instanceof Error ? error.message : \"Unknown error\"}`\r\n        );\r\n      }\r\n    };\r\n    input.click();\r\n  };\r\n\r\n  const renderElementContent = () => {\r\n    if (element.type === \"text\") {\r\n      return (\r\n        <div className=\"w-full h-full flex items-center justify-start pl-2\">\r\n          <span className=\"text-xs text-white truncate\">{element.content}</span>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    // Render media element ->\r\n    const mediaItem = mediaItems.find((item) => item.id === element.mediaId);\r\n    if (!mediaItem) {\r\n      return (\r\n        <span className=\"text-xs text-foreground/80 truncate\">\r\n          {element.name}\r\n        </span>\r\n      );\r\n    }\r\n\r\n    const TILE_ASPECT_RATIO = 16 / 9;\r\n\r\n    if (\r\n      mediaItem.type === \"image\" ||\r\n      (mediaItem.type === \"video\" && mediaItem.thumbnailUrl)\r\n    ) {\r\n      // Calculate tile size based on 16:9 aspect ratio\r\n      const trackHeight = getTrackHeight(track.type);\r\n      const tileHeight = trackHeight;\r\n      const tileWidth = tileHeight * TILE_ASPECT_RATIO;\r\n\r\n      const imageUrl =\r\n        mediaItem.type === \"image\" ? mediaItem.url : mediaItem.thumbnailUrl;\r\n      const isImage = mediaItem.type === \"image\";\r\n\r\n      return (\r\n        <div className=\"w-full h-full flex items-center justify-center\">\r\n          <div\r\n            className={`w-full h-full relative ${\r\n              isSelected ? \"bg-primary\" : \"bg-transparent\"\r\n            }`}\r\n          >\r\n            <div\r\n              className={`absolute top-[0.15rem] bottom-[0.15rem] left-0 right-0`}\r\n              style={{\r\n                backgroundImage: imageUrl ? `url(${imageUrl})` : \"none\",\r\n                backgroundRepeat: \"repeat-x\",\r\n                backgroundSize: `${tileWidth}px ${tileHeight}px`,\r\n                backgroundPosition: \"left center\",\r\n                pointerEvents: \"none\",\r\n              }}\r\n              aria-label={`Tiled ${isImage ? \"background\" : \"thumbnail\"} of ${mediaItem.name}`}\r\n            />\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    // Render audio element ->\r\n    if (mediaItem.type === \"audio\") {\r\n      return (\r\n        <div className=\"w-full h-full flex items-center gap-2\">\r\n          <div className=\"flex-1 min-w-0\">\r\n            <AudioWaveform\r\n              audioUrl={mediaItem.url || \"\"}\r\n              height={24}\r\n              className=\"w-full\"\r\n            />\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <span className=\"text-xs text-foreground/80 truncate\">\r\n        {element.name}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  const handleElementMouseDown = (e: React.MouseEvent) => {\r\n    if (onElementMouseDown) {\r\n      onElementMouseDown(e, element);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <ContextMenu>\r\n      <ContextMenuTrigger asChild>\r\n        <div\r\n          className={`absolute top-0 h-full select-none timeline-element ${\r\n            isBeingDragged ? \"z-50\" : \"z-10\"\r\n          }`}\r\n          style={{\r\n            left: `${elementLeft}px`,\r\n            width: `${elementWidth}px`,\r\n          }}\r\n          data-element-id={element.id}\r\n          data-track-id={track.id}\r\n          onMouseMove={resizing ? handleResizeMove : undefined}\r\n          onMouseUp={resizing ? handleResizeEnd : undefined}\r\n          onMouseLeave={resizing ? handleResizeEnd : undefined}\r\n        >\r\n          <div\r\n            className={`relative h-full rounded-[0.15rem] cursor-pointer overflow-hidden ${getTrackElementClasses(\r\n              track.type\r\n            )} ${isSelected ? \"\" : \"\"} ${\r\n              isBeingDragged ? \"z-50\" : \"z-10\"\r\n            } ${element.hidden ? \"opacity-50\" : \"\"}`}\r\n            onClick={(e) => onElementClick && onElementClick(e, element)}\r\n            onMouseDown={handleElementMouseDown}\r\n            onContextMenu={(e) =>\r\n              onElementMouseDown && onElementMouseDown(e, element)\r\n            }\r\n          >\r\n            <div className=\"absolute inset-0 flex items-center h-full\">\r\n              {renderElementContent()}\r\n            </div>\r\n\r\n            {element.hidden && (\r\n              <div className=\"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center pointer-events-none\">\r\n                {isAudio ? (\r\n                  <VolumeX className=\"h-6 w-6 text-white\" />\r\n                ) : (\r\n                  <EyeOff className=\"h-6 w-6 text-white\" />\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {isSelected && (\r\n              <>\r\n                <div\r\n                  className=\"absolute left-0 top-0 bottom-0 w-[0.2rem] cursor-w-resize bg-primary z-50\"\r\n                  onMouseDown={(e) => handleResizeStart(e, element.id, \"left\")}\r\n                />\r\n                <div\r\n                  className=\"absolute right-0 top-0 bottom-0 w-[0.2rem] cursor-e-resize bg-primary z-50\"\r\n                  onMouseDown={(e) => handleResizeStart(e, element.id, \"right\")}\r\n                />\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </ContextMenuTrigger>\r\n      <ContextMenuContent className=\"z-200\">\r\n        <ContextMenuItem onClick={handleElementSplitContext}>\r\n          <Scissors className=\"h-4 w-4 mr-2\" />\r\n          Split at playhead\r\n        </ContextMenuItem>\r\n        <ContextMenuItem onClick={handleToggleElementHidden}>\r\n          {isAudio ? (\r\n            element.hidden ? (\r\n              <Volume2 className=\"h-4 w-4 mr-2\" />\r\n            ) : (\r\n              <VolumeX className=\"h-4 w-4 mr-2\" />\r\n            )\r\n          ) : element.hidden ? (\r\n            <Eye className=\"h-4 w-4 mr-2\" />\r\n          ) : (\r\n            <EyeOff className=\"h-4 w-4 mr-2\" />\r\n          )}\r\n          <span>\r\n            {isAudio\r\n              ? element.hidden\r\n                ? \"Unmute\"\r\n                : \"Mute\"\r\n              : element.hidden\r\n                ? \"Show\"\r\n                : \"Hide\"}{\" \"}\r\n            {element.type === \"text\" ? \"text\" : \"clip\"}\r\n          </span>\r\n        </ContextMenuItem>\r\n        <ContextMenuItem onClick={handleElementDuplicateContext}>\r\n          <Copy className=\"h-4 w-4 mr-2\" />\r\n          Duplicate {element.type === \"text\" ? \"text\" : \"clip\"}\r\n        </ContextMenuItem>\r\n        {element.type === \"media\" && (\r\n          <ContextMenuItem onClick={handleReplaceClip}>\r\n            <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n            Replace clip\r\n          </ContextMenuItem>\r\n        )}\r\n        <ContextMenuSeparator />\r\n        <ContextMenuItem\r\n          onClick={handleElementDeleteContext}\r\n          className=\"text-destructive focus:text-destructive\"\r\n        >\r\n          <Trash2 className=\"h-4 w-4 mr-2\" />\r\n          Delete {element.type === \"text\" ? \"text\" : \"clip\"}\r\n        </ContextMenuItem>\r\n      </ContextMenuContent>\r\n    </ContextMenu>\r\n  );\r\n}\r\n","import { useCallback } from \"react\";\r\nimport { TimelineTrack } from \"@/types/timeline\";\r\nimport { TIMELINE_CONSTANTS } from \"@/constants/timeline-constants\";\r\n\r\nexport interface SnapPoint {\r\n  time: number;\r\n  type: \"element-start\" | \"element-end\" | \"playhead\";\r\n  elementId?: string;\r\n  trackId?: string;\r\n}\r\n\r\nexport interface SnapResult {\r\n  snappedTime: number;\r\n  snapPoint: SnapPoint | null;\r\n  snapDistance: number;\r\n}\r\n\r\nexport interface UseTimelineSnappingOptions {\r\n  snapThreshold?: number; // Distance in pixels to trigger snapping\r\n  enableElementSnapping?: boolean;\r\n  enablePlayheadSnapping?: boolean;\r\n}\r\n\r\nexport function useTimelineSnapping({\r\n  snapThreshold = 10,\r\n  enableElementSnapping = true,\r\n  enablePlayheadSnapping = true,\r\n}: UseTimelineSnappingOptions = {}) {\r\n  const findSnapPoints = useCallback(\r\n    (\r\n      tracks: TimelineTrack[],\r\n      currentTime: number,\r\n      playheadTime: number,\r\n      zoomLevel: number,\r\n      excludeElementId?: string\r\n    ): SnapPoint[] => {\r\n      const snapPoints: SnapPoint[] = [];\r\n\r\n      // Add element snap points\r\n      if (enableElementSnapping) {\r\n        tracks.forEach((track) => {\r\n          track.elements.forEach((element) => {\r\n            // Skip the element being dragged\r\n            if (element.id === excludeElementId) return;\r\n\r\n            const elementStart = element.startTime;\r\n            const elementEnd =\r\n              element.startTime +\r\n              (element.duration - element.trimStart - element.trimEnd);\r\n\r\n            snapPoints.push(\r\n              {\r\n                time: elementStart,\r\n                type: \"element-start\",\r\n                elementId: element.id,\r\n                trackId: track.id,\r\n              },\r\n              {\r\n                time: elementEnd,\r\n                type: \"element-end\",\r\n                elementId: element.id,\r\n                trackId: track.id,\r\n              }\r\n            );\r\n          });\r\n        });\r\n      }\r\n\r\n      // Add playhead snap point\r\n      if (enablePlayheadSnapping) {\r\n        snapPoints.push({\r\n          time: playheadTime,\r\n          type: \"playhead\",\r\n        });\r\n      }\r\n\r\n      return snapPoints;\r\n    },\r\n    [enableElementSnapping, enablePlayheadSnapping]\r\n  );\r\n\r\n  const snapToNearestPoint = useCallback(\r\n    (\r\n      targetTime: number,\r\n      snapPoints: SnapPoint[],\r\n      zoomLevel: number\r\n    ): SnapResult => {\r\n      const pixelsPerSecond = TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel;\r\n      const thresholdInSeconds = snapThreshold / pixelsPerSecond;\r\n\r\n      let closestSnapPoint: SnapPoint | null = null;\r\n      let closestDistance = Infinity;\r\n\r\n      snapPoints.forEach((snapPoint) => {\r\n        const distance = Math.abs(targetTime - snapPoint.time);\r\n        if (distance < thresholdInSeconds && distance < closestDistance) {\r\n          closestDistance = distance;\r\n          closestSnapPoint = snapPoint;\r\n        }\r\n      });\r\n\r\n      return {\r\n        snappedTime: closestSnapPoint\r\n          ? (closestSnapPoint as SnapPoint).time\r\n          : targetTime,\r\n        snapPoint: closestSnapPoint,\r\n        snapDistance: closestDistance,\r\n      };\r\n    },\r\n    [snapThreshold]\r\n  );\r\n\r\n  const snapElementPosition = useCallback(\r\n    (\r\n      targetTime: number,\r\n      tracks: TimelineTrack[],\r\n      playheadTime: number,\r\n      zoomLevel: number,\r\n      excludeElementId?: string\r\n    ): SnapResult => {\r\n      const snapPoints = findSnapPoints(\r\n        tracks,\r\n        targetTime,\r\n        playheadTime,\r\n        zoomLevel,\r\n        excludeElementId\r\n      );\r\n\r\n      return snapToNearestPoint(targetTime, snapPoints, zoomLevel);\r\n    },\r\n    [findSnapPoints, snapToNearestPoint]\r\n  );\r\n\r\n  const snapElementEdge = useCallback(\r\n    (\r\n      targetTime: number,\r\n      elementDuration: number,\r\n      tracks: TimelineTrack[],\r\n      playheadTime: number,\r\n      zoomLevel: number,\r\n      excludeElementId?: string,\r\n      snapToStart = true // true for start edge, false for end edge\r\n    ): SnapResult => {\r\n      const snapPoints = findSnapPoints(\r\n        tracks,\r\n        targetTime,\r\n        playheadTime,\r\n        zoomLevel,\r\n        excludeElementId\r\n      );\r\n\r\n      // For end edge snapping, we need to account for element duration\r\n      const effectiveTargetTime = snapToStart\r\n        ? targetTime\r\n        : targetTime + elementDuration;\r\n      const snapResult = snapToNearestPoint(\r\n        effectiveTargetTime,\r\n        snapPoints,\r\n        zoomLevel\r\n      );\r\n\r\n      // Adjust the snapped time back for end edge\r\n      if (!snapToStart && snapResult.snapPoint) {\r\n        snapResult.snappedTime = snapResult.snappedTime - elementDuration;\r\n      }\r\n\r\n      return snapResult;\r\n    },\r\n    [findSnapPoints, snapToNearestPoint]\r\n  );\r\n\r\n  return {\r\n    snapElementPosition,\r\n    snapElementEdge,\r\n    findSnapPoints,\r\n    snapToNearestPoint,\r\n  };\r\n}\r\n","\"use client\";\r\n\r\nimport { useRef, useState, useEffect } from \"react\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { useMediaStore } from \"@/stores/media-store\";\r\nimport { toast } from \"sonner\";\r\nimport { TimelineElement } from \"./timeline-element\";\r\nimport {\r\n  TimelineTrack,\r\n  sortTracksByOrder,\r\n  ensureMainTrack,\r\n  getMainTrack,\r\n  canElementGoOnTrack,\r\n} from \"@/types/timeline\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\nimport type {\r\n  TimelineElement as TimelineElementType,\r\n  DragData,\r\n} from \"@/types/timeline\";\r\nimport {\r\n  snapTimeToFrame,\r\n  TIMELINE_CONSTANTS,\r\n} from \"@/constants/timeline-constants\";\r\nimport { useProjectStore } from \"@/stores/project-store\";\r\nimport { useTimelineSnapping, SnapPoint } from \"@/hooks/use-timeline-snapping\";\r\n\r\nexport function TimelineTrackContent({\r\n  track,\r\n  zoomLevel,\r\n  onSnapPointChange,\r\n}: {\r\n  track: TimelineTrack;\r\n  zoomLevel: number;\r\n  onSnapPointChange?: (snapPoint: SnapPoint | null) => void;\r\n}) {\r\n  const { mediaItems } = useMediaStore();\r\n  const {\r\n    tracks,\r\n    addTrack,\r\n    moveElementToTrack,\r\n    updateElementStartTime,\r\n    updateElementStartTimeWithRipple,\r\n    addElementToTrack,\r\n    selectedElements,\r\n    selectElement,\r\n    dragState,\r\n    startDrag: startDragAction,\r\n    updateDragTime,\r\n    endDrag: endDragAction,\r\n    clearSelectedElements,\r\n    insertTrackAt,\r\n    snappingEnabled,\r\n    rippleEditingEnabled,\r\n  } = useTimelineStore();\r\n\r\n  const { currentTime } = usePlaybackStore();\r\n\r\n  // Initialize snapping hook\r\n  const { snapElementPosition, snapElementEdge } = useTimelineSnapping({\r\n    snapThreshold: 10,\r\n    enableElementSnapping: snappingEnabled,\r\n    enablePlayheadSnapping: snappingEnabled,\r\n  });\r\n\r\n  // Helper function for drop snapping that tries both edges\r\n  const getDropSnappedTime = (\r\n    dropTime: number,\r\n    elementDuration: number,\r\n    excludeElementId?: string\r\n  ) => {\r\n    // Always apply frame snapping first\r\n    const projectStore = useProjectStore.getState();\r\n    const projectFps = projectStore.activeProject?.fps || 30;\r\n    let finalTime = snapTimeToFrame(dropTime, projectFps);\r\n\r\n    // Additionally apply element snapping if enabled\r\n    if (snappingEnabled) {\r\n      // Try snapping both start and end edges for drops\r\n      const startSnapResult = snapElementEdge(\r\n        dropTime,\r\n        elementDuration,\r\n        tracks,\r\n        currentTime,\r\n        zoomLevel,\r\n        excludeElementId,\r\n        true // snap to start edge\r\n      );\r\n\r\n      const endSnapResult = snapElementEdge(\r\n        dropTime,\r\n        elementDuration,\r\n        tracks,\r\n        currentTime,\r\n        zoomLevel,\r\n        excludeElementId,\r\n        false // snap to end edge\r\n      );\r\n\r\n      // Choose the snap result with the smaller distance (closer snap)\r\n      let bestSnapResult = startSnapResult;\r\n      if (\r\n        endSnapResult.snapPoint &&\r\n        (!startSnapResult.snapPoint ||\r\n          endSnapResult.snapDistance < startSnapResult.snapDistance)\r\n      ) {\r\n        bestSnapResult = endSnapResult;\r\n      }\r\n\r\n      // Only use element snapping if it found a snap point, otherwise keep frame-snapped time\r\n      if (bestSnapResult.snapPoint) {\r\n        finalTime = bestSnapResult.snappedTime;\r\n      }\r\n    }\r\n\r\n    return finalTime;\r\n  };\r\n\r\n  const timelineRef = useRef<HTMLDivElement>(null);\r\n  const [isDropping, setIsDropping] = useState(false);\r\n  const [dropPosition, setDropPosition] = useState<number | null>(null);\r\n  const [wouldOverlap, setWouldOverlap] = useState(false);\r\n  const dragCounterRef = useRef(0);\r\n  const [mouseDownLocation, setMouseDownLocation] = useState<{\r\n    x: number;\r\n    y: number;\r\n  } | null>(null);\r\n\r\n  // Set up mouse event listeners for drag\r\n  useEffect(() => {\r\n    if (!dragState.isDragging) return;\r\n\r\n    const handleMouseMove = (e: MouseEvent) => {\r\n      if (!timelineRef.current) return;\r\n\r\n      // On first mouse move during drag, ensure the element is selected\r\n      if (dragState.elementId && dragState.trackId) {\r\n        const isSelected = selectedElements.some(\r\n          (c) =>\r\n            c.trackId === dragState.trackId &&\r\n            c.elementId === dragState.elementId\r\n        );\r\n\r\n        if (!isSelected) {\r\n          // Select this element (replacing other selections) since we're dragging it\r\n          selectElement(dragState.trackId, dragState.elementId, false);\r\n        }\r\n      }\r\n\r\n      const timelineRect = timelineRef.current.getBoundingClientRect();\r\n      const mouseX = e.clientX - timelineRect.left;\r\n      const mouseTime = Math.max(\r\n        0,\r\n        mouseX / (TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel)\r\n      );\r\n      const adjustedTime = Math.max(0, mouseTime - dragState.clickOffsetTime);\r\n\r\n      // Always apply frame snapping first\r\n      const projectStore = useProjectStore.getState();\r\n      const projectFps = projectStore.activeProject?.fps || 30;\r\n      let finalTime = snapTimeToFrame(adjustedTime, projectFps);\r\n      let snapPoint = null;\r\n\r\n      // Additionally apply element snapping if enabled\r\n      if (snappingEnabled) {\r\n        // Find the element being dragged to get its duration\r\n        let elementDuration = 5; // fallback duration\r\n        if (dragState.elementId && dragState.trackId) {\r\n          const sourceTrack = tracks.find((t) => t.id === dragState.trackId);\r\n          const element = sourceTrack?.elements.find(\r\n            (e) => e.id === dragState.elementId\r\n          );\r\n          if (element) {\r\n            elementDuration =\r\n              element.duration - element.trimStart - element.trimEnd;\r\n          }\r\n        }\r\n\r\n        // Try snapping both start and end edges\r\n        const startSnapResult = snapElementEdge(\r\n          adjustedTime,\r\n          elementDuration,\r\n          tracks,\r\n          currentTime,\r\n          zoomLevel,\r\n          dragState.elementId || undefined,\r\n          true // snap to start edge\r\n        );\r\n\r\n        const endSnapResult = snapElementEdge(\r\n          adjustedTime,\r\n          elementDuration,\r\n          tracks,\r\n          currentTime,\r\n          zoomLevel,\r\n          dragState.elementId || undefined,\r\n          false // snap to end edge\r\n        );\r\n\r\n        // Choose the snap result with the smaller distance (closer snap)\r\n        let bestSnapResult = startSnapResult;\r\n        if (\r\n          endSnapResult.snapPoint &&\r\n          (!startSnapResult.snapPoint ||\r\n            endSnapResult.snapDistance < startSnapResult.snapDistance)\r\n        ) {\r\n          bestSnapResult = endSnapResult;\r\n        }\r\n\r\n        // Only use element snapping if it found a snap point, otherwise keep frame-snapped time\r\n        if (bestSnapResult.snapPoint) {\r\n          finalTime = bestSnapResult.snappedTime;\r\n          snapPoint = bestSnapResult.snapPoint;\r\n        }\r\n\r\n        // Notify parent component about snap point change\r\n        onSnapPointChange?.(snapPoint);\r\n      } else {\r\n        // Clear snap point when element snapping is disabled\r\n        onSnapPointChange?.(null);\r\n      }\r\n\r\n      updateDragTime(finalTime);\r\n    };\r\n\r\n    const handleMouseUp = (e: MouseEvent) => {\r\n      if (!dragState.elementId || !dragState.trackId) return;\r\n\r\n      // If this track initiated the drag, we should handle the mouse up regardless of where it occurs\r\n      const isTrackThatStartedDrag = dragState.trackId === track.id;\r\n\r\n      const timelineRect = timelineRef.current?.getBoundingClientRect();\r\n      if (!timelineRect) {\r\n        if (isTrackThatStartedDrag) {\r\n          if (rippleEditingEnabled) {\r\n            updateElementStartTimeWithRipple(\r\n              track.id,\r\n              dragState.elementId,\r\n              dragState.currentTime\r\n            );\r\n          } else {\r\n            updateElementStartTime(\r\n              track.id,\r\n              dragState.elementId,\r\n              dragState.currentTime\r\n            );\r\n          }\r\n          endDragAction();\r\n          // Clear snap point when drag ends\r\n          onSnapPointChange?.(null);\r\n        }\r\n        return;\r\n      }\r\n\r\n      const isMouseOverThisTrack =\r\n        e.clientY >= timelineRect.top && e.clientY <= timelineRect.bottom;\r\n\r\n      if (!isMouseOverThisTrack && !isTrackThatStartedDrag) return;\r\n\r\n      const finalTime = dragState.currentTime;\r\n\r\n      if (isMouseOverThisTrack) {\r\n        const sourceTrack = tracks.find((t) => t.id === dragState.trackId);\r\n        const movingElement = sourceTrack?.elements.find(\r\n          (c) => c.id === dragState.elementId\r\n        );\r\n\r\n        if (movingElement) {\r\n          const movingElementDuration =\r\n            movingElement.duration -\r\n            movingElement.trimStart -\r\n            movingElement.trimEnd;\r\n          const movingElementEnd = finalTime + movingElementDuration;\r\n\r\n          const targetTrack = tracks.find((t) => t.id === track.id);\r\n          const hasOverlap = targetTrack?.elements.some((existingElement) => {\r\n            if (\r\n              dragState.trackId === track.id &&\r\n              existingElement.id === dragState.elementId\r\n            ) {\r\n              return false;\r\n            }\r\n            const existingStart = existingElement.startTime;\r\n            const existingEnd =\r\n              existingElement.startTime +\r\n              (existingElement.duration -\r\n                existingElement.trimStart -\r\n                existingElement.trimEnd);\r\n            return finalTime < existingEnd && movingElementEnd > existingStart;\r\n          });\r\n\r\n          if (!hasOverlap) {\r\n            if (dragState.trackId === track.id) {\r\n              if (rippleEditingEnabled) {\r\n                updateElementStartTimeWithRipple(\r\n                  track.id,\r\n                  dragState.elementId,\r\n                  finalTime\r\n                );\r\n              } else {\r\n                updateElementStartTime(\r\n                  track.id,\r\n                  dragState.elementId,\r\n                  finalTime\r\n                );\r\n              }\r\n            } else {\r\n              moveElementToTrack(\r\n                dragState.trackId,\r\n                track.id,\r\n                dragState.elementId\r\n              );\r\n              requestAnimationFrame(() => {\r\n                if (rippleEditingEnabled) {\r\n                  updateElementStartTimeWithRipple(\r\n                    track.id,\r\n                    dragState.elementId!,\r\n                    finalTime\r\n                  );\r\n                } else {\r\n                  updateElementStartTime(\r\n                    track.id,\r\n                    dragState.elementId!,\r\n                    finalTime\r\n                  );\r\n                }\r\n              });\r\n            }\r\n          }\r\n        }\r\n      } else if (isTrackThatStartedDrag) {\r\n        // Mouse is not over this track, but this track started the drag\r\n        // This means user released over ruler/outside - update position within same track\r\n        const sourceTrack = tracks.find((t) => t.id === dragState.trackId);\r\n        const movingElement = sourceTrack?.elements.find(\r\n          (c) => c.id === dragState.elementId\r\n        );\r\n\r\n        if (movingElement) {\r\n          const movingElementDuration =\r\n            movingElement.duration -\r\n            movingElement.trimStart -\r\n            movingElement.trimEnd;\r\n          const movingElementEnd = finalTime + movingElementDuration;\r\n\r\n          const hasOverlap = track.elements.some((existingElement) => {\r\n            if (existingElement.id === dragState.elementId) {\r\n              return false;\r\n            }\r\n            const existingStart = existingElement.startTime;\r\n            const existingEnd =\r\n              existingElement.startTime +\r\n              (existingElement.duration -\r\n                existingElement.trimStart -\r\n                existingElement.trimEnd);\r\n            return finalTime < existingEnd && movingElementEnd > existingStart;\r\n          });\r\n\r\n          if (!hasOverlap) {\r\n            if (rippleEditingEnabled) {\r\n              updateElementStartTimeWithRipple(\r\n                track.id,\r\n                dragState.elementId,\r\n                finalTime\r\n              );\r\n            } else {\r\n              updateElementStartTime(track.id, dragState.elementId, finalTime);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      if (isTrackThatStartedDrag) {\r\n        endDragAction();\r\n        // Clear snap point when drag ends\r\n        onSnapPointChange?.(null);\r\n      }\r\n    };\r\n\r\n    document.addEventListener(\"mousemove\", handleMouseMove);\r\n    document.addEventListener(\"mouseup\", handleMouseUp);\r\n\r\n    return () => {\r\n      document.removeEventListener(\"mousemove\", handleMouseMove);\r\n      document.removeEventListener(\"mouseup\", handleMouseUp);\r\n    };\r\n  }, [\r\n    dragState.isDragging,\r\n    dragState.clickOffsetTime,\r\n    dragState.elementId,\r\n    dragState.trackId,\r\n    dragState.currentTime,\r\n    zoomLevel,\r\n    tracks,\r\n    track.id,\r\n    updateDragTime,\r\n    updateElementStartTime,\r\n    moveElementToTrack,\r\n    endDragAction,\r\n    selectedElements,\r\n    selectElement,\r\n    onSnapPointChange,\r\n  ]);\r\n\r\n  const handleElementMouseDown = (\r\n    e: React.MouseEvent,\r\n    element: TimelineElementType\r\n  ) => {\r\n    setMouseDownLocation({ x: e.clientX, y: e.clientY });\r\n\r\n    // Detect right-click (button 2) and handle selection without starting drag\r\n    const isRightClick = e.button === 2;\r\n    const isMultiSelect = e.metaKey || e.ctrlKey || e.shiftKey;\r\n\r\n    if (isRightClick) {\r\n      // Handle right-click selection\r\n      const isSelected = selectedElements.some(\r\n        (c) => c.trackId === track.id && c.elementId === element.id\r\n      );\r\n\r\n      // If element is not selected, select it (keep other selections if multi-select)\r\n      if (!isSelected) {\r\n        selectElement(track.id, element.id, isMultiSelect);\r\n      }\r\n      // If element is already selected, keep it selected\r\n\r\n      // Don't start drag action for right-clicks\r\n      return;\r\n    }\r\n\r\n    // Handle multi-selection for left-click with modifiers\r\n    if (isMultiSelect) {\r\n      selectElement(track.id, element.id, true);\r\n    }\r\n\r\n    // Calculate the offset from the left edge of the element to where the user clicked\r\n    const elementElement = e.currentTarget as HTMLElement;\r\n    const elementRect = elementElement.getBoundingClientRect();\r\n    const clickOffsetX = e.clientX - elementRect.left;\r\n    const clickOffsetTime =\r\n      clickOffsetX / (TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel);\r\n\r\n    startDragAction(\r\n      element.id,\r\n      track.id,\r\n      e.clientX,\r\n      element.startTime,\r\n      clickOffsetTime\r\n    );\r\n  };\r\n\r\n  const handleElementClick = (\r\n    e: React.MouseEvent,\r\n    element: TimelineElementType\r\n  ) => {\r\n    e.stopPropagation();\r\n\r\n    // Check if mouse moved significantly\r\n    if (mouseDownLocation) {\r\n      const deltaX = Math.abs(e.clientX - mouseDownLocation.x);\r\n      const deltaY = Math.abs(e.clientY - mouseDownLocation.y);\r\n      // If it moved more than a few pixels, consider it a drag and not a click.\r\n      if (deltaX > 5 || deltaY > 5) {\r\n        setMouseDownLocation(null); // Reset for next interaction\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Skip selection logic for multi-selection (handled in mousedown)\r\n    if (e.metaKey || e.ctrlKey || e.shiftKey) {\r\n      return;\r\n    }\r\n\r\n    // Handle single selection\r\n    const isSelected = selectedElements.some(\r\n      (c) => c.trackId === track.id && c.elementId === element.id\r\n    );\r\n\r\n    if (!isSelected) {\r\n      // If element is not selected, select it (replacing other selections)\r\n      selectElement(track.id, element.id, false);\r\n    }\r\n    // If element is already selected, keep it selected (do nothing)\r\n  };\r\n\r\n  const handleTrackDragOver = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n\r\n    // Handle both timeline elements and media items\r\n    const hasTimelineElement = e.dataTransfer.types.includes(\r\n      \"application/x-timeline-element\"\r\n    );\r\n    const hasMediaItem = e.dataTransfer.types.includes(\r\n      \"application/x-media-item\"\r\n    );\r\n\r\n    if (!hasTimelineElement && !hasMediaItem) return;\r\n\r\n    // Calculate drop position for overlap checking\r\n    const trackContainer = e.currentTarget.querySelector(\r\n      \".track-elements-container\"\r\n    ) as HTMLElement;\r\n    let dropTime = 0;\r\n    if (trackContainer) {\r\n      const rect = trackContainer.getBoundingClientRect();\r\n      const mouseX = Math.max(0, e.clientX - rect.left);\r\n      dropTime = mouseX / (TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel);\r\n    }\r\n\r\n    // Check for potential overlaps and show appropriate feedback\r\n    let wouldOverlap = false;\r\n\r\n    if (hasMediaItem) {\r\n      try {\r\n        const mediaItemData = e.dataTransfer.getData(\r\n          \"application/x-media-item\"\r\n        );\r\n        if (mediaItemData) {\r\n          const dragData: DragData = JSON.parse(mediaItemData);\r\n\r\n          if (dragData.type === \"text\") {\r\n            // Text elements have default duration of 5 seconds\r\n            const newElementDuration = 5;\r\n            const snappedTime = getDropSnappedTime(\r\n              dropTime,\r\n              newElementDuration\r\n            );\r\n            const newElementEnd = snappedTime + newElementDuration;\r\n\r\n            wouldOverlap = track.elements.some((existingElement) => {\r\n              const existingStart = existingElement.startTime;\r\n              const existingEnd =\r\n                existingElement.startTime +\r\n                (existingElement.duration -\r\n                  existingElement.trimStart -\r\n                  existingElement.trimEnd);\r\n              return snappedTime < existingEnd && newElementEnd > existingStart;\r\n            });\r\n          } else {\r\n            // Media elements\r\n            const mediaItem = mediaItems.find(\r\n              (item) => item.id === dragData.id\r\n            );\r\n            if (mediaItem) {\r\n              const newElementDuration = mediaItem.duration || 5;\r\n              const snappedTime = getDropSnappedTime(\r\n                dropTime,\r\n                newElementDuration\r\n              );\r\n              const newElementEnd = snappedTime + newElementDuration;\r\n\r\n              wouldOverlap = track.elements.some((existingElement) => {\r\n                const existingStart = existingElement.startTime;\r\n                const existingEnd =\r\n                  existingElement.startTime +\r\n                  (existingElement.duration -\r\n                    existingElement.trimStart -\r\n                    existingElement.trimEnd);\r\n                return (\r\n                  snappedTime < existingEnd && newElementEnd > existingStart\r\n                );\r\n              });\r\n            }\r\n          }\r\n        }\r\n      } catch (error) {\r\n        // Continue with default behavior\r\n      }\r\n    } else if (hasTimelineElement) {\r\n      try {\r\n        const timelineElementData = e.dataTransfer.getData(\r\n          \"application/x-timeline-element\"\r\n        );\r\n        if (timelineElementData) {\r\n          const { elementId, trackId: fromTrackId } =\r\n            JSON.parse(timelineElementData);\r\n          const sourceTrack = tracks.find(\r\n            (t: TimelineTrack) => t.id === fromTrackId\r\n          );\r\n          const movingElement = sourceTrack?.elements.find(\r\n            (c: any) => c.id === elementId\r\n          );\r\n\r\n          if (movingElement) {\r\n            const movingElementDuration =\r\n              movingElement.duration -\r\n              movingElement.trimStart -\r\n              movingElement.trimEnd;\r\n            const snappedTime = getDropSnappedTime(\r\n              dropTime,\r\n              movingElementDuration,\r\n              elementId\r\n            );\r\n            const movingElementEnd = snappedTime + movingElementDuration;\r\n\r\n            wouldOverlap = track.elements.some((existingElement) => {\r\n              if (fromTrackId === track.id && existingElement.id === elementId)\r\n                return false;\r\n\r\n              const existingStart = existingElement.startTime;\r\n              const existingEnd =\r\n                existingElement.startTime +\r\n                (existingElement.duration -\r\n                  existingElement.trimStart -\r\n                  existingElement.trimEnd);\r\n              return (\r\n                snappedTime < existingEnd && movingElementEnd > existingStart\r\n              );\r\n            });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        // Continue with default behavior\r\n      }\r\n    }\r\n\r\n    if (wouldOverlap) {\r\n      e.dataTransfer.dropEffect = \"none\";\r\n      setWouldOverlap(true);\r\n      // Use default duration for position indicator\r\n      setDropPosition(getDropSnappedTime(dropTime, 5));\r\n      return;\r\n    }\r\n\r\n    e.dataTransfer.dropEffect = hasTimelineElement ? \"move\" : \"copy\";\r\n    setWouldOverlap(false);\r\n    // Use default duration for position indicator\r\n    setDropPosition(getDropSnappedTime(dropTime, 5));\r\n  };\r\n\r\n  const handleTrackDragEnter = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n\r\n    const hasTimelineElement = e.dataTransfer.types.includes(\r\n      \"application/x-timeline-element\"\r\n    );\r\n    const hasMediaItem = e.dataTransfer.types.includes(\r\n      \"application/x-media-item\"\r\n    );\r\n\r\n    if (!hasTimelineElement && !hasMediaItem) return;\r\n\r\n    dragCounterRef.current++;\r\n    setIsDropping(true);\r\n  };\r\n\r\n  const handleTrackDragLeave = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n\r\n    const hasTimelineElement = e.dataTransfer.types.includes(\r\n      \"application/x-timeline-element\"\r\n    );\r\n    const hasMediaItem = e.dataTransfer.types.includes(\r\n      \"application/x-media-item\"\r\n    );\r\n\r\n    if (!hasTimelineElement && !hasMediaItem) return;\r\n\r\n    dragCounterRef.current--;\r\n\r\n    if (dragCounterRef.current === 0) {\r\n      setIsDropping(false);\r\n      setWouldOverlap(false);\r\n      setDropPosition(null);\r\n    }\r\n  };\r\n\r\n  const handleTrackDrop = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    // Debug logging\r\n    console.log(\r\n      JSON.stringify({\r\n        message: \"Drop event started in timeline track\",\r\n        dataTransferTypes: Array.from(e.dataTransfer.types),\r\n        trackId: track.id,\r\n        trackType: track.type,\r\n      })\r\n    );\r\n\r\n    // Reset all drag states\r\n    dragCounterRef.current = 0;\r\n    setIsDropping(false);\r\n    setWouldOverlap(false);\r\n\r\n    const hasTimelineElement = e.dataTransfer.types.includes(\r\n      \"application/x-timeline-element\"\r\n    );\r\n    const hasMediaItem = e.dataTransfer.types.includes(\r\n      \"application/x-media-item\"\r\n    );\r\n\r\n    if (!hasTimelineElement && !hasMediaItem) return;\r\n\r\n    const trackContainer = e.currentTarget.querySelector(\r\n      \".track-elements-container\"\r\n    ) as HTMLElement;\r\n    if (!trackContainer) return;\r\n\r\n    const rect = trackContainer.getBoundingClientRect();\r\n    const mouseX = Math.max(0, e.clientX - rect.left);\r\n    const mouseY = e.clientY - rect.top; // Get Y position relative to this track\r\n    const newStartTime =\r\n      mouseX / (TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel);\r\n    const projectStore = useProjectStore.getState();\r\n    const projectFps = projectStore.activeProject?.fps || 30;\r\n    const snappedTime = snapTimeToFrame(newStartTime, projectFps);\r\n\r\n    // Calculate drop position relative to tracks\r\n    const currentTrackIndex = tracks.findIndex((t) => t.id === track.id);\r\n\r\n    // Determine drop zone within the track (top 20px, middle 20px, bottom 20px)\r\n    let dropPosition: \"above\" | \"on\" | \"below\";\r\n    if (mouseY < 20) {\r\n      dropPosition = \"above\";\r\n    } else if (mouseY > 40) {\r\n      dropPosition = \"below\";\r\n    } else {\r\n      dropPosition = \"on\";\r\n    }\r\n\r\n    try {\r\n      if (hasTimelineElement) {\r\n        // Handle timeline element movement\r\n        const timelineElementData = e.dataTransfer.getData(\r\n          \"application/x-timeline-element\"\r\n        );\r\n        if (!timelineElementData) return;\r\n\r\n        const {\r\n          elementId,\r\n          trackId: fromTrackId,\r\n          clickOffsetTime = 0,\r\n        } = JSON.parse(timelineElementData);\r\n\r\n        // Find the element being moved\r\n        const sourceTrack = tracks.find(\r\n          (t: TimelineTrack) => t.id === fromTrackId\r\n        );\r\n        const movingElement = sourceTrack?.elements.find(\r\n          (c: TimelineElementType) => c.id === elementId\r\n        );\r\n\r\n        if (!movingElement) {\r\n          toast.error(\"Element not found\");\r\n          return;\r\n        }\r\n\r\n        // Check for overlaps with existing elements (excluding the moving element itself)\r\n        const movingElementDuration =\r\n          movingElement.duration -\r\n          movingElement.trimStart -\r\n          movingElement.trimEnd;\r\n\r\n        // Adjust position based on where user clicked on the element\r\n        const adjustedStartTime = newStartTime - clickOffsetTime;\r\n        const snappedStartTime = getDropSnappedTime(\r\n          adjustedStartTime,\r\n          movingElementDuration,\r\n          elementId\r\n        );\r\n        const finalStartTime = Math.max(0, snappedStartTime);\r\n        const movingElementEnd = finalStartTime + movingElementDuration;\r\n\r\n        const hasOverlap = track.elements.some((existingElement) => {\r\n          // Skip the element being moved if it's on the same track\r\n          if (fromTrackId === track.id && existingElement.id === elementId)\r\n            return false;\r\n\r\n          const existingStart = existingElement.startTime;\r\n          const existingEnd =\r\n            existingElement.startTime +\r\n            (existingElement.duration -\r\n              existingElement.trimStart -\r\n              existingElement.trimEnd);\r\n\r\n          // Check if elements overlap\r\n          return (\r\n            finalStartTime < existingEnd && movingElementEnd > existingStart\r\n          );\r\n        });\r\n\r\n        if (hasOverlap) {\r\n          toast.error(\r\n            \"Cannot move element here - it would overlap with existing elements\"\r\n          );\r\n          return;\r\n        }\r\n\r\n        if (fromTrackId === track.id) {\r\n          // Moving within same track\r\n          if (rippleEditingEnabled) {\r\n            updateElementStartTimeWithRipple(\r\n              track.id,\r\n              elementId,\r\n              finalStartTime\r\n            );\r\n          } else {\r\n            updateElementStartTime(track.id, elementId, finalStartTime);\r\n          }\r\n        } else {\r\n          // Moving to different track\r\n          moveElementToTrack(fromTrackId, track.id, elementId);\r\n          requestAnimationFrame(() => {\r\n            if (rippleEditingEnabled) {\r\n              updateElementStartTimeWithRipple(\r\n                track.id,\r\n                elementId,\r\n                finalStartTime\r\n              );\r\n            } else {\r\n              updateElementStartTime(track.id, elementId, finalStartTime);\r\n            }\r\n          });\r\n        }\r\n      } else if (hasMediaItem) {\r\n        // Handle media item drop\r\n        const mediaItemData = e.dataTransfer.getData(\r\n          \"application/x-media-item\"\r\n        );\r\n        if (!mediaItemData) return;\r\n\r\n        const dragData: DragData = JSON.parse(mediaItemData);\r\n\r\n        if (dragData.type === \"text\") {\r\n          let targetTrackId = track.id;\r\n          let targetTrack = track;\r\n\r\n          // Handle position-aware track creation for text\r\n          if (track.type !== \"text\" || dropPosition !== \"on\") {\r\n            // Text tracks should go above the main track\r\n            const mainTrack = getMainTrack(tracks);\r\n            let insertIndex: number;\r\n\r\n            if (dropPosition === \"above\") {\r\n              insertIndex = currentTrackIndex;\r\n            } else if (dropPosition === \"below\") {\r\n              insertIndex = currentTrackIndex + 1;\r\n            } else {\r\n              // dropPosition === \"on\" but track is not text type\r\n              // Insert above main track if main track exists, otherwise at top\r\n              if (mainTrack) {\r\n                const mainTrackIndex = tracks.findIndex(\r\n                  (t) => t.id === mainTrack.id\r\n                );\r\n                insertIndex = mainTrackIndex;\r\n              } else {\r\n                insertIndex = 0; // Top of timeline\r\n              }\r\n            }\r\n\r\n            targetTrackId = insertTrackAt(\"text\", insertIndex);\r\n            // Get the updated tracks array after creating the new track\r\n            const updatedTracks = useTimelineStore.getState().tracks;\r\n            const newTargetTrack = updatedTracks.find(\r\n              (t) => t.id === targetTrackId\r\n            );\r\n            if (!newTargetTrack) return;\r\n            targetTrack = newTargetTrack;\r\n          }\r\n\r\n          // Check for overlaps with existing elements in target track\r\n          const newElementDuration = 5; // Default text duration\r\n          const textSnappedTime = getDropSnappedTime(\r\n            newStartTime,\r\n            newElementDuration\r\n          );\r\n          const newElementEnd = textSnappedTime + newElementDuration;\r\n\r\n          const hasOverlap = targetTrack.elements.some((existingElement) => {\r\n            const existingStart = existingElement.startTime;\r\n            const existingEnd =\r\n              existingElement.startTime +\r\n              (existingElement.duration -\r\n                existingElement.trimStart -\r\n                existingElement.trimEnd);\r\n\r\n            // Check if elements overlap\r\n            return (\r\n              textSnappedTime < existingEnd && newElementEnd > existingStart\r\n            );\r\n          });\r\n\r\n          if (hasOverlap) {\r\n            toast.error(\r\n              \"Cannot place element here - it would overlap with existing elements\"\r\n            );\r\n            return;\r\n          }\r\n\r\n          addElementToTrack(targetTrackId, {\r\n            type: \"text\",\r\n            name: dragData.name || \"Text\",\r\n            content: dragData.content || \"Default Text\",\r\n            duration: TIMELINE_CONSTANTS.DEFAULT_TEXT_DURATION,\r\n            startTime: textSnappedTime,\r\n            trimStart: 0,\r\n            trimEnd: 0,\r\n            fontSize: 48,\r\n            fontFamily: \"Arial\",\r\n            color: \"#ffffff\",\r\n            backgroundColor: \"transparent\",\r\n            textAlign: \"center\",\r\n            fontWeight: \"normal\",\r\n            fontStyle: \"normal\",\r\n            textDecoration: \"none\",\r\n            x: 0,\r\n            y: 0,\r\n            rotation: 0,\r\n            opacity: 1,\r\n          });\r\n        } else {\r\n          // Handle media items\r\n          const mediaItem = mediaItems.find((item) => item.id === dragData.id);\r\n\r\n          if (!mediaItem) {\r\n            toast.error(\"Media item not found\");\r\n            return;\r\n          }\r\n\r\n          let targetTrackId = track.id;\r\n\r\n          // Check if track type is compatible\r\n          const isVideoOrImage =\r\n            dragData.type === \"video\" || dragData.type === \"image\";\r\n          const isAudio = dragData.type === \"audio\";\r\n          const isCompatible = isVideoOrImage\r\n            ? canElementGoOnTrack(\"media\", track.type)\r\n            : isAudio\r\n              ? canElementGoOnTrack(\"media\", track.type)\r\n              : false;\r\n\r\n          let targetTrack = tracks.find((t) => t.id === targetTrackId);\r\n\r\n          // Handle position-aware track creation for media elements\r\n          if (!isCompatible || dropPosition !== \"on\") {\r\n            if (isVideoOrImage) {\r\n              // For video/image, check if we need a main track or additional media track\r\n              const mainTrack = getMainTrack(tracks);\r\n\r\n              if (!mainTrack) {\r\n                // No main track exists, create it\r\n                targetTrackId = addTrack(\"media\");\r\n                const updatedTracks = useTimelineStore.getState().tracks;\r\n                const newTargetTrack = updatedTracks.find(\r\n                  (t) => t.id === targetTrackId\r\n                );\r\n                if (!newTargetTrack) return;\r\n                targetTrack = newTargetTrack;\r\n              } else if (\r\n                mainTrack.elements.length === 0 &&\r\n                dropPosition === \"on\"\r\n              ) {\r\n                // Main track exists and is empty, use it\r\n                targetTrackId = mainTrack.id;\r\n                targetTrack = mainTrack;\r\n              } else {\r\n                // Create new media track\r\n                let insertIndex: number;\r\n\r\n                if (dropPosition === \"above\") {\r\n                  insertIndex = currentTrackIndex;\r\n                } else if (dropPosition === \"below\") {\r\n                  insertIndex = currentTrackIndex + 1;\r\n                } else {\r\n                  // Insert above main track\r\n                  const mainTrackIndex = tracks.findIndex(\r\n                    (t) => t.id === mainTrack.id\r\n                  );\r\n                  insertIndex = mainTrackIndex;\r\n                }\r\n\r\n                targetTrackId = insertTrackAt(\"media\", insertIndex);\r\n                const updatedTracks = useTimelineStore.getState().tracks;\r\n                const newTargetTrack = updatedTracks.find(\r\n                  (t) => t.id === targetTrackId\r\n                );\r\n                if (!newTargetTrack) return;\r\n                targetTrack = newTargetTrack;\r\n              }\r\n            } else if (isAudio) {\r\n              // Audio tracks go at the bottom\r\n              const mainTrack = getMainTrack(tracks);\r\n              let insertIndex: number;\r\n\r\n              if (dropPosition === \"above\") {\r\n                insertIndex = currentTrackIndex;\r\n              } else if (dropPosition === \"below\") {\r\n                insertIndex = currentTrackIndex + 1;\r\n              } else {\r\n                // Insert after main track (bottom area)\r\n                if (mainTrack) {\r\n                  const mainTrackIndex = tracks.findIndex(\r\n                    (t) => t.id === mainTrack.id\r\n                  );\r\n                  insertIndex = mainTrackIndex + 1;\r\n                } else {\r\n                  insertIndex = tracks.length; // Bottom of timeline\r\n                }\r\n              }\r\n\r\n              targetTrackId = insertTrackAt(\"audio\", insertIndex);\r\n              const updatedTracks = useTimelineStore.getState().tracks;\r\n              const newTargetTrack = updatedTracks.find(\r\n                (t) => t.id === targetTrackId\r\n              );\r\n              if (!newTargetTrack) return;\r\n              targetTrack = newTargetTrack;\r\n            }\r\n          }\r\n\r\n          if (!targetTrack) return;\r\n\r\n          // Check for overlaps with existing elements in target track\r\n          const newElementDuration = mediaItem.duration || 5;\r\n          const mediaSnappedTime = getDropSnappedTime(\r\n            newStartTime,\r\n            newElementDuration\r\n          );\r\n          const newElementEnd = mediaSnappedTime + newElementDuration;\r\n\r\n          const hasOverlap = targetTrack.elements.some((existingElement) => {\r\n            const existingStart = existingElement.startTime;\r\n            const existingEnd =\r\n              existingElement.startTime +\r\n              (existingElement.duration -\r\n                existingElement.trimStart -\r\n                existingElement.trimEnd);\r\n\r\n            // Check if elements overlap\r\n            return (\r\n              mediaSnappedTime < existingEnd && newElementEnd > existingStart\r\n            );\r\n          });\r\n\r\n          if (hasOverlap) {\r\n            toast.error(\r\n              \"Cannot place element here - it would overlap with existing elements\"\r\n            );\r\n            return;\r\n          }\r\n\r\n          addElementToTrack(targetTrackId, {\r\n            type: \"media\",\r\n            mediaId: mediaItem.id,\r\n            name: mediaItem.name,\r\n            duration: mediaItem.duration || 5,\r\n            startTime: mediaSnappedTime,\r\n            trimStart: 0,\r\n            trimEnd: 0,\r\n          });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error handling drop:\", error);\r\n      toast.error(\"Failed to add media to track\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className=\"w-full h-full hover:bg-muted/20\"\r\n      onClick={(e) => {\r\n        // If clicking empty area (not on an element), deselect all elements\r\n        if (!(e.target as HTMLElement).closest(\".timeline-element\")) {\r\n          clearSelectedElements();\r\n        }\r\n      }}\r\n      onDragOver={handleTrackDragOver}\r\n      onDragEnter={handleTrackDragEnter}\r\n      onDragLeave={handleTrackDragLeave}\r\n      onDrop={handleTrackDrop}\r\n    >\r\n      <div\r\n        ref={timelineRef}\r\n        className=\"h-full relative track-elements-container min-w-full\"\r\n      >\r\n        {track.elements.length === 0 ? (\r\n          <div\r\n            className={`h-full w-full rounded-sm border-2 border-dashed flex items-center justify-center text-xs text-muted-foreground transition-colors ${\r\n              isDropping\r\n                ? wouldOverlap\r\n                  ? \"border-red-500 bg-red-500/10 text-red-600\"\r\n                  : \"border-blue-500 bg-blue-500/10 text-blue-600\"\r\n                : \"border-muted/30\"\r\n            }`}\r\n          >\r\n            {isDropping\r\n              ? wouldOverlap\r\n                ? \"Cannot drop - would overlap\"\r\n                : \"Drop element here\"\r\n              : \"\"}\r\n          </div>\r\n        ) : (\r\n          <>\r\n            {track.elements.map((element) => {\r\n              const isSelected = selectedElements.some(\r\n                (c) => c.trackId === track.id && c.elementId === element.id\r\n              );\r\n\r\n              const handleElementSplit = () => {\r\n                const { currentTime } = usePlaybackStore();\r\n                const { splitElement } = useTimelineStore();\r\n                const splitTime = currentTime;\r\n                const effectiveStart = element.startTime;\r\n                const effectiveEnd =\r\n                  element.startTime +\r\n                  (element.duration - element.trimStart - element.trimEnd);\r\n\r\n                if (splitTime > effectiveStart && splitTime < effectiveEnd) {\r\n                  const secondElementId = splitElement(\r\n                    track.id,\r\n                    element.id,\r\n                    splitTime\r\n                  );\r\n                  if (!secondElementId) {\r\n                    toast.error(\"Failed to split element\");\r\n                  }\r\n                } else {\r\n                  toast.error(\"Playhead must be within element to split\");\r\n                }\r\n              };\r\n\r\n              const handleElementDuplicate = () => {\r\n                const { addElementToTrack } = useTimelineStore.getState();\r\n                const { id, ...elementWithoutId } = element;\r\n                addElementToTrack(track.id, {\r\n                  ...elementWithoutId,\r\n                  name: element.name + \" (copy)\",\r\n                  startTime:\r\n                    element.startTime +\r\n                    (element.duration - element.trimStart - element.trimEnd) +\r\n                    0.1,\r\n                });\r\n              };\r\n\r\n              const handleElementDelete = () => {\r\n                const { removeElementFromTrack } = useTimelineStore.getState();\r\n                removeElementFromTrack(track.id, element.id);\r\n              };\r\n\r\n              return (\r\n                <TimelineElement\r\n                  key={element.id}\r\n                  element={element}\r\n                  track={track}\r\n                  zoomLevel={zoomLevel}\r\n                  isSelected={isSelected}\r\n                  onElementMouseDown={handleElementMouseDown}\r\n                  onElementClick={handleElementClick}\r\n                />\r\n              );\r\n            })}\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { snapTimeToFrame } from \"@/constants/timeline-constants\";\r\nimport { useProjectStore } from \"@/stores/project-store\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\nimport { useState, useEffect, useCallback, useRef } from \"react\";\r\n\r\ninterface UseTimelinePlayheadProps {\r\n  currentTime: number;\r\n  duration: number;\r\n  zoomLevel: number;\r\n  seek: (time: number) => void;\r\n  rulerRef: React.RefObject<HTMLDivElement>;\r\n  rulerScrollRef: React.RefObject<HTMLDivElement>;\r\n  tracksScrollRef: React.RefObject<HTMLDivElement>;\r\n  playheadRef?: React.RefObject<HTMLDivElement>;\r\n}\r\n\r\nexport function useTimelinePlayhead({\r\n  currentTime,\r\n  duration,\r\n  zoomLevel,\r\n  seek,\r\n  rulerRef,\r\n  rulerScrollRef,\r\n  tracksScrollRef,\r\n  playheadRef,\r\n}: UseTimelinePlayheadProps) {\r\n  // Playhead scrubbing state\r\n  const [isScrubbing, setIsScrubbing] = useState(false);\r\n  const [scrubTime, setScrubTime] = useState<number | null>(null);\r\n\r\n  // Ruler drag detection state\r\n  const [isDraggingRuler, setIsDraggingRuler] = useState(false);\r\n  const [hasDraggedRuler, setHasDraggedRuler] = useState(false);\r\n\r\n  // Auto-scroll state during dragging\r\n  const autoScrollRef = useRef<number | null>(null);\r\n  const lastMouseXRef = useRef<number>(0);\r\n\r\n  const playheadPosition =\r\n    isScrubbing && scrubTime !== null ? scrubTime : currentTime;\r\n\r\n  // --- Playhead Scrubbing Handlers ---\r\n  const handlePlayheadMouseDown = useCallback(\r\n    (e: React.MouseEvent) => {\r\n      e.preventDefault();\r\n      e.stopPropagation(); // Prevent ruler drag from triggering\r\n      setIsScrubbing(true);\r\n      handleScrub(e);\r\n    },\r\n    [duration, zoomLevel]\r\n  );\r\n\r\n  // Ruler mouse down handler\r\n  const handleRulerMouseDown = useCallback(\r\n    (e: React.MouseEvent) => {\r\n      // Only handle left mouse button\r\n      if (e.button !== 0) return;\r\n\r\n      // Don't interfere if clicking on the playhead itself\r\n      if (playheadRef?.current?.contains(e.target as Node)) return;\r\n\r\n      e.preventDefault();\r\n      setIsDraggingRuler(true);\r\n      setHasDraggedRuler(false);\r\n\r\n      // Start scrubbing immediately\r\n      setIsScrubbing(true);\r\n      handleScrub(e);\r\n    },\r\n    [duration, zoomLevel]\r\n  );\r\n\r\n  const handleScrub = useCallback(\r\n    (e: MouseEvent | React.MouseEvent) => {\r\n      const ruler = rulerRef.current;\r\n      if (!ruler) return;\r\n      const rect = ruler.getBoundingClientRect();\r\n      const rawX = e.clientX - rect.left;\r\n\r\n      // Get the timeline content width based on duration and zoom\r\n      const timelineContentWidth = duration * 50 * zoomLevel; // TIMELINE_CONSTANTS.PIXELS_PER_SECOND = 50\r\n\r\n      // Constrain x to be within the timeline content bounds\r\n      const x = Math.max(0, Math.min(timelineContentWidth, rawX));\r\n\r\n      const rawTime = Math.max(0, Math.min(duration, x / (50 * zoomLevel)));\r\n      // Use frame snapping for playhead scrubbing\r\n      const projectStore = useProjectStore.getState();\r\n      const projectFps = projectStore.activeProject?.fps || 30;\r\n      const time = snapTimeToFrame(rawTime, projectFps);\r\n\r\n      // Debug logging\r\n      if (rawX < 0 || x !== rawX) {\r\n        console.log(\r\n          \"PLAYHEAD DEBUG:\",\r\n          JSON.stringify({\r\n            mouseX: e.clientX,\r\n            rulerLeft: rect.left,\r\n            rawX,\r\n            constrainedX: x,\r\n            timelineContentWidth,\r\n            rawTime,\r\n            finalTime: time,\r\n            duration,\r\n            zoomLevel,\r\n            playheadPx: time * 50 * zoomLevel,\r\n          })\r\n        );\r\n      }\r\n\r\n      setScrubTime(time);\r\n      seek(time); // update video preview in real time\r\n\r\n      // Store mouse position for auto-scrolling\r\n      lastMouseXRef.current = e.clientX;\r\n    },\r\n    [duration, zoomLevel, seek, rulerRef]\r\n  );\r\n\r\n  // Auto-scroll function during dragging\r\n  const performAutoScroll = useCallback(() => {\r\n    const rulerViewport = rulerScrollRef.current?.querySelector(\r\n      \"[data-radix-scroll-area-viewport]\"\r\n    ) as HTMLElement;\r\n    const tracksViewport = tracksScrollRef.current?.querySelector(\r\n      \"[data-radix-scroll-area-viewport]\"\r\n    ) as HTMLElement;\r\n\r\n    if (!rulerViewport || !tracksViewport || !isScrubbing) return;\r\n\r\n    const viewportRect = rulerViewport.getBoundingClientRect();\r\n    const mouseX = lastMouseXRef.current;\r\n    const mouseXRelative = mouseX - viewportRect.left;\r\n\r\n    const edgeThreshold = 100; // pixels from edge to start scrolling\r\n    const maxScrollSpeed = 15; // max pixels per frame\r\n    const viewportWidth = rulerViewport.clientWidth;\r\n\r\n    // Calculate timeline content boundaries\r\n    const timelineContentWidth = duration * 50 * zoomLevel; // TIMELINE_CONSTANTS.PIXELS_PER_SECOND = 50\r\n    const scrollMax = Math.max(0, timelineContentWidth - viewportWidth);\r\n\r\n    let scrollSpeed = 0;\r\n\r\n    // Check if near left edge (and can scroll left)\r\n    if (mouseXRelative < edgeThreshold && rulerViewport.scrollLeft > 0) {\r\n      const edgeDistance = Math.max(0, mouseXRelative);\r\n      const intensity = 1 - edgeDistance / edgeThreshold;\r\n      scrollSpeed = -maxScrollSpeed * intensity;\r\n    }\r\n    // Check if near right edge (and can scroll right, and haven't reached timeline end)\r\n    else if (\r\n      mouseXRelative > viewportWidth - edgeThreshold &&\r\n      rulerViewport.scrollLeft < scrollMax\r\n    ) {\r\n      const edgeDistance = Math.max(\r\n        0,\r\n        viewportWidth - edgeThreshold - mouseXRelative\r\n      );\r\n      const intensity = 1 - edgeDistance / edgeThreshold;\r\n      scrollSpeed = maxScrollSpeed * intensity;\r\n    }\r\n\r\n    if (scrollSpeed !== 0) {\r\n      const newScrollLeft = Math.max(\r\n        0,\r\n        Math.min(scrollMax, rulerViewport.scrollLeft + scrollSpeed)\r\n      );\r\n      rulerViewport.scrollLeft = newScrollLeft;\r\n      tracksViewport.scrollLeft = newScrollLeft;\r\n    }\r\n\r\n    if (isScrubbing) {\r\n      autoScrollRef.current = requestAnimationFrame(performAutoScroll);\r\n    }\r\n  }, [isScrubbing, rulerScrollRef, tracksScrollRef, duration, zoomLevel]);\r\n\r\n  // Mouse move/up event handlers\r\n  useEffect(() => {\r\n    if (!isScrubbing) return;\r\n\r\n    const onMouseMove = (e: MouseEvent) => {\r\n      handleScrub(e);\r\n      // Mark that we've dragged if ruler drag is active\r\n      if (isDraggingRuler) {\r\n        setHasDraggedRuler(true);\r\n      }\r\n    };\r\n\r\n    const onMouseUp = (e: MouseEvent) => {\r\n      setIsScrubbing(false);\r\n      if (scrubTime !== null) seek(scrubTime); // finalize seek\r\n      setScrubTime(null);\r\n\r\n      // Stop auto-scrolling\r\n      if (autoScrollRef.current) {\r\n        cancelAnimationFrame(autoScrollRef.current);\r\n        autoScrollRef.current = null;\r\n      }\r\n\r\n      // Handle ruler click vs drag\r\n      if (isDraggingRuler) {\r\n        setIsDraggingRuler(false);\r\n        // If we didn't drag, treat it as a click-to-seek\r\n        if (!hasDraggedRuler) {\r\n          handleScrub(e);\r\n        }\r\n        setHasDraggedRuler(false);\r\n      }\r\n    };\r\n\r\n    window.addEventListener(\"mousemove\", onMouseMove);\r\n    window.addEventListener(\"mouseup\", onMouseUp);\r\n\r\n    // Start auto-scrolling\r\n    autoScrollRef.current = requestAnimationFrame(performAutoScroll);\r\n\r\n    return () => {\r\n      window.removeEventListener(\"mousemove\", onMouseMove);\r\n      window.removeEventListener(\"mouseup\", onMouseUp);\r\n      if (autoScrollRef.current) {\r\n        cancelAnimationFrame(autoScrollRef.current);\r\n        autoScrollRef.current = null;\r\n      }\r\n    };\r\n  }, [\r\n    isScrubbing,\r\n    scrubTime,\r\n    seek,\r\n    handleScrub,\r\n    isDraggingRuler,\r\n    hasDraggedRuler,\r\n    performAutoScroll,\r\n  ]);\r\n\r\n  // --- Playhead auto-scroll effect (only during playback) ---\r\n  useEffect(() => {\r\n    const { isPlaying } = usePlaybackStore.getState();\r\n\r\n    // Only auto-scroll during playback, not during manual interactions\r\n    if (!isPlaying || isScrubbing) return;\r\n\r\n    const rulerViewport = rulerScrollRef.current?.querySelector(\r\n      \"[data-radix-scroll-area-viewport]\"\r\n    ) as HTMLElement;\r\n    const tracksViewport = tracksScrollRef.current?.querySelector(\r\n      \"[data-radix-scroll-area-viewport]\"\r\n    ) as HTMLElement;\r\n    if (!rulerViewport || !tracksViewport) return;\r\n\r\n    const playheadPx = playheadPosition * 50 * zoomLevel; // TIMELINE_CONSTANTS.PIXELS_PER_SECOND = 50\r\n    const viewportWidth = rulerViewport.clientWidth;\r\n    const scrollMin = 0;\r\n    const scrollMax = rulerViewport.scrollWidth - viewportWidth;\r\n\r\n    // Only auto-scroll if playhead is completely out of view (no buffer)\r\n    const needsScroll =\r\n      playheadPx < rulerViewport.scrollLeft ||\r\n      playheadPx > rulerViewport.scrollLeft + viewportWidth;\r\n\r\n    if (needsScroll) {\r\n      // Center the playhead in the viewport\r\n      const desiredScroll = Math.max(\r\n        scrollMin,\r\n        Math.min(scrollMax, playheadPx - viewportWidth / 2)\r\n      );\r\n      rulerViewport.scrollLeft = tracksViewport.scrollLeft = desiredScroll;\r\n    }\r\n  }, [\r\n    playheadPosition,\r\n    duration,\r\n    zoomLevel,\r\n    rulerScrollRef,\r\n    tracksScrollRef,\r\n    isScrubbing,\r\n  ]);\r\n\r\n  return {\r\n    playheadPosition,\r\n    handlePlayheadMouseDown,\r\n    handleRulerMouseDown,\r\n    isDraggingRuler,\r\n  };\r\n}\r\n","\"use client\";\r\n\r\nimport { useRef, useState, useEffect } from \"react\";\r\nimport { TimelineTrack } from \"@/types/timeline\";\r\nimport { TIMELINE_CONSTANTS } from \"@/constants/timeline-constants\";\r\nimport { useTimelinePlayhead } from \"@/hooks/use-timeline-playhead\";\r\n\r\ninterface TimelinePlayheadProps {\r\n  currentTime: number;\r\n  duration: number;\r\n  zoomLevel: number;\r\n  tracks: TimelineTrack[];\r\n  seek: (time: number) => void;\r\n  rulerRef: React.RefObject<HTMLDivElement>;\r\n  rulerScrollRef: React.RefObject<HTMLDivElement>;\r\n  tracksScrollRef: React.RefObject<HTMLDivElement>;\r\n  trackLabelsRef?: React.RefObject<HTMLDivElement>;\r\n  timelineRef: React.RefObject<HTMLDivElement>;\r\n  playheadRef?: React.RefObject<HTMLDivElement>;\r\n  isSnappingToPlayhead?: boolean;\r\n}\r\n\r\nexport function TimelinePlayhead({\r\n  currentTime,\r\n  duration,\r\n  zoomLevel,\r\n  tracks,\r\n  seek,\r\n  rulerRef,\r\n  rulerScrollRef,\r\n  tracksScrollRef,\r\n  trackLabelsRef,\r\n  timelineRef,\r\n  playheadRef: externalPlayheadRef,\r\n  isSnappingToPlayhead = false,\r\n}: TimelinePlayheadProps) {\r\n  const internalPlayheadRef = useRef<HTMLDivElement>(null);\r\n  const playheadRef = externalPlayheadRef || internalPlayheadRef;\r\n  const [scrollLeft, setScrollLeft] = useState(0);\r\n\r\n  const { playheadPosition, handlePlayheadMouseDown } = useTimelinePlayhead({\r\n    currentTime,\r\n    duration,\r\n    zoomLevel,\r\n    seek,\r\n    rulerRef,\r\n    rulerScrollRef,\r\n    tracksScrollRef,\r\n    playheadRef,\r\n  });\r\n\r\n  // Track scroll position to lock playhead to frame\r\n  useEffect(() => {\r\n    const tracksViewport = tracksScrollRef.current?.querySelector(\r\n      \"[data-radix-scroll-area-viewport]\"\r\n    ) as HTMLElement;\r\n\r\n    if (!tracksViewport) return;\r\n\r\n    const handleScroll = () => {\r\n      setScrollLeft(tracksViewport.scrollLeft);\r\n    };\r\n\r\n    // Set initial scroll position\r\n    setScrollLeft(tracksViewport.scrollLeft);\r\n\r\n    tracksViewport.addEventListener(\"scroll\", handleScroll);\r\n    return () => tracksViewport.removeEventListener(\"scroll\", handleScroll);\r\n  }, [tracksScrollRef]);\r\n\r\n  // Use timeline container height minus a few pixels for breathing room\r\n  const timelineContainerHeight = timelineRef.current?.offsetHeight || 400;\r\n  const totalHeight = timelineContainerHeight - 4;\r\n\r\n  // Get dynamic track labels width, fallback to 0 if no tracks or no ref\r\n  const trackLabelsWidth =\r\n    tracks.length > 0 && trackLabelsRef?.current\r\n      ? trackLabelsRef.current.offsetWidth\r\n      : 0;\r\n\r\n  // Calculate position locked to timeline content (accounting for scroll)\r\n  const timelinePosition =\r\n    playheadPosition * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel;\r\n  const rawLeftPosition = trackLabelsWidth + timelinePosition - scrollLeft;\r\n\r\n  // Get the timeline content width and viewport width for right boundary\r\n  const timelineContentWidth =\r\n    duration * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel;\r\n  const tracksViewport = tracksScrollRef.current?.querySelector(\r\n    \"[data-radix-scroll-area-viewport]\"\r\n  ) as HTMLElement;\r\n  const viewportWidth = tracksViewport?.clientWidth || 1000;\r\n\r\n  // Constrain playhead to never appear outside the timeline area\r\n  const leftBoundary = trackLabelsWidth;\r\n  const rightBoundary = Math.min(\r\n    trackLabelsWidth + timelineContentWidth - scrollLeft, // Don't go beyond timeline content\r\n    trackLabelsWidth + viewportWidth // Don't go beyond viewport\r\n  );\r\n\r\n  const leftPosition = Math.max(\r\n    leftBoundary,\r\n    Math.min(rightBoundary, rawLeftPosition)\r\n  );\r\n\r\n  // Debug logging when playhead might go outside\r\n  if (rawLeftPosition < leftBoundary || rawLeftPosition > rightBoundary) {\r\n    console.log(\r\n      \"PLAYHEAD VISUAL DEBUG:\",\r\n      JSON.stringify({\r\n        playheadPosition,\r\n        timelinePosition,\r\n        trackLabelsWidth,\r\n        scrollLeft,\r\n        rawLeftPosition,\r\n        constrainedLeftPosition: leftPosition,\r\n        leftBoundary,\r\n        rightBoundary,\r\n        timelineContentWidth,\r\n        viewportWidth,\r\n        zoomLevel,\r\n      })\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div\r\n      ref={playheadRef}\r\n      className=\"absolute pointer-events-auto z-150\"\r\n      style={{\r\n        left: `${leftPosition}px`,\r\n        top: 0,\r\n        height: `${totalHeight}px`,\r\n        width: \"2px\", // Slightly wider for better click target\r\n      }}\r\n      onMouseDown={handlePlayheadMouseDown}\r\n    >\r\n      {/* The playhead line spanning full height */}\r\n      <div\r\n        className={`absolute left-0 w-0.5 cursor-col-resize h-full ${isSnappingToPlayhead ? \"bg-foreground\" : \"bg-foreground\"}`}\r\n      />\r\n\r\n      {/* Playhead dot indicator at the top (in ruler area) */}\r\n      <div\r\n        className={`absolute top-1 left-1/2 transform -translate-x-1/2 w-3 h-3 rounded-full border-2 shadow-xs ${isSnappingToPlayhead ? \"bg-foreground border-foreground\" : \"bg-foreground border-foreground/50\"}`}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\n// Also export a hook for getting ruler handlers\r\nexport function useTimelinePlayheadRuler({\r\n  currentTime,\r\n  duration,\r\n  zoomLevel,\r\n  seek,\r\n  rulerRef,\r\n  rulerScrollRef,\r\n  tracksScrollRef,\r\n  playheadRef,\r\n}: Omit<TimelinePlayheadProps, \"tracks\" | \"trackLabelsRef\" | \"timelineRef\">) {\r\n  const { handleRulerMouseDown, isDraggingRuler } = useTimelinePlayhead({\r\n    currentTime,\r\n    duration,\r\n    zoomLevel,\r\n    seek,\r\n    rulerRef,\r\n    rulerScrollRef,\r\n    tracksScrollRef,\r\n    playheadRef,\r\n  });\r\n\r\n  return { handleRulerMouseDown, isDraggingRuler };\r\n}\r\n\r\nexport { TimelinePlayhead as default };\r\n","\"use client\";\r\n\r\nimport { useEffect, useRef } from \"react\";\r\n\r\ninterface SelectionBoxProps {\r\n  startPos: { x: number; y: number } | null;\r\n  currentPos: { x: number; y: number } | null;\r\n  containerRef: React.RefObject<HTMLElement>;\r\n  isActive: boolean;\r\n}\r\n\r\nexport function SelectionBox({\r\n  startPos,\r\n  currentPos,\r\n  containerRef,\r\n  isActive,\r\n}: SelectionBoxProps) {\r\n  const selectionBoxRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    if (!isActive || !startPos || !currentPos || !containerRef.current) return;\r\n\r\n    const container = containerRef.current;\r\n    const containerRect = container.getBoundingClientRect();\r\n\r\n    // Calculate relative positions within the container\r\n    const startX = startPos.x - containerRect.left;\r\n    const startY = startPos.y - containerRect.top;\r\n    const currentX = currentPos.x - containerRect.left;\r\n    const currentY = currentPos.y - containerRect.top;\r\n\r\n    // Calculate the selection rectangle bounds\r\n    const left = Math.min(startX, currentX);\r\n    const top = Math.min(startY, currentY);\r\n    const width = Math.abs(currentX - startX);\r\n    const height = Math.abs(currentY - startY);\r\n\r\n    // Update the selection box position and size\r\n    if (selectionBoxRef.current) {\r\n      selectionBoxRef.current.style.left = `${left}px`;\r\n      selectionBoxRef.current.style.top = `${top}px`;\r\n      selectionBoxRef.current.style.width = `${width}px`;\r\n      selectionBoxRef.current.style.height = `${height}px`;\r\n    }\r\n  }, [startPos, currentPos, isActive, containerRef]);\r\n\r\n  if (!isActive || !startPos || !currentPos) return null;\r\n\r\n  return (\r\n    <div\r\n      ref={selectionBoxRef}\r\n      className=\"absolute pointer-events-none z-50 bg-foreground/10\"\r\n    />\r\n  );\r\n}\r\n","import { useState, useEffect, useCallback } from \"react\";\r\n\r\ninterface UseSelectionBoxProps {\r\n  containerRef: React.RefObject<HTMLElement>;\r\n  playheadRef?: React.RefObject<HTMLElement>;\r\n  onSelectionComplete: (\r\n    elements: { trackId: string; elementId: string }[]\r\n  ) => void;\r\n  isEnabled?: boolean;\r\n}\r\n\r\ninterface SelectionBoxState {\r\n  startPos: { x: number; y: number };\r\n  currentPos: { x: number; y: number };\r\n  isActive: boolean;\r\n}\r\n\r\nexport function useSelectionBox({\r\n  containerRef,\r\n  playheadRef,\r\n  onSelectionComplete,\r\n  isEnabled = true,\r\n}: UseSelectionBoxProps) {\r\n  const [selectionBox, setSelectionBox] = useState<SelectionBoxState | null>(\r\n    null\r\n  );\r\n  const [justFinishedSelecting, setJustFinishedSelecting] = useState(false);\r\n\r\n  // Mouse down handler to start selection\r\n  const handleMouseDown = useCallback(\r\n    (e: React.MouseEvent) => {\r\n      if (!isEnabled) return;\r\n\r\n      // Only start selection on empty space clicks\r\n      if ((e.target as HTMLElement).closest(\".timeline-element\")) {\r\n        return;\r\n      }\r\n      if (playheadRef?.current?.contains(e.target as Node)) {\r\n        return;\r\n      }\r\n      if ((e.target as HTMLElement).closest(\"[data-track-labels]\")) {\r\n        return;\r\n      }\r\n      // Don't start selection when clicking in the ruler area - this interferes with playhead dragging\r\n      if ((e.target as HTMLElement).closest(\"[data-ruler-area]\")) {\r\n        return;\r\n      }\r\n\r\n      setSelectionBox({\r\n        startPos: { x: e.clientX, y: e.clientY },\r\n        currentPos: { x: e.clientX, y: e.clientY },\r\n        isActive: false, // Will become active when mouse moves\r\n      });\r\n    },\r\n    [isEnabled, playheadRef]\r\n  );\r\n\r\n  // Function to select elements within the selection box\r\n  const selectElementsInBox = useCallback(\r\n    (startPos: { x: number; y: number }, endPos: { x: number; y: number }) => {\r\n      if (!containerRef.current) return;\r\n\r\n      const container = containerRef.current;\r\n      const containerRect = container.getBoundingClientRect();\r\n\r\n      // Calculate selection rectangle in container coordinates\r\n      const startX = startPos.x - containerRect.left;\r\n      const startY = startPos.y - containerRect.top;\r\n      const endX = endPos.x - containerRect.left;\r\n      const endY = endPos.y - containerRect.top;\r\n\r\n      const selectionRect = {\r\n        left: Math.min(startX, endX),\r\n        top: Math.min(startY, endY),\r\n        right: Math.max(startX, endX),\r\n        bottom: Math.max(startY, endY),\r\n      };\r\n\r\n      // Find all timeline elements within the selection rectangle\r\n      const timelineElements = container.querySelectorAll(\".timeline-element\");\r\n\r\n      const selectedElements: { trackId: string; elementId: string }[] = [];\r\n\r\n      timelineElements.forEach((element) => {\r\n        const elementRect = element.getBoundingClientRect();\r\n        // Use absolute coordinates for more accurate intersection detection\r\n        const elementAbsolute = {\r\n          left: elementRect.left,\r\n          top: elementRect.top,\r\n          right: elementRect.right,\r\n          bottom: elementRect.bottom,\r\n        };\r\n\r\n        const selectionAbsolute = {\r\n          left: startPos.x,\r\n          top: startPos.y,\r\n          right: endPos.x,\r\n          bottom: endPos.y,\r\n        };\r\n\r\n        // Normalize selection rectangle (handle dragging in any direction)\r\n        const normalizedSelection = {\r\n          left: Math.min(selectionAbsolute.left, selectionAbsolute.right),\r\n          top: Math.min(selectionAbsolute.top, selectionAbsolute.bottom),\r\n          right: Math.max(selectionAbsolute.left, selectionAbsolute.right),\r\n          bottom: Math.max(selectionAbsolute.top, selectionAbsolute.bottom),\r\n        };\r\n\r\n        const elementId = element.getAttribute(\"data-element-id\");\r\n        const trackId = element.getAttribute(\"data-track-id\");\r\n\r\n        // Check if element intersects with selection rectangle (any overlap)\r\n        // Using absolute coordinates for more precise detection\r\n        const intersects = !(\r\n          elementAbsolute.right < normalizedSelection.left ||\r\n          elementAbsolute.left > normalizedSelection.right ||\r\n          elementAbsolute.bottom < normalizedSelection.top ||\r\n          elementAbsolute.top > normalizedSelection.bottom\r\n        );\r\n\r\n        if (intersects && elementId && trackId) {\r\n          selectedElements.push({ trackId, elementId });\r\n        }\r\n      });\r\n\r\n      // Always call the callback - with elements or empty array to clear selection\r\n      console.log(\r\n        JSON.stringify({ selectElementsInBox: selectedElements.length })\r\n      );\r\n      onSelectionComplete(selectedElements);\r\n    },\r\n    [containerRef, onSelectionComplete]\r\n  );\r\n\r\n  // Effect to track selection box movement\r\n  useEffect(() => {\r\n    if (!selectionBox) return;\r\n\r\n    const handleMouseMove = (e: MouseEvent) => {\r\n      const deltaX = Math.abs(e.clientX - selectionBox.startPos.x);\r\n      const deltaY = Math.abs(e.clientY - selectionBox.startPos.y);\r\n\r\n      // Start selection if mouse moved more than 5px\r\n      const shouldActivate = deltaX > 5 || deltaY > 5;\r\n\r\n      const newSelectionBox = {\r\n        ...selectionBox,\r\n        currentPos: { x: e.clientX, y: e.clientY },\r\n        isActive: shouldActivate || selectionBox.isActive,\r\n      };\r\n\r\n      setSelectionBox(newSelectionBox);\r\n\r\n      // Real-time visual feedback: update selection as we drag\r\n      if (newSelectionBox.isActive) {\r\n        selectElementsInBox(\r\n          newSelectionBox.startPos,\r\n          newSelectionBox.currentPos\r\n        );\r\n      }\r\n    };\r\n\r\n    const handleMouseUp = () => {\r\n      console.log(\r\n        JSON.stringify({ mouseUp: { wasActive: selectionBox?.isActive } })\r\n      );\r\n\r\n      // If we had an active selection, mark that we just finished selecting\r\n      if (selectionBox?.isActive) {\r\n        console.log(JSON.stringify({ settingJustFinishedSelecting: true }));\r\n        setJustFinishedSelecting(true);\r\n        // Clear the flag after a short delay to allow click events to check it\r\n        setTimeout(() => {\r\n          console.log(JSON.stringify({ clearingJustFinishedSelecting: true }));\r\n          setJustFinishedSelecting(false);\r\n        }, 50);\r\n      }\r\n\r\n      // Don't call selectElementsInBox again - real-time selection already handled it\r\n      // Just clean up the selection box visual\r\n      setSelectionBox(null);\r\n    };\r\n\r\n    window.addEventListener(\"mousemove\", handleMouseMove);\r\n    window.addEventListener(\"mouseup\", handleMouseUp);\r\n\r\n    return () => {\r\n      window.removeEventListener(\"mousemove\", handleMouseMove);\r\n      window.removeEventListener(\"mouseup\", handleMouseUp);\r\n    };\r\n  }, [selectionBox, selectElementsInBox]);\r\n\r\n  return {\r\n    selectionBox,\r\n    handleMouseDown,\r\n    isSelecting: selectionBox?.isActive || false,\r\n    justFinishedSelecting,\r\n  };\r\n}\r\n","\"use client\";\r\n\r\nimport { SnapPoint } from \"@/hooks/use-timeline-snapping\";\r\nimport { TIMELINE_CONSTANTS } from \"@/constants/timeline-constants\";\r\nimport type { TimelineTrack } from \"@/types/timeline\";\r\nimport { useState, useEffect } from \"react\";\r\n\r\ninterface SnapIndicatorProps {\r\n  snapPoint: SnapPoint | null;\r\n  zoomLevel: number;\r\n  isVisible: boolean;\r\n  tracks: TimelineTrack[];\r\n  timelineRef: React.RefObject<HTMLDivElement>;\r\n  trackLabelsRef?: React.RefObject<HTMLDivElement>;\r\n  tracksScrollRef: React.RefObject<HTMLDivElement>;\r\n}\r\n\r\nexport function SnapIndicator({\r\n  snapPoint,\r\n  zoomLevel,\r\n  isVisible,\r\n  tracks,\r\n  timelineRef,\r\n  trackLabelsRef,\r\n  tracksScrollRef,\r\n}: SnapIndicatorProps) {\r\n  const [scrollLeft, setScrollLeft] = useState(0);\r\n\r\n  // Track scroll position to lock snap indicator to frame\r\n  useEffect(() => {\r\n    const tracksViewport = tracksScrollRef.current?.querySelector(\r\n      \"[data-radix-scroll-area-viewport]\"\r\n    ) as HTMLElement;\r\n\r\n    if (!tracksViewport) return;\r\n\r\n    const handleScroll = () => {\r\n      setScrollLeft(tracksViewport.scrollLeft);\r\n    };\r\n\r\n    // Set initial scroll position\r\n    setScrollLeft(tracksViewport.scrollLeft);\r\n\r\n    tracksViewport.addEventListener(\"scroll\", handleScroll);\r\n    return () => tracksViewport.removeEventListener(\"scroll\", handleScroll);\r\n  }, [tracksScrollRef]);\r\n\r\n  if (!isVisible || !snapPoint) {\r\n    return null;\r\n  }\r\n\r\n  const timelineContainerHeight = timelineRef.current?.offsetHeight || 400;\r\n  const totalHeight = timelineContainerHeight - 8; // 8px padding from edges\r\n\r\n  // Get dynamic track labels width, fallback to 0 if no tracks or no ref\r\n  const trackLabelsWidth =\r\n    tracks.length > 0 && trackLabelsRef?.current\r\n      ? trackLabelsRef.current.offsetWidth\r\n      : 0;\r\n\r\n  // Calculate position locked to timeline content (accounting for scroll)\r\n  const timelinePosition =\r\n    snapPoint.time * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel;\r\n  const leftPosition = trackLabelsWidth + timelinePosition - scrollLeft;\r\n\r\n  return (\r\n    <div\r\n      className=\"absolute pointer-events-none z-90\"\r\n      style={{\r\n        left: `${leftPosition}px`,\r\n        top: 0,\r\n        height: `${totalHeight}px`,\r\n        width: \"2px\",\r\n      }}\r\n    >\r\n      <div className={\"w-0.5 h-full bg-primary/40 opacity-80\"} />\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { Button } from \"../../ui/button\";\r\nimport {\r\n  Scissors,\r\n  ArrowLeftToLine,\r\n  ArrowRightToLine,\r\n  Trash2,\r\n  Snowflake,\r\n  Copy,\r\n  SplitSquareHorizontal,\r\n  Pause,\r\n  Play,\r\n  Video,\r\n  Music,\r\n  TypeIcon,\r\n  Magnet,\r\n  Link,\r\n  ZoomIn,\r\n  ZoomOut,\r\n  Bookmark,\r\n  Eye,\r\n  MicOff,\r\n  Mic,\r\n} from \"lucide-react\";\r\nimport {\r\n  Tooltip,\r\n  TooltipContent,\r\n  TooltipTrigger,\r\n  TooltipProvider,\r\n} from \"../../ui/tooltip\";\r\nimport {\r\n  ContextMenu,\r\n  ContextMenuContent,\r\n  ContextMenuItem,\r\n  ContextMenuTrigger,\r\n} from \"../../ui/context-menu\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { useMediaStore } from \"@/stores/media-store\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\nimport { useProjectStore } from \"@/stores/project-store\";\r\nimport { useTimelineZoom } from \"@/hooks/use-timeline-zoom\";\r\nimport { processMediaFiles } from \"@/lib/media-processing\";\r\nimport { toast } from \"sonner\";\r\nimport { useState, useRef, useEffect, useCallback } from \"react\";\r\nimport { TimelineTrackContent } from \"./timeline-track\";\r\nimport {\r\n  TimelinePlayhead,\r\n  useTimelinePlayheadRuler,\r\n} from \"./timeline-playhead\";\r\nimport { SelectionBox } from \"../selection-box\";\r\nimport { useSelectionBox } from \"@/hooks/use-selection-box\";\r\nimport { SnapIndicator } from \"../snap-indicator\";\r\nimport { SnapPoint } from \"@/hooks/use-timeline-snapping\";\r\nimport type { DragData, TimelineTrack } from \"@/types/timeline\";\r\nimport {\r\n  getTrackHeight,\r\n  getCumulativeHeightBefore,\r\n  getTotalTracksHeight,\r\n  TIMELINE_CONSTANTS,\r\n  snapTimeToFrame,\r\n} from \"@/constants/timeline-constants\";\r\nimport { Slider } from \"@/components/ui/slider\";\r\n\r\nexport function Timeline() {\r\n  // Timeline shows all tracks (video, audio, effects) and their elements.\r\n  // You can drag media here to add it to your project.\r\n  // elements can be trimmed, deleted, and moved.\r\n\r\n  const {\r\n    tracks,\r\n    getTotalDuration,\r\n    clearSelectedElements,\r\n    snappingEnabled,\r\n    setSelectedElements,\r\n    toggleTrackMute,\r\n    dragState,\r\n  } = useTimelineStore();\r\n  const { mediaItems, addMediaItem } = useMediaStore();\r\n  const { activeProject } = useProjectStore();\r\n  const { currentTime, duration, seek, setDuration, isPlaying, toggle } =\r\n    usePlaybackStore();\r\n  const [isDragOver, setIsDragOver] = useState(false);\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [progress, setProgress] = useState(0);\r\n  const dragCounterRef = useRef(0);\r\n  const timelineRef = useRef<HTMLDivElement>(null);\r\n  const rulerRef = useRef<HTMLDivElement>(null);\r\n  const [isInTimeline, setIsInTimeline] = useState(false);\r\n\r\n  // Track mouse down/up for distinguishing clicks from drag/resize ends\r\n  const mouseTrackingRef = useRef({\r\n    isMouseDown: false,\r\n    downX: 0,\r\n    downY: 0,\r\n    downTime: 0,\r\n  });\r\n\r\n  // Timeline zoom functionality\r\n  const { zoomLevel, setZoomLevel, handleWheel } = useTimelineZoom({\r\n    containerRef: timelineRef,\r\n    isInTimeline,\r\n  });\r\n\r\n  // Old marquee selection removed - using new SelectionBox component instead\r\n\r\n  // Dynamic timeline width calculation based on playhead position and duration\r\n  const dynamicTimelineWidth = Math.max(\r\n    (duration || 0) * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel, // Base width from duration\r\n    (currentTime + 30) * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel, // Width to show current time + 30 seconds buffer\r\n    timelineRef.current?.clientWidth || 1000 // Minimum width\r\n  );\r\n\r\n  // Scroll synchronization and auto-scroll to playhead\r\n  const rulerScrollRef = useRef<HTMLDivElement>(null);\r\n  const tracksScrollRef = useRef<HTMLDivElement>(null);\r\n  const trackLabelsRef = useRef<HTMLDivElement>(null);\r\n  const playheadRef = useRef<HTMLDivElement>(null);\r\n  const trackLabelsScrollRef = useRef<HTMLDivElement>(null);\r\n  const isUpdatingRef = useRef(false);\r\n  const lastRulerSync = useRef(0);\r\n  const lastTracksSync = useRef(0);\r\n  const lastVerticalSync = useRef(0);\r\n\r\n  // Timeline playhead ruler handlers\r\n  const { handleRulerMouseDown } = useTimelinePlayheadRuler({\r\n    currentTime,\r\n    duration,\r\n    zoomLevel,\r\n    seek,\r\n    rulerRef,\r\n    rulerScrollRef,\r\n    tracksScrollRef,\r\n    playheadRef,\r\n  });\r\n\r\n  // Selection box functionality\r\n  const tracksContainerRef = useRef<HTMLDivElement>(null);\r\n  const {\r\n    selectionBox,\r\n    handleMouseDown: handleSelectionMouseDown,\r\n    isSelecting,\r\n    justFinishedSelecting,\r\n  } = useSelectionBox({\r\n    containerRef: tracksContainerRef,\r\n    playheadRef,\r\n    onSelectionComplete: (elements) => {\r\n      console.log(JSON.stringify({ onSelectionComplete: elements.length }));\r\n      setSelectedElements(elements);\r\n    },\r\n  });\r\n\r\n  // Calculate snap indicator state\r\n  const [currentSnapPoint, setCurrentSnapPoint] = useState<SnapPoint | null>(\r\n    null\r\n  );\r\n  const showSnapIndicator =\r\n    dragState.isDragging && snappingEnabled && currentSnapPoint !== null;\r\n\r\n  // Callback to handle snap point changes from TimelineTrackContent\r\n  const handleSnapPointChange = useCallback((snapPoint: SnapPoint | null) => {\r\n    setCurrentSnapPoint(snapPoint);\r\n  }, []);\r\n\r\n  // Track mouse down to distinguish real clicks from drag/resize ends\r\n  const handleTimelineMouseDown = useCallback((e: React.MouseEvent) => {\r\n    // Only track mouse down on timeline background areas (not elements)\r\n    const target = e.target as HTMLElement;\r\n    const isTimelineBackground =\r\n      !target.closest(\".timeline-element\") &&\r\n      !playheadRef.current?.contains(target) &&\r\n      !target.closest(\"[data-track-labels]\");\r\n\r\n    if (isTimelineBackground) {\r\n      mouseTrackingRef.current = {\r\n        isMouseDown: true,\r\n        downX: e.clientX,\r\n        downY: e.clientY,\r\n        downTime: e.timeStamp,\r\n      };\r\n    }\r\n  }, []);\r\n\r\n  // Timeline content click to seek handler\r\n  const handleTimelineContentClick = useCallback(\r\n    (e: React.MouseEvent) => {\r\n      const { isMouseDown, downX, downY, downTime } = mouseTrackingRef.current;\r\n\r\n      // Reset mouse tracking\r\n      mouseTrackingRef.current = {\r\n        isMouseDown: false,\r\n        downX: 0,\r\n        downY: 0,\r\n        downTime: 0,\r\n      };\r\n\r\n      // Only process as click if we tracked a mouse down on timeline background\r\n      if (!isMouseDown) {\r\n        console.log(\r\n          JSON.stringify({\r\n            ignoredClickWithoutMouseDown: true,\r\n            timeStamp: e.timeStamp,\r\n          })\r\n        );\r\n        return;\r\n      }\r\n\r\n      // Check if mouse moved significantly (indicates drag, not click)\r\n      const deltaX = Math.abs(e.clientX - downX);\r\n      const deltaY = Math.abs(e.clientY - downY);\r\n      const deltaTime = e.timeStamp - downTime;\r\n\r\n      if (deltaX > 5 || deltaY > 5 || deltaTime > 500) {\r\n        console.log(\r\n          JSON.stringify({\r\n            ignoredDragNotClick: true,\r\n            deltaX,\r\n            deltaY,\r\n            deltaTime,\r\n            timeStamp: e.timeStamp,\r\n          })\r\n        );\r\n        return;\r\n      }\r\n\r\n      // Don't seek if this was a selection box operation\r\n      if (isSelecting || justFinishedSelecting) {\r\n        return;\r\n      }\r\n\r\n      // Don't seek if clicking on timeline elements, but still deselect\r\n      if ((e.target as HTMLElement).closest(\".timeline-element\")) {\r\n        return;\r\n      }\r\n\r\n      // Don't seek if clicking on playhead\r\n      if (playheadRef.current?.contains(e.target as Node)) {\r\n        return;\r\n      }\r\n\r\n      // Don't seek if clicking on track labels\r\n      if ((e.target as HTMLElement).closest(\"[data-track-labels]\")) {\r\n        clearSelectedElements();\r\n        return;\r\n      }\r\n\r\n      // Clear selected elements when clicking empty timeline area\r\n      console.log(JSON.stringify({ clearingSelectedElements: true }));\r\n      clearSelectedElements();\r\n\r\n      // Determine if we're clicking in ruler or tracks area\r\n      const isRulerClick = (e.target as HTMLElement).closest(\r\n        \"[data-ruler-area]\"\r\n      );\r\n\r\n      let mouseX: number;\r\n      let scrollLeft = 0;\r\n\r\n      if (isRulerClick) {\r\n        // Calculate based on ruler position\r\n        const rulerContent = rulerScrollRef.current?.querySelector(\r\n          \"[data-radix-scroll-area-viewport]\"\r\n        ) as HTMLElement;\r\n        if (!rulerContent) return;\r\n        const rect = rulerContent.getBoundingClientRect();\r\n        mouseX = e.clientX - rect.left;\r\n        scrollLeft = rulerContent.scrollLeft;\r\n      } else {\r\n        // Calculate based on tracks content position\r\n        const tracksContent = tracksScrollRef.current?.querySelector(\r\n          \"[data-radix-scroll-area-viewport]\"\r\n        ) as HTMLElement;\r\n        if (!tracksContent) return;\r\n        const rect = tracksContent.getBoundingClientRect();\r\n        mouseX = e.clientX - rect.left;\r\n        scrollLeft = tracksContent.scrollLeft;\r\n      }\r\n\r\n      const rawTime = Math.max(\r\n        0,\r\n        Math.min(\r\n          duration,\r\n          (mouseX + scrollLeft) /\r\n            (TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel)\r\n        )\r\n      );\r\n\r\n      // Use frame snapping for timeline clicking\r\n      const projectFps = activeProject?.fps || 30;\r\n      const time = snapTimeToFrame(rawTime, projectFps);\r\n\r\n      seek(time);\r\n    },\r\n    [\r\n      duration,\r\n      zoomLevel,\r\n      seek,\r\n      rulerScrollRef,\r\n      tracksScrollRef,\r\n      clearSelectedElements,\r\n      isSelecting,\r\n      justFinishedSelecting,\r\n    ]\r\n  );\r\n\r\n  // Update timeline duration when tracks change\r\n  useEffect(() => {\r\n    const totalDuration = getTotalDuration();\r\n    setDuration(Math.max(totalDuration, 10)); // Minimum 10 seconds for empty timeline\r\n  }, [tracks, setDuration, getTotalDuration]);\r\n\r\n  // Old marquee system removed - using new SelectionBox component instead\r\n\r\n  const handleDragEnter = (e: React.DragEvent) => {\r\n    // When something is dragged over the timeline, show overlay\r\n    e.preventDefault();\r\n    // Don't show overlay for timeline elements - they're handled by tracks\r\n    if (e.dataTransfer.types.includes(\"application/x-timeline-element\")) {\r\n      return;\r\n    }\r\n    dragCounterRef.current += 1;\r\n    if (!isDragOver) {\r\n      setIsDragOver(true);\r\n    }\r\n  };\r\n\r\n  const handleDragOver = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n  };\r\n\r\n  const handleDragLeave = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n\r\n    // Don't update state for timeline elements - they're handled by tracks\r\n    if (e.dataTransfer.types.includes(\"application/x-timeline-element\")) {\r\n      return;\r\n    }\r\n\r\n    dragCounterRef.current -= 1;\r\n    if (dragCounterRef.current === 0) {\r\n      setIsDragOver(false);\r\n    }\r\n  };\r\n\r\n  const handleDrop = async (e: React.DragEvent) => {\r\n    // When media is dropped, add it as a new track/element\r\n    e.preventDefault();\r\n    setIsDragOver(false);\r\n    dragCounterRef.current = 0;\r\n\r\n    // Ignore timeline element drags - they're handled by track-specific handlers\r\n    const hasTimelineElement = e.dataTransfer.types.includes(\r\n      \"application/x-timeline-element\"\r\n    );\r\n    if (hasTimelineElement) {\r\n      return;\r\n    }\r\n\r\n    const itemData = e.dataTransfer.getData(\"application/x-media-item\");\r\n    if (itemData) {\r\n      try {\r\n        const dragData: DragData = JSON.parse(itemData);\r\n\r\n        if (dragData.type === \"text\") {\r\n          // Always create new text track to avoid overlaps\r\n          useTimelineStore.getState().addTextToNewTrack(dragData);\r\n        } else {\r\n          // Handle media items\r\n          const mediaItem = mediaItems.find(\r\n            (item: any) => item.id === dragData.id\r\n          );\r\n          if (!mediaItem) {\r\n            toast.error(\"Media item not found\");\r\n            return;\r\n          }\r\n\r\n          useTimelineStore.getState().addMediaToNewTrack(mediaItem);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error parsing dropped item data:\", error);\r\n        toast.error(\"Failed to add item to timeline\");\r\n      }\r\n    } else if (e.dataTransfer.files?.length > 0) {\r\n      // Handle file drops by creating new tracks\r\n      if (!activeProject) {\r\n        toast.error(\"No active project\");\r\n        return;\r\n      }\r\n\r\n      setIsProcessing(true);\r\n      setProgress(0);\r\n      try {\r\n        const processedItems = await processMediaFiles(\r\n          e.dataTransfer.files,\r\n          (p) => setProgress(p)\r\n        );\r\n        for (const processedItem of processedItems) {\r\n          await addMediaItem(activeProject.id, processedItem);\r\n          const currentMediaItems = useMediaStore.getState().mediaItems;\r\n          const addedItem = currentMediaItems.find(\r\n            (item) =>\r\n              item.name === processedItem.name && item.url === processedItem.url\r\n          );\r\n          if (addedItem) {\r\n            useTimelineStore.getState().addMediaToNewTrack(addedItem);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        // Show error if file processing fails\r\n        console.error(\"Error processing external files:\", error);\r\n        toast.error(\"Failed to process dropped files\");\r\n      } finally {\r\n        setIsProcessing(false);\r\n        setProgress(0);\r\n      }\r\n    }\r\n  };\r\n\r\n  const dragProps = {\r\n    onDragEnter: handleDragEnter,\r\n    onDragOver: handleDragOver,\r\n    onDragLeave: handleDragLeave,\r\n    onDrop: handleDrop,\r\n  };\r\n\r\n  // --- Scroll synchronization effect ---\r\n  useEffect(() => {\r\n    const rulerViewport = rulerScrollRef.current?.querySelector(\r\n      \"[data-radix-scroll-area-viewport]\"\r\n    ) as HTMLElement;\r\n    const tracksViewport = tracksScrollRef.current?.querySelector(\r\n      \"[data-radix-scroll-area-viewport]\"\r\n    ) as HTMLElement;\r\n    const trackLabelsViewport = trackLabelsScrollRef.current?.querySelector(\r\n      \"[data-radix-scroll-area-viewport]\"\r\n    ) as HTMLElement;\r\n\r\n    if (!rulerViewport || !tracksViewport) return;\r\n\r\n    // Horizontal scroll synchronization between ruler and tracks\r\n    const handleRulerScroll = () => {\r\n      const now = Date.now();\r\n      if (isUpdatingRef.current || now - lastRulerSync.current < 16) return;\r\n      lastRulerSync.current = now;\r\n      isUpdatingRef.current = true;\r\n      tracksViewport.scrollLeft = rulerViewport.scrollLeft;\r\n      isUpdatingRef.current = false;\r\n    };\r\n    const handleTracksScroll = () => {\r\n      const now = Date.now();\r\n      if (isUpdatingRef.current || now - lastTracksSync.current < 16) return;\r\n      lastTracksSync.current = now;\r\n      isUpdatingRef.current = true;\r\n      rulerViewport.scrollLeft = tracksViewport.scrollLeft;\r\n      isUpdatingRef.current = false;\r\n    };\r\n\r\n    rulerViewport.addEventListener(\"scroll\", handleRulerScroll);\r\n    tracksViewport.addEventListener(\"scroll\", handleTracksScroll);\r\n\r\n    // Vertical scroll synchronization between track labels and tracks content\r\n    if (trackLabelsViewport) {\r\n      const handleTrackLabelsScroll = () => {\r\n        const now = Date.now();\r\n        if (isUpdatingRef.current || now - lastVerticalSync.current < 16)\r\n          return;\r\n        lastVerticalSync.current = now;\r\n        isUpdatingRef.current = true;\r\n        tracksViewport.scrollTop = trackLabelsViewport.scrollTop;\r\n        isUpdatingRef.current = false;\r\n      };\r\n      const handleTracksVerticalScroll = () => {\r\n        const now = Date.now();\r\n        if (isUpdatingRef.current || now - lastVerticalSync.current < 16)\r\n          return;\r\n        lastVerticalSync.current = now;\r\n        isUpdatingRef.current = true;\r\n        trackLabelsViewport.scrollTop = tracksViewport.scrollTop;\r\n        isUpdatingRef.current = false;\r\n      };\r\n\r\n      trackLabelsViewport.addEventListener(\"scroll\", handleTrackLabelsScroll);\r\n      tracksViewport.addEventListener(\"scroll\", handleTracksVerticalScroll);\r\n\r\n      return () => {\r\n        rulerViewport.removeEventListener(\"scroll\", handleRulerScroll);\r\n        tracksViewport.removeEventListener(\"scroll\", handleTracksScroll);\r\n        trackLabelsViewport.removeEventListener(\r\n          \"scroll\",\r\n          handleTrackLabelsScroll\r\n        );\r\n        tracksViewport.removeEventListener(\r\n          \"scroll\",\r\n          handleTracksVerticalScroll\r\n        );\r\n      };\r\n    }\r\n\r\n    return () => {\r\n      rulerViewport.removeEventListener(\"scroll\", handleRulerScroll);\r\n      tracksViewport.removeEventListener(\"scroll\", handleTracksScroll);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div\r\n      className={\r\n        \"h-full flex flex-col transition-colors duration-200 relative bg-panel rounded-sm overflow-hidden\"\r\n      }\r\n      {...dragProps}\r\n      onMouseEnter={() => setIsInTimeline(true)}\r\n      onMouseLeave={() => setIsInTimeline(false)}\r\n    >\r\n      <TimelineToolbar zoomLevel={zoomLevel} setZoomLevel={setZoomLevel} />\r\n\r\n      {/* Timeline Container */}\r\n      <div\r\n        className=\"flex-1 flex flex-col overflow-hidden relative\"\r\n        ref={timelineRef}\r\n      >\r\n        <TimelinePlayhead\r\n          currentTime={currentTime}\r\n          duration={duration}\r\n          zoomLevel={zoomLevel}\r\n          tracks={tracks}\r\n          seek={seek}\r\n          rulerRef={rulerRef}\r\n          rulerScrollRef={rulerScrollRef}\r\n          tracksScrollRef={tracksScrollRef}\r\n          trackLabelsRef={trackLabelsRef}\r\n          timelineRef={timelineRef}\r\n          playheadRef={playheadRef}\r\n          isSnappingToPlayhead={\r\n            showSnapIndicator && currentSnapPoint?.type === \"playhead\"\r\n          }\r\n        />\r\n        <SnapIndicator\r\n          snapPoint={currentSnapPoint}\r\n          zoomLevel={zoomLevel}\r\n          tracks={tracks}\r\n          timelineRef={timelineRef}\r\n          trackLabelsRef={trackLabelsRef}\r\n          tracksScrollRef={tracksScrollRef}\r\n          isVisible={showSnapIndicator}\r\n        />\r\n        {/* Timeline Header with Ruler */}\r\n        <div className=\"flex bg-panel sticky top-0 z-10\">\r\n          {/* Track Labels Header */}\r\n          <div className=\"w-28 shrink-0 bg-panel border-r flex items-center justify-between px-3 py-2\">\r\n            {/* Empty space */}\r\n            <span className=\"text-sm font-medium text-muted-foreground opacity-0\">\r\n              .\r\n            </span>\r\n          </div>\r\n\r\n          {/* Timeline Ruler */}\r\n          <div\r\n            className=\"flex-1 relative overflow-hidden h-10\"\r\n            onWheel={(e) => {\r\n              // Check if this is horizontal scrolling - if so, don't handle it here\r\n              if (e.shiftKey || Math.abs(e.deltaX) > Math.abs(e.deltaY)) {\r\n                return; // Let ScrollArea handle horizontal scrolling\r\n              }\r\n              handleWheel(e);\r\n            }}\r\n            onMouseDown={handleSelectionMouseDown}\r\n            onClick={handleTimelineContentClick}\r\n            data-ruler-area\r\n          >\r\n            <ScrollArea className=\"w-full\" ref={rulerScrollRef}>\r\n              <div\r\n                ref={rulerRef}\r\n                className=\"relative h-10 select-none cursor-default\"\r\n                style={{\r\n                  width: `${dynamicTimelineWidth}px`,\r\n                }}\r\n                onMouseDown={handleRulerMouseDown}\r\n              >\r\n                {/* Time markers */}\r\n                {(() => {\r\n                  // Calculate appropriate time interval based on zoom level\r\n                  const getTimeInterval = (zoom: number) => {\r\n                    const pixelsPerSecond =\r\n                      TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoom;\r\n                    if (pixelsPerSecond >= 200) return 0.1; // Every 0.1s when very zoomed in\r\n                    if (pixelsPerSecond >= 100) return 0.5; // Every 0.5s when zoomed in\r\n                    if (pixelsPerSecond >= 50) return 1; // Every 1s at normal zoom\r\n                    if (pixelsPerSecond >= 25) return 2; // Every 2s when zoomed out\r\n                    if (pixelsPerSecond >= 12) return 5; // Every 5s when more zoomed out\r\n                    if (pixelsPerSecond >= 6) return 10; // Every 10s when very zoomed out\r\n                    return 30; // Every 30s when extremely zoomed out\r\n                  };\r\n\r\n                  const interval = getTimeInterval(zoomLevel);\r\n                  const markerCount = Math.ceil(duration / interval) + 1;\r\n\r\n                  return Array.from({ length: markerCount }, (_, i) => {\r\n                    const time = i * interval;\r\n                    if (time > duration) return null;\r\n\r\n                    const isMainMarker =\r\n                      time % (interval >= 1 ? Math.max(1, interval) : 1) === 0;\r\n\r\n                    return (\r\n                      <div\r\n                        key={i}\r\n                        className={`absolute top-0 h-4 ${\r\n                          isMainMarker\r\n                            ? \"border-l border-muted-foreground/40\"\r\n                            : \"border-l border-muted-foreground/20\"\r\n                        }`}\r\n                        style={{\r\n                          left: `${\r\n                            time *\r\n                            TIMELINE_CONSTANTS.PIXELS_PER_SECOND *\r\n                            zoomLevel\r\n                          }px`,\r\n                        }}\r\n                      >\r\n                        <span\r\n                          className={`absolute top-1 left-1 text-[0.6rem] ${\r\n                            isMainMarker\r\n                              ? \"text-muted-foreground font-medium\"\r\n                              : \"text-muted-foreground/70\"\r\n                          }`}\r\n                        >\r\n                          {(() => {\r\n                            const formatTime = (seconds: number) => {\r\n                              const hours = Math.floor(seconds / 3600);\r\n                              const minutes = Math.floor((seconds % 3600) / 60);\r\n                              const secs = seconds % 60;\r\n\r\n                              if (hours > 0) {\r\n                                return `${hours}:${minutes\r\n                                  .toString()\r\n                                  .padStart(2, \"0\")}:${Math.floor(secs)\r\n                                  .toString()\r\n                                  .padStart(2, \"0\")}`;\r\n                              }\r\n                              if (minutes > 0) {\r\n                                return `${minutes}:${Math.floor(secs)\r\n                                  .toString()\r\n                                  .padStart(2, \"0\")}`;\r\n                              }\r\n                              if (interval >= 1) {\r\n                                return `${Math.floor(secs)}s`;\r\n                              }\r\n                              return `${secs.toFixed(1)}s`;\r\n                            };\r\n                            return formatTime(time);\r\n                          })()}\r\n                        </span>\r\n                      </div>\r\n                    );\r\n                  }).filter(Boolean);\r\n                })()}\r\n\r\n                {/* Bookmark markers */}\r\n                {(() => {\r\n                  const { activeProject } = useProjectStore.getState();\r\n                  if (!activeProject?.bookmarks?.length) return null;\r\n\r\n                  return activeProject.bookmarks.map((bookmarkTime, i) => (\r\n                    <div\r\n                      key={`bookmark-${i}`}\r\n                      className=\"absolute top-0 h-10 w-0.5 !bg-primary cursor-pointer\"\r\n                      style={{\r\n                        left: `${bookmarkTime * TIMELINE_CONSTANTS.PIXELS_PER_SECOND * zoomLevel}px`,\r\n                      }}\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        usePlaybackStore.getState().seek(bookmarkTime);\r\n                      }}\r\n                    >\r\n                      <div className=\"absolute top-[-1px] left-[-5px] text-primary\">\r\n                        <Bookmark className=\"h-3 w-3 fill-primary\" />\r\n                      </div>\r\n                    </div>\r\n                  ));\r\n                })()}\r\n              </div>\r\n            </ScrollArea>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Tracks Area */}\r\n        <div className=\"flex-1 flex overflow-hidden\">\r\n          {/* Track Labels */}\r\n          {tracks.length > 0 && (\r\n            <div\r\n              ref={trackLabelsRef}\r\n              className=\"w-28 shrink-0 border-r overflow-y-auto z-100 bg-panel\"\r\n              data-track-labels\r\n            >\r\n              <ScrollArea className=\"w-full h-full\" ref={trackLabelsScrollRef}>\r\n                <div className=\"flex flex-col gap-1\">\r\n                  {tracks.map((track) => (\r\n                    <div\r\n                      key={track.id}\r\n                      className=\"flex items-center px-3 group\"\r\n                      style={{ height: `${getTrackHeight(track.type)}px` }}\r\n                    >\r\n                      <div className=\"flex items-center justify-end flex-1 min-w-0 gap-2\">\r\n                        {track.muted ? (\r\n                          <MicOff\r\n                            className=\"h-4 w-4 text-destructive cursor-pointer\"\r\n                            onClick={() => toggleTrackMute(track.id)}\r\n                          />\r\n                        ) : (\r\n                          <Mic\r\n                            className=\"h-4 w-4 text-muted-foreground cursor-pointer\"\r\n                            onClick={() => toggleTrackMute(track.id)}\r\n                          />\r\n                        )}\r\n                        <Eye className=\"h-4 w-4 text-muted-foreground\" />\r\n                        <TrackIcon track={track} />\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </ScrollArea>\r\n            </div>\r\n          )}\r\n\r\n          {/* Timeline Tracks Content */}\r\n          <div\r\n            className=\"flex-1 relative overflow-hidden\"\r\n            onWheel={(e) => {\r\n              // Check if this is horizontal scrolling - if so, don't handle it here\r\n              if (e.shiftKey || Math.abs(e.deltaX) > Math.abs(e.deltaY)) {\r\n                return; // Let ScrollArea handle horizontal scrolling\r\n              }\r\n              handleWheel(e);\r\n            }}\r\n            onMouseDown={(e) => {\r\n              handleTimelineMouseDown(e);\r\n              handleSelectionMouseDown(e);\r\n            }}\r\n            onClick={handleTimelineContentClick}\r\n            ref={tracksContainerRef}\r\n          >\r\n            <SelectionBox\r\n              startPos={selectionBox?.startPos || null}\r\n              currentPos={selectionBox?.currentPos || null}\r\n              containerRef={tracksContainerRef}\r\n              isActive={selectionBox?.isActive || false}\r\n            />\r\n            <ScrollArea className=\"w-full h-full\" ref={tracksScrollRef}>\r\n              <div\r\n                className=\"relative flex-1\"\r\n                style={{\r\n                  height: `${Math.max(\r\n                    200,\r\n                    Math.min(800, getTotalTracksHeight(tracks))\r\n                  )}px`,\r\n                  width: `${dynamicTimelineWidth}px`,\r\n                }}\r\n              >\r\n                {tracks.length === 0 ? (\r\n                  <div />\r\n                ) : (\r\n                  <>\r\n                    {tracks.map((track, index) => (\r\n                      <ContextMenu key={track.id}>\r\n                        <ContextMenuTrigger asChild>\r\n                          <div\r\n                            className=\"absolute left-0 right-0\"\r\n                            style={{\r\n                              top: `${getCumulativeHeightBefore(\r\n                                tracks,\r\n                                index\r\n                              )}px`,\r\n                              height: `${getTrackHeight(track.type)}px`,\r\n                            }}\r\n                            onClick={(e) => {\r\n                              // If clicking empty area (not on a element), deselect all elements\r\n                              if (\r\n                                !(e.target as HTMLElement).closest(\r\n                                  \".timeline-element\"\r\n                                )\r\n                              ) {\r\n                                clearSelectedElements();\r\n                              }\r\n                            }}\r\n                          >\r\n                            <TimelineTrackContent\r\n                              track={track}\r\n                              zoomLevel={zoomLevel}\r\n                              onSnapPointChange={handleSnapPointChange}\r\n                            />\r\n                          </div>\r\n                        </ContextMenuTrigger>\r\n                        <ContextMenuContent className=\"z-200\">\r\n                          <ContextMenuItem\r\n                            onClick={(e) => {\r\n                              e.stopPropagation();\r\n                              toggleTrackMute(track.id);\r\n                            }}\r\n                          >\r\n                            {track.muted ? \"Unmute Track\" : \"Mute Track\"}\r\n                          </ContextMenuItem>\r\n                          <ContextMenuItem onClick={(e) => e.stopPropagation()}>\r\n                            Track settings (soon)\r\n                          </ContextMenuItem>\r\n                        </ContextMenuContent>\r\n                      </ContextMenu>\r\n                    ))}\r\n                  </>\r\n                )}\r\n              </div>\r\n            </ScrollArea>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction TrackIcon({ track }: { track: TimelineTrack }) {\r\n  return (\r\n    <>\r\n      {track.type === \"media\" && (\r\n        <Video className=\"w-4 h-4 shrink-0 text-muted-foreground\" />\r\n      )}\r\n      {track.type === \"text\" && (\r\n        <TypeIcon className=\"w-4 h-4 shrink-0 text-muted-foreground\" />\r\n      )}\r\n      {track.type === \"audio\" && (\r\n        <Music className=\"w-4 h-4 shrink-0 text-muted-foreground\" />\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\nfunction TimelineToolbar({\r\n  zoomLevel,\r\n  setZoomLevel,\r\n}: {\r\n  zoomLevel: number;\r\n  setZoomLevel: (zoom: number) => void;\r\n}) {\r\n  const {\r\n    tracks,\r\n    addTrack,\r\n    addElementToTrack,\r\n    removeElementFromTrack,\r\n    removeElementFromTrackWithRipple,\r\n    selectedElements,\r\n    clearSelectedElements,\r\n    splitElement,\r\n    splitAndKeepLeft,\r\n    splitAndKeepRight,\r\n    separateAudio,\r\n    snappingEnabled,\r\n    toggleSnapping,\r\n    rippleEditingEnabled,\r\n    toggleRippleEditing,\r\n  } = useTimelineStore();\r\n  const { currentTime, duration, isPlaying, toggle } = usePlaybackStore();\r\n  const { toggleBookmark, isBookmarked } = useProjectStore();\r\n\r\n  // Action handlers\r\n  const handleSplitSelected = () => {\r\n    if (selectedElements.length === 0) return;\r\n    let splitCount = 0;\r\n    selectedElements.forEach(({ trackId, elementId }) => {\r\n      const track = tracks.find((t) => t.id === trackId);\r\n      const element = track?.elements.find((c) => c.id === elementId);\r\n      if (element && track) {\r\n        const effectiveStart = element.startTime;\r\n        const effectiveEnd =\r\n          element.startTime +\r\n          (element.duration - element.trimStart - element.trimEnd);\r\n        if (currentTime > effectiveStart && currentTime < effectiveEnd) {\r\n          const newElementId = splitElement(trackId, elementId, currentTime);\r\n          if (newElementId) splitCount++;\r\n        }\r\n      }\r\n    });\r\n    if (splitCount === 0) {\r\n      toast.error(\"Playhead must be within selected elements to split\");\r\n    }\r\n  };\r\n\r\n  const handleDuplicateSelected = () => {\r\n    if (selectedElements.length === 0) return;\r\n    const canDuplicate = selectedElements.length === 1;\r\n    if (!canDuplicate) return;\r\n\r\n    selectedElements.forEach(({ trackId, elementId }) => {\r\n      const track = tracks.find((t) => t.id === trackId);\r\n      const element = track?.elements.find((el) => el.id === elementId);\r\n      if (element) {\r\n        const newStartTime =\r\n          element.startTime +\r\n          (element.duration - element.trimStart - element.trimEnd) +\r\n          0.1;\r\n        const { id, ...elementWithoutId } = element;\r\n        addElementToTrack(trackId, {\r\n          ...elementWithoutId,\r\n          startTime: newStartTime,\r\n        });\r\n      }\r\n    });\r\n    clearSelectedElements();\r\n  };\r\n\r\n  const handleFreezeSelected = () => {\r\n    toast.info(\"Freeze frame functionality coming soon!\");\r\n  };\r\n\r\n  const handleSplitAndKeepLeft = () => {\r\n    if (selectedElements.length !== 1) {\r\n      toast.error(\"Select exactly one element\");\r\n      return;\r\n    }\r\n    const { trackId, elementId } = selectedElements[0];\r\n    const track = tracks.find((t) => t.id === trackId);\r\n    const element = track?.elements.find((c) => c.id === elementId);\r\n    if (!element) return;\r\n    const effectiveStart = element.startTime;\r\n    const effectiveEnd =\r\n      element.startTime +\r\n      (element.duration - element.trimStart - element.trimEnd);\r\n    if (currentTime <= effectiveStart || currentTime >= effectiveEnd) {\r\n      toast.error(\"Playhead must be within selected element\");\r\n      return;\r\n    }\r\n    splitAndKeepLeft(trackId, elementId, currentTime);\r\n  };\r\n\r\n  const handleSplitAndKeepRight = () => {\r\n    if (selectedElements.length !== 1) {\r\n      toast.error(\"Select exactly one element\");\r\n      return;\r\n    }\r\n    const { trackId, elementId } = selectedElements[0];\r\n    const track = tracks.find((t) => t.id === trackId);\r\n    const element = track?.elements.find((c) => c.id === elementId);\r\n    if (!element) return;\r\n    const effectiveStart = element.startTime;\r\n    const effectiveEnd =\r\n      element.startTime +\r\n      (element.duration - element.trimStart - element.trimEnd);\r\n    if (currentTime <= effectiveStart || currentTime >= effectiveEnd) {\r\n      toast.error(\"Playhead must be within selected element\");\r\n      return;\r\n    }\r\n    splitAndKeepRight(trackId, elementId, currentTime);\r\n  };\r\n\r\n  const handleSeparateAudio = () => {\r\n    if (selectedElements.length !== 1) {\r\n      toast.error(\"Select exactly one media element to separate audio\");\r\n      return;\r\n    }\r\n    const { trackId, elementId } = selectedElements[0];\r\n    const track = tracks.find((t) => t.id === trackId);\r\n    if (!track || track.type !== \"media\") {\r\n      toast.error(\"Select a media element to separate audio\");\r\n      return;\r\n    }\r\n    separateAudio(trackId, elementId);\r\n  };\r\n\r\n  const handleDeleteSelected = () => {\r\n    if (selectedElements.length === 0) return;\r\n    selectedElements.forEach(({ trackId, elementId }) => {\r\n      if (rippleEditingEnabled) {\r\n        removeElementFromTrackWithRipple(trackId, elementId);\r\n      } else {\r\n        removeElementFromTrack(trackId, elementId);\r\n      }\r\n    });\r\n    clearSelectedElements();\r\n  };\r\n\r\n  // Zoom handlers\r\n  const handleZoomIn = () => {\r\n    setZoomLevel(Math.min(4, zoomLevel + 0.25));\r\n  };\r\n\r\n  const handleZoomOut = () => {\r\n    setZoomLevel(Math.max(0.25, zoomLevel - 0.25));\r\n  };\r\n\r\n  const handleZoomSliderChange = (values: number[]) => {\r\n    setZoomLevel(values[0]);\r\n  };\r\n\r\n  const handleToggleBookmark = async () => {\r\n    await toggleBookmark(currentTime);\r\n  };\r\n\r\n  // Check if the current time is bookmarked\r\n  const currentBookmarked = isBookmarked(currentTime);\r\n  return (\r\n    <div className=\"border-b flex items-center justify-between px-2 py-1\">\r\n      <div className=\"flex items-center gap-1 w-full\">\r\n        <TooltipProvider delayDuration={500}>\r\n          {/* Play/Pause Button */}\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button\r\n                variant=\"text\"\r\n                size=\"icon\"\r\n                onClick={toggle}\r\n                className=\"mr-2\"\r\n              >\r\n                {isPlaying ? (\r\n                  <Pause className=\"h-4 w-4\" />\r\n                ) : (\r\n                  <Play className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>\r\n              {isPlaying ? \"Pause (Space)\" : \"Play (Space)\"}\r\n            </TooltipContent>\r\n          </Tooltip>\r\n          <div className=\"w-px h-6 bg-border mx-1\" />\r\n          {/* Time Display */}\r\n          <div\r\n            className=\"text-xs text-muted-foreground font-mono px-2\"\r\n            style={{ minWidth: \"18ch\", textAlign: \"center\" }}\r\n          >\r\n            {currentTime.toFixed(1)}s / {duration.toFixed(1)}s\r\n          </div>\r\n          {/* Test Clip Button - for debugging */}\r\n          {tracks.length === 0 && (\r\n            <>\r\n              <div className=\"w-px h-6 bg-border mx-1\" />\r\n              <Tooltip>\r\n                <TooltipTrigger asChild>\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => {\r\n                      const trackId = addTrack(\"media\");\r\n                      addElementToTrack(trackId, {\r\n                        type: \"media\",\r\n                        mediaId: \"test\",\r\n                        name: \"Test Clip\",\r\n                        duration: TIMELINE_CONSTANTS.DEFAULT_TEXT_DURATION,\r\n                        startTime: 0,\r\n                        trimStart: 0,\r\n                        trimEnd: 0,\r\n                      });\r\n                    }}\r\n                    className=\"text-xs\"\r\n                  >\r\n                    Add Test Clip\r\n                  </Button>\r\n                </TooltipTrigger>\r\n                <TooltipContent>Add a test clip to try playback</TooltipContent>\r\n              </Tooltip>\r\n            </>\r\n          )}\r\n          <div className=\"w-px h-6 bg-border mx-1\" />\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button variant=\"text\" size=\"icon\" onClick={handleSplitSelected}>\r\n                <Scissors className=\"h-4 w-4\" />\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>Split element (Ctrl+S)</TooltipContent>\r\n          </Tooltip>\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button\r\n                variant=\"text\"\r\n                size=\"icon\"\r\n                onClick={handleSplitAndKeepLeft}\r\n              >\r\n                <ArrowLeftToLine className=\"h-4 w-4\" />\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>Split and keep left (Ctrl+Q)</TooltipContent>\r\n          </Tooltip>\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button\r\n                variant=\"text\"\r\n                size=\"icon\"\r\n                onClick={handleSplitAndKeepRight}\r\n              >\r\n                <ArrowRightToLine className=\"h-4 w-4\" />\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>Split and keep right (Ctrl+W)</TooltipContent>\r\n          </Tooltip>\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button variant=\"text\" size=\"icon\" onClick={handleSeparateAudio}>\r\n                <SplitSquareHorizontal className=\"h-4 w-4\" />\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>Separate audio (Ctrl+D)</TooltipContent>\r\n          </Tooltip>\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button\r\n                variant=\"text\"\r\n                size=\"icon\"\r\n                onClick={handleDuplicateSelected}\r\n              >\r\n                <Copy className=\"h-4 w-4\" />\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>Duplicate element (Ctrl+D)</TooltipContent>\r\n          </Tooltip>\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button variant=\"text\" size=\"icon\" onClick={handleFreezeSelected}>\r\n                <Snowflake className=\"h-4 w-4\" />\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>Freeze frame (F)</TooltipContent>\r\n          </Tooltip>\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button variant=\"text\" size=\"icon\" onClick={handleDeleteSelected}>\r\n                <Trash2 className=\"h-4 w-4\" />\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>Delete element (Delete)</TooltipContent>\r\n          </Tooltip>\r\n          <div className=\"w-px h-6 bg-border mx-1\" />\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button variant=\"text\" size=\"icon\" onClick={handleToggleBookmark}>\r\n                <Bookmark\r\n                  className={`h-4 w-4 ${currentBookmarked ? \"fill-primary text-primary\" : \"\"}`}\r\n                />\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>\r\n              {currentBookmarked ? \"Remove bookmark\" : \"Add bookmark\"}\r\n            </TooltipContent>\r\n          </Tooltip>\r\n        </TooltipProvider>\r\n      </div>\r\n      <div className=\"flex items-center gap-1\">\r\n        <TooltipProvider delayDuration={500}>\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button variant=\"text\" size=\"icon\" onClick={toggleSnapping}>\r\n                {snappingEnabled ? (\r\n                  <Magnet className=\"h-4 w-4 text-primary\" />\r\n                ) : (\r\n                  <Magnet className=\"h-4 w-4\" />\r\n                )}\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>Auto snapping</TooltipContent>\r\n          </Tooltip>\r\n          <Tooltip>\r\n            <TooltipTrigger asChild>\r\n              <Button variant=\"text\" size=\"icon\" onClick={toggleRippleEditing}>\r\n                <Link\r\n                  className={`h-4 w-4 ${\r\n                    rippleEditingEnabled ? \"text-primary\" : \"\"\r\n                  }`}\r\n                />\r\n              </Button>\r\n            </TooltipTrigger>\r\n            <TooltipContent>\r\n              {rippleEditingEnabled\r\n                ? \"Disable Ripple Editing\"\r\n                : \"Enable Ripple Editing\"}\r\n            </TooltipContent>\r\n          </Tooltip>\r\n        </TooltipProvider>\r\n\r\n        <div className=\"h-6 w-px bg-border mx-1\" />\r\n        <div className=\"flex items-center gap-1\">\r\n          <Button variant=\"text\" size=\"icon\" onClick={handleZoomOut}>\r\n            <ZoomOut className=\"h-4 w-4\" />\r\n          </Button>\r\n          <Slider\r\n            className=\"w-24\"\r\n            value={[zoomLevel]}\r\n            onValueChange={handleZoomSliderChange}\r\n            min={0.25}\r\n            max={4}\r\n            step={0.25}\r\n          />\r\n          <Button variant=\"text\" size=\"icon\" onClick={handleZoomIn}>\r\n            <ZoomIn className=\"h-4 w-4\" />\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","/* An `action` is a unique verb that is associated with certain thing that can be done on OpenCut.\r\n * For example, toggling playback or seeking.\r\n */\r\n\r\nimport {\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n  useCallback,\r\n  MutableRefObject,\r\n} from \"react\";\r\n\r\n// Simple event emitter for action changes\r\nclass ActionEmitter {\r\n  private listeners: Array<(actions: Action[]) => void> = [];\r\n\r\n  subscribe(listener: (actions: Action[]) => void) {\r\n    this.listeners.push(listener);\r\n    return () => {\r\n      this.listeners = this.listeners.filter((l) => l !== listener);\r\n    };\r\n  }\r\n\r\n  emit(actions: Action[]) {\r\n    this.listeners.forEach((listener) => listener(actions));\r\n  }\r\n}\r\n\r\nconst actionEmitter = new ActionEmitter();\r\n\r\nexport type Action =\r\n  | \"toggle-play\" // Toggle play/pause state\r\n  | \"stop-playback\" // Stop playback\r\n  | \"seek-forward\" // Seek forward in playback\r\n  | \"seek-backward\" // Seek backward in playback\r\n  | \"frame-step-forward\" // Step forward by one frame\r\n  | \"frame-step-backward\" // Step backward by one frame\r\n  | \"jump-forward\" // Jump forward by 5 seconds\r\n  | \"jump-backward\" // Jump backward by 5 seconds\r\n  | \"goto-start\" // Go to timeline start\r\n  | \"goto-end\" // Go to timeline end\r\n  | \"split-element\" // Split element at current time\r\n  | \"delete-selected\" // Delete selected elements\r\n  | \"select-all\" // Select all elements\r\n  | \"duplicate-selected\" // Duplicate selected element\r\n  | \"toggle-snapping\" // Toggle snapping\r\n  | \"undo\" // Undo last action\r\n  | \"redo\"; // Redo last undone action\r\n\r\n/**\r\n * Defines the arguments, if present for a given type that is required to be passed on\r\n * invocation and will be passed to action handlers.\r\n *\r\n * This type is supposed to be an object with the key being one of the actions mentioned above.\r\n * The value to the key can be anything.\r\n * If an action has no argument, you do not need to add it to this type.\r\n *\r\n * NOTE: We can't enforce type checks to make sure the key is Action, you\r\n * will know if you got something wrong if there is a type error in this file\r\n */\r\ntype ActionArgsMap = {\r\n  \"seek-forward\": { seconds: number } | undefined; // Args needed for seeking forward (default: 1)\r\n  \"seek-backward\": { seconds: number } | undefined; // Args needed for seeking backward (default: 1)\r\n  \"jump-forward\": { seconds: number } | undefined; // Args needed for jumping forward (default: 5)\r\n  \"jump-backward\": { seconds: number } | undefined; // Args needed for jumping backward (default: 5)\r\n};\r\n\r\ntype KeysWithValueUndefined<T> = {\r\n  [K in keyof T]: undefined extends T[K] ? K : never;\r\n}[keyof T];\r\n\r\n/**\r\n * Actions which require arguments for their invocation\r\n */\r\nexport type ActionWithArgs = keyof ActionArgsMap;\r\n\r\n/**\r\n * Actions which optionally takes in arguments for their invocation\r\n */\r\n\r\nexport type ActionWithOptionalArgs =\r\n  | ActionWithNoArgs\r\n  | KeysWithValueUndefined<ActionArgsMap>;\r\n\r\n/**\r\n * Actions which do not require arguments for their invocation\r\n */\r\nexport type ActionWithNoArgs = Exclude<Action, ActionWithArgs>;\r\n\r\n/**\r\n * Resolves the argument type for a given Action\r\n */\r\ntype ArgOfHoppAction<A extends Action> = A extends ActionWithArgs\r\n  ? ActionArgsMap[A]\r\n  : undefined;\r\n\r\n/**\r\n * Resolves the action function for a given Action, used by action handler function defs\r\n */\r\ntype ActionFunc<A extends Action> = A extends ActionWithArgs\r\n  ? (arg: ArgOfHoppAction<A>, trigger?: InvocationTriggers) => void\r\n  : (_?: undefined, trigger?: InvocationTriggers) => void;\r\n\r\ntype BoundActionList = {\r\n  [A in Action]?: Array<ActionFunc<A>>;\r\n};\r\n\r\nconst boundActions: BoundActionList = {};\r\n\r\nlet currentActiveActions: Action[] = [];\r\n\r\nfunction updateActiveActions() {\r\n  const newActions = Object.keys(boundActions) as Action[];\r\n  currentActiveActions = newActions;\r\n  actionEmitter.emit(newActions);\r\n}\r\n\r\nexport function bindAction<A extends Action>(\r\n  action: A,\r\n  handler: ActionFunc<A>\r\n) {\r\n  if (boundActions[action]) {\r\n    boundActions[action]?.push(handler);\r\n  } else {\r\n    // 'any' assertion because TypeScript doesn't seem to be able to figure out the links.\r\n    boundActions[action] = [handler] as any;\r\n  }\r\n\r\n  updateActiveActions();\r\n}\r\n\r\nexport type InvocationTriggers = \"keypress\" | \"mouseclick\";\r\n\r\ntype InvokeActionFunc = {\r\n  (\r\n    action: ActionWithOptionalArgs,\r\n    args?: undefined,\r\n    trigger?: InvocationTriggers\r\n  ): void;\r\n  <A extends ActionWithArgs>(action: A, args: ActionArgsMap[A]): void;\r\n};\r\n\r\n/**\r\n * Invokes an action, triggering action handlers if any registered.\r\n * The second and third arguments are optional\r\n * @param action The action to fire\r\n * @param args The argument passed to the action handler. Optional if action has no args required\r\n * @param trigger Optionally supply the trigger that invoked the action (keypress/mouseclick)\r\n */\r\nexport const invokeAction: InvokeActionFunc = <A extends Action>(\r\n  action: A,\r\n  args?: ArgOfHoppAction<A>,\r\n  trigger?: InvocationTriggers\r\n) => {\r\n  boundActions[action]?.forEach((handler) => (handler as any)(args, trigger));\r\n};\r\n\r\nexport function unbindAction<A extends Action>(\r\n  action: A,\r\n  handler: ActionFunc<A>\r\n) {\r\n  // 'any' assertion because TypeScript doesn't seem to be able to figure out the links.\r\n  boundActions[action] = boundActions[action]?.filter(\r\n    (x) => x !== handler\r\n  ) as any;\r\n\r\n  if (boundActions[action]?.length === 0) {\r\n    delete boundActions[action];\r\n  }\r\n\r\n  updateActiveActions();\r\n}\r\n\r\n/**\r\n * Returns whether a given action is bound at a given time\r\n *\r\n * @param action The action to check\r\n */\r\nexport function isActionBound(action: Action): boolean {\r\n  return !!boundActions[action];\r\n}\r\n\r\n/**\r\n * A React hook that defines a component can handle a given\r\n * Action. The handler will be bound when the component is mounted\r\n * and unbound when the component is unmounted.\r\n * @param action The action to be bound\r\n * @param handler The function to be called when the action is invoked\r\n * @param isActive A ref that indicates whether the action is active\r\n */\r\nexport function useActionHandler<A extends Action>(\r\n  action: A,\r\n  handler: ActionFunc<A>,\r\n  isActive: MutableRefObject<boolean> | boolean | undefined\r\n) {\r\n  const handlerRef = useRef(handler);\r\n  const [isBound, setIsBound] = useState(false);\r\n\r\n  // Update handler ref when handler changes\r\n  useEffect(() => {\r\n    handlerRef.current = handler;\r\n  }, [handler]);\r\n\r\n  // Create a stable handler wrapper\r\n  const stableHandler = useCallback(\r\n    (args: any, trigger?: InvocationTriggers) => {\r\n      (handlerRef.current as any)(args, trigger);\r\n    },\r\n    []\r\n  ) as ActionFunc<A>;\r\n\r\n  useEffect(() => {\r\n    const shouldBind =\r\n      isActive === undefined ||\r\n      (typeof isActive === \"boolean\" ? isActive : isActive.current);\r\n\r\n    if (shouldBind && !isBound) {\r\n      bindAction(action, stableHandler);\r\n      setIsBound(true);\r\n    } else if (!shouldBind && isBound) {\r\n      unbindAction(action, stableHandler);\r\n      setIsBound(false);\r\n    }\r\n\r\n    return () => {\r\n      if (isBound) {\r\n        unbindAction(action, stableHandler);\r\n        setIsBound(false);\r\n      }\r\n    };\r\n  }, [action, stableHandler, isActive, isBound]);\r\n\r\n  // Handle ref-based isActive changes\r\n  useEffect(() => {\r\n    if (isActive && typeof isActive === \"object\" && \"current\" in isActive) {\r\n      // Poll for ref changes\r\n      const interval = setInterval(() => {\r\n        const shouldBind = isActive.current;\r\n        if (shouldBind !== isBound) {\r\n          if (shouldBind) {\r\n            bindAction(action, stableHandler);\r\n          } else {\r\n            unbindAction(action, stableHandler);\r\n          }\r\n          setIsBound(shouldBind);\r\n        }\r\n      }, 100);\r\n      return () => clearInterval(interval);\r\n    }\r\n  }, [action, stableHandler, isActive, isBound]);\r\n}\r\n\r\n/**\r\n * A React hook that returns the current list of active actions\r\n * and re-renders when the list changes\r\n */\r\nexport function useActiveActions(): Action[] {\r\n  const [activeActions, setActiveActions] = useState<Action[]>([]);\r\n\r\n  useEffect(() => {\r\n    // Set initial value\r\n    setActiveActions(currentActiveActions);\r\n\r\n    // Subscribe to changes\r\n    const unsubscribe = actionEmitter.subscribe(setActiveActions);\r\n    return unsubscribe;\r\n  }, []);\r\n\r\n  return activeActions;\r\n}\r\n\r\n/**\r\n * A React hook that returns whether a specific action is currently bound\r\n * and re-renders when the binding state changes\r\n */\r\nexport function useIsActionBound(action: Action): boolean {\r\n  const [isBound, setIsBound] = useState(() => isActionBound(action));\r\n\r\n  useEffect(() => {\r\n    const updateBoundState = () => {\r\n      setIsBound(isActionBound(action));\r\n    };\r\n\r\n    // Set initial value\r\n    updateBoundState();\r\n\r\n    // Subscribe to changes\r\n    const unsubscribe = actionEmitter.subscribe(updateBoundState);\r\n    return unsubscribe;\r\n  }, [action]);\r\n\r\n  return isBound;\r\n}\r\n","import { useEffect } from \"react\";\r\nimport { invokeAction } from \"../constants/actions\";\r\nimport { useKeybindingsStore } from \"@/stores/keybindings-store\";\r\n\r\n/**\r\n * A composable that hooks to the caller component's\r\n * lifecycle and hooks to the keyboard events to fire\r\n * the appropriate actions based on keybindings\r\n */\r\nexport function useKeybindingsListener() {\r\n  const { keybindings, getKeybindingString, keybindingsEnabled, isRecording } =\r\n    useKeybindingsStore();\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (ev: KeyboardEvent) => {\r\n      // Do not check keybinds if the mode is disabled\r\n      if (!keybindingsEnabled) return;\r\n      // ignore key events if user is changing keybindings\r\n      if (isRecording) return;\r\n\r\n      const binding = getKeybindingString(ev);\r\n      if (!binding) return;\r\n\r\n      const boundAction = keybindings[binding];\r\n      if (!boundAction) return;\r\n\r\n      const activeElement = document.activeElement;\r\n      const isTextInput =\r\n        activeElement &&\r\n        (activeElement.tagName === \"INPUT\" ||\r\n          activeElement.tagName === \"TEXTAREA\" ||\r\n          (activeElement as HTMLElement).isContentEditable);\r\n\r\n      if (isTextInput) return;\r\n\r\n      ev.preventDefault();\r\n\r\n      // Handle actions with default arguments\r\n      let actionArgs: any;\r\n\r\n      if (boundAction === \"seek-forward\") {\r\n        actionArgs = { seconds: 1 };\r\n      } else if (boundAction === \"seek-backward\") {\r\n        actionArgs = { seconds: 1 };\r\n      } else if (boundAction === \"jump-forward\") {\r\n        actionArgs = { seconds: 5 };\r\n      } else if (boundAction === \"jump-backward\") {\r\n        actionArgs = { seconds: 5 };\r\n      }\r\n\r\n      invokeAction(boundAction, actionArgs, \"keypress\");\r\n    };\r\n\r\n    document.addEventListener(\"keydown\", handleKeyDown);\r\n\r\n    return () => {\r\n      document.removeEventListener(\"keydown\", handleKeyDown);\r\n    };\r\n  }, [keybindings, getKeybindingString, keybindingsEnabled, isRecording]);\r\n}\r\n\r\n/**\r\n * This composable allows for the UI component to be disabled if the component in question is mounted\r\n */\r\nexport function useKeybindingDisabler() {\r\n  const { disableKeybindings, enableKeybindings } = useKeybindingsStore();\r\n\r\n  return {\r\n    disableKeybindings,\r\n    enableKeybindings,\r\n  };\r\n}\r\n\r\n// Export the bindings for backward compatibility\r\nexport const bindings = {};\r\n","\"use client\";\r\n\r\nimport { useEffect } from \"react\";\r\nimport { useActionHandler } from \"@/constants/actions\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\nimport { useProjectStore } from \"@/stores/project-store\";\r\nimport { toast } from \"sonner\";\r\n\r\nexport function useEditorActions() {\r\n  const {\r\n    tracks,\r\n    selectedElements,\r\n    clearSelectedElements,\r\n    setSelectedElements,\r\n    removeElementFromTrack,\r\n    splitElement,\r\n    addElementToTrack,\r\n    snappingEnabled,\r\n    toggleSnapping,\r\n    undo,\r\n    redo,\r\n  } = useTimelineStore();\r\n\r\n  const { currentTime, duration, isPlaying, toggle, seek } = usePlaybackStore();\r\n  const { activeProject } = useProjectStore();\r\n\r\n  // Playback actions\r\n  useActionHandler(\r\n    \"toggle-play\",\r\n    () => {\r\n      toggle();\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"stop-playback\",\r\n    () => {\r\n      if (isPlaying) {\r\n        toggle();\r\n      }\r\n      seek(0);\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"seek-forward\",\r\n    (args) => {\r\n      const seconds = args?.seconds ?? 1;\r\n      seek(Math.min(duration, currentTime + seconds));\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"seek-backward\",\r\n    (args) => {\r\n      const seconds = args?.seconds ?? 1;\r\n      seek(Math.max(0, currentTime - seconds));\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"frame-step-forward\",\r\n    () => {\r\n      const projectFps = activeProject?.fps || 30;\r\n      seek(Math.min(duration, currentTime + 1 / projectFps));\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"frame-step-backward\",\r\n    () => {\r\n      const projectFps = activeProject?.fps || 30;\r\n      seek(Math.max(0, currentTime - 1 / projectFps));\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"jump-forward\",\r\n    (args) => {\r\n      const seconds = args?.seconds ?? 5;\r\n      seek(Math.min(duration, currentTime + seconds));\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"jump-backward\",\r\n    (args) => {\r\n      const seconds = args?.seconds ?? 5;\r\n      seek(Math.max(0, currentTime - seconds));\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"goto-start\",\r\n    () => {\r\n      seek(0);\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"goto-end\",\r\n    () => {\r\n      seek(duration);\r\n    },\r\n    undefined\r\n  );\r\n\r\n  // Timeline editing actions\r\n  useActionHandler(\r\n    \"split-element\",\r\n    () => {\r\n      if (selectedElements.length !== 1) {\r\n        toast.error(\"Select exactly one element to split\");\r\n        return;\r\n      }\r\n\r\n      const { trackId, elementId } = selectedElements[0];\r\n      const track = tracks.find((t: any) => t.id === trackId);\r\n      const element = track?.elements.find((el: any) => el.id === elementId);\r\n\r\n      if (element) {\r\n        const effectiveStart = element.startTime;\r\n        const effectiveEnd =\r\n          element.startTime +\r\n          (element.duration - element.trimStart - element.trimEnd);\r\n\r\n        if (currentTime > effectiveStart && currentTime < effectiveEnd) {\r\n          splitElement(trackId, elementId, currentTime);\r\n        } else {\r\n          toast.error(\"Playhead must be within selected element\");\r\n        }\r\n      }\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"delete-selected\",\r\n    () => {\r\n      if (selectedElements.length === 0) {\r\n        return;\r\n      }\r\n      selectedElements.forEach(\r\n        ({ trackId, elementId }: { trackId: string; elementId: string }) => {\r\n          removeElementFromTrack(trackId, elementId);\r\n        }\r\n      );\r\n      clearSelectedElements();\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"select-all\",\r\n    () => {\r\n      const allElements = tracks.flatMap((track: any) =>\r\n        track.elements.map((element: any) => ({\r\n          trackId: track.id,\r\n          elementId: element.id,\r\n        }))\r\n      );\r\n      setSelectedElements(allElements);\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"duplicate-selected\",\r\n    () => {\r\n      if (selectedElements.length !== 1) {\r\n        toast.error(\"Select exactly one element to duplicate\");\r\n        return;\r\n      }\r\n\r\n      const { trackId, elementId } = selectedElements[0];\r\n      const track = tracks.find((t: any) => t.id === trackId);\r\n      const element = track?.elements.find((el: any) => el.id === elementId);\r\n\r\n      if (element) {\r\n        const newStartTime =\r\n          element.startTime +\r\n          (element.duration - element.trimStart - element.trimEnd) +\r\n          0.1;\r\n        const { id, ...elementWithoutId } = element;\r\n\r\n        addElementToTrack(trackId, {\r\n          ...elementWithoutId,\r\n          startTime: newStartTime,\r\n        });\r\n      }\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"toggle-snapping\",\r\n    () => {\r\n      toggleSnapping();\r\n    },\r\n    undefined\r\n  );\r\n\r\n  // History actions\r\n  useActionHandler(\r\n    \"undo\",\r\n    () => {\r\n      undo();\r\n    },\r\n    undefined\r\n  );\r\n\r\n  useActionHandler(\r\n    \"redo\",\r\n    () => {\r\n      redo();\r\n    },\r\n    undefined\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { useEffect } from \"react\";\r\nimport { Loader2 } from \"lucide-react\";\r\nimport { useEditorStore } from \"@/stores/editor-store\";\r\nimport {\r\n  useKeybindingsListener,\r\n  useKeybindingDisabler,\r\n} from \"@/hooks/use-keybindings\";\r\nimport { useEditorActions } from \"@/hooks/use-editor-actions\";\r\n\r\ninterface EditorProviderProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport function EditorProvider({ children }: EditorProviderProps) {\r\n  const { isInitializing, isPanelsReady, initializeApp } = useEditorStore();\r\n  const { disableKeybindings, enableKeybindings } = useKeybindingDisabler();\r\n\r\n  // Set up action handlers\r\n  useEditorActions();\r\n\r\n  // Set up keybinding listener\r\n  useKeybindingsListener();\r\n\r\n  // Disable keybindings when initializing\r\n  useEffect(() => {\r\n    if (isInitializing || !isPanelsReady) {\r\n      disableKeybindings();\r\n    } else {\r\n      enableKeybindings();\r\n    }\r\n  }, [isInitializing, isPanelsReady, disableKeybindings, enableKeybindings]);\r\n\r\n  useEffect(() => {\r\n    initializeApp();\r\n  }, [initializeApp]);\r\n\r\n  // Show loading screen while initializing\r\n  if (isInitializing || !isPanelsReady) {\r\n    return (\r\n      <div className=\"h-screen w-screen flex items-center justify-center bg-background\">\r\n        <div className=\"flex flex-col items-center gap-4\">\r\n          <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\r\n          <p className=\"text-sm text-muted-foreground\">Loading editor...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // App is ready, render children\r\n  return <>{children}</>;\r\n}\r\n","import { create } from \"zustand\";\r\nimport { persist } from \"zustand/middleware\";\r\n\r\nconst DEFAULT_PANEL_SIZES = {\r\n  toolsPanel: 45,\r\n  previewPanel: 75,\r\n  propertiesPanel: 20,\r\n  mainContent: 70,\r\n  timeline: 30,\r\n} as const;\r\n\r\ninterface PanelState {\r\n  // Panel sizes as percentages\r\n  toolsPanel: number;\r\n  previewPanel: number;\r\n  propertiesPanel: number;\r\n  mainContent: number;\r\n  timeline: number;\r\n\r\n  mediaViewMode: \"grid\" | \"list\";\r\n\r\n  // Actions\r\n  setToolsPanel: (size: number) => void;\r\n  setPreviewPanel: (size: number) => void;\r\n  setPropertiesPanel: (size: number) => void;\r\n  setMainContent: (size: number) => void;\r\n  setTimeline: (size: number) => void;\r\n  setMediaViewMode: (mode: \"grid\" | \"list\") => void;\r\n}\r\n\r\nexport const usePanelStore = create<PanelState>()(\r\n  persist(\r\n    (set) => ({\r\n      // Default sizes - optimized for responsiveness\r\n      ...DEFAULT_PANEL_SIZES,\r\n\r\n      mediaViewMode: \"grid\" as const,\r\n\r\n      // Actions\r\n      setToolsPanel: (size) => set({ toolsPanel: size }),\r\n      setPreviewPanel: (size) => set({ previewPanel: size }),\r\n      setPropertiesPanel: (size) => set({ propertiesPanel: size }),\r\n      setMainContent: (size) => set({ mainContent: size }),\r\n      setTimeline: (size) => set({ timeline: size }),\r\n      setMediaViewMode: (mode) => set({ mediaViewMode: mode }),\r\n    }),\r\n    {\r\n      name: \"panel-sizes\",\r\n    }\r\n  )\r\n);\r\n","\"use client\";\r\n\r\nimport { create } from \"zustand\";\r\nimport { persist } from \"zustand/middleware\";\r\nimport { ActionWithOptionalArgs } from \"@/constants/actions\";\r\nimport { isAppleDevice, isDOMElement, isTypableElement } from \"@/lib/utils\";\r\nimport { KeybindingConfig, ShortcutKey } from \"@/types/keybinding\";\r\n\r\n// Default keybindings configuration\r\nexport const defaultKeybindings: KeybindingConfig = {\r\n  space: \"toggle-play\",\r\n  j: \"seek-backward\",\r\n  k: \"toggle-play\",\r\n  l: \"seek-forward\",\r\n  left: \"frame-step-backward\",\r\n  right: \"frame-step-forward\",\r\n  \"shift+left\": \"jump-backward\",\r\n  \"shift+right\": \"jump-forward\",\r\n  home: \"goto-start\",\r\n  end: \"goto-end\",\r\n  s: \"split-element\",\r\n  n: \"toggle-snapping\",\r\n  \"ctrl+a\": \"select-all\",\r\n  \"ctrl+d\": \"duplicate-selected\",\r\n  \"ctrl+z\": \"undo\",\r\n  \"ctrl+shift+z\": \"redo\",\r\n  \"ctrl+y\": \"redo\",\r\n  delete: \"delete-selected\",\r\n  backspace: \"delete-selected\",\r\n};\r\n\r\nexport interface KeybindingConflict {\r\n  key: ShortcutKey;\r\n  existingAction: ActionWithOptionalArgs;\r\n  newAction: ActionWithOptionalArgs;\r\n}\r\n\r\ninterface KeybindingsState {\r\n  keybindings: KeybindingConfig;\r\n  isCustomized: boolean;\r\n  keybindingsEnabled: boolean;\r\n  isRecording: boolean;\r\n\r\n  // Actions\r\n  updateKeybinding: (key: ShortcutKey, action: ActionWithOptionalArgs) => void;\r\n  removeKeybinding: (key: ShortcutKey) => void;\r\n  resetToDefaults: () => void;\r\n  importKeybindings: (config: KeybindingConfig) => void;\r\n  exportKeybindings: () => KeybindingConfig;\r\n  enableKeybindings: () => void;\r\n  disableKeybindings: () => void;\r\n  setIsRecording: (isRecording: boolean) => void;\r\n\r\n  // Validation\r\n  validateKeybinding: (\r\n    key: ShortcutKey,\r\n    action: ActionWithOptionalArgs\r\n  ) => KeybindingConflict | null;\r\n  getKeybindingsForAction: (action: ActionWithOptionalArgs) => ShortcutKey[];\r\n\r\n  // Utility\r\n  getKeybindingString: (ev: KeyboardEvent) => ShortcutKey | null;\r\n}\r\n\r\nexport const useKeybindingsStore = create<KeybindingsState>()(\r\n  persist(\r\n    (set, get) => ({\r\n      keybindings: { ...defaultKeybindings },\r\n      isCustomized: false,\r\n      keybindingsEnabled: true,\r\n      isRecording: false,\r\n\r\n      updateKeybinding: (key: ShortcutKey, action: ActionWithOptionalArgs) => {\r\n        set((state) => {\r\n          const newKeybindings = { ...state.keybindings };\r\n          newKeybindings[key] = action;\r\n\r\n          return {\r\n            keybindings: newKeybindings,\r\n            isCustomized: true,\r\n          };\r\n        });\r\n      },\r\n\r\n      removeKeybinding: (key: ShortcutKey) => {\r\n        set((state) => {\r\n          const newKeybindings = { ...state.keybindings };\r\n          delete newKeybindings[key];\r\n\r\n          return {\r\n            keybindings: newKeybindings,\r\n            isCustomized: true,\r\n          };\r\n        });\r\n      },\r\n\r\n      resetToDefaults: () => {\r\n        set({\r\n          keybindings: { ...defaultKeybindings },\r\n          isCustomized: false,\r\n        });\r\n      },\r\n\r\n      enableKeybindings: () => {\r\n        set({ keybindingsEnabled: true });\r\n      },\r\n\r\n      disableKeybindings: () => {\r\n        set({ keybindingsEnabled: false });\r\n      },\r\n\r\n      importKeybindings: (config: KeybindingConfig) => {\r\n        // Validate all keys and actions\r\n        for (const [key, action] of Object.entries(config)) {\r\n          // Validate the key format\r\n          if (typeof key !== \"string\" || key.length === 0) {\r\n            throw new Error(`Invalid key format: ${key}`);\r\n          }\r\n        }\r\n        set({\r\n          keybindings: { ...config },\r\n          isCustomized: true,\r\n        });\r\n      },\r\n\r\n      exportKeybindings: () => {\r\n        return get().keybindings;\r\n      },\r\n\r\n      validateKeybinding: (\r\n        key: ShortcutKey,\r\n        action: ActionWithOptionalArgs\r\n      ) => {\r\n        const { keybindings } = get();\r\n        const existingAction = keybindings[key];\r\n\r\n        if (existingAction && existingAction !== action) {\r\n          return {\r\n            key,\r\n            existingAction,\r\n            newAction: action,\r\n          };\r\n        }\r\n\r\n        return null;\r\n      },\r\n      setIsRecording: (isRecording: boolean) => {\r\n        set({ isRecording });\r\n      },\r\n\r\n      getKeybindingsForAction: (action: ActionWithOptionalArgs) => {\r\n        const { keybindings } = get();\r\n        return Object.keys(keybindings).filter(\r\n          (key) => keybindings[key as ShortcutKey] === action\r\n        ) as ShortcutKey[];\r\n      },\r\n\r\n      getKeybindingString: (ev: KeyboardEvent) => {\r\n        return generateKeybindingString(ev) as ShortcutKey | null;\r\n      },\r\n    }),\r\n    {\r\n      name: \"opencut-keybindings\",\r\n      version: 1,\r\n    }\r\n  )\r\n);\r\n\r\n// Utility functions\r\nfunction generateKeybindingString(ev: KeyboardEvent): ShortcutKey | null {\r\n  const target = ev.target;\r\n\r\n  // We may or may not have a modifier key\r\n  const modifierKey = getActiveModifier(ev);\r\n\r\n  // We will always have a non-modifier key\r\n  const key = getPressedKey(ev);\r\n  if (!key) return null;\r\n\r\n  // All key combos backed by modifiers are valid shortcuts (whether currently typing or not)\r\n  if (modifierKey) {\r\n    // If the modifier is shift and the target is an input, we ignore\r\n    if (\r\n      modifierKey === \"shift\" &&\r\n      isDOMElement(target) &&\r\n      isTypableElement(target)\r\n    ) {\r\n      return null;\r\n    }\r\n\r\n    return `${modifierKey}+${key}` as ShortcutKey;\r\n  }\r\n\r\n  // no modifier key here then we do not do anything while on input\r\n  if (isDOMElement(target) && isTypableElement(target)) return null;\r\n\r\n  // single key while not input\r\n  return `${key}` as ShortcutKey;\r\n}\r\n\r\nfunction getPressedKey(ev: KeyboardEvent): string | null {\r\n  // Sometimes the property code is not available on the KeyboardEvent object\r\n  const key = (ev.key ?? \"\").toLowerCase();\r\n  const code = ev.code ?? \"\";\r\n\r\n  // Check arrow keys\r\n  if (key.startsWith(\"arrow\")) {\r\n    return key.slice(5);\r\n  }\r\n\r\n  // Check for special keys\r\n  if (key === \"tab\") return \"tab\";\r\n  if (key === \" \" || key === \"space\") return \"space\";\r\n  if (key === \"home\") return \"home\";\r\n  if (key === \"end\") return \"end\";\r\n  if (key === \"delete\") return \"delete\";\r\n  if (key === \"backspace\") return \"backspace\";\r\n\r\n  // Check letter keys\r\n  if (code.startsWith(\"Key\")) {\r\n    const letter = code.slice(3).toLowerCase();\r\n    if (letter.length === 1 && letter >= \"a\" && letter <= \"z\") {\r\n      return letter;\r\n    }\r\n  }\r\n\r\n  // Check number keys using physical position for AZERTY support\r\n  if (code.startsWith(\"Digit\")) {\r\n    const digit = code.slice(5);\r\n    if (digit.length === 1 && digit >= \"0\" && digit <= \"9\") {\r\n      return digit;\r\n    }\r\n  }\r\n\r\n  // Fallback for other layouts\r\n  const isDigit = key.length === 1 && key >= \"0\" && key <= \"9\";\r\n  if (isDigit) return key;\r\n\r\n  // Check if slash, period or enter\r\n  if (key === \"/\" || key === \".\" || key === \"enter\") return key;\r\n\r\n  // If no other cases match, this is not a valid key\r\n  return null;\r\n}\r\n\r\nfunction getActiveModifier(ev: KeyboardEvent): string | null {\r\n  const modifierKeys = {\r\n    ctrl: isAppleDevice() ? ev.metaKey : ev.ctrlKey,\r\n    alt: ev.altKey,\r\n    shift: ev.shiftKey,\r\n  };\r\n\r\n  // active modifier: ctrl | alt | ctrl+alt | ctrl+shift | ctrl+alt+shift | alt+shift\r\n  // modiferKeys object's keys are sorted to match the above order\r\n  const activeModifier = Object.keys(modifierKeys)\r\n    .filter((key) => modifierKeys[key as keyof typeof modifierKeys])\r\n    .join(\"+\");\r\n\r\n  return activeModifier === \"\" ? null : activeModifier;\r\n}\r\n","\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { Slider as SliderPrimitive } from \"radix-ui\";\r\n\r\nimport { cn } from \"../../lib/utils\";\r\n\r\nconst Slider = React.forwardRef<\r\n  React.ElementRef<typeof SliderPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\r\n>(({ className, ...props }, ref) => (\r\n  <SliderPrimitive.Root\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex w-full touch-none select-none items-center\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\r\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\r\n    </SliderPrimitive.Track>\r\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow-sm transition-colors focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\r\n  </SliderPrimitive.Root>\r\n));\r\nSlider.displayName = SliderPrimitive.Root.displayName;\r\n\r\nexport { Slider };\r\n","\"use client\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport { ReactNode } from \"react\";\r\n\r\ninterface HeaderBaseProps {\r\n  leftContent?: ReactNode;\r\n  centerContent?: ReactNode;\r\n  rightContent?: ReactNode;\r\n  className?: string;\r\n  children?: ReactNode;\r\n}\r\n\r\nexport function HeaderBase({\r\n  leftContent,\r\n  centerContent,\r\n  rightContent,\r\n  className,\r\n  children,\r\n}: HeaderBaseProps) {\r\n  // If children is provided, render it directly without the grid layout\r\n  if (children) {\r\n    return (\r\n      <header className={cn(\"px-6 h-16 flex items-center\", className)}>\r\n        {children}\r\n      </header>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <header\r\n      className={cn(\"px-6 h-14 flex justify-between items-center\", className)}\r\n    >\r\n      {leftContent && <div className=\"flex items-center\">{leftContent}</div>}\r\n      {centerContent && (\r\n        <div className=\"flex items-center\">{centerContent}</div>\r\n      )}\r\n      {rightContent && <div className=\"flex items-center\">{rightContent}</div>}\r\n    </header>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { useMemo } from \"react\";\r\nimport { useKeybindingsStore } from \"@/stores/keybindings-store\";\r\nimport { Action } from \"@/constants/actions\";\r\nimport { getPlatformAlternateKey, getPlatformSpecialKey } from \"@/lib/utils\";\r\n\r\nexport interface KeyboardShortcut {\r\n  id: string;\r\n  keys: string[];\r\n  description: string;\r\n  category: string;\r\n  action: Action;\r\n  icon?: React.ReactNode;\r\n}\r\n\r\n// Map actions to their descriptions and categories\r\nconst actionDescriptions: Record<\r\n  Action,\r\n  { description: string; category: string }\r\n> = {\r\n  \"toggle-play\": { description: \"Play/Pause\", category: \"Playback\" },\r\n  \"stop-playback\": { description: \"Stop playback\", category: \"Playback\" },\r\n  \"seek-forward\": {\r\n    description: \"Seek forward 1 second\",\r\n    category: \"Playback\",\r\n  },\r\n  \"seek-backward\": {\r\n    description: \"Seek backward 1 second\",\r\n    category: \"Playback\",\r\n  },\r\n  \"frame-step-forward\": {\r\n    description: \"Frame step forward\",\r\n    category: \"Navigation\",\r\n  },\r\n  \"frame-step-backward\": {\r\n    description: \"Frame step backward\",\r\n    category: \"Navigation\",\r\n  },\r\n  \"jump-forward\": {\r\n    description: \"Jump forward 5 seconds\",\r\n    category: \"Navigation\",\r\n  },\r\n  \"jump-backward\": {\r\n    description: \"Jump backward 5 seconds\",\r\n    category: \"Navigation\",\r\n  },\r\n  \"goto-start\": { description: \"Go to timeline start\", category: \"Navigation\" },\r\n  \"goto-end\": { description: \"Go to timeline end\", category: \"Navigation\" },\r\n  \"split-element\": {\r\n    description: \"Split element at playhead\",\r\n    category: \"Editing\",\r\n  },\r\n  \"delete-selected\": {\r\n    description: \"Delete selected elements\",\r\n    category: \"Editing\",\r\n  },\r\n  \"select-all\": { description: \"Select all elements\", category: \"Selection\" },\r\n  \"duplicate-selected\": {\r\n    description: \"Duplicate selected element\",\r\n    category: \"Selection\",\r\n  },\r\n  \"toggle-snapping\": { description: \"Toggle snapping\", category: \"Editing\" },\r\n  undo: { description: \"Undo\", category: \"History\" },\r\n  redo: { description: \"Redo\", category: \"History\" },\r\n};\r\n\r\n// Convert key binding format to display format\r\nconst formatKey = (key: string): string => {\r\n  return key\r\n    .replace(\"ctrl\", getPlatformSpecialKey())\r\n    .replace(\"alt\", getPlatformAlternateKey())\r\n    .replace(\"shift\", \"Shift\")\r\n    .replace(\"left\", \"←\")\r\n    .replace(\"right\", \"→\")\r\n    .replace(\"up\", \"↑\")\r\n    .replace(\"down\", \"↓\")\r\n    .replace(\"space\", \"Space\")\r\n    .replace(\"home\", \"Home\")\r\n    .replace(\"end\", \"End\")\r\n    .replace(\"delete\", \"Delete\")\r\n    .replace(\"backspace\", \"Backspace\")\r\n    .replace(\"-\", \"+\");\r\n};\r\n\r\nexport const useKeyboardShortcutsHelp = () => {\r\n  const { keybindings } = useKeybindingsStore();\r\n\r\n  const shortcuts = useMemo(() => {\r\n    const result: KeyboardShortcut[] = [];\r\n\r\n    // Group keybindings by action\r\n    const actionToKeys: Record<Action, string[]> = {} as any;\r\n\r\n    Object.entries(keybindings).forEach(([key, action]) => {\r\n      if (action) {\r\n        if (!actionToKeys[action]) {\r\n          actionToKeys[action] = [];\r\n        }\r\n        actionToKeys[action].push(formatKey(key));\r\n      }\r\n    });\r\n\r\n    // Convert to shortcuts format\r\n    Object.entries(actionToKeys).forEach(([action, keys]) => {\r\n      const actionInfo = actionDescriptions[action as Action];\r\n      if (actionInfo) {\r\n        result.push({\r\n          id: action,\r\n          keys,\r\n          description: actionInfo.description,\r\n          category: actionInfo.category,\r\n          action: action as Action,\r\n        });\r\n      }\r\n    });\r\n\r\n    // Sort shortcuts by category first, then by description to ensure consistent ordering\r\n    return result.sort((a, b) => {\r\n      if (a.category !== b.category) {\r\n        return a.category.localeCompare(b.category);\r\n      }\r\n      return a.description.localeCompare(b.description);\r\n    });\r\n  }, [keybindings]);\r\n\r\n  return {\r\n    shortcuts,\r\n  };\r\n};\r\n","\"use client\";\r\n\r\nimport { Keyboard } from \"lucide-react\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { toast } from \"sonner\";\r\nimport {\r\n  type KeyboardShortcut,\r\n  useKeyboardShortcutsHelp,\r\n} from \"@/hooks/use-keyboard-shortcuts-help\";\r\nimport { useKeybindingsStore } from \"@/stores/keybindings-store\";\r\nimport { Button } from \"./ui/button\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"./ui/dialog\";\r\n\r\nconst ShortcutItem = ({\r\n  shortcut,\r\n  isRecording,\r\n  onStartRecording,\r\n}: {\r\n  shortcut: KeyboardShortcut;\r\n  isRecording: boolean;\r\n  onStartRecording: (shortcut: KeyboardShortcut) => void;\r\n}) => {\r\n  // Filter out lowercase duplicates for display - if both \"j\" and \"J\" exist, only show \"J\"\r\n  const displayKeys = shortcut.keys.filter((key: string) => {\r\n    if (\r\n      key.includes(\"Cmd\") &&\r\n      shortcut.keys.includes(key.replace(\"Cmd\", \"Ctrl\"))\r\n    )\r\n      return false;\r\n\r\n    return true;\r\n  });\r\n\r\n  return (\r\n    <div className=\"flex items-center justify-between\">\r\n      <div className=\"flex items-center gap-3\">\r\n        {shortcut.icon && (\r\n          <div className=\"text-muted-foreground\">{shortcut.icon}</div>\r\n        )}\r\n        <span className=\"text-sm\">{shortcut.description}</span>\r\n      </div>\r\n      <div className=\"flex items-center gap-1\">\r\n        {displayKeys.map((key: string, index: number) => (\r\n          <div key={key} className=\"flex items-center gap-1\">\r\n            <div className=\"flex items-center\">\r\n              {key.split(\"+\").map((keyPart: string, partIndex: number) => {\r\n                const keyId = `${shortcut.id}-${index}-${partIndex}`;\r\n                return (\r\n                  <EditableShortcutKey\r\n                    key={keyId}\r\n                    isRecording={isRecording}\r\n                    onStartRecording={() => onStartRecording(shortcut)}\r\n                  >\r\n                    {keyPart}\r\n                  </EditableShortcutKey>\r\n                );\r\n              })}\r\n            </div>\r\n            {index < displayKeys.length - 1 && (\r\n              <span className=\"text-xs text-muted-foreground\">or</span>\r\n            )}\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst EditableShortcutKey = ({\r\n  children,\r\n  isRecording,\r\n  onStartRecording,\r\n}: {\r\n  children: React.ReactNode;\r\n  isRecording: boolean;\r\n  onStartRecording: () => void;\r\n}) => {\r\n  const handleClick = (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    onStartRecording();\r\n  };\r\n\r\n  return (\r\n    <Button\r\n      variant=\"text\"\r\n      size=\"sm\"\r\n      className={`inline-flex font-sans text-xs rounded px-2 min-w-6 min-h-6 leading-none items-center justify-center shadow-xs border mr-1 cursor-pointer hover:bg-opacity-80 ${\r\n        isRecording\r\n          ? \"border-primary bg-primary/10\"\r\n          : \"border bg-accent\"\r\n      }`}\r\n      onClick={handleClick}\r\n      title={\r\n        isRecording ? \"Press any key combination...\" : \"Click to edit shortcut\"\r\n      }\r\n    >\r\n      {children}\r\n    </Button>\r\n  );\r\n};\r\n\r\nexport const KeyboardShortcutsHelp = () => {\r\n  const [open, setOpen] = useState(false);\r\n  const [recordingShortcut, setRecordingShortcut] =\r\n    useState<KeyboardShortcut | null>(null);\r\n\r\n  const {\r\n    updateKeybinding,\r\n    removeKeybinding,\r\n    getKeybindingString,\r\n    validateKeybinding,\r\n    getKeybindingsForAction,\r\n    setIsRecording,\r\n    resetToDefaults,\r\n    isRecording,\r\n  } = useKeybindingsStore();\r\n\r\n  // Get shortcuts from centralized hook\r\n  const { shortcuts } = useKeyboardShortcutsHelp();\r\n\r\n  const categories = Array.from(new Set(shortcuts.map((s) => s.category)));\r\n\r\n  useEffect(() => {\r\n    if (!isRecording || !recordingShortcut) return;\r\n\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      const keyString = getKeybindingString(e);\r\n      if (keyString) {\r\n        // Auto-save the new keybinding\r\n        const conflict = validateKeybinding(\r\n          keyString,\r\n          recordingShortcut.action\r\n        );\r\n        if (conflict) {\r\n          toast.error(\r\n            `Key \"${keyString}\" is already bound to \"${conflict.existingAction}\"`\r\n          );\r\n          setRecordingShortcut(null);\r\n          return;\r\n        }\r\n\r\n        // Remove old keybindings for this action\r\n        const oldKeys = getKeybindingsForAction(recordingShortcut.action);\r\n        oldKeys.forEach((key) => removeKeybinding(key));\r\n\r\n        // Add new keybinding\r\n        updateKeybinding(keyString, recordingShortcut.action);\r\n\r\n        setIsRecording(false);\r\n        setRecordingShortcut(null);\r\n      }\r\n    };\r\n\r\n    const handleClickOutside = () => {\r\n      setRecordingShortcut(null);\r\n      setIsRecording(false);\r\n    };\r\n\r\n    document.addEventListener(\"keydown\", handleKeyDown);\r\n    document.addEventListener(\"click\", handleClickOutside);\r\n\r\n    return () => {\r\n      document.removeEventListener(\"keydown\", handleKeyDown);\r\n      document.removeEventListener(\"click\", handleClickOutside);\r\n    };\r\n  }, [\r\n    recordingShortcut,\r\n    getKeybindingString,\r\n    updateKeybinding,\r\n    removeKeybinding,\r\n    validateKeybinding,\r\n    getKeybindingsForAction,\r\n    setIsRecording,\r\n    isRecording,\r\n  ]);\r\n\r\n  const handleStartRecording = (shortcut: KeyboardShortcut) => {\r\n    setRecordingShortcut(shortcut);\r\n    setIsRecording(true);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={setOpen}>\r\n      <DialogTrigger asChild>\r\n        <Button variant=\"text\" size=\"sm\" className=\"gap-2\">\r\n          <Keyboard className=\"w-4 h-4\" />\r\n          Shortcuts\r\n        </Button>\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-2xl overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <Keyboard className=\"w-5 h-5\" />\r\n            Keyboard Shortcuts\r\n          </DialogTitle>\r\n          <DialogDescription>\r\n            Speed up your video editing workflow with these keyboard shortcuts.\r\n            Click any shortcut key to edit it.\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-6\">\r\n          {categories.map((category) => (\r\n            <div key={category} className=\"flex flex-col gap-1\">\r\n              <h3 className=\"text-xs text-muted-foreground uppercase tracking-wide font-medium\">\r\n                {category}\r\n              </h3>\r\n              <div className=\"space-y-0.5\">\r\n                {shortcuts\r\n                  .filter((shortcut) => shortcut.category === category)\r\n                  .map((shortcut) => (\r\n                    <ShortcutItem\r\n                      key={shortcut.action}\r\n                      shortcut={shortcut}\r\n                      isRecording={\r\n                        shortcut.action === recordingShortcut?.action\r\n                      }\r\n                      onStartRecording={handleStartRecording}\r\n                    />\r\n                  ))}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <DialogFooter>\r\n          <Button\r\n            size=\"sm\"\r\n            className=\"mt-4\"\r\n            variant=\"destructive\"\r\n            onClick={resetToDefaults}\r\n          >\r\n            Reset to Default\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n","\"use client\";\r\n\r\nimport { Button } from \"./ui/button\";\r\nimport {\r\n  ChevronDown,\r\n  ArrowLeft,\r\n  Download,\r\n  SquarePen,\r\n  Trash,\r\n  Sun,\r\n} from \"lucide-react\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { HeaderBase } from \"./header-base\";\r\nimport { formatTimeCode } from \"@/lib/time\";\r\nimport { useProjectStore } from \"@/stores/project-store\";\r\nimport { KeyboardShortcutsHelp } from \"./keyboard-shortcuts-help\";\r\nimport { useState } from \"react\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuTrigger,\r\n} from \"./ui/dropdown-menu\";\r\nimport Link from \"next/link\";\r\nimport { navigateToProjects, navigateToHome } from \"@/lib/navigation\";\r\nimport { RenameProjectDialog } from \"./rename-project-dialog\";\r\nimport { DeleteProjectDialog } from \"./delete-project-dialog\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { FaDiscord } from \"react-icons/fa6\";\r\nimport { useTheme } from \"next-themes\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\n\r\nexport function EditorHeader() {\r\n  const { getTotalDuration } = useTimelineStore();\r\n  const { currentTime } = usePlaybackStore();\r\n  const { activeProject, renameProject, deleteProject } = useProjectStore();\r\n  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\r\n  const [isRenameDialogOpen, setIsRenameDialogOpen] = useState(false);\r\n  const router = useRouter();\r\n  const { theme, setTheme } = useTheme();\r\n\r\n  const handleExport = () => {\r\n    // TODO: Implement export functionality\r\n    // NOTE: This is already being worked on\r\n    console.log(\"Export project\");\r\n    window.open(\"https://youtube.com/watch?v=dQw4w9WgXcQ\", \"_blank\");\r\n  };\r\n\r\n  const handleNameSave = async (newName: string) => {\r\n    console.log(\"handleNameSave\", newName);\r\n    if (activeProject && newName.trim() && newName !== activeProject.name) {\r\n      try {\r\n        await renameProject(activeProject.id, newName.trim());\r\n        setIsRenameDialogOpen(false);\r\n      } catch (error) {\r\n        console.error(\"Failed to rename project:\", error);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    if (activeProject) {\r\n      deleteProject(activeProject.id);\r\n      setIsDeleteDialogOpen(false);\r\n      navigateToProjects();\r\n    }\r\n  };\r\n\r\n  const leftContent = (\r\n    <div className=\"flex items-center gap-2\">\r\n      <DropdownMenu>\r\n        <DropdownMenuTrigger asChild>\r\n          <Button\r\n            variant=\"secondary\"\r\n            className=\"h-auto py-1.5 px-2.5 flex items-center justify-center\"\r\n          >\r\n            <ChevronDown className=\"text-muted-foreground\" />\r\n            <span className=\"text-[0.85rem] mr-2\">{activeProject?.name}</span>\r\n          </Button>\r\n        </DropdownMenuTrigger>\r\n        <DropdownMenuContent align=\"start\" className=\"w-40\">\r\n          <DropdownMenuItem \r\n            className=\"flex items-center gap-1.5\"\r\n            onClick={() => navigateToProjects()}\r\n          >\r\n            <ArrowLeft className=\"h-4 w-4\" />\r\n            Projects\r\n          </DropdownMenuItem>\r\n          <DropdownMenuItem\r\n            className=\"flex items-center gap-1.5\"\r\n            onClick={() => setIsRenameDialogOpen(true)}\r\n          >\r\n            <SquarePen className=\"h-4 w-4\" />\r\n            Rename project\r\n          </DropdownMenuItem>\r\n          <DropdownMenuItem\r\n            variant=\"destructive\"\r\n            className=\"flex items-center gap-1.5\"\r\n            onClick={() => setIsDeleteDialogOpen(true)}\r\n          >\r\n            <Trash className=\"h-4 w-4\" />\r\n            Delete Project\r\n          </DropdownMenuItem>\r\n          <DropdownMenuSeparator />\r\n          <DropdownMenuItem asChild>\r\n            <Link\r\n              href=\"https://discord.gg/zmR9N35cjK\"\r\n              target=\"_blank\"\r\n              rel=\"noopener noreferrer\"\r\n              className=\"flex items-center gap-1.5\"\r\n            >\r\n              <FaDiscord className=\"h-4 w-4\" />\r\n              Discord\r\n            </Link>\r\n          </DropdownMenuItem>\r\n        </DropdownMenuContent>\r\n      </DropdownMenu>\r\n      <RenameProjectDialog\r\n        isOpen={isRenameDialogOpen}\r\n        onOpenChange={setIsRenameDialogOpen}\r\n        onConfirm={handleNameSave}\r\n        projectName={activeProject?.name || \"\"}\r\n      />\r\n      <DeleteProjectDialog\r\n        isOpen={isDeleteDialogOpen}\r\n        onOpenChange={setIsDeleteDialogOpen}\r\n        onConfirm={handleDelete}\r\n        projectName={activeProject?.name || \"\"}\r\n      />\r\n    </div>\r\n  );\r\n\r\n  const centerContent = (\r\n    <div className=\"flex items-center gap-2 text-xs\">\r\n      <span className=\"text-foreground tabular-nums\">\r\n        {formatTimeCode(currentTime, \"HH:MM:SS:FF\", activeProject?.fps || 30)}\r\n      </span>\r\n      <span className=\"text-foreground/50\">/</span>\r\n      <span className=\"text-foreground/50 tabular-nums\">\r\n        {formatTimeCode(\r\n          getTotalDuration(),\r\n          \"HH:MM:SS:FF\",\r\n          activeProject?.fps || 30\r\n        )}\r\n      </span>\r\n    </div>\r\n  );\r\n\r\n  const rightContent = (\r\n    <nav className=\"flex items-center gap-2\">\r\n      <KeyboardShortcutsHelp />\r\n      <Button\r\n        size=\"sm\"\r\n        className=\"h-8 text-xs !bg-linear-to-r from-cyan-400 to-blue-500 text-white hover:opacity-85 transition-opacity\"\r\n        onClick={handleExport}\r\n      >\r\n        <Download className=\"h-4 w-4\" />\r\n        <span className=\"text-sm pr-1\">Export</span>\r\n      </Button>\r\n      <Button\r\n        size=\"icon\"\r\n        variant=\"text\"\r\n        className=\"h-7\"\r\n        onClick={() => setTheme(theme === \"dark\" ? \"light\" : \"dark\")}\r\n      >\r\n        <Sun className=\"!size-[1.1rem]\" />\r\n        <span className=\"sr-only\">{theme === \"dark\" ? \"Light\" : \"Dark\"}</span>\r\n      </Button>\r\n    </nav>\r\n  );\r\n\r\n  return (\r\n    <HeaderBase\r\n      leftContent={leftContent}\r\n      centerContent={centerContent}\r\n      rightContent={rightContent}\r\n      className=\"bg-background h-[3.2rem] px-3 items-center mt-0.5\"\r\n    />\r\n  );\r\n}\r\n","import { MediaElement } from \"@/types/timeline\";\r\n\r\nexport function AudioProperties({ element }: { element: MediaElement }) {\r\n  return <div className=\"space-y-4 p-5\">Audio properties</div>;\r\n}\r\n","import { MediaElement } from \"@/types/timeline\";\r\n\r\nexport function MediaProperties({ element }: { element: MediaElement }) {\r\n  return <div className=\"space-y-4 p-5\">Media properties</div>;\r\n}\r\n","import * as React from \"react\";\r\n\r\nimport { cn } from \"../../lib/utils\";\r\n\r\nconst Textarea = React.forwardRef<\r\n  HTMLTextAreaElement,\r\n  React.ComponentProps<\"textarea\">\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <textarea\r\n      className={cn(\r\n        \"flex min-h-[60px] w-full rounded-md border border-input bg-background px-3 py-2 text-base shadow-xs placeholder:text-muted-foreground focus-visible:outline-hidden focus-visible:ring-0 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-xs\",\r\n        className\r\n      )}\r\n      ref={ref}\r\n      {...props}\r\n    />\r\n  );\r\n});\r\nTextarea.displayName = \"Textarea\";\r\n\r\nexport { Textarea };\r\n","export interface FontOption {\r\n  value: string;\r\n  label: string;\r\n  category: \"system\" | \"google\" | \"custom\";\r\n  weights?: number[];\r\n  hasClassName?: boolean;\r\n}\r\n\r\nexport const FONT_OPTIONS: FontOption[] = [\r\n  // System fonts (always available)\r\n  { value: \"Arial\", label: \"Arial\", category: \"system\", hasClassName: false },\r\n  {\r\n    value: \"Helvetica\",\r\n    label: \"Helvetica\",\r\n    category: \"system\",\r\n    hasClassName: false,\r\n  },\r\n  {\r\n    value: \"Times New Roman\",\r\n    label: \"Times New Roman\",\r\n    category: \"system\",\r\n    hasClassName: false,\r\n  },\r\n  {\r\n    value: \"Georgia\",\r\n    label: \"Georgia\",\r\n    category: \"system\",\r\n    hasClassName: false,\r\n  },\r\n\r\n  // Google Fonts (loaded in layout.tsx)\r\n  {\r\n    value: \"Inter\",\r\n    label: \"Inter\",\r\n    category: \"google\",\r\n    weights: [400, 700],\r\n    hasClassName: true,\r\n  },\r\n  {\r\n    value: \"Roboto\",\r\n    label: \"Roboto\",\r\n    category: \"google\",\r\n    weights: [400, 700],\r\n    hasClassName: true,\r\n  },\r\n  {\r\n    value: \"Open Sans\",\r\n    label: \"Open Sans\",\r\n    category: \"google\",\r\n    hasClassName: true,\r\n  },\r\n  {\r\n    value: \"Playfair Display\",\r\n    label: \"Playfair Display\",\r\n    category: \"google\",\r\n    hasClassName: true,\r\n  },\r\n  {\r\n    value: \"Comic Neue\",\r\n    label: \"Comic Neue\",\r\n    category: \"google\",\r\n    hasClassName: false,\r\n  },\r\n] as const;\r\n\r\nexport const DEFAULT_FONT = \"Arial\";\r\n\r\n// Type-safe font family union\r\nexport type FontFamily = (typeof FONT_OPTIONS)[number][\"value\"];\r\n\r\n// Helper functions\r\nexport const getFontByValue = (value: string): FontOption | undefined =>\r\n  FONT_OPTIONS.find((font) => font.value === value);\r\n\r\nexport const getGoogleFonts = (): FontOption[] =>\r\n  FONT_OPTIONS.filter((font) => font.category === \"google\");\r\n\r\nexport const getSystemFonts = (): FontOption[] =>\r\n  FONT_OPTIONS.filter((font) => font.category === \"system\");\r\n","import {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { FONT_OPTIONS, FontFamily } from \"@/constants/font-constants\";\r\n\r\ninterface FontPickerProps {\r\n  defaultValue?: FontFamily;\r\n  onValueChange?: (value: FontFamily) => void;\r\n  className?: string;\r\n}\r\n\r\nexport function FontPicker({\r\n  defaultValue,\r\n  onValueChange,\r\n  className,\r\n}: FontPickerProps) {\r\n  return (\r\n    <Select defaultValue={defaultValue} onValueChange={onValueChange}>\r\n      <SelectTrigger className={`w-full text-xs ${className || \"\"}`}>\r\n        <SelectValue placeholder=\"Select a font\" />\r\n      </SelectTrigger>\r\n      <SelectContent>\r\n        {FONT_OPTIONS.map((font) => (\r\n          <SelectItem\r\n            key={font.value}\r\n            value={font.value}\r\n            className=\"text-xs\"\r\n            style={{ fontFamily: font.value }}\r\n          >\r\n            {font.label}\r\n          </SelectItem>\r\n        ))}\r\n      </SelectContent>\r\n    </Select>\r\n  );\r\n}\r\n","import { Textarea } from \"@/components/ui/textarea\";\r\nimport { FontPicker } from \"@/components/ui/font-picker\";\r\nimport { FontFamily } from \"@/constants/font-constants\";\r\nimport { TextElement } from \"@/types/timeline\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { Slider } from \"@/components/ui/slider\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { useState } from \"react\";\r\nimport {\r\n  PropertyItem,\r\n  PropertyItemLabel,\r\n  PropertyItemValue,\r\n} from \"./property-item\";\r\n\r\nexport function TextProperties({\r\n  element,\r\n  trackId,\r\n}: {\r\n  element: TextElement;\r\n  trackId: string;\r\n}) {\r\n  const { updateTextElement } = useTimelineStore();\r\n\r\n  // Local state for input values to allow temporary empty/invalid states\r\n  const [fontSizeInput, setFontSizeInput] = useState(\r\n    element.fontSize.toString()\r\n  );\r\n  const [opacityInput, setOpacityInput] = useState(\r\n    Math.round(element.opacity * 100).toString()\r\n  );\r\n\r\n  const parseAndValidateNumber = (\r\n    value: string,\r\n    min: number,\r\n    max: number,\r\n    fallback: number\r\n  ): number => {\r\n    const parsed = parseInt(value, 10);\r\n    if (isNaN(parsed)) return fallback;\r\n    return Math.max(min, Math.min(max, parsed));\r\n  };\r\n\r\n  const handleFontSizeChange = (value: string) => {\r\n    setFontSizeInput(value);\r\n\r\n    if (value.trim() !== \"\") {\r\n      const fontSize = parseAndValidateNumber(value, 8, 300, element.fontSize);\r\n      updateTextElement(trackId, element.id, { fontSize });\r\n    }\r\n  };\r\n\r\n  const handleFontSizeBlur = () => {\r\n    const fontSize = parseAndValidateNumber(\r\n      fontSizeInput,\r\n      8,\r\n      300,\r\n      element.fontSize\r\n    );\r\n    setFontSizeInput(fontSize.toString());\r\n    updateTextElement(trackId, element.id, { fontSize });\r\n  };\r\n\r\n  const handleOpacityChange = (value: string) => {\r\n    setOpacityInput(value);\r\n\r\n    if (value.trim() !== \"\") {\r\n      const opacityPercent = parseAndValidateNumber(\r\n        value,\r\n        0,\r\n        100,\r\n        Math.round(element.opacity * 100)\r\n      );\r\n      updateTextElement(trackId, element.id, { opacity: opacityPercent / 100 });\r\n    }\r\n  };\r\n\r\n  const handleOpacityBlur = () => {\r\n    const opacityPercent = parseAndValidateNumber(\r\n      opacityInput,\r\n      0,\r\n      100,\r\n      Math.round(element.opacity * 100)\r\n    );\r\n    setOpacityInput(opacityPercent.toString());\r\n    updateTextElement(trackId, element.id, { opacity: opacityPercent / 100 });\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6 p-5\">\r\n      <Textarea\r\n        placeholder=\"Name\"\r\n        defaultValue={element.content}\r\n        className=\"min-h-18 resize-none bg-background/50\"\r\n        onChange={(e) =>\r\n          updateTextElement(trackId, element.id, { content: e.target.value })\r\n        }\r\n      />\r\n      <PropertyItem direction=\"row\">\r\n        <PropertyItemLabel>Font</PropertyItemLabel>\r\n        <PropertyItemValue>\r\n          <FontPicker\r\n            defaultValue={element.fontFamily}\r\n            onValueChange={(value: FontFamily) =>\r\n              updateTextElement(trackId, element.id, { fontFamily: value })\r\n            }\r\n          />\r\n        </PropertyItemValue>\r\n      </PropertyItem>\r\n      <PropertyItem direction=\"column\">\r\n        <PropertyItem direction=\"row\">\r\n          <PropertyItemLabel>Style</PropertyItemLabel>\r\n          <PropertyItemValue>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Button\r\n                variant={element.fontWeight === \"bold\" ? \"default\" : \"outline\"}\r\n                size=\"sm\"\r\n                onClick={() =>\r\n                  updateTextElement(trackId, element.id, {\r\n                    fontWeight:\r\n                      element.fontWeight === \"bold\" ? \"normal\" : \"bold\",\r\n                  })\r\n                }\r\n                className=\"h-8 px-3 font-bold\"\r\n              >\r\n                B\r\n              </Button>\r\n              <Button\r\n                variant={element.fontStyle === \"italic\" ? \"default\" : \"outline\"}\r\n                size=\"sm\"\r\n                onClick={() =>\r\n                  updateTextElement(trackId, element.id, {\r\n                    fontStyle:\r\n                      element.fontStyle === \"italic\" ? \"normal\" : \"italic\",\r\n                  })\r\n                }\r\n                className=\"h-8 px-3 italic\"\r\n              >\r\n                I\r\n              </Button>\r\n              <Button\r\n                variant={\r\n                  element.textDecoration === \"underline\" ? \"default\" : \"outline\"\r\n                }\r\n                size=\"sm\"\r\n                onClick={() =>\r\n                  updateTextElement(trackId, element.id, {\r\n                    textDecoration:\r\n                      element.textDecoration === \"underline\"\r\n                        ? \"none\"\r\n                        : \"underline\",\r\n                  })\r\n                }\r\n                className=\"h-8 px-3 underline\"\r\n              >\r\n                U\r\n              </Button>\r\n              <Button\r\n                variant={\r\n                  element.textDecoration === \"line-through\"\r\n                    ? \"default\"\r\n                    : \"outline\"\r\n                }\r\n                size=\"sm\"\r\n                onClick={() =>\r\n                  updateTextElement(trackId, element.id, {\r\n                    textDecoration:\r\n                      element.textDecoration === \"line-through\"\r\n                        ? \"none\"\r\n                        : \"line-through\",\r\n                  })\r\n                }\r\n                className=\"h-8 px-3 line-through\"\r\n              >\r\n                S\r\n              </Button>\r\n            </div>\r\n          </PropertyItemValue>\r\n        </PropertyItem>\r\n        <PropertyItemLabel>Font size</PropertyItemLabel>\r\n        <PropertyItemValue>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Slider\r\n              value={[element.fontSize]}\r\n              min={8}\r\n              max={300}\r\n              step={1}\r\n              onValueChange={([value]) => {\r\n                updateTextElement(trackId, element.id, { fontSize: value });\r\n                setFontSizeInput(value.toString());\r\n              }}\r\n              className=\"w-full\"\r\n            />\r\n            <Input\r\n              type=\"number\"\r\n              value={fontSizeInput}\r\n              min={8}\r\n              max={300}\r\n              onChange={(e) => handleFontSizeChange(e.target.value)}\r\n              onBlur={handleFontSizeBlur}\r\n              className=\"w-12 !text-xs h-7 rounded-sm text-center\r\n               [appearance:textfield]\r\n               [&::-webkit-outer-spin-button]:appearance-none\r\n               [&::-webkit-inner-spin-button]:appearance-none\"\r\n            />\r\n          </div>\r\n        </PropertyItemValue>\r\n      </PropertyItem>\r\n      <PropertyItem direction=\"row\">\r\n        <PropertyItemLabel>Color</PropertyItemLabel>\r\n        <PropertyItemValue>\r\n          <Input\r\n            type=\"color\"\r\n            value={element.color || \"#ffffff\"}\r\n            onChange={(e) => {\r\n              const color = e.target.value;\r\n              updateTextElement(trackId, element.id, { color });\r\n            }}\r\n            className=\"w-full cursor-pointer rounded-full\"\r\n          />\r\n        </PropertyItemValue>\r\n      </PropertyItem>\r\n      <PropertyItem direction=\"row\">\r\n        <PropertyItemLabel>Background</PropertyItemLabel>\r\n        <PropertyItemValue>\r\n          <Input\r\n            type=\"color\"\r\n            value={\r\n              element.backgroundColor === \"transparent\"\r\n                ? \"#000000\"\r\n                : element.backgroundColor || \"#000000\"\r\n            }\r\n            onChange={(e) => {\r\n              const backgroundColor = e.target.value;\r\n              updateTextElement(trackId, element.id, { backgroundColor });\r\n            }}\r\n            className=\"w-full cursor-pointer rounded-full\"\r\n          />\r\n        </PropertyItemValue>\r\n      </PropertyItem>\r\n      <PropertyItem direction=\"column\">\r\n        <PropertyItemLabel>Opacity</PropertyItemLabel>\r\n        <PropertyItemValue>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Slider\r\n              value={[element.opacity * 100]}\r\n              min={0}\r\n              max={100}\r\n              step={1}\r\n              onValueChange={([value]) => {\r\n                updateTextElement(trackId, element.id, {\r\n                  opacity: value / 100,\r\n                });\r\n                setOpacityInput(value.toString());\r\n              }}\r\n              className=\"w-full\"\r\n            />\r\n            <Input\r\n              type=\"number\"\r\n              value={opacityInput}\r\n              min={0}\r\n              max={100}\r\n              onChange={(e) => handleOpacityChange(e.target.value)}\r\n              onBlur={handleOpacityBlur}\r\n              className=\"w-12 !text-xs h-7 rounded-sm text-center\r\n               [appearance:textfield]\r\n               [&::-webkit-outer-spin-button]:appearance-none\r\n               [&::-webkit-inner-spin-button]:appearance-none\"\r\n            />\r\n          </div>\r\n        </PropertyItemValue>\r\n      </PropertyItem>\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { useMediaStore } from \"@/stores/media-store\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { ScrollArea } from \"../../ui/scroll-area\";\r\nimport { AudioProperties } from \"./audio-properties\";\r\nimport { MediaProperties } from \"./media-properties\";\r\nimport { TextProperties } from \"./text-properties\";\r\nimport { SquareSlashIcon } from \"lucide-react\";\r\n\r\nexport function PropertiesPanel() {\r\n  const { selectedElements, tracks } = useTimelineStore();\r\n  const { mediaItems } = useMediaStore();\r\n\r\n  return (\r\n    <>\r\n      {selectedElements.length > 0 ? (\r\n        <ScrollArea className=\"h-full bg-panel rounded-sm\">\r\n          {selectedElements.map(({ trackId, elementId }) => {\r\n            const track = tracks.find((t) => t.id === trackId);\r\n            const element = track?.elements.find((e) => e.id === elementId);\r\n\r\n            if (element?.type === \"text\") {\r\n              return (\r\n                <div key={elementId}>\r\n                  <TextProperties element={element} trackId={trackId} />\r\n                </div>\r\n              );\r\n            }\r\n            if (element?.type === \"media\") {\r\n              const mediaItem = mediaItems.find(\r\n                (item) => item.id === element.mediaId\r\n              );\r\n\r\n              if (mediaItem?.type === \"audio\") {\r\n                return <AudioProperties key={elementId} element={element} />;\r\n              }\r\n\r\n              return (\r\n                <div key={elementId}>\r\n                  <MediaProperties element={element} />\r\n                </div>\r\n              );\r\n            }\r\n            return null;\r\n          })}\r\n        </ScrollArea>\r\n      ) : (\r\n        <EmptyView />\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\nfunction EmptyView() {\r\n  return (\r\n    <div className=\"bg-panel h-full p-4 flex flex-col items-center justify-center gap-3\">\r\n      <SquareSlashIcon\r\n        className=\"w-10 h-10 text-muted-foreground\"\r\n        strokeWidth={1.5}\r\n      />\r\n      <div className=\"flex flex-col gap-2 text-center\">\r\n        <p className=\"text-lg font-medium\">It’s empty here</p>\r\n        <p className=\"text-sm text-muted-foreground text-balance\">\r\n          Click an element on the timeline to edit its properties\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { cn } from \"@/lib/utils\";\r\nimport { ChevronDown } from \"lucide-react\";\r\nimport { useState } from \"react\";\r\n\r\ninterface PropertyItemProps {\r\n  direction?: \"row\" | \"column\";\r\n  children: React.ReactNode;\r\n  className?: string;\r\n}\r\n\r\nexport function PropertyItem({\r\n  direction = \"row\",\r\n  children,\r\n  className,\r\n}: PropertyItemProps) {\r\n  return (\r\n    <div\r\n      className={cn(\r\n        \"flex gap-2\",\r\n        direction === \"row\"\r\n          ? \"items-center justify-between gap-6\"\r\n          : \"flex-col gap-1.5\",\r\n        className\r\n      )}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function PropertyItemLabel({\r\n  children,\r\n  className,\r\n}: {\r\n  children: React.ReactNode;\r\n  className?: string;\r\n}) {\r\n  return (\r\n    <label className={cn(\"text-xs text-muted-foreground\", className)}>\r\n      {children}\r\n    </label>\r\n  );\r\n}\r\n\r\nexport function PropertyItemValue({\r\n  children,\r\n  className,\r\n}: {\r\n  children: React.ReactNode;\r\n  className?: string;\r\n}) {\r\n  return <div className={cn(\"flex-1 text-sm\", className)}>{children}</div>;\r\n}\r\n\r\ninterface PropertyGroupProps {\r\n  title: string;\r\n  children: React.ReactNode;\r\n  defaultExpanded?: boolean;\r\n  className?: string;\r\n}\r\n\r\nexport function PropertyGroup({\r\n  title,\r\n  children,\r\n  defaultExpanded = true,\r\n  className,\r\n}: PropertyGroupProps) {\r\n  const [isExpanded, setIsExpanded] = useState(defaultExpanded);\r\n\r\n  return (\r\n    <PropertyItem direction=\"column\" className={cn(\"gap-3\", className)}>\r\n      <div\r\n        className=\"flex items-center gap-1.5 cursor-pointer\"\r\n        onClick={() => setIsExpanded(!isExpanded)}\r\n      >\r\n        <PropertyItemLabel className=\"cursor-pointer\">\r\n          {title}\r\n        </PropertyItemLabel>\r\n        <ChevronDown className={cn(\"size-3\", !isExpanded && \"-rotate-90\")} />\r\n      </div>\r\n      {isExpanded && <PropertyItemValue>{children}</PropertyItemValue>}\r\n    </PropertyItem>\r\n  );\r\n}\r\n","import { FFmpeg } from \"@ffmpeg/ffmpeg\";\r\nimport { toBlobURL } from \"@ffmpeg/util\";\r\nimport { basePath } from \"./base-path\";\r\n\r\nlet ffmpeg: FFmpeg | null = null;\r\n\r\nexport const initFFmpeg = async (): Promise<FFmpeg> => {\r\n  if (ffmpeg) return ffmpeg;\r\n\r\n  ffmpeg = new FFmpeg();\r\n\r\n  // Use locally hosted files instead of CDN\r\n  const baseURL = `${basePath}/ffmpeg`;\r\n\r\n  await ffmpeg.load({\r\n    coreURL: await toBlobURL(`${baseURL}/ffmpeg-core.js`, \"text/javascript\"),\r\n    wasmURL: await toBlobURL(`${baseURL}/ffmpeg-core.wasm`, \"application/wasm\"),\r\n  });\r\n\r\n  return ffmpeg;\r\n};\r\n\r\nexport const generateThumbnail = async (\r\n  videoFile: File,\r\n  timeInSeconds = 1\r\n): Promise<string> => {\r\n  const ffmpeg = await initFFmpeg();\r\n\r\n  const inputName = \"input.mp4\";\r\n  const outputName = \"thumbnail.jpg\";\r\n\r\n  // Write input file\r\n  await ffmpeg.writeFile(\r\n    inputName,\r\n    new Uint8Array(await videoFile.arrayBuffer())\r\n  );\r\n\r\n  // Generate thumbnail at specific time\r\n  await ffmpeg.exec([\r\n    \"-i\",\r\n    inputName,\r\n    \"-ss\",\r\n    timeInSeconds.toString(),\r\n    \"-vframes\",\r\n    \"1\",\r\n    \"-vf\",\r\n    \"scale=320:240\",\r\n    \"-q:v\",\r\n    \"2\",\r\n    outputName,\r\n  ]);\r\n\r\n  // Read output file\r\n  const data = await ffmpeg.readFile(outputName);\r\n  const blob = new Blob([data], { type: \"image/jpeg\" });\r\n\r\n  // Cleanup\r\n  await ffmpeg.deleteFile(inputName);\r\n  await ffmpeg.deleteFile(outputName);\r\n\r\n  return URL.createObjectURL(blob);\r\n};\r\n\r\nexport const trimVideo = async (\r\n  videoFile: File,\r\n  startTime: number,\r\n  endTime: number,\r\n  onProgress?: (progress: number) => void\r\n): Promise<Blob> => {\r\n  const ffmpeg = await initFFmpeg();\r\n\r\n  const inputName = \"input.mp4\";\r\n  const outputName = \"output.mp4\";\r\n\r\n  // Set up progress callback\r\n  if (onProgress) {\r\n    ffmpeg.on(\"progress\", ({ progress }) => {\r\n      onProgress(progress * 100);\r\n    });\r\n  }\r\n\r\n  // Write input file\r\n  await ffmpeg.writeFile(\r\n    inputName,\r\n    new Uint8Array(await videoFile.arrayBuffer())\r\n  );\r\n\r\n  const duration = endTime - startTime;\r\n\r\n  // Trim video\r\n  await ffmpeg.exec([\r\n    \"-i\",\r\n    inputName,\r\n    \"-ss\",\r\n    startTime.toString(),\r\n    \"-t\",\r\n    duration.toString(),\r\n    \"-c\",\r\n    \"copy\", // Use stream copy for faster processing\r\n    outputName,\r\n  ]);\r\n\r\n  // Read output file\r\n  const data = await ffmpeg.readFile(outputName);\r\n  const blob = new Blob([data], { type: \"video/mp4\" });\r\n\r\n  // Cleanup\r\n  await ffmpeg.deleteFile(inputName);\r\n  await ffmpeg.deleteFile(outputName);\r\n\r\n  return blob;\r\n};\r\n\r\nexport const getVideoInfo = async (\r\n  videoFile: File\r\n): Promise<{\r\n  duration: number;\r\n  width: number;\r\n  height: number;\r\n  fps: number;\r\n}> => {\r\n  const ffmpeg = await initFFmpeg();\r\n\r\n  const inputName = \"input.mp4\";\r\n\r\n  // Write input file\r\n  await ffmpeg.writeFile(\r\n    inputName,\r\n    new Uint8Array(await videoFile.arrayBuffer())\r\n  );\r\n\r\n  // Capture FFmpeg stderr output with a one-time listener pattern\r\n  let ffmpegOutput = \"\";\r\n  let listening = true;\r\n  const listener = (data: string) => {\r\n    if (listening) ffmpegOutput += data;\r\n  };\r\n  ffmpeg.on(\"log\", ({ message }) => listener(message));\r\n\r\n  // Run ffmpeg to get info (stderr will contain the info)\r\n  try {\r\n    await ffmpeg.exec([\"-i\", inputName, \"-f\", \"null\", \"-\"]);\r\n  } catch (error) {\r\n    listening = false;\r\n    await ffmpeg.deleteFile(inputName);\r\n    console.error(\"FFmpeg execution failed:\", error);\r\n    throw new Error(\r\n      \"Failed to extract video info. The file may be corrupted or in an unsupported format.\"\r\n    );\r\n  }\r\n\r\n  // Disable listener after exec completes\r\n  listening = false;\r\n\r\n  // Cleanup\r\n  await ffmpeg.deleteFile(inputName);\r\n\r\n  // Parse output for duration, resolution, and fps\r\n  // Example: Duration: 00:00:10.00, start: 0.000000, bitrate: 1234 kb/s\r\n  // Example: Stream #0:0: Video: h264 (High), yuv420p(progressive), 1920x1080 [SAR 1:1 DAR 16:9], 30 fps, 30 tbr, 90k tbn, 60 tbc\r\n\r\n  const durationMatch = ffmpegOutput.match(/Duration: (\\d+):(\\d+):([\\d.]+)/);\r\n  let duration = 0;\r\n  if (durationMatch) {\r\n    const [, h, m, s] = durationMatch;\r\n    duration = parseInt(h) * 3600 + parseInt(m) * 60 + parseFloat(s);\r\n  }\r\n\r\n  const videoStreamMatch = ffmpegOutput.match(\r\n    /Video:.* (\\d+)x(\\d+)[^,]*, ([\\d.]+) fps/\r\n  );\r\n  let width = 0,\r\n    height = 0,\r\n    fps = 0;\r\n  if (videoStreamMatch) {\r\n    width = parseInt(videoStreamMatch[1]);\r\n    height = parseInt(videoStreamMatch[2]);\r\n    fps = parseFloat(videoStreamMatch[3]);\r\n  }\r\n\r\n  return {\r\n    duration,\r\n    width,\r\n    height,\r\n    fps,\r\n  };\r\n};\r\n\r\nexport const convertToWebM = async (\r\n  videoFile: File,\r\n  onProgress?: (progress: number) => void\r\n): Promise<Blob> => {\r\n  const ffmpeg = await initFFmpeg();\r\n\r\n  const inputName = \"input.mp4\";\r\n  const outputName = \"output.webm\";\r\n\r\n  // Set up progress callback\r\n  if (onProgress) {\r\n    ffmpeg.on(\"progress\", ({ progress }) => {\r\n      onProgress(progress * 100);\r\n    });\r\n  }\r\n\r\n  // Write input file\r\n  await ffmpeg.writeFile(\r\n    inputName,\r\n    new Uint8Array(await videoFile.arrayBuffer())\r\n  );\r\n\r\n  // Convert to WebM\r\n  await ffmpeg.exec([\r\n    \"-i\",\r\n    inputName,\r\n    \"-c:v\",\r\n    \"libvpx-vp9\",\r\n    \"-crf\",\r\n    \"30\",\r\n    \"-b:v\",\r\n    \"0\",\r\n    \"-c:a\",\r\n    \"libopus\",\r\n    outputName,\r\n  ]);\r\n\r\n  // Read output file\r\n  const data = await ffmpeg.readFile(outputName);\r\n  const blob = new Blob([data], { type: \"video/webm\" });\r\n\r\n  // Cleanup\r\n  await ffmpeg.deleteFile(inputName);\r\n  await ffmpeg.deleteFile(outputName);\r\n\r\n  return blob;\r\n};\r\n\r\nexport const extractAudio = async (\r\n  videoFile: File,\r\n  format: \"mp3\" | \"wav\" = \"mp3\"\r\n): Promise<Blob> => {\r\n  const ffmpeg = await initFFmpeg();\r\n\r\n  const inputName = \"input.mp4\";\r\n  const outputName = `output.${format}`;\r\n\r\n  // Write input file\r\n  await ffmpeg.writeFile(\r\n    inputName,\r\n    new Uint8Array(await videoFile.arrayBuffer())\r\n  );\r\n\r\n  // Extract audio\r\n  await ffmpeg.exec([\r\n    \"-i\",\r\n    inputName,\r\n    \"-vn\", // Disable video\r\n    \"-acodec\",\r\n    format === \"mp3\" ? \"libmp3lame\" : \"pcm_s16le\",\r\n    outputName,\r\n  ]);\r\n\r\n  // Read output file\r\n  const data = await ffmpeg.readFile(outputName);\r\n  const blob = new Blob([data], { type: `audio/${format}` });\r\n\r\n  // Cleanup\r\n  await ffmpeg.deleteFile(inputName);\r\n  await ffmpeg.deleteFile(outputName);\r\n\r\n  return blob;\r\n};\r\n","import { toast } from \"sonner\";\r\nimport {\r\n  getFileType,\r\n  generateVideoThumbnail,\r\n  getMediaDuration,\r\n  getImageDimensions,\r\n  type MediaItem,\r\n} from \"@/stores/media-store\";\r\nimport { generateThumbnail, getVideoInfo } from \"./ffmpeg-utils\";\r\n\r\nexport interface ProcessedMediaItem extends Omit<MediaItem, \"id\"> {}\r\n\r\nexport async function processMediaFiles(\r\n  files: FileList | File[],\r\n  onProgress?: (progress: number) => void\r\n): Promise<ProcessedMediaItem[]> {\r\n  const fileArray = Array.from(files);\r\n  const processedItems: ProcessedMediaItem[] = [];\r\n\r\n  const total = fileArray.length;\r\n  let completed = 0;\r\n\r\n  for (const file of fileArray) {\r\n    const fileType = getFileType(file);\r\n\r\n    if (!fileType) {\r\n      toast.error(`Unsupported file type: ${file.name}`);\r\n      continue;\r\n    }\r\n\r\n    const url = URL.createObjectURL(file);\r\n    let thumbnailUrl: string | undefined;\r\n    let duration: number | undefined;\r\n    let width: number | undefined;\r\n    let height: number | undefined;\r\n    let fps: number | undefined;\r\n\r\n    try {\r\n      if (fileType === \"image\") {\r\n        // Get image dimensions\r\n        const dimensions = await getImageDimensions(file);\r\n        width = dimensions.width;\r\n        height = dimensions.height;\r\n      } else if (fileType === \"video\") {\r\n        try {\r\n          // Use FFmpeg for comprehensive video info extraction\r\n          const videoInfo = await getVideoInfo(file);\r\n          duration = videoInfo.duration;\r\n          width = videoInfo.width;\r\n          height = videoInfo.height;\r\n          fps = videoInfo.fps;\r\n\r\n          // Generate thumbnail using FFmpeg\r\n          thumbnailUrl = await generateThumbnail(file, 1);\r\n        } catch (error) {\r\n          console.warn(\r\n            \"FFmpeg processing failed, falling back to basic processing:\",\r\n            error\r\n          );\r\n          // Fallback to basic processing\r\n          const videoResult = await generateVideoThumbnail(file);\r\n          thumbnailUrl = videoResult.thumbnailUrl;\r\n          width = videoResult.width;\r\n          height = videoResult.height;\r\n          duration = await getMediaDuration(file);\r\n          // FPS will remain undefined for fallback\r\n        }\r\n      } else if (fileType === \"audio\") {\r\n        // For audio, we don't set width/height/fps (they'll be undefined)\r\n        duration = await getMediaDuration(file);\r\n      }\r\n\r\n      processedItems.push({\r\n        name: file.name,\r\n        type: fileType,\r\n        file,\r\n        url,\r\n        thumbnailUrl,\r\n        duration,\r\n        width,\r\n        height,\r\n        fps,\r\n      });\r\n\r\n      // Yield back to the event loop to keep the UI responsive\r\n      await new Promise((resolve) => setTimeout(resolve, 0));\r\n\r\n      completed += 1;\r\n      if (onProgress) {\r\n        const percent = Math.round((completed / total) * 100);\r\n        onProgress(percent);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error processing file:\", file.name, error);\r\n      toast.error(`Failed to process ${file.name}`);\r\n      URL.revokeObjectURL(url); // Clean up on error\r\n    }\r\n  }\r\n\r\n  return processedItems;\r\n}\r\n","\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { Tooltip as TooltipPrimitive } from \"radix-ui\";\r\n\r\nimport { cn } from \"../../lib/utils\";\r\n\r\nconst TooltipProvider = TooltipPrimitive.Provider;\r\n\r\nconst Tooltip = TooltipPrimitive.Root;\r\n\r\nconst TooltipTrigger = TooltipPrimitive.Trigger;\r\n\r\nconst TooltipContent = React.forwardRef<\r\n  React.ElementRef<typeof TooltipPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\r\n>(({ className, sideOffset = 4, ...props }, ref) => (\r\n  <TooltipPrimitive.Portal>\r\n    <TooltipPrimitive.Content\r\n      ref={ref}\r\n      sideOffset={sideOffset}\r\n      className={cn(\r\n        \"z-50 overflow-hidden rounded-md bg-foreground px-3 py-1.5 text-xs text-background animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  </TooltipPrimitive.Portal>\r\n));\r\nTooltipContent.displayName = TooltipPrimitive.Content.displayName;\r\n\r\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider };\r\n","\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nconst Separator = React.forwardRef<\r\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\r\n>(\r\n  (\r\n    { className, orientation = \"horizontal\", decorative = true, ...props },\r\n    ref\r\n  ) => (\r\n    <SeparatorPrimitive.Root\r\n      ref={ref}\r\n      decorative={decorative}\r\n      orientation={orientation}\r\n      className={cn(\r\n        \"shrink-0 bg-border\",\r\n        orientation === \"horizontal\" ? \"h-px w-full\" : \"h-full w-px\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n);\r\nSeparator.displayName = SeparatorPrimitive.Root.displayName;\r\n\r\nexport { Separator };\r\n","\"use client\";\r\n\r\nimport * as ResizablePrimitive from \"react-resizable-panels\";\r\n\r\nimport { cn } from \"../../lib/utils\";\r\n\r\nconst ResizablePanelGroup = ({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\r\n  <ResizablePrimitive.PanelGroup\r\n    className={cn(\r\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n);\r\n\r\nconst ResizablePanel = ResizablePrimitive.Panel;\r\n\r\nconst ResizableHandle = ({\r\n  withHandle,\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\r\n  withHandle?: boolean;\r\n}) => (\r\n  <ResizablePrimitive.PanelResizeHandle\r\n    className={cn(\r\n      \"relative flex w-px items-center justify-center bg-transparent after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-hidden focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n);\r\n\r\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle };\r\n","import { create } from \"zustand\";\r\nimport type { PlaybackState, PlaybackControls } from \"@/types/playback\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { useProjectStore } from \"./project-store\";\r\n\r\ninterface PlaybackStore extends PlaybackState, PlaybackControls {\r\n  setDuration: (duration: number) => void;\r\n  setCurrentTime: (time: number) => void;\r\n}\r\n\r\nlet playbackTimer: number | null = null;\r\n\r\nconst startTimer = (store: () => PlaybackStore) => {\r\n  if (playbackTimer) cancelAnimationFrame(playbackTimer);\r\n\r\n  // Use requestAnimationFrame for smoother updates\r\n  const updateTime = () => {\r\n    const state = store();\r\n    if (state.isPlaying && state.currentTime < state.duration) {\r\n      const now = performance.now();\r\n      const delta = (now - lastUpdate) / 1000; // Convert to seconds\r\n      lastUpdate = now;\r\n\r\n      const newTime = state.currentTime + delta * state.speed;\r\n\r\n      // Get actual content duration from timeline store\r\n      const actualContentDuration = useTimelineStore\r\n        .getState()\r\n        .getTotalDuration();\r\n\r\n      // Stop at actual content end, not timeline duration (which has 10s minimum)\r\n      // It was either this or reducing default min timeline to 1 second\r\n      const effectiveDuration =\r\n        actualContentDuration > 0 ? actualContentDuration : state.duration;\r\n\r\n      if (newTime >= effectiveDuration) {\r\n        // When content completes, pause just before the end so we can see the last frame\r\n        const projectFps = useProjectStore.getState().activeProject?.fps;\r\n        if (!projectFps)\r\n          console.error(\"Project FPS is not set, assuming 30fps\");\r\n\r\n        const frameOffset = 1 / (projectFps ?? 30); // Stop 1 frame before end based on project FPS\r\n        const stopTime = Math.max(0, effectiveDuration - frameOffset);\r\n\r\n        state.pause();\r\n        state.setCurrentTime(stopTime);\r\n        // Notify video elements to sync with end position\r\n        window.dispatchEvent(\r\n          new CustomEvent(\"playback-seek\", {\r\n            detail: { time: stopTime },\r\n          })\r\n        );\r\n      } else {\r\n        state.setCurrentTime(newTime);\r\n        // Notify video elements to sync\r\n        window.dispatchEvent(\r\n          new CustomEvent(\"playback-update\", { detail: { time: newTime } })\r\n        );\r\n      }\r\n    }\r\n    playbackTimer = requestAnimationFrame(updateTime);\r\n  };\r\n\r\n  let lastUpdate = performance.now();\r\n  playbackTimer = requestAnimationFrame(updateTime);\r\n};\r\n\r\nconst stopTimer = () => {\r\n  if (playbackTimer) {\r\n    cancelAnimationFrame(playbackTimer);\r\n    playbackTimer = null;\r\n  }\r\n};\r\n\r\nexport const usePlaybackStore = create<PlaybackStore>((set, get) => ({\r\n  isPlaying: false,\r\n  currentTime: 0,\r\n  duration: 0,\r\n  volume: 1,\r\n  muted: false,\r\n  previousVolume: 1,\r\n  speed: 1.0,\r\n\r\n  play: () => {\r\n    set({ isPlaying: true });\r\n    startTimer(get);\r\n  },\r\n\r\n  pause: () => {\r\n    set({ isPlaying: false });\r\n    stopTimer();\r\n  },\r\n\r\n  toggle: () => {\r\n    const { isPlaying } = get();\r\n    if (isPlaying) {\r\n      get().pause();\r\n    } else {\r\n      get().play();\r\n    }\r\n  },\r\n\r\n  seek: (time: number) => {\r\n    const { duration } = get();\r\n    const clampedTime = Math.max(0, Math.min(duration, time));\r\n    set({ currentTime: clampedTime });\r\n\r\n    const event = new CustomEvent(\"playback-seek\", {\r\n      detail: { time: clampedTime },\r\n    });\r\n    window.dispatchEvent(event);\r\n  },\r\n\r\n  setVolume: (volume: number) =>\r\n    set((state) => ({\r\n      volume: Math.max(0, Math.min(1, volume)),\r\n      muted: volume === 0,\r\n      previousVolume: volume > 0 ? volume : state.previousVolume,\r\n    })),\r\n\r\n  setSpeed: (speed: number) => {\r\n    const newSpeed = Math.max(0.1, Math.min(2.0, speed));\r\n    set({ speed: newSpeed });\r\n\r\n    const event = new CustomEvent(\"playback-speed\", {\r\n      detail: { speed: newSpeed },\r\n    });\r\n    window.dispatchEvent(event);\r\n  },\r\n\r\n  setDuration: (duration: number) => set({ duration }),\r\n  setCurrentTime: (time: number) => set({ currentTime: time }),\r\n\r\n  mute: () => {\r\n    const { volume, previousVolume } = get();\r\n    set({\r\n      muted: true,\r\n      previousVolume: volume > 0 ? volume : previousVolume,\r\n      volume: 0,\r\n    });\r\n  },\r\n\r\n  unmute: () => {\r\n    const { previousVolume } = get();\r\n    set({ muted: false, volume: previousVolume ?? 1 });\r\n  },\r\n\r\n  toggleMute: () => {\r\n    const { muted } = get();\r\n    if (muted) {\r\n      get().unmute();\r\n    } else {\r\n      get().mute();\r\n    }\r\n  },\r\n}));\r\n","import {\r\n  CaptionsIcon,\r\n  ArrowLeftRightIcon,\r\n  SparklesIcon,\r\n  StickerIcon,\r\n  MusicIcon,\r\n  VideoIcon,\r\n  BlendIcon,\r\n  SlidersHorizontalIcon,\r\n  LucideIcon,\r\n  TypeIcon,\r\n  SettingsIcon,\r\n} from \"lucide-react\";\r\nimport { create } from \"zustand\";\r\n\r\nexport type Tab =\r\n  | \"media\"\r\n  | \"sounds\"\r\n  | \"text\"\r\n  | \"stickers\"\r\n  | \"effects\"\r\n  | \"transitions\"\r\n  | \"captions\"\r\n  | \"filters\"\r\n  | \"adjustment\"\r\n  | \"settings\";\r\n\r\nexport const tabs: { [key in Tab]: { icon: LucideIcon; label: string } } = {\r\n  media: {\r\n    icon: VideoIcon,\r\n    label: \"Media\",\r\n  },\r\n  sounds: {\r\n    icon: MusicIcon,\r\n    label: \"Sounds\",\r\n  },\r\n  text: {\r\n    icon: TypeIcon,\r\n    label: \"Text\",\r\n  },\r\n  stickers: {\r\n    icon: StickerIcon,\r\n    label: \"Stickers\",\r\n  },\r\n  effects: {\r\n    icon: SparklesIcon,\r\n    label: \"Effects\",\r\n  },\r\n  transitions: {\r\n    icon: ArrowLeftRightIcon,\r\n    label: \"Transitions\",\r\n  },\r\n  captions: {\r\n    icon: CaptionsIcon,\r\n    label: \"Captions\",\r\n  },\r\n  filters: {\r\n    icon: BlendIcon,\r\n    label: \"Filters\",\r\n  },\r\n  adjustment: {\r\n    icon: SlidersHorizontalIcon,\r\n    label: \"Adjustment\",\r\n  },\r\n  settings: {\r\n    icon: SettingsIcon,\r\n    label: \"Settings\",\r\n  },\r\n};\r\n\r\ninterface MediaPanelStore {\r\n  activeTab: Tab;\r\n  setActiveTab: (tab: Tab) => void;\r\n}\r\n\r\nexport const useMediaPanelStore = create<MediaPanelStore>((set) => ({\r\n  activeTab: \"media\",\r\n  setActiveTab: (tab) => set({ activeTab: tab }),\r\n}));\r\n","\"use client\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Tab, tabs, useMediaPanelStore } from \"./store\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { ChevronRight, ChevronLeft } from \"lucide-react\";\r\nimport { useRef, useState, useEffect } from \"react\";\r\n\r\nexport function TabBar() {\r\n  const { activeTab, setActiveTab } = useMediaPanelStore();\r\n  const scrollContainerRef = useRef<HTMLDivElement>(null);\r\n  const [isAtEnd, setIsAtEnd] = useState(false);\r\n  const [isAtStart, setIsAtStart] = useState(true);\r\n\r\n  const scrollToEnd = () => {\r\n    if (scrollContainerRef.current) {\r\n      scrollContainerRef.current.scrollTo({\r\n        left: scrollContainerRef.current.scrollWidth,\r\n      });\r\n      setIsAtEnd(true);\r\n      setIsAtStart(false);\r\n    }\r\n  };\r\n\r\n  const scrollToStart = () => {\r\n    if (scrollContainerRef.current) {\r\n      scrollContainerRef.current.scrollTo({\r\n        left: 0,\r\n      });\r\n      setIsAtStart(true);\r\n      setIsAtEnd(false);\r\n    }\r\n  };\r\n\r\n  const checkScrollPosition = () => {\r\n    if (scrollContainerRef.current) {\r\n      const { scrollLeft, scrollWidth, clientWidth } =\r\n        scrollContainerRef.current;\r\n      const isAtEndNow = scrollLeft + clientWidth >= scrollWidth - 1;\r\n      const isAtStartNow = scrollLeft <= 1;\r\n      setIsAtEnd(isAtEndNow);\r\n      setIsAtStart(isAtStartNow);\r\n    }\r\n  };\r\n\r\n  // We're using useEffect because we need to sync with external DOM scroll events\r\n  useEffect(() => {\r\n    const container = scrollContainerRef.current;\r\n    if (!container) return;\r\n\r\n    checkScrollPosition();\r\n    container.addEventListener(\"scroll\", checkScrollPosition);\r\n\r\n    const resizeObserver = new ResizeObserver(checkScrollPosition);\r\n    resizeObserver.observe(container);\r\n\r\n    return () => {\r\n      container.removeEventListener(\"scroll\", checkScrollPosition);\r\n      resizeObserver.disconnect();\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"flex\">\r\n      <ScrollButton\r\n        direction=\"left\"\r\n        onClick={scrollToStart}\r\n        isVisible={!isAtStart}\r\n      />\r\n      <div\r\n        ref={scrollContainerRef}\r\n        className=\"h-full px-4 flex flex-col justify-start items-center gap-5 overflow-x-auto scrollbar-x-hidden relative w-full py-4\"\r\n      >\r\n        {(Object.keys(tabs) as Tab[]).map((tabKey) => {\r\n          const tab = tabs[tabKey];\r\n          return (\r\n            <div\r\n              className={cn(\r\n                \"flex flex-col gap-0.5 items-center cursor-pointer opacity-100 hover:opacity-75\",\r\n                activeTab === tabKey ? \"text-primary !opacity-100\" : \"text-muted-foreground\"\r\n              )}\r\n              onClick={() => setActiveTab(tabKey)}\r\n              key={tabKey}\r\n            >\r\n              <tab.icon className=\"size-[1.1rem]!\" />\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n      <ScrollButton\r\n        direction=\"right\"\r\n        onClick={scrollToEnd}\r\n        isVisible={!isAtEnd}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ScrollButton({\r\n  direction,\r\n  onClick,\r\n  isVisible,\r\n}: {\r\n  direction: \"left\" | \"right\";\r\n  onClick: () => void;\r\n  isVisible: boolean;\r\n}) {\r\n  if (!isVisible) return null;\r\n\r\n  const Icon = direction === \"left\" ? ChevronLeft : ChevronRight;\r\n\r\n  return (\r\n    <div className=\"bg-panel-accent w-12 h-full flex items-center justify-center\">\r\n      <Button\r\n        size=\"icon\"\r\n        className=\"rounded-[0.4rem] w-4 h-7 bg-foreground/10!\"\r\n        onClick={onClick}\r\n      >\r\n        <Icon className=\"size-4! text-foreground\" />\r\n      </Button>\r\n    </div>\r\n  );\r\n}\r\n","import { useState, useRef } from \"react\";\r\n\r\ninterface UseDragDropOptions {\r\n  onDrop?: (files: FileList) => void;\r\n}\r\n\r\n// Helper function to check if drag contains files from external sources (not internal app drags)\r\nconst containsFiles = (dataTransfer: DataTransfer): boolean => {\r\n  // Check if this is an internal app drag (media item)\r\n  if (dataTransfer.types.includes(\"application/x-media-item\")) {\r\n    return false;\r\n  }\r\n\r\n  // Only show overlay for external file drags\r\n  return dataTransfer.types.includes(\"Files\");\r\n};\r\n\r\nexport function useDragDrop(options: UseDragDropOptions = {}) {\r\n  const [isDragOver, setIsDragOver] = useState(false);\r\n  const dragCounterRef = useRef(0);\r\n\r\n  const handleDragEnter = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n\r\n    // Only handle external file drags, not internal app element drags\r\n    if (!containsFiles(e.dataTransfer)) {\r\n      return;\r\n    }\r\n\r\n    dragCounterRef.current += 1;\r\n    if (!isDragOver) {\r\n      setIsDragOver(true);\r\n    }\r\n  };\r\n\r\n  const handleDragOver = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n\r\n    // Only handle file drags\r\n    if (!containsFiles(e.dataTransfer)) {\r\n      return;\r\n    }\r\n  };\r\n\r\n  const handleDragLeave = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n\r\n    // Only handle file drags\r\n    if (!containsFiles(e.dataTransfer)) {\r\n      return;\r\n    }\r\n\r\n    dragCounterRef.current -= 1;\r\n    if (dragCounterRef.current === 0) {\r\n      setIsDragOver(false);\r\n    }\r\n  };\r\n\r\n  const handleDrop = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragOver(false);\r\n    dragCounterRef.current = 0;\r\n\r\n    // Only handle file drops\r\n    if (\r\n      options.onDrop &&\r\n      e.dataTransfer.files &&\r\n      containsFiles(e.dataTransfer)\r\n    ) {\r\n      options.onDrop(e.dataTransfer.files);\r\n    }\r\n  };\r\n\r\n  const dragProps = {\r\n    onDragEnter: handleDragEnter,\r\n    onDragOver: handleDragOver,\r\n    onDragLeave: handleDragLeave,\r\n    onDrop: handleDrop,\r\n  };\r\n\r\n  return {\r\n    isDragOver,\r\n    dragProps,\r\n  };\r\n}\r\n","import { Upload, Plus, Image } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\ninterface MediaDragOverlayProps {\r\n  isVisible: boolean;\r\n  isProcessing?: boolean;\r\n  progress?: number;\r\n  onClick?: () => void;\r\n  isEmptyState?: boolean;\r\n}\r\n\r\nexport function MediaDragOverlay({\r\n  isVisible,\r\n  isProcessing = false,\r\n  progress = 0,\r\n  onClick,\r\n  isEmptyState = false,\r\n}: MediaDragOverlayProps) {\r\n  if (!isVisible) return null;\r\n\r\n  const handleClick = (e: React.MouseEvent) => {\r\n    if (isProcessing || !onClick) return;\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    onClick();\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className=\"flex flex-col items-center justify-center gap-4 h-full text-center rounded-lg bg-foreground/5 hover:bg-foreground/10 transition-all duration-200 p-8\"\r\n      onClick={handleClick}\r\n    >\r\n      <div className=\"flex items-center justify-center\">\r\n        <Upload className=\"h-10 w-10 text-foreground\" />\r\n      </div>\r\n\r\n      <div className=\"space-y-2\">\r\n        <p className=\"text-xs text-muted-foreground max-w-sm\">\r\n          {isProcessing\r\n            ? `Processing your files (${progress}%)`\r\n            : \"Drag and drop videos, photos, and audio files here\"}\r\n        </p>\r\n      </div>\r\n\r\n      {isProcessing && (\r\n        <div className=\"w-full max-w-xs\">\r\n          <div className=\"w-full bg-muted/50 rounded-full h-2\">\r\n            <div\r\n              className=\"bg-primary h-2 rounded-full transition-all duration-300\"\r\n              style={{ width: `${progress}%` }}\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { AspectRatio as AspectRatioPrimitive } from \"radix-ui\";\r\n\r\nconst AspectRatio = AspectRatioPrimitive.Root;\r\n\r\nexport { AspectRatio };\r\n","\"use client\";\r\n\r\nimport { AspectRatio } from \"@/components/ui/aspect-ratio\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  Tooltip,\r\n  TooltipContent,\r\n  TooltipTrigger,\r\n} from \"@/components/ui/tooltip\";\r\nimport { ReactNode, useState, useRef, useEffect } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { Plus } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\n\r\nexport interface DraggableMediaItemProps {\r\n  name: string;\r\n  preview: ReactNode;\r\n  dragData: Record<string, any>;\r\n  onDragStart?: (e: React.DragEvent) => void;\r\n  onAddToTimeline?: (currentTime: number) => void;\r\n  aspectRatio?: number;\r\n  className?: string;\r\n  showPlusOnDrag?: boolean;\r\n  showLabel?: boolean;\r\n  rounded?: boolean;\r\n  variant?: \"card\" | \"compact\";\r\n}\r\n\r\nexport function DraggableMediaItem({\r\n  name,\r\n  preview,\r\n  dragData,\r\n  onDragStart,\r\n  onAddToTimeline,\r\n  aspectRatio = 16 / 9,\r\n  className = \"\",\r\n  showPlusOnDrag = true,\r\n  showLabel = true,\r\n  rounded = true,\r\n  variant = \"card\",\r\n}: DraggableMediaItemProps) {\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  const [dragPosition, setDragPosition] = useState({ x: 0, y: 0 });\r\n  const dragRef = useRef<HTMLDivElement>(null);\r\n  const currentTime = usePlaybackStore((state) => state.currentTime);\r\n\r\n  const handleAddToTimeline = () => {\r\n    onAddToTimeline?.(currentTime);\r\n  };\r\n\r\n  const emptyImg = new window.Image();\r\n  emptyImg.src =\r\n    \"data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=\";\r\n\r\n  useEffect(() => {\r\n    if (!isDragging) return;\r\n\r\n    const handleDragOver = (e: DragEvent) => {\r\n      setDragPosition({ x: e.clientX, y: e.clientY });\r\n    };\r\n\r\n    document.addEventListener(\"dragover\", handleDragOver);\r\n\r\n    return () => {\r\n      document.removeEventListener(\"dragover\", handleDragOver);\r\n    };\r\n  }, [isDragging]);\r\n\r\n  const handleDragStart = (e: React.DragEvent) => {\r\n    e.dataTransfer.setDragImage(emptyImg, 0, 0);\r\n\r\n    // Set drag data\r\n    e.dataTransfer.setData(\r\n      \"application/x-media-item\",\r\n      JSON.stringify(dragData)\r\n    );\r\n    e.dataTransfer.effectAllowed = \"copy\";\r\n\r\n    // Set initial position and show custom drag preview\r\n    setDragPosition({ x: e.clientX, y: e.clientY });\r\n    setIsDragging(true);\r\n\r\n    onDragStart?.(e);\r\n  };\r\n\r\n  const handleDragEnd = () => {\r\n    setIsDragging(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {variant === \"card\" ? (\r\n        <div ref={dragRef} className=\"relative group w-28 h-28\">\r\n          <div\r\n            className={`flex flex-col gap-1 p-0 h-auto w-full relative cursor-default ${className}`}\r\n          >\r\n            <AspectRatio\r\n              ratio={aspectRatio}\r\n              className={cn(\r\n                \"bg-panel-accent relative overflow-hidden\",\r\n                rounded && \"rounded-md\",\r\n                \"[&::-webkit-drag-ghost]:opacity-0\" // Webkit-specific ghost hiding\r\n              )}\r\n              draggable={true}\r\n              onDragStart={handleDragStart}\r\n              onDragEnd={handleDragEnd}\r\n            >\r\n              {preview}\r\n              {!isDragging && (\r\n                <PlusButton\r\n                  className=\"opacity-0 group-hover:opacity-100\"\r\n                  onClick={handleAddToTimeline}\r\n                />\r\n              )}\r\n            </AspectRatio>\r\n            {showLabel && (\r\n              <span\r\n                className=\"text-[0.7rem] text-muted-foreground truncate w-full text-left\"\r\n                aria-label={name}\r\n                title={name}\r\n              >\r\n                {name.length > 8\r\n                  ? `${name.slice(0, 16)}...${name.slice(-3)}`\r\n                  : name}\r\n              </span>\r\n            )}\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div ref={dragRef} className=\"relative group w-full\">\r\n          <div\r\n            className={cn(\r\n              \"h-10 flex items-center gap-3 cursor-default w-full\",\r\n              \"[&::-webkit-drag-ghost]:opacity-0\",\r\n              className\r\n            )}\r\n            draggable={true}\r\n            onDragStart={handleDragStart}\r\n            onDragEnd={handleDragEnd}\r\n          >\r\n            <div className=\"w-6 h-6 flex-shrink-0 rounded overflow-hidden\">\r\n              {preview}\r\n            </div>\r\n            <span className=\"text-sm truncate flex-1 w-full\">{name}</span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Custom drag preview */}\r\n      {isDragging &&\r\n        typeof document !== \"undefined\" &&\r\n        createPortal(\r\n          <div\r\n            className=\"fixed pointer-events-none z-9999\"\r\n            style={{\r\n              left: dragPosition.x - 40, // Center the preview (half of 80px)\r\n              top: dragPosition.y - 40, // Center the preview (half of 80px)\r\n            }}\r\n          >\r\n            <div className=\"w-[80px]\">\r\n              <AspectRatio\r\n                ratio={1}\r\n                className=\"relative rounded-md overflow-hidden shadow-2xl ring-3 ring-primary\"\r\n              >\r\n                <div className=\"w-full h-full [&_img]:w-full [&_img]:h-full [&_img]:object-cover [&_img]:rounded-none\">\r\n                  {preview}\r\n                </div>\r\n                {showPlusOnDrag && (\r\n                  <PlusButton\r\n                    onClick={handleAddToTimeline}\r\n                    tooltipText=\"Add to timeline or drag to position\"\r\n                  />\r\n                )}\r\n              </AspectRatio>\r\n            </div>\r\n          </div>,\r\n          document.body\r\n        )}\r\n    </>\r\n  );\r\n}\r\n\r\nfunction PlusButton({\r\n  className,\r\n  onClick,\r\n  tooltipText,\r\n}: {\r\n  className?: string;\r\n  onClick?: () => void;\r\n  tooltipText?: string;\r\n}) {\r\n  const button = (\r\n    <Button\r\n      size=\"icon\"\r\n      className={cn(\r\n        \"absolute bottom-2 right-2 size-4 bg-background text-foreground\",\r\n        className\r\n      )}\r\n      onClick={(e) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        onClick?.();\r\n      }}\r\n      title={tooltipText}\r\n    >\r\n      <Plus className=\"size-3!\" />\r\n    </Button>\r\n  );\r\n\r\n  if (tooltipText) {\r\n    return (\r\n      <Tooltip>\r\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\r\n        <TooltipContent>\r\n          <p>{tooltipText}</p>\r\n        </TooltipContent>\r\n      </Tooltip>\r\n    );\r\n  }\r\n\r\n  return button;\r\n}\r\n","\"use client\";\r\n\r\nimport { useDragDrop } from \"@/hooks/use-drag-drop\";\r\nimport { processMediaFiles } from \"@/lib/media-processing\";\r\nimport { useMediaStore, type MediaItem } from \"@/stores/media-store\";\r\nimport {\r\n  ArrowDown01,\r\n  CloudUpload,\r\n  Grid2X2,\r\n  Image,\r\n  List,\r\n  Loader2,\r\n  Music,\r\n  Search,\r\n  Video,\r\n} from \"lucide-react\";\r\nimport { useEffect, useRef, useState, useMemo } from \"react\";\r\nimport { toast } from \"sonner\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { MediaDragOverlay } from \"@/components/editor/media-panel/drag-overlay\";\r\nimport {\r\n  ContextMenu,\r\n  ContextMenuContent,\r\n  ContextMenuItem,\r\n  ContextMenuTrigger,\r\n} from \"@/components/ui/context-menu\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuTrigger,\r\n} from \"@/components/ui/dropdown-menu\";\r\nimport { DraggableMediaItem } from \"@/components/ui/draggable-item\";\r\nimport { useProjectStore } from \"@/stores/project-store\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport {\r\n  Tooltip,\r\n  TooltipContent,\r\n  TooltipProvider,\r\n  TooltipTrigger,\r\n} from \"@/components/ui/tooltip\";\r\nimport { usePanelStore } from \"@/stores/panel-store\";\r\n\r\nfunction MediaItemWithContextMenu({\r\n  item,\r\n  children,\r\n  onRemove,\r\n}: {\r\n  item: MediaItem;\r\n  children: React.ReactNode;\r\n  onRemove: (e: React.MouseEvent, id: string) => Promise<void>;\r\n}) {\r\n  return (\r\n    <ContextMenu>\r\n      <ContextMenuTrigger>{children}</ContextMenuTrigger>\r\n      <ContextMenuContent>\r\n        <ContextMenuItem>Export clips</ContextMenuItem>\r\n        <ContextMenuItem\r\n          variant=\"destructive\"\r\n          onClick={(e) => onRemove(e, item.id)}\r\n        >\r\n          Delete\r\n        </ContextMenuItem>\r\n      </ContextMenuContent>\r\n    </ContextMenu>\r\n  );\r\n}\r\n\r\nexport function MediaView() {\r\n  const { mediaItems, addMediaItem, removeMediaItem } = useMediaStore();\r\n  const { activeProject } = useProjectStore();\r\n  const { mediaViewMode, setMediaViewMode } = usePanelStore();\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [progress, setProgress] = useState(0);\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [mediaFilter, setMediaFilter] = useState(\"all\");\r\n  const [sortBy, setSortBy] = useState<\"name\" | \"type\" | \"duration\" | \"size\">(\r\n    \"name\"\r\n  );\r\n  const [sortOrder, setSortOrder] = useState<\"asc\" | \"desc\">(\"asc\");\r\n\r\n  const processFiles = async (files: FileList | File[]) => {\r\n    if (!files || files.length === 0) return;\r\n    if (!activeProject) {\r\n      toast.error(\"No active project\");\r\n      return;\r\n    }\r\n\r\n    setIsProcessing(true);\r\n    setProgress(0);\r\n    try {\r\n      // Process files (extract metadata, generate thumbnails, etc.)\r\n      const processedItems = await processMediaFiles(files, (p) =>\r\n        setProgress(p)\r\n      );\r\n      // Add each processed media item to the store\r\n      for (const item of processedItems) {\r\n        await addMediaItem(activeProject.id, item);\r\n      }\r\n    } catch (error) {\r\n      // Show error toast if processing fails\r\n      console.error(\"Error processing files:\", error);\r\n      toast.error(\"Failed to process files\");\r\n    } finally {\r\n      setIsProcessing(false);\r\n      setProgress(0);\r\n    }\r\n  };\r\n\r\n  const { isDragOver, dragProps } = useDragDrop({\r\n    // When files are dropped, process them\r\n    onDrop: processFiles,\r\n  });\r\n\r\n  const handleFileSelect = () => fileInputRef.current?.click(); // Open file picker\r\n\r\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    // When files are selected via file picker, process them\r\n    if (e.target.files) processFiles(e.target.files);\r\n    e.target.value = \"\"; // Reset input\r\n  };\r\n\r\n  const handleRemove = async (e: React.MouseEvent, id: string) => {\r\n    // Remove a media item from the store\r\n    e.stopPropagation();\r\n\r\n    if (!activeProject) {\r\n      toast.error(\"No active project\");\r\n      return;\r\n    }\r\n\r\n    // Media store now handles cascade deletion automatically\r\n    await removeMediaItem(activeProject.id, id);\r\n  };\r\n\r\n  const formatDuration = (duration: number) => {\r\n    // Format seconds as mm:ss\r\n    const min = Math.floor(duration / 60);\r\n    const sec = Math.floor(duration % 60);\r\n    return `${min}:${sec.toString().padStart(2, \"0\")}`;\r\n  };\r\n\r\n  const [filteredMediaItems, setFilteredMediaItems] = useState(mediaItems);\r\n\r\n  useEffect(() => {\r\n    let filtered = mediaItems.filter((item) => {\r\n      if (mediaFilter && mediaFilter !== \"all\" && item.type !== mediaFilter) {\r\n        return false;\r\n      }\r\n\r\n      if (\r\n        searchQuery &&\r\n        !item.name.toLowerCase().includes(searchQuery.toLowerCase())\r\n      ) {\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    });\r\n\r\n    filtered.sort((a, b) => {\r\n      let valueA: any;\r\n      let valueB: any;\r\n\r\n      switch (sortBy) {\r\n        case \"name\":\r\n          valueA = a.name.toLowerCase();\r\n          valueB = b.name.toLowerCase();\r\n          break;\r\n        case \"type\":\r\n          valueA = a.type;\r\n          valueB = b.type;\r\n          break;\r\n        case \"duration\":\r\n          valueA = a.duration || 0;\r\n          valueB = b.duration || 0;\r\n          break;\r\n        case \"size\":\r\n          valueA = a.file.size;\r\n          valueB = b.file.size;\r\n          break;\r\n        default:\r\n          return 0;\r\n      }\r\n\r\n      if (valueA < valueB) return sortOrder === \"asc\" ? -1 : 1;\r\n      if (valueA > valueB) return sortOrder === \"asc\" ? 1 : -1;\r\n      return 0;\r\n    });\r\n\r\n    setFilteredMediaItems(filtered);\r\n  }, [mediaItems, mediaFilter, searchQuery, sortBy, sortOrder]);\r\n\r\n  const previewComponents = useMemo(() => {\r\n    const previews = new Map<string, React.ReactNode>();\r\n\r\n    filteredMediaItems.forEach((item) => {\r\n      let preview: React.ReactNode;\r\n\r\n      if (item.type === \"image\") {\r\n        preview = (\r\n          <div className=\"w-full h-full flex items-center justify-center\">\r\n            <img\r\n              src={item.url}\r\n              alt={item.name}\r\n              className=\"max-w-full max-h-full object-contain\"\r\n              loading=\"lazy\"\r\n            />\r\n          </div>\r\n        );\r\n      } else if (item.type === \"video\") {\r\n        if (item.thumbnailUrl) {\r\n          preview = (\r\n            <div className=\"relative w-full h-full\">\r\n              <img\r\n                src={item.thumbnailUrl}\r\n                alt={item.name}\r\n                className=\"w-full h-full object-cover rounded\"\r\n                loading=\"lazy\"\r\n              />\r\n              <div className=\"absolute inset-0 flex items-center justify-center bg-black/20 rounded\">\r\n                <Video className=\"h-6 w-6 text-white drop-shadow-md\" />\r\n              </div>\r\n              {item.duration && (\r\n                <div className=\"absolute bottom-1 right-1 bg-black/70 text-white text-xs px-1 rounded\">\r\n                  {formatDuration(item.duration)}\r\n                </div>\r\n              )}\r\n            </div>\r\n          );\r\n        } else {\r\n          preview = (\r\n            <div className=\"w-full h-full bg-muted/30 flex flex-col items-center justify-center text-muted-foreground rounded\">\r\n              <Video className=\"h-6 w-6 mb-1\" />\r\n              <span className=\"text-xs\">Video</span>\r\n              {item.duration && (\r\n                <span className=\"text-xs opacity-70\">\r\n                  {formatDuration(item.duration)}\r\n                </span>\r\n              )}\r\n            </div>\r\n          );\r\n        }\r\n      } else if (item.type === \"audio\") {\r\n        preview = (\r\n          <div className=\"w-full h-full bg-linear-to-br from-green-500/20 to-emerald-500/20 flex flex-col items-center justify-center text-muted-foreground rounded border border-green-500/20\">\r\n            <Music className=\"h-6 w-6 mb-1\" />\r\n            <span className=\"text-xs\">Audio</span>\r\n            {item.duration && (\r\n              <span className=\"text-xs opacity-70\">\r\n                {formatDuration(item.duration)}\r\n              </span>\r\n            )}\r\n          </div>\r\n        );\r\n      } else {\r\n        preview = (\r\n          <div className=\"w-full h-full bg-muted/30 flex flex-col items-center justify-center text-muted-foreground rounded\">\r\n            <Image className=\"h-6 w-6\" />\r\n            <span className=\"text-xs mt-1\">Unknown</span>\r\n          </div>\r\n        );\r\n      }\r\n\r\n      previews.set(item.id, preview);\r\n    });\r\n\r\n    return previews;\r\n  }, [filteredMediaItems]);\r\n\r\n  const renderPreview = (item: MediaItem) => previewComponents.get(item.id);\r\n\r\n  return (\r\n    <>\r\n      {/* Hidden file input for uploading media */}\r\n      <input\r\n        ref={fileInputRef}\r\n        type=\"file\"\r\n        accept=\"image/*,video/*,audio/*\"\r\n        multiple\r\n        className=\"hidden\"\r\n        onChange={handleFileChange}\r\n      />\r\n\r\n      <div\r\n        className={`h-full flex flex-col gap-1 transition-colors relative ${isDragOver ? \"bg-accent/30\" : \"\"}`}\r\n        {...dragProps}\r\n      >\r\n        <div className=\"p-3 pb-2 bg-panel\">\r\n          {/* Search and filter controls */}\r\n          <div className=\"flex items-center gap-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"lg\"\r\n              onClick={handleFileSelect}\r\n              disabled={isProcessing}\r\n              className=\"!bg-background px-4 flex-1 justify-center items-center h-9 opacity-100 hover:opacity-75 transition-opacity\"\r\n            >\r\n              {isProcessing ? (\r\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n              ) : (\r\n                <CloudUpload className=\"h-4 w-4\" />\r\n              )}\r\n              <span>Upload</span>\r\n            </Button>\r\n            <div className=\"flex items-center gap-0\">\r\n              <TooltipProvider>\r\n                <Tooltip>\r\n                  <TooltipTrigger asChild>\r\n                    <Button\r\n                      size=\"icon\"\r\n                      variant=\"text\"\r\n                      onClick={() =>\r\n                        setMediaViewMode(\r\n                          mediaViewMode === \"grid\" ? \"list\" : \"grid\"\r\n                        )\r\n                      }\r\n                      disabled={isProcessing}\r\n                      className=\"justify-center items-center\"\r\n                    >\r\n                      {mediaViewMode === \"grid\" ? (\r\n                        <List strokeWidth={1.5} className=\"!size-[1.05rem]\" />\r\n                      ) : (\r\n                        <Grid2X2\r\n                          strokeWidth={1.5}\r\n                          className=\"!size-[1.05rem]\"\r\n                        />\r\n                      )}\r\n                    </Button>\r\n                  </TooltipTrigger>\r\n                  <TooltipContent>\r\n                    <p>\r\n                      {mediaViewMode === \"grid\"\r\n                        ? \"Switch to list view\"\r\n                        : \"Switch to grid view\"}\r\n                    </p>\r\n                  </TooltipContent>\r\n                  <Tooltip>\r\n                    <DropdownMenu>\r\n                      <TooltipTrigger asChild>\r\n                        <DropdownMenuTrigger asChild>\r\n                          <Button\r\n                            size=\"icon\"\r\n                            variant=\"text\"\r\n                            disabled={isProcessing}\r\n                            className=\"justify-center items-center\"\r\n                          >\r\n                            <ArrowDown01\r\n                              strokeWidth={1.5}\r\n                              className=\"!size-[1.05rem]\"\r\n                            />\r\n                          </Button>\r\n                        </DropdownMenuTrigger>\r\n                      </TooltipTrigger>\r\n                      <DropdownMenuContent align=\"end\">\r\n                        <DropdownMenuItem\r\n                          onClick={() => {\r\n                            if (sortBy === \"name\") {\r\n                              setSortOrder(\r\n                                sortOrder === \"asc\" ? \"desc\" : \"asc\"\r\n                              );\r\n                            } else {\r\n                              setSortBy(\"name\");\r\n                              setSortOrder(\"asc\");\r\n                            }\r\n                          }}\r\n                        >\r\n                          Name{\" \"}\r\n                          {sortBy === \"name\" &&\r\n                            (sortOrder === \"asc\" ? \"↑\" : \"↓\")}\r\n                        </DropdownMenuItem>\r\n                        <DropdownMenuItem\r\n                          onClick={() => {\r\n                            if (sortBy === \"type\") {\r\n                              setSortOrder(\r\n                                sortOrder === \"asc\" ? \"desc\" : \"asc\"\r\n                              );\r\n                            } else {\r\n                              setSortBy(\"type\");\r\n                              setSortOrder(\"asc\");\r\n                            }\r\n                          }}\r\n                        >\r\n                          Type{\" \"}\r\n                          {sortBy === \"type\" &&\r\n                            (sortOrder === \"asc\" ? \"↑\" : \"↓\")}\r\n                        </DropdownMenuItem>\r\n                        <DropdownMenuItem\r\n                          onClick={() => {\r\n                            if (sortBy === \"duration\") {\r\n                              setSortOrder(\r\n                                sortOrder === \"asc\" ? \"desc\" : \"asc\"\r\n                              );\r\n                            } else {\r\n                              setSortBy(\"duration\");\r\n                              setSortOrder(\"asc\");\r\n                            }\r\n                          }}\r\n                        >\r\n                          Duration{\" \"}\r\n                          {sortBy === \"duration\" &&\r\n                            (sortOrder === \"asc\" ? \"↑\" : \"↓\")}\r\n                        </DropdownMenuItem>\r\n                        <DropdownMenuItem\r\n                          onClick={() => {\r\n                            if (sortBy === \"size\") {\r\n                              setSortOrder(\r\n                                sortOrder === \"asc\" ? \"desc\" : \"asc\"\r\n                              );\r\n                            } else {\r\n                              setSortBy(\"size\");\r\n                              setSortOrder(\"asc\");\r\n                            }\r\n                          }}\r\n                        >\r\n                          File Size{\" \"}\r\n                          {sortBy === \"size\" &&\r\n                            (sortOrder === \"asc\" ? \"↑\" : \"↓\")}\r\n                        </DropdownMenuItem>\r\n                      </DropdownMenuContent>\r\n                    </DropdownMenu>\r\n                    <TooltipContent>\r\n                      <p>\r\n                        Sort by {sortBy} (\r\n                        {sortOrder === \"asc\" ? \"ascending\" : \"descending\"})\r\n                      </p>\r\n                    </TooltipContent>\r\n                  </Tooltip>\r\n                </Tooltip>\r\n              </TooltipProvider>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"h-full w-full overflow-y-auto scrollbar-thin\">\r\n          <div className=\"flex-1 p-3 pt-0 w-full\">\r\n            {isDragOver || filteredMediaItems.length === 0 ? (\r\n              <MediaDragOverlay\r\n                isVisible={true}\r\n                isProcessing={isProcessing}\r\n                progress={progress}\r\n                onClick={handleFileSelect}\r\n                isEmptyState={filteredMediaItems.length === 0 && !isDragOver}\r\n              />\r\n            ) : mediaViewMode === \"grid\" ? (\r\n              <GridView\r\n                filteredMediaItems={filteredMediaItems}\r\n                renderPreview={renderPreview}\r\n                handleRemove={handleRemove}\r\n              />\r\n            ) : (\r\n              <ListView\r\n                filteredMediaItems={filteredMediaItems}\r\n                renderPreview={renderPreview}\r\n                handleRemove={handleRemove}\r\n                formatDuration={formatDuration}\r\n              />\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction GridView({\r\n  filteredMediaItems,\r\n  renderPreview,\r\n  handleRemove,\r\n}: {\r\n  filteredMediaItems: MediaItem[];\r\n  renderPreview: (item: MediaItem) => React.ReactNode;\r\n  handleRemove: (e: React.MouseEvent, id: string) => Promise<void>;\r\n}) {\r\n  return (\r\n    <div\r\n      className=\"grid gap-2\"\r\n      style={{\r\n        gridTemplateColumns: \"repeat(auto-fill, 160px)\",\r\n      }}\r\n    >\r\n      {filteredMediaItems.map((item) => (\r\n        <MediaItemWithContextMenu\r\n          key={item.id}\r\n          item={item}\r\n          onRemove={handleRemove}\r\n        >\r\n          <DraggableMediaItem\r\n            name={item.name}\r\n            preview={renderPreview(item)}\r\n            dragData={{\r\n              id: item.id,\r\n              type: item.type,\r\n              name: item.name,\r\n            }}\r\n            showPlusOnDrag={false}\r\n            onAddToTimeline={(currentTime) =>\r\n              useTimelineStore.getState().addMediaAtTime(item, currentTime)\r\n            }\r\n            rounded={false}\r\n            variant=\"card\"\r\n          />\r\n        </MediaItemWithContextMenu>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ListView({\r\n  filteredMediaItems,\r\n  renderPreview,\r\n  handleRemove,\r\n  formatDuration,\r\n}: {\r\n  filteredMediaItems: MediaItem[];\r\n  renderPreview: (item: MediaItem) => React.ReactNode;\r\n  handleRemove: (e: React.MouseEvent, id: string) => Promise<void>;\r\n  formatDuration: (duration: number) => string;\r\n}) {\r\n  return (\r\n    <div className=\"space-y-1\">\r\n      {filteredMediaItems.map((item) => (\r\n        <MediaItemWithContextMenu\r\n          key={item.id}\r\n          item={item}\r\n          onRemove={handleRemove}\r\n        >\r\n          <DraggableMediaItem\r\n            name={item.name}\r\n            preview={renderPreview(item)}\r\n            dragData={{\r\n              id: item.id,\r\n              type: item.type,\r\n              name: item.name,\r\n            }}\r\n            showPlusOnDrag={false}\r\n            onAddToTimeline={(currentTime) =>\r\n              useTimelineStore.getState().addMediaAtTime(item, currentTime)\r\n            }\r\n            variant=\"compact\"\r\n          />\r\n        </MediaItemWithContextMenu>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n","import { DraggableMediaItem } from \"@/components/ui/draggable-item\";\r\nimport { TIMELINE_CONSTANTS } from \"@/constants/timeline-constants\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { type TextElement } from \"@/types/timeline\";\r\n\r\nconst textData: TextElement = {\r\n  id: \"default-text\",\r\n  type: \"text\",\r\n  name: \"Default text\",\r\n  content: \"Default text\",\r\n  fontSize: 48,\r\n  fontFamily: \"Arial\",\r\n  color: \"#ffffff\",\r\n  backgroundColor: \"transparent\",\r\n  textAlign: \"center\" as const,\r\n  fontWeight: \"normal\" as const,\r\n  fontStyle: \"normal\" as const,\r\n  textDecoration: \"none\" as const,\r\n  x: 0,\r\n  y: 0,\r\n  rotation: 0,\r\n  opacity: 1,\r\n  duration: TIMELINE_CONSTANTS.DEFAULT_TEXT_DURATION,\r\n  startTime: 0,\r\n  trimStart: 0,\r\n  trimEnd: 0,\r\n};\r\n\r\nexport function TextView() {\r\n  return (\r\n    <div className=\"p-4\">\r\n      <DraggableMediaItem\r\n        name=\"Default text\"\r\n        preview={\r\n          <div className=\"flex items-center justify-center w-full h-full bg-panel-accent rounded\">\r\n            <span className=\"text-xs select-none\">Default text</span>\r\n          </div>\r\n        }\r\n        dragData={{\r\n          id: textData.id,\r\n          type: textData.type,\r\n          name: textData.name,\r\n          content: textData.content,\r\n        }}\r\n        aspectRatio={1}\r\n        onAddToTimeline={(currentTime) =>\r\n          useTimelineStore.getState().addTextAtTime(textData, currentTime)\r\n        }\r\n        showLabel={false}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { Tabs as TabsPrimitive } from \"radix-ui\";\r\n\r\nimport { cn } from \"../../lib/utils\";\r\n\r\nconst Tabs = TabsPrimitive.Root;\r\n\r\nconst TabsList = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.List\r\n    ref={ref}\r\n    className={cn(\r\n      \"inline-flex h-auto items-center justify-center gap-2 rounded-lg bg-transparent p-0 text-muted-foreground\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nTabsList.displayName = TabsPrimitive.List.displayName;\r\n\r\nconst TabsTrigger = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.Trigger\r\n    ref={ref}\r\n    className={cn(\r\n      \"inline-flex items-center cursor-pointer justify-center whitespace-nowrap rounded-lg px-3 py-1 text-sm font-medium ring-offset-background focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-card data-[state=active]:text-foreground\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName;\r\n\r\nconst TabsContent = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.Content\r\n    ref={ref}\r\n    className={cn(\r\n      \"mt-2 ring-offset-background focus-visible:outline-hidden focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nTabsContent.displayName = TabsPrimitive.Content.displayName;\r\n\r\nexport { Tabs, TabsList, TabsTrigger, TabsContent };\r\n","import { create } from \"zustand\";\r\nimport type { SoundEffect, SavedSound } from \"@/types/sounds\";\r\nimport { storageService } from \"@/lib/storage/storage-service\";\r\nimport { toast } from \"sonner\";\r\nimport { useMediaStore } from \"./media-store\";\r\nimport { useTimelineStore } from \"./timeline-store\";\r\nimport { useProjectStore } from \"./project-store\";\r\nimport { usePlaybackStore } from \"./playback-store\";\r\n\r\ninterface SoundsStore {\r\n  topSoundEffects: SoundEffect[];\r\n  isLoading: boolean;\r\n  error: string | null;\r\n  hasLoaded: boolean;\r\n\r\n  // Filter state\r\n  showCommercialOnly: boolean;\r\n  toggleCommercialFilter: () => void;\r\n\r\n  // Search state\r\n  searchQuery: string;\r\n  searchResults: SoundEffect[];\r\n  isSearching: boolean;\r\n  searchError: string | null;\r\n  lastSearchQuery: string;\r\n  scrollPosition: number;\r\n\r\n  // Pagination state\r\n  currentPage: number;\r\n  hasNextPage: boolean;\r\n  totalCount: number;\r\n  isLoadingMore: boolean;\r\n\r\n  // Saved sounds state\r\n  savedSounds: SavedSound[];\r\n  isSavedSoundsLoaded: boolean;\r\n  isLoadingSavedSounds: boolean;\r\n  savedSoundsError: string | null;\r\n\r\n  // Timeline integration\r\n  addSoundToTimeline: (sound: SoundEffect) => Promise<boolean>;\r\n\r\n  setTopSoundEffects: (sounds: SoundEffect[]) => void;\r\n  setLoading: (loading: boolean) => void;\r\n  setError: (error: string | null) => void;\r\n  setHasLoaded: (loaded: boolean) => void;\r\n\r\n  // Search actions\r\n  setSearchQuery: (query: string) => void;\r\n  setSearchResults: (results: SoundEffect[]) => void;\r\n  setSearching: (searching: boolean) => void;\r\n  setSearchError: (error: string | null) => void;\r\n  setLastSearchQuery: (query: string) => void;\r\n  setScrollPosition: (position: number) => void;\r\n\r\n  // Pagination actions\r\n  setCurrentPage: (page: number) => void;\r\n  setHasNextPage: (hasNext: boolean) => void;\r\n  setTotalCount: (count: number) => void;\r\n  setLoadingMore: (loading: boolean) => void;\r\n  appendSearchResults: (results: SoundEffect[]) => void;\r\n  appendTopSounds: (results: SoundEffect[]) => void;\r\n  resetPagination: () => void;\r\n\r\n  // Saved sounds actions\r\n  loadSavedSounds: () => Promise<void>;\r\n  saveSoundEffect: (soundEffect: SoundEffect) => Promise<void>;\r\n  removeSavedSound: (soundId: number) => Promise<void>;\r\n  isSoundSaved: (soundId: number) => boolean;\r\n  toggleSavedSound: (soundEffect: SoundEffect) => Promise<void>;\r\n  clearSavedSounds: () => Promise<void>;\r\n}\r\n\r\nexport const useSoundsStore = create<SoundsStore>((set, get) => ({\r\n  topSoundEffects: [],\r\n  isLoading: false,\r\n  error: null,\r\n  hasLoaded: false,\r\n  showCommercialOnly: true,\r\n\r\n  toggleCommercialFilter: () => {\r\n    set((state) => ({ showCommercialOnly: !state.showCommercialOnly }));\r\n  },\r\n\r\n  // Search state\r\n  searchQuery: \"\",\r\n  searchResults: [],\r\n  isSearching: false,\r\n  searchError: null,\r\n  lastSearchQuery: \"\",\r\n  scrollPosition: 0,\r\n\r\n  // Pagination state\r\n  currentPage: 1,\r\n  hasNextPage: false,\r\n  totalCount: 0,\r\n  isLoadingMore: false,\r\n\r\n  // Saved sounds state\r\n  savedSounds: [],\r\n  isSavedSoundsLoaded: false,\r\n  isLoadingSavedSounds: false,\r\n  savedSoundsError: null,\r\n\r\n  setTopSoundEffects: (sounds) => set({ topSoundEffects: sounds }),\r\n  setLoading: (loading) => set({ isLoading: loading }),\r\n  setError: (error) => set({ error }),\r\n  setHasLoaded: (loaded) => set({ hasLoaded: loaded }),\r\n\r\n  // Search actions\r\n  setSearchQuery: (query) => set({ searchQuery: query }),\r\n  setSearchResults: (results) =>\r\n    set({ searchResults: results, currentPage: 1 }),\r\n  setSearching: (searching) => set({ isSearching: searching }),\r\n  setSearchError: (error) => set({ searchError: error }),\r\n  setLastSearchQuery: (query) => set({ lastSearchQuery: query }),\r\n  setScrollPosition: (position) => set({ scrollPosition: position }),\r\n\r\n  // Pagination actions\r\n  setCurrentPage: (page) => set({ currentPage: page }),\r\n  setHasNextPage: (hasNext) => set({ hasNextPage: hasNext }),\r\n  setTotalCount: (count) => set({ totalCount: count }),\r\n  setLoadingMore: (loading) => set({ isLoadingMore: loading }),\r\n  appendSearchResults: (results) =>\r\n    set((state) => ({\r\n      searchResults: [...state.searchResults, ...results],\r\n    })),\r\n  appendTopSounds: (results) =>\r\n    set((state) => ({\r\n      topSoundEffects: [...state.topSoundEffects, ...results],\r\n    })),\r\n  resetPagination: () =>\r\n    set({\r\n      currentPage: 1,\r\n      hasNextPage: false,\r\n      totalCount: 0,\r\n      isLoadingMore: false,\r\n    }),\r\n\r\n  // Saved sounds actions\r\n  loadSavedSounds: async () => {\r\n    if (get().isSavedSoundsLoaded) return;\r\n\r\n    try {\r\n      set({ isLoadingSavedSounds: true, savedSoundsError: null });\r\n      const savedSoundsData = await storageService.loadSavedSounds();\r\n      set({\r\n        savedSounds: savedSoundsData.sounds,\r\n        isSavedSoundsLoaded: true,\r\n        isLoadingSavedSounds: false,\r\n      });\r\n    } catch (error) {\r\n      const errorMessage =\r\n        error instanceof Error ? error.message : \"Failed to load saved sounds\";\r\n      set({\r\n        savedSoundsError: errorMessage,\r\n        isLoadingSavedSounds: false,\r\n      });\r\n      console.error(\"Failed to load saved sounds:\", error);\r\n    }\r\n  },\r\n\r\n  saveSoundEffect: async (soundEffect: SoundEffect) => {\r\n    try {\r\n      await storageService.saveSoundEffect(soundEffect);\r\n\r\n      // Refresh saved sounds\r\n      const savedSoundsData = await storageService.loadSavedSounds();\r\n      set({ savedSounds: savedSoundsData.sounds });\r\n    } catch (error) {\r\n      const errorMessage =\r\n        error instanceof Error ? error.message : \"Failed to save sound\";\r\n      set({ savedSoundsError: errorMessage });\r\n      toast.error(\"Failed to save sound\");\r\n      console.error(\"Failed to save sound:\", error);\r\n    }\r\n  },\r\n\r\n  removeSavedSound: async (soundId: number) => {\r\n    try {\r\n      await storageService.removeSavedSound(soundId);\r\n\r\n      // Update local state immediately\r\n      set((state) => ({\r\n        savedSounds: state.savedSounds.filter((sound) => sound.id !== soundId),\r\n      }));\r\n    } catch (error) {\r\n      const errorMessage =\r\n        error instanceof Error ? error.message : \"Failed to remove sound\";\r\n      set({ savedSoundsError: errorMessage });\r\n      toast.error(\"Failed to remove sound\");\r\n      console.error(\"Failed to remove sound:\", error);\r\n    }\r\n  },\r\n\r\n  isSoundSaved: (soundId: number) => {\r\n    const { savedSounds } = get();\r\n    return savedSounds.some((sound) => sound.id === soundId);\r\n  },\r\n\r\n  toggleSavedSound: async (soundEffect: SoundEffect) => {\r\n    const { isSoundSaved, saveSoundEffect, removeSavedSound } = get();\r\n\r\n    if (isSoundSaved(soundEffect.id)) {\r\n      await removeSavedSound(soundEffect.id);\r\n    } else {\r\n      await saveSoundEffect(soundEffect);\r\n    }\r\n  },\r\n\r\n  clearSavedSounds: async () => {\r\n    try {\r\n      await storageService.clearSavedSounds();\r\n      set({\r\n        savedSounds: [],\r\n        savedSoundsError: null,\r\n      });\r\n    } catch (error) {\r\n      const errorMessage =\r\n        error instanceof Error ? error.message : \"Failed to clear saved sounds\";\r\n      set({ savedSoundsError: errorMessage });\r\n      toast.error(\"Failed to clear saved sounds\");\r\n      console.error(\"Failed to clear saved sounds:\", error);\r\n    }\r\n  },\r\n\r\n  addSoundToTimeline: async (sound) => {\r\n    const activeProject = useProjectStore.getState().activeProject;\r\n    if (!activeProject) {\r\n      toast.error(\"No active project\");\r\n      return false;\r\n    }\r\n\r\n    const audioUrl = sound.previewUrl;\r\n    if (!audioUrl) {\r\n      toast.error(\"Sound file not available\");\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(audioUrl);\r\n      if (!response.ok)\r\n        throw new Error(`Failed to download audio: ${response.statusText}`);\r\n\r\n      const blob = await response.blob();\r\n      const file = new File([blob], `${sound.name}.mp3`, {\r\n        type: \"audio/mpeg\",\r\n      });\r\n\r\n      await useMediaStore.getState().addMediaItem(activeProject.id, {\r\n        name: sound.name,\r\n        type: \"audio\",\r\n        file,\r\n        duration: sound.duration,\r\n        url: URL.createObjectURL(file),\r\n      });\r\n\r\n      const mediaItem = useMediaStore\r\n        .getState()\r\n        .mediaItems.find((item) => item.file === file);\r\n      if (!mediaItem) throw new Error(\"Failed to create media item\");\r\n\r\n      const success = useTimelineStore\r\n        .getState()\r\n        .addMediaAtTime(mediaItem, usePlaybackStore.getState().currentTime);\r\n\r\n      if (success) {\r\n        return true;\r\n      }\r\n      throw new Error(\"Failed to add to timeline - check for overlaps\");\r\n    } catch (error) {\r\n      console.error(\"Failed to add sound to timeline:\", error);\r\n      toast.error(\r\n        error instanceof Error\r\n          ? error.message\r\n          : \"Failed to add sound to timeline\",\r\n        { id: `sound-${sound.id}` }\r\n      );\r\n      return false;\r\n    }\r\n  },\r\n}));\r\n","import { useEffect } from \"react\";\r\nimport { useSoundsStore } from \"@/stores/sounds-store\";\r\n\r\n/**\r\n * Custom hook for searching sound effects with race condition protection.\r\n * Uses global Zustand store to persist search state across tab switches.\r\n * - Debounced search (300ms)\r\n * - Race condition protection with cleanup\r\n * - Proper error handling\r\n */\r\n\r\nexport function useSoundSearch(query: string, commercialOnly: boolean) {\r\n  const {\r\n    searchResults,\r\n    isSearching,\r\n    searchError,\r\n    lastSearchQuery,\r\n    currentPage,\r\n    hasNextPage,\r\n    isLoadingMore,\r\n    totalCount,\r\n    setSearchResults,\r\n    setSearching,\r\n    setSearchError,\r\n    setLastSearchQuery,\r\n    setCurrentPage,\r\n    setHasNextPage,\r\n    setTotalCount,\r\n    setLoadingMore,\r\n    appendSearchResults,\r\n    appendTopSounds,\r\n    resetPagination,\r\n  } = useSoundsStore();\r\n\r\n  // Load more function for infinite scroll\r\n  const loadMore = async () => {\r\n    if (isLoadingMore || !hasNextPage) return;\r\n\r\n    try {\r\n      setLoadingMore(true);\r\n      const nextPage = currentPage + 1;\r\n\r\n      const searchParams = new URLSearchParams({\r\n        page: nextPage.toString(),\r\n        type: \"effects\",\r\n      });\r\n\r\n      if (query.trim()) {\r\n        searchParams.set(\"q\", query);\r\n      }\r\n\r\n      searchParams.set(\"commercial_only\", commercialOnly.toString());\r\n      const response = await fetch(\r\n        `/api/sounds/search?${searchParams.toString()}`\r\n      );\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n\r\n        // Append to appropriate array based on whether we have a query\r\n        if (query.trim()) {\r\n          appendSearchResults(data.results);\r\n        } else {\r\n          appendTopSounds(data.results);\r\n        }\r\n\r\n        setCurrentPage(nextPage);\r\n        setHasNextPage(!!data.next);\r\n        setTotalCount(data.count);\r\n      } else {\r\n        setSearchError(`Load more failed: ${response.status}`);\r\n      }\r\n    } catch (err) {\r\n      setSearchError(err instanceof Error ? err.message : \"Load more failed\");\r\n    } finally {\r\n      setLoadingMore(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!query.trim()) {\r\n      setSearchResults([]);\r\n      setSearchError(null);\r\n      setLastSearchQuery(\"\");\r\n      // Don't reset pagination here - top sounds pagination is managed by prefetcher\r\n      return;\r\n    }\r\n\r\n    // If we already searched for this query and have results, don't search again\r\n    if (query === lastSearchQuery && searchResults.length > 0) {\r\n      return;\r\n    }\r\n\r\n    let ignore = false;\r\n\r\n    const timeoutId = setTimeout(async () => {\r\n      try {\r\n        setSearching(true);\r\n        setSearchError(null);\r\n        resetPagination();\r\n\r\n        const response = await fetch(\r\n          `/api/sounds/search?q=${encodeURIComponent(query)}&type=effects&page=1`\r\n        );\r\n\r\n        if (!ignore) {\r\n          if (response.ok) {\r\n            const data = await response.json();\r\n            setSearchResults(data.results);\r\n            setLastSearchQuery(query);\r\n            setHasNextPage(!!data.next);\r\n            setTotalCount(data.count);\r\n            setCurrentPage(1);\r\n          } else {\r\n            setSearchError(`Search failed: ${response.status}`);\r\n          }\r\n        }\r\n      } catch (err) {\r\n        if (!ignore) {\r\n          setSearchError(err instanceof Error ? err.message : \"Search failed\");\r\n        }\r\n      } finally {\r\n        if (!ignore) {\r\n          setSearching(false);\r\n        }\r\n      }\r\n    }, 300);\r\n\r\n    return () => {\r\n      clearTimeout(timeoutId);\r\n      ignore = true;\r\n    };\r\n  }, [\r\n    query,\r\n    lastSearchQuery,\r\n    searchResults.length,\r\n    setSearchResults,\r\n    setSearching,\r\n    setSearchError,\r\n    setLastSearchQuery,\r\n    setCurrentPage,\r\n    setHasNextPage,\r\n    setTotalCount,\r\n    resetPagination,\r\n  ]);\r\n\r\n  return {\r\n    results: searchResults,\r\n    isLoading: isSearching,\r\n    error: searchError,\r\n    loadMore,\r\n    hasNextPage,\r\n    isLoadingMore,\r\n    totalCount,\r\n  };\r\n}\r\n","\"use client\";\r\n\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { useState, useMemo, useRef, useEffect } from \"react\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport {\r\n  PlayIcon,\r\n  PauseIcon,\r\n  HeartIcon,\r\n  PlusIcon,\r\n  ListFilter,\r\n} from \"lucide-react\";\r\nimport { useSoundsStore } from \"@/stores/sounds-store\";\r\nimport { useSoundSearch } from \"@/hooks/use-sound-search\";\r\nimport type { SoundEffect, SavedSound } from \"@/types/sounds\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuTrigger,\r\n  DropdownMenuContent,\r\n  DropdownMenuCheckboxItem,\r\n} from \"@/components/ui/dropdown-menu\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nexport function SoundsView() {\r\n  return (\r\n    <div className=\"h-full flex flex-col\">\r\n      <Tabs defaultValue=\"sound-effects\" className=\"flex flex-col h-full\">\r\n        <div className=\"px-3 pt-4 pb-0\">\r\n          <TabsList>\r\n            <TabsTrigger value=\"sound-effects\">Sound effects</TabsTrigger>\r\n            <TabsTrigger value=\"songs\">Songs</TabsTrigger>\r\n            <TabsTrigger value=\"saved\">Saved</TabsTrigger>\r\n          </TabsList>\r\n        </div>\r\n        <Separator className=\"my-4\" />\r\n        <TabsContent\r\n          value=\"sound-effects\"\r\n          className=\"p-5 pt-0 mt-0 flex-1 flex flex-col min-h-0\"\r\n        >\r\n          <SoundEffectsView />\r\n        </TabsContent>\r\n        <TabsContent\r\n          value=\"saved\"\r\n          className=\"p-5 pt-0 mt-0 flex-1 flex flex-col min-h-0\"\r\n        >\r\n          <SavedSoundsView />\r\n        </TabsContent>\r\n        <TabsContent\r\n          value=\"songs\"\r\n          className=\"p-5 pt-0 mt-0 flex-1 flex flex-col min-h-0\"\r\n        >\r\n          <SongsView />\r\n        </TabsContent>\r\n      </Tabs>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction SoundEffectsView() {\r\n  const {\r\n    topSoundEffects,\r\n    isLoading,\r\n    searchQuery,\r\n    setSearchQuery,\r\n    scrollPosition,\r\n    setScrollPosition,\r\n    loadSavedSounds,\r\n    isSoundSaved,\r\n    toggleSavedSound,\r\n    showCommercialOnly,\r\n    toggleCommercialFilter,\r\n  } = useSoundsStore();\r\n  const {\r\n    results: searchResults,\r\n    isLoading: isSearching,\r\n    loadMore,\r\n    hasNextPage,\r\n    isLoadingMore,\r\n  } = useSoundSearch(searchQuery, showCommercialOnly);\r\n\r\n  // Audio playback state\r\n  const [playingId, setPlayingId] = useState<number | null>(null);\r\n  const [audioElement, setAudioElement] = useState<HTMLAudioElement | null>(\r\n    null\r\n  );\r\n\r\n  // Scroll position persistence\r\n  const scrollAreaRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Load saved sounds and restore scroll position when component mounts\r\n  useEffect(() => {\r\n    loadSavedSounds();\r\n\r\n    if (scrollAreaRef.current && scrollPosition > 0) {\r\n      const timeoutId = setTimeout(() => {\r\n        scrollAreaRef.current?.scrollTo({ top: scrollPosition });\r\n      }, 100); // Small delay to ensure content is rendered\r\n\r\n      return () => clearTimeout(timeoutId);\r\n    }\r\n  }, []); // Only run on mount\r\n\r\n  // Track scroll position changes and handle infinite scroll\r\n  const handleScroll = (event: React.UIEvent<HTMLDivElement>) => {\r\n    const { scrollTop, scrollHeight, clientHeight } = event.currentTarget;\r\n    setScrollPosition(scrollTop);\r\n\r\n    // Trigger loadMore when scrolled to within 200px of bottom\r\n    const nearBottom = scrollTop + clientHeight >= scrollHeight - 200;\r\n    if (nearBottom && hasNextPage && !isLoadingMore && !isSearching) {\r\n      loadMore();\r\n    }\r\n  };\r\n\r\n  // Use your existing design, just swap the data source\r\n  const displayedSounds = useMemo(() => {\r\n    const sounds = searchQuery ? searchResults : topSoundEffects;\r\n    return sounds;\r\n  }, [searchQuery, searchResults, topSoundEffects]);\r\n\r\n  const playSound = (sound: SoundEffect) => {\r\n    if (playingId === sound.id) {\r\n      audioElement?.pause();\r\n      setPlayingId(null);\r\n      return;\r\n    }\r\n\r\n    // Stop previous sound\r\n    audioElement?.pause();\r\n\r\n    if (sound.previewUrl) {\r\n      const audio = new Audio(sound.previewUrl);\r\n      audio.addEventListener(\"ended\", () => {\r\n        setPlayingId(null);\r\n      });\r\n      audio.addEventListener(\"error\", (e) => {\r\n        setPlayingId(null);\r\n      });\r\n      audio.play().catch((error) => {\r\n        setPlayingId(null);\r\n      });\r\n\r\n      setAudioElement(audio);\r\n      setPlayingId(sound.id);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-5 mt-1 h-full\">\r\n      <div className=\"flex items-center gap-3\">\r\n        <Input\r\n          placeholder=\"Search sound effects\"\r\n          className=\"bg-panel-accent w-full\"\r\n          containerClassName=\"w-full\"\r\n          value={searchQuery}\r\n          onChange={(e) => setSearchQuery(e.target.value)}\r\n          showClearIcon\r\n          onClear={() => setSearchQuery(\"\")}\r\n        />\r\n        <DropdownMenu>\r\n          <DropdownMenuTrigger asChild>\r\n            <Button\r\n              variant=\"text\"\r\n              size=\"icon\"\r\n              className={cn(showCommercialOnly && \"text-primary\")}\r\n            >\r\n              <ListFilter className=\"w-4 h-4\" />\r\n            </Button>\r\n          </DropdownMenuTrigger>\r\n          <DropdownMenuContent align=\"end\" className=\"w-56\">\r\n            <DropdownMenuCheckboxItem\r\n              checked={showCommercialOnly}\r\n              onCheckedChange={toggleCommercialFilter}\r\n            >\r\n              Show only commercially licensed\r\n            </DropdownMenuCheckboxItem>\r\n            <div className=\"px-2 py-1.5 text-xs text-muted-foreground\">\r\n              {showCommercialOnly\r\n                ? \"Only showing sounds licensed for commercial use\"\r\n                : \"Showing all sounds regardless of license\"}\r\n            </div>\r\n          </DropdownMenuContent>\r\n        </DropdownMenu>\r\n      </div>\r\n\r\n      <div className=\"relative h-full overflow-hidden\">\r\n        <ScrollArea\r\n          className=\"flex-1 h-full\"\r\n          ref={scrollAreaRef}\r\n          onScrollCapture={handleScroll}\r\n        >\r\n          <div className=\"flex flex-col gap-4\">\r\n            {isLoading && !searchQuery && (\r\n              <div className=\"text-muted-foreground text-sm\">\r\n                Loading sounds...\r\n              </div>\r\n            )}\r\n            {isSearching && searchQuery && (\r\n              <div className=\"text-muted-foreground text-sm\">Searching...</div>\r\n            )}\r\n            {displayedSounds.map((sound) => (\r\n              <AudioItem\r\n                key={sound.id}\r\n                sound={sound}\r\n                isPlaying={playingId === sound.id}\r\n                onPlay={() => playSound(sound)}\r\n                isSaved={isSoundSaved(sound.id)}\r\n                onToggleSaved={() => toggleSavedSound(sound)}\r\n              />\r\n            ))}\r\n            {!isLoading && !isSearching && displayedSounds.length === 0 && (\r\n              <div className=\"text-muted-foreground text-sm\">\r\n                {searchQuery ? \"No sounds found\" : \"No sounds available\"}\r\n              </div>\r\n            )}\r\n            {isLoadingMore && (\r\n              <div className=\"text-muted-foreground text-sm text-center py-4\">\r\n                Loading more sounds...\r\n              </div>\r\n            )}\r\n          </div>\r\n        </ScrollArea>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction SavedSoundsView() {\r\n  const {\r\n    savedSounds,\r\n    isLoadingSavedSounds,\r\n    savedSoundsError,\r\n    loadSavedSounds,\r\n    isSoundSaved,\r\n    toggleSavedSound,\r\n    clearSavedSounds,\r\n  } = useSoundsStore();\r\n\r\n  // Audio playback state\r\n  const [playingId, setPlayingId] = useState<number | null>(null);\r\n  const [audioElement, setAudioElement] = useState<HTMLAudioElement | null>(\r\n    null\r\n  );\r\n\r\n  // Clear confirmation dialog state\r\n  const [showClearDialog, setShowClearDialog] = useState(false);\r\n\r\n  // Load saved sounds when tab becomes active\r\n  useEffect(() => {\r\n    loadSavedSounds();\r\n  }, [loadSavedSounds]);\r\n\r\n  const playSound = (sound: SavedSound) => {\r\n    if (playingId === sound.id) {\r\n      audioElement?.pause();\r\n      setPlayingId(null);\r\n      return;\r\n    }\r\n\r\n    // Stop previous sound\r\n    audioElement?.pause();\r\n\r\n    if (sound.previewUrl) {\r\n      const audio = new Audio(sound.previewUrl);\r\n      audio.addEventListener(\"ended\", () => {\r\n        setPlayingId(null);\r\n      });\r\n      audio.addEventListener(\"error\", (e) => {\r\n        setPlayingId(null);\r\n      });\r\n      audio.play().catch((error) => {\r\n        setPlayingId(null);\r\n      });\r\n\r\n      setAudioElement(audio);\r\n      setPlayingId(sound.id);\r\n    }\r\n  };\r\n\r\n  // Convert SavedSound to SoundEffect for compatibility with AudioItem\r\n  const convertToSoundEffect = (savedSound: SavedSound): SoundEffect => ({\r\n    id: savedSound.id,\r\n    name: savedSound.name,\r\n    description: \"\",\r\n    url: \"\",\r\n    previewUrl: savedSound.previewUrl,\r\n    downloadUrl: savedSound.downloadUrl,\r\n    duration: savedSound.duration,\r\n    filesize: 0,\r\n    type: \"audio\",\r\n    channels: 0,\r\n    bitrate: 0,\r\n    bitdepth: 0,\r\n    samplerate: 0,\r\n    username: savedSound.username,\r\n    tags: savedSound.tags,\r\n    license: savedSound.license,\r\n    created: savedSound.savedAt,\r\n    downloads: 0,\r\n    rating: 0,\r\n    ratingCount: 0,\r\n  });\r\n\r\n  if (isLoadingSavedSounds) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-full\">\r\n        <div className=\"text-muted-foreground text-sm\">\r\n          Loading saved sounds...\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (savedSoundsError) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-full\">\r\n        <div className=\"text-destructive text-sm\">\r\n          Error: {savedSoundsError}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (savedSounds.length === 0) {\r\n    return (\r\n      <div className=\"bg-panel h-full p-4 flex flex-col items-center justify-center gap-3\">\r\n        <HeartIcon\r\n          className=\"w-10 h-10 text-muted-foreground\"\r\n          strokeWidth={1.5}\r\n        />\r\n        <div className=\"flex flex-col gap-2 text-center\">\r\n          <p className=\"text-lg font-medium\">No saved sounds</p>\r\n          <p className=\"text-sm text-muted-foreground text-balance\">\r\n            Click the heart icon on any sound to save it here\r\n          </p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-5 mt-1 h-full\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <p className=\"text-sm text-muted-foreground\">\r\n          {savedSounds.length} saved{\" \"}\r\n          {savedSounds.length === 1 ? \"sound\" : \"sounds\"}\r\n        </p>\r\n        <Dialog open={showClearDialog} onOpenChange={setShowClearDialog}>\r\n          <DialogTrigger asChild>\r\n            <Button\r\n              variant=\"text\"\r\n              size=\"sm\"\r\n              className=\"h-auto text-muted-foreground hover:text-destructive !opacity-100\"\r\n            >\r\n              Clear all\r\n            </Button>\r\n          </DialogTrigger>\r\n          <DialogContent>\r\n            <DialogHeader>\r\n              <DialogTitle>Clear all saved sounds?</DialogTitle>\r\n              <DialogDescription>\r\n                This will permanently remove all {savedSounds.length} saved\r\n                sounds from your collection. This action cannot be undone.\r\n              </DialogDescription>\r\n            </DialogHeader>\r\n            <DialogFooter>\r\n              <Button variant=\"text\" onClick={() => setShowClearDialog(false)}>\r\n                Cancel\r\n              </Button>\r\n              <Button\r\n                variant=\"destructive\"\r\n                onClick={async () => {\r\n                  await clearSavedSounds();\r\n                  setShowClearDialog(false);\r\n                }}\r\n              >\r\n                Clear all sounds\r\n              </Button>\r\n            </DialogFooter>\r\n          </DialogContent>\r\n        </Dialog>\r\n      </div>\r\n\r\n      <div className=\"relative h-full overflow-hidden\">\r\n        <ScrollArea className=\"flex-1 h-full\">\r\n          <div className=\"flex flex-col gap-4\">\r\n            {savedSounds.map((sound) => (\r\n              <AudioItem\r\n                key={sound.id}\r\n                sound={convertToSoundEffect(sound)}\r\n                isPlaying={playingId === sound.id}\r\n                onPlay={() => playSound(sound)}\r\n                isSaved={isSoundSaved(sound.id)}\r\n                onToggleSaved={() =>\r\n                  toggleSavedSound(convertToSoundEffect(sound))\r\n                }\r\n              />\r\n            ))}\r\n          </div>\r\n        </ScrollArea>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction SongsView() {\r\n  return <div>Songs</div>;\r\n}\r\n\r\ninterface AudioItemProps {\r\n  sound: SoundEffect;\r\n  isPlaying: boolean;\r\n  onPlay: () => void;\r\n  isSaved: boolean;\r\n  onToggleSaved: () => void;\r\n}\r\n\r\nfunction AudioItem({\r\n  sound,\r\n  isPlaying,\r\n  onPlay,\r\n  isSaved,\r\n  onToggleSaved,\r\n}: AudioItemProps) {\r\n  const { addSoundToTimeline } = useSoundsStore();\r\n\r\n  const handleClick = () => {\r\n    onPlay();\r\n  };\r\n\r\n  const handleSaveClick = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    onToggleSaved();\r\n  };\r\n\r\n  const handleAddToTimeline = async (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    await addSoundToTimeline(sound);\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className=\"group flex items-center gap-3 opacity-100 hover:opacity-75 transition-opacity cursor-pointer\"\r\n      onClick={handleClick}\r\n    >\r\n      <div className=\"relative w-12 h-12 bg-accent rounded-md flex items-center justify-center overflow-hidden shrink-0\">\r\n        <div className=\"absolute inset-0 bg-gradient-to-br from-primary/20 to-transparent\" />\r\n        {isPlaying ? (\r\n          <PauseIcon className=\"w-5 h-5\" />\r\n        ) : (\r\n          <PlayIcon className=\"w-5 h-5\" />\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"flex-1 min-w-0 overflow-hidden\">\r\n        <p className=\"font-medium truncate text-sm\">{sound.name}</p>\r\n        <span className=\"text-xs text-muted-foreground truncate block\">\r\n          {sound.username}\r\n        </span>\r\n      </div>\r\n\r\n      <div className=\"flex items-center gap-3 pr-2\">\r\n        <Button\r\n          variant=\"text\"\r\n          size=\"icon\"\r\n          className=\"text-muted-foreground hover:text-foreground !opacity-100 w-auto\"\r\n          onClick={handleAddToTimeline}\r\n          title=\"Add to timeline\"\r\n        >\r\n          <PlusIcon className=\"w-4 h-4\" />\r\n        </Button>\r\n        <Button\r\n          variant=\"text\"\r\n          size=\"icon\"\r\n          className={`hover:text-foreground !opacity-100 w-auto ${\r\n            isSaved\r\n              ? \"text-red-500 hover:text-red-600\"\r\n              : \"text-muted-foreground\"\r\n          }`}\r\n          onClick={handleSaveClick}\r\n          title={isSaved ? \"Remove from saved\" : \"Save sound\"}\r\n        >\r\n          <HeartIcon className={`w-4 h-4 ${isSaved ? \"fill-current\" : \"\"}`} />\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { useEditorStore } from \"@/stores/editor-store\";\r\nimport { useMediaStore, getMediaAspectRatio } from \"@/stores/media-store\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\n\r\nexport function useAspectRatio() {\r\n  const { canvasSize, canvasMode, canvasPresets } = useEditorStore();\r\n  const { mediaItems } = useMediaStore();\r\n  const { tracks } = useTimelineStore();\r\n\r\n  // Find the current preset based on canvas size\r\n  const currentPreset = canvasPresets.find(\r\n    (preset) =>\r\n      preset.width === canvasSize.width && preset.height === canvasSize.height\r\n  );\r\n\r\n  // Get the original aspect ratio from the first video/image in timeline\r\n  const getOriginalAspectRatio = (): number => {\r\n    // Find first video or image in timeline\r\n    for (const track of tracks) {\r\n      for (const element of track.elements) {\r\n        if (element.type === \"media\") {\r\n          const mediaItem = mediaItems.find(\r\n            (item) => item.id === element.mediaId\r\n          );\r\n          if (\r\n            mediaItem &&\r\n            (mediaItem.type === \"video\" || mediaItem.type === \"image\")\r\n          ) {\r\n            return getMediaAspectRatio(mediaItem);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return 16 / 9; // Default aspect ratio\r\n  };\r\n\r\n  // Get current aspect ratio\r\n  const getCurrentAspectRatio = (): number => {\r\n    return canvasSize.width / canvasSize.height;\r\n  };\r\n\r\n  // Format aspect ratio as a readable string\r\n  const formatAspectRatio = (aspectRatio: number): string => {\r\n    // Check if it matches a common aspect ratio\r\n    const ratios = [\r\n      { ratio: 16 / 9, label: \"16:9\" },\r\n      { ratio: 9 / 16, label: \"9:16\" },\r\n      { ratio: 1, label: \"1:1\" },\r\n      { ratio: 4 / 3, label: \"4:3\" },\r\n      { ratio: 3 / 4, label: \"3:4\" },\r\n      { ratio: 21 / 9, label: \"21:9\" },\r\n    ];\r\n\r\n    for (const { ratio, label } of ratios) {\r\n      if (Math.abs(aspectRatio - ratio) < 0.01) {\r\n        return label;\r\n      }\r\n    }\r\n\r\n    // If not a common ratio, format as decimal\r\n    return aspectRatio.toFixed(2);\r\n  };\r\n\r\n  // Check if current mode is \"Original\"\r\n  const isOriginal = canvasMode === \"original\";\r\n\r\n  // Get display name for current aspect ratio\r\n  const getDisplayName = (): string => {\r\n    // If explicitly set to original mode, always show \"Original\"\r\n    if (canvasMode === \"original\") {\r\n      return \"Original\";\r\n    }\r\n\r\n    if (currentPreset) {\r\n      return currentPreset.name;\r\n    }\r\n\r\n    return formatAspectRatio(getCurrentAspectRatio());\r\n  };\r\n\r\n  return {\r\n    currentPreset,\r\n    canvasMode,\r\n    isOriginal,\r\n    getCurrentAspectRatio,\r\n    getOriginalAspectRatio,\r\n    formatAspectRatio,\r\n    getDisplayName,\r\n    canvasSize,\r\n    canvasPresets,\r\n  };\r\n}\r\n","export const colors = [\r\n  \"#ffffff\",\r\n  \"#000000\",\r\n  \"#ffe2e2\",\r\n  \"#ffc9c9\",\r\n  \"#ffa2a2\",\r\n  \"#ff6467\",\r\n  \"#fb2c36\",\r\n  \"#e7000b\",\r\n  \"#c10007\",\r\n  \"#9f0712\",\r\n  \"#82181a\",\r\n  \"#460809\",\r\n  \"#fff7ed\",\r\n  \"#ffedd4\",\r\n  \"#ffd6a7\",\r\n  \"#ffb86a\",\r\n  \"#ff8904\",\r\n  \"#ff6900\",\r\n  \"#f54900\",\r\n  \"#ca3500\",\r\n  \"#9f2d00\",\r\n  \"#7e2a0c\",\r\n  \"#441306\",\r\n  \"#fffbeb\",\r\n  \"#fef3c6\",\r\n  \"#fee685\",\r\n  \"#ffd230\",\r\n  \"#ffb900\",\r\n  \"#fe9a00\",\r\n  \"#e17100\",\r\n  \"#bb4d00\",\r\n  \"#973c00\",\r\n  \"#7b3306\",\r\n  \"#461901\",\r\n  \"#fefce8\",\r\n  \"#fef9c2\",\r\n  \"#fff085\",\r\n  \"#ffdf20\",\r\n  \"#fdc700\",\r\n  \"#f0b100\",\r\n  \"#d08700\",\r\n  \"#a65f00\",\r\n  \"#894b00\",\r\n  \"#733e0a\",\r\n  \"#432004\",\r\n  \"#f7fee7\",\r\n  \"#ecfcca\",\r\n  \"#d8f999\",\r\n  \"#bbf451\",\r\n  \"#9ae600\",\r\n  \"#7ccf00\",\r\n  \"#5ea500\",\r\n  \"#497d00\",\r\n  \"#3c6300\",\r\n  \"#35530e\",\r\n  \"#192e03\",\r\n  \"#f0fdf4\",\r\n  \"#dcfce7\",\r\n  \"#b9f8cf\",\r\n  \"#7bf1a8\",\r\n  \"#05df72\",\r\n  \"#00c950\",\r\n  \"#00a63e\",\r\n  \"#008236\",\r\n  \"#016630\",\r\n  \"#0d542b\",\r\n  \"#032e15\",\r\n  \"#ecfdf5\",\r\n  \"#d0fae5\",\r\n  \"#a4f4cf\",\r\n  \"#5ee9b5\",\r\n  \"#00d492\",\r\n  \"#00bc7d\",\r\n  \"#009966\",\r\n  \"#007a55\",\r\n  \"#006045\",\r\n  \"#004f3b\",\r\n  \"#002c22\",\r\n  \"#f0fdfa\",\r\n  \"#cbfbf1\",\r\n  \"#96f7e4\",\r\n  \"#46ecd5\",\r\n  \"#00d5be\",\r\n  \"#00bba7\",\r\n  \"#009689\",\r\n  \"#00786f\",\r\n  \"#005f5a\",\r\n  \"#0b4f4a\",\r\n  \"#022f2e\",\r\n  \"#ecfeff\",\r\n  \"#cefafe\",\r\n  \"#a2f4fd\",\r\n  \"#53eafd\",\r\n  \"#00d3f2\",\r\n  \"#00b8db\",\r\n  \"#0092b8\",\r\n  \"#007595\",\r\n  \"#005f78\",\r\n  \"#104e64\",\r\n  \"#053345\",\r\n  \"#f0f9ff\",\r\n  \"#dff2fe\",\r\n  \"#b8e6fe\",\r\n  \"#74d4ff\",\r\n  \"#00bcff\",\r\n  \"#00a6f4\",\r\n  \"#0084d1\",\r\n  \"#0069a8\",\r\n  \"#00598a\",\r\n  \"#024a70\",\r\n  \"#052f4a\",\r\n  \"#eff6ff\",\r\n  \"#dbeafe\",\r\n  \"#bedbff\",\r\n  \"#8ec5ff\",\r\n  \"#51a2ff\",\r\n  \"#2b7fff\",\r\n  \"#155dfc\",\r\n  \"#1447e6\",\r\n  \"#193cb8\",\r\n  \"#1c398e\",\r\n  \"#162456\",\r\n  \"#eef2ff\",\r\n  \"#e0e7ff\",\r\n  \"#c6d2ff\",\r\n  \"#a3b3ff\",\r\n  \"#7c86ff\",\r\n  \"#615fff\",\r\n  \"#4f39f6\",\r\n  \"#432dd7\",\r\n  \"#372aac\",\r\n  \"#312c85\",\r\n  \"#1e1a4d\",\r\n  \"#f5f3ff\",\r\n  \"#ede9fe\",\r\n  \"#ddd6ff\",\r\n  \"#c4b4ff\",\r\n  \"#a684ff\",\r\n  \"#8e51ff\",\r\n  \"#7f22fe\",\r\n  \"#7008e7\",\r\n  \"#5d0ec0\",\r\n  \"#4d179a\",\r\n  \"#2f0d68\",\r\n  \"#faf5ff\",\r\n  \"#f3e8ff\",\r\n  \"#e9d4ff\",\r\n  \"#dab2ff\",\r\n  \"#c27aff\",\r\n  \"#ad46ff\",\r\n  \"#9810fa\",\r\n  \"#8200db\",\r\n  \"#6e11b0\",\r\n  \"#59168b\",\r\n  \"#3c0366\",\r\n  \"#fdf4ff\",\r\n  \"#fae8ff\",\r\n  \"#f6cfff\",\r\n  \"#f4a8ff\",\r\n  \"#ed6aff\",\r\n  \"#e12afb\",\r\n  \"#c800de\",\r\n  \"#a800b7\",\r\n  \"#8a0194\",\r\n  \"#721378\",\r\n  \"#4b004f\",\r\n  \"#fdf2f8\",\r\n  \"#fce7f3\",\r\n  \"#fccee8\",\r\n  \"#fda5d5\",\r\n  \"#fb64b6\",\r\n  \"#f6339a\",\r\n  \"#e60076\",\r\n  \"#c6005c\",\r\n  \"#a3004c\",\r\n  \"#861043\",\r\n  \"#510424\",\r\n  \"#fff1f2\",\r\n  \"#ffe4e6\",\r\n  \"#ffccd3\",\r\n  \"#ffa1ad\",\r\n  \"#ff637e\",\r\n  \"#ff2056\",\r\n  \"#ec003f\",\r\n  \"#c70036\",\r\n  \"#a50036\",\r\n  \"#8b0836\",\r\n  \"#4d0218\",\r\n  \"#f8fafc\",\r\n  \"#f1f5f9\",\r\n  \"#e2e8f0\",\r\n  \"#cad5e2\",\r\n  \"#90a1b9\",\r\n  \"#62748e\",\r\n  \"#45556c\",\r\n  \"#314158\",\r\n  \"#1d293d\",\r\n  \"#0f172b\",\r\n  \"#020618\",\r\n  \"#f9fafb\",\r\n  \"#f3f4f6\",\r\n  \"#e5e7eb\",\r\n  \"#d1d5dc\",\r\n  \"#99a1af\",\r\n  \"#6a7282\",\r\n  \"#4a5565\",\r\n  \"#364153\",\r\n  \"#1e2939\",\r\n  \"#101828\",\r\n  \"#030712\",\r\n  \"#fafafa\",\r\n  \"#f4f4f5\",\r\n  \"#e4e4e7\",\r\n  \"#d4d4d8\",\r\n  \"#9f9fa9\",\r\n  \"#71717b\",\r\n  \"#52525c\",\r\n  \"#3f3f46\",\r\n  \"#27272a\",\r\n  \"#18181b\",\r\n  \"#09090b\",\r\n  \"#f5f5f5\",\r\n  \"#e5e5e5\",\r\n  \"#d4d4d4\",\r\n  \"#a1a1a1\",\r\n  \"#737373\",\r\n  \"#525252\",\r\n  \"#404040\",\r\n  \"#262626\",\r\n  \"#171717\",\r\n  \"#0a0a0a\",\r\n  \"#fafaf9\",\r\n  \"#f5f5f4\",\r\n  \"#e7e5e4\",\r\n  \"#d6d3d1\",\r\n  \"#a6a09b\",\r\n  \"#79716b\",\r\n  \"#57534d\",\r\n  \"#44403b\",\r\n  \"#292524\",\r\n  \"#1c1917\",\r\n  \"#0c0a09\",\r\n];\r\n","// These are the gradients from Pattern Craft (https://patterncraft.fun/)\r\n\r\nexport const patternCraftGradients = [\r\n  // Dreamy Sky Pink Glow\r\n  \"radial-gradient(circle at 30% 70%, rgba(173, 216, 230, 0.35), transparent 60%), radial-gradient(circle at 70% 30%, rgba(255, 182, 193, 0.4), transparent 60%)\",\r\n\r\n  // Soft Warm Pastel Texture\r\n  \"radial-gradient(circle at 20% 80%, rgba(255, 182, 153, 0.3) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(255, 244, 214, 0.5) 0%, transparent 50%), radial-gradient(circle at 40% 40%, rgba(255, 182, 153, 0.1) 0%, transparent 50%), #fff8f0\",\r\n\r\n  // Warm Soft Coral & Cream\r\n  \"radial-gradient(circle at 20% 80%, rgba(255, 160, 146, 0.25) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(255, 244, 228, 0.3) 0%, transparent 50%), radial-gradient(circle at 40% 40%, rgba(255, 160, 146, 0.15) 0%, transparent 50%), #fef9f7\",\r\n\r\n  // Soft Green Glow\r\n  \"radial-gradient(circle at center, #8FFFB0, transparent), white\",\r\n\r\n  // Purple Glow Right\r\n  \"radial-gradient(circle at top right, rgba(173, 109, 244, 0.5), transparent 70%)\",\r\n\r\n  // Teal Glow Right\r\n  \"radial-gradient(circle at top right, rgba(56, 193, 182, 0.5), transparent 70%)\",\r\n\r\n  // Warm Orange Glow Right\r\n  \"radial-gradient(circle at top right, rgba(255, 140, 60, 0.5), transparent 70%)\",\r\n\r\n  // Cool Blue Glow Right\r\n  \"radial-gradient(circle at top right, rgba(70, 130, 180, 0.5), transparent 70%)\",\r\n\r\n  // Purple Glow Left\r\n  \"radial-gradient(circle at top left, rgba(173, 109, 244, 0.5), transparent 70%)\",\r\n];\r\n","// These are the gradients from Syntax UI (https://syntaxui.com/effects/gradients)\r\n\r\nexport const syntaxUIGradients = [\r\n  // Cyan to Blue gradients\r\n  \"linear-gradient(to right, #22d3ee, #0ea5e9, #0284c7)\",\r\n  \"linear-gradient(to right, #bfdbfe, #a5f3fc)\",\r\n  \"linear-gradient(to right, #22d3ee, #0ea5e9, #0284c7)\",\r\n\r\n  // Purple gradients\r\n  \"linear-gradient(to right, #e9d5ff, #d8b4fe, #c084fc)\",\r\n  \"linear-gradient(to right, #c4b5fd, #a78bfa, #8b5cf6)\",\r\n\r\n  // Blue gradients\r\n  \"linear-gradient(to right, #93c5fd, #60a5fa, #3b82f6)\",\r\n  \"linear-gradient(to right, #93c5fd, #60a5fa, #3b82f6)\",\r\n\r\n  // Green gradients\r\n  \"linear-gradient(to right, #6ee7b7, #34d399, #10b981)\",\r\n  \"linear-gradient(to right, #d1fae5, #a7f3d0, #6ee7b7)\",\r\n\r\n  // Red gradient\r\n  \"linear-gradient(to right, #fca5a5, #f87171, #ef4444)\",\r\n\r\n  // Yellow/Orange gradient\r\n  \"linear-gradient(to right, #fde68a, #fbbf24, #f59e0b)\",\r\n\r\n  // Pink gradient\r\n  \"linear-gradient(to right, #fbcfe8, #f9a8d4, #f472b6)\",\r\n\r\n  // Neon radial gradient\r\n  \"radial-gradient(circle at bottom left, #ff00ff, #00ffff)\",\r\n];\r\n","\"use client\";\r\n\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport {\r\n  PropertyItem,\r\n  PropertyItemLabel,\r\n  PropertyItemValue,\r\n  PropertyGroup,\r\n} from \"../../properties-panel/property-item\";\r\nimport { FPS_PRESETS } from \"@/constants/timeline-constants\";\r\nimport { useProjectStore } from \"@/stores/project-store\";\r\nimport { useEditorStore } from \"@/stores/editor-store\";\r\nimport { useAspectRatio } from \"@/hooks/use-aspect-ratio\";\r\nimport Image from \"next/image\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { colors } from \"@/data/colors/solid\";\r\nimport { patternCraftGradients } from \"@/data/colors/pattern-craft\";\r\nimport { PipetteIcon } from \"lucide-react\";\r\nimport { useMemo, memo, useCallback } from \"react\";\r\nimport { syntaxUIGradients } from \"@/data/colors/syntax-ui\";\r\n\r\nexport function SettingsView() {\r\n  return <ProjectSettingsTabs />;\r\n}\r\n\r\nfunction ProjectSettingsTabs() {\r\n  return (\r\n    <div className=\"h-full flex flex-col\">\r\n      <Tabs defaultValue=\"project-info\" className=\"flex flex-col h-full\">\r\n        <div className=\"px-3 pt-4 pb-0\">\r\n          <TabsList>\r\n            <TabsTrigger value=\"project-info\">Project info</TabsTrigger>\r\n            <TabsTrigger value=\"background\">Background</TabsTrigger>\r\n          </TabsList>\r\n        </div>\r\n        <Separator className=\"my-4\" />\r\n        <ScrollArea className=\"flex-1\">\r\n          <TabsContent value=\"project-info\" className=\"p-5 pt-0 mt-0\">\r\n            <ProjectInfoView />\r\n          </TabsContent>\r\n          <TabsContent value=\"background\" className=\"p-4 pt-0\">\r\n            <BackgroundView />\r\n          </TabsContent>\r\n        </ScrollArea>\r\n      </Tabs>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ProjectInfoView() {\r\n  const { activeProject, updateProjectFps } = useProjectStore();\r\n  const { canvasPresets, setCanvasSize } = useEditorStore();\r\n  const { getDisplayName } = useAspectRatio();\r\n\r\n  const handleAspectRatioChange = (value: string) => {\r\n    const preset = canvasPresets.find((p) => p.name === value);\r\n    if (preset) {\r\n      setCanvasSize({ width: preset.width, height: preset.height });\r\n    }\r\n  };\r\n\r\n  const handleFpsChange = (value: string) => {\r\n    const fps = parseFloat(value);\r\n    updateProjectFps(fps);\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-4\">\r\n      <PropertyItem direction=\"column\">\r\n        <PropertyItemLabel>Name</PropertyItemLabel>\r\n        <PropertyItemValue>\r\n          {activeProject?.name || \"Untitled project\"}\r\n        </PropertyItemValue>\r\n      </PropertyItem>\r\n\r\n      <PropertyItem direction=\"column\">\r\n        <PropertyItemLabel>Aspect ratio</PropertyItemLabel>\r\n        <PropertyItemValue>\r\n          <Select\r\n            value={getDisplayName()}\r\n            onValueChange={handleAspectRatioChange}\r\n          >\r\n            <SelectTrigger className=\"bg-panel-accent\">\r\n              <SelectValue placeholder=\"Select an aspect ratio\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              {canvasPresets.map((preset) => (\r\n                <SelectItem key={preset.name} value={preset.name}>\r\n                  {preset.name}\r\n                </SelectItem>\r\n              ))}\r\n            </SelectContent>\r\n          </Select>\r\n        </PropertyItemValue>\r\n      </PropertyItem>\r\n\r\n      <PropertyItem direction=\"column\">\r\n        <PropertyItemLabel>Frame rate</PropertyItemLabel>\r\n        <PropertyItemValue>\r\n          <Select\r\n            value={(activeProject?.fps || 30).toString()}\r\n            onValueChange={handleFpsChange}\r\n          >\r\n            <SelectTrigger className=\"bg-panel-accent\">\r\n              <SelectValue placeholder=\"Select a frame rate\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              {FPS_PRESETS.map((preset) => (\r\n                <SelectItem key={preset.value} value={preset.value}>\r\n                  {preset.label}\r\n                </SelectItem>\r\n              ))}\r\n            </SelectContent>\r\n          </Select>\r\n        </PropertyItemValue>\r\n      </PropertyItem>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst BlurPreview = memo(\r\n  ({\r\n    blur,\r\n    isSelected,\r\n    onSelect,\r\n  }: {\r\n    blur: { label: string; value: number };\r\n    isSelected: boolean;\r\n    onSelect: () => void;\r\n  }) => (\r\n    <div\r\n      className={cn(\r\n        \"w-full aspect-square rounded-sm cursor-pointer border border-foreground/15 hover:border-primary relative overflow-hidden\",\r\n        isSelected && \"border-2 border-primary\"\r\n      )}\r\n      onClick={onSelect}\r\n    >\r\n      <Image\r\n        src=\"https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=1470&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D\"\r\n        alt={`Blur preview ${blur.label}`}\r\n        fill\r\n        className=\"object-cover\"\r\n        style={{ filter: `blur(${blur.value}px)` }}\r\n        loading=\"eager\"\r\n      />\r\n      <div className=\"absolute bottom-1 left-1 right-1 text-center\">\r\n        <span className=\"text-xs text-white bg-black/50 px-1 rounded\">\r\n          {blur.label}\r\n        </span>\r\n      </div>\r\n    </div>\r\n  )\r\n);\r\n\r\nBlurPreview.displayName = \"BlurPreview\";\r\n\r\nconst BackgroundPreviews = memo(\r\n  ({\r\n    backgrounds,\r\n    currentBackgroundColor,\r\n    isColorBackground,\r\n    handleColorSelect,\r\n    useBackgroundColor = false,\r\n  }: {\r\n    backgrounds: string[];\r\n    currentBackgroundColor: string;\r\n    isColorBackground: boolean;\r\n    handleColorSelect: (bg: string) => void;\r\n    useBackgroundColor?: boolean;\r\n  }) => {\r\n    return useMemo(\r\n      () =>\r\n        backgrounds.map((bg) => (\r\n          <div\r\n            key={bg}\r\n            className={cn(\r\n              \"w-full aspect-square rounded-sm cursor-pointer border border-foreground/15 hover:border-primary\",\r\n              isColorBackground &&\r\n                bg === currentBackgroundColor &&\r\n                \"border-2 border-primary\"\r\n            )}\r\n            style={\r\n              useBackgroundColor\r\n                ? { backgroundColor: bg }\r\n                : {\r\n                    background: bg,\r\n                    backgroundSize: \"cover\",\r\n                    backgroundPosition: \"center\",\r\n                    backgroundRepeat: \"no-repeat\",\r\n                  }\r\n            }\r\n            onClick={() => handleColorSelect(bg)}\r\n          />\r\n        )),\r\n      [\r\n        backgrounds,\r\n        isColorBackground,\r\n        currentBackgroundColor,\r\n        handleColorSelect,\r\n        useBackgroundColor,\r\n      ]\r\n    );\r\n  }\r\n);\r\n\r\nBackgroundPreviews.displayName = \"BackgroundPreviews\";\r\n\r\nfunction BackgroundView() {\r\n  const { activeProject, updateBackgroundType } = useProjectStore();\r\n\r\n  const blurLevels = useMemo(\r\n    () => [\r\n      { label: \"Light\", value: 4 },\r\n      { label: \"Medium\", value: 8 },\r\n      { label: \"Heavy\", value: 18 },\r\n    ],\r\n    []\r\n  );\r\n\r\n  const handleBlurSelect = useCallback(\r\n    async (blurIntensity: number) => {\r\n      await updateBackgroundType(\"blur\", { blurIntensity });\r\n    },\r\n    [updateBackgroundType]\r\n  );\r\n\r\n  const handleColorSelect = useCallback(\r\n    async (color: string) => {\r\n      await updateBackgroundType(\"color\", { backgroundColor: color });\r\n    },\r\n    [updateBackgroundType]\r\n  );\r\n\r\n  const currentBlurIntensity = activeProject?.blurIntensity || 8;\r\n  const isBlurBackground = activeProject?.backgroundType === \"blur\";\r\n  const currentBackgroundColor = activeProject?.backgroundColor || \"#000000\";\r\n  const isColorBackground = activeProject?.backgroundType === \"color\";\r\n\r\n  const blurPreviews = useMemo(\r\n    () =>\r\n      blurLevels.map((blur) => (\r\n        <BlurPreview\r\n          key={blur.value}\r\n          blur={blur}\r\n          isSelected={isBlurBackground && currentBlurIntensity === blur.value}\r\n          onSelect={() => handleBlurSelect(blur.value)}\r\n        />\r\n      )),\r\n    [blurLevels, isBlurBackground, currentBlurIntensity, handleBlurSelect]\r\n  );\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-5\">\r\n      <PropertyGroup title=\"Blur\" defaultExpanded={false}>\r\n        <div className=\"grid grid-cols-4 gap-2 w-full\">{blurPreviews}</div>\r\n      </PropertyGroup>\r\n\r\n      <PropertyGroup title=\"Colors\" defaultExpanded={false}>\r\n        <div className=\"grid grid-cols-4 gap-2 w-full\">\r\n          <div className=\"w-full aspect-square rounded-sm cursor-pointer border border-foreground/15 hover:border-primary flex items-center justify-center\">\r\n            <PipetteIcon className=\"size-4\" />\r\n          </div>\r\n          <BackgroundPreviews\r\n            backgrounds={colors}\r\n            currentBackgroundColor={currentBackgroundColor}\r\n            isColorBackground={isColorBackground}\r\n            handleColorSelect={handleColorSelect}\r\n            useBackgroundColor={true}\r\n          />\r\n        </div>\r\n      </PropertyGroup>\r\n\r\n      <PropertyGroup title=\"Pattern Craft\" defaultExpanded={false}>\r\n        <div className=\"grid grid-cols-4 gap-2 w-full\">\r\n          <BackgroundPreviews\r\n            backgrounds={patternCraftGradients}\r\n            currentBackgroundColor={currentBackgroundColor}\r\n            isColorBackground={isColorBackground}\r\n            handleColorSelect={handleColorSelect}\r\n          />\r\n        </div>\r\n      </PropertyGroup>\r\n\r\n      <PropertyGroup title=\"Syntax UI\" defaultExpanded={false}>\r\n        <div className=\"grid grid-cols-4 gap-2 w-full\">\r\n          <BackgroundPreviews\r\n            backgrounds={syntaxUIGradients}\r\n            currentBackgroundColor={currentBackgroundColor}\r\n            isColorBackground={isColorBackground}\r\n            handleColorSelect={handleColorSelect}\r\n          />\r\n        </div>\r\n      </PropertyGroup>\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { TabBar } from \"./tabbar\";\r\nimport { MediaView } from \"./views/media\";\r\nimport { useMediaPanelStore, Tab } from \"./store\";\r\nimport { TextView } from \"./views/text\";\r\nimport { SoundsView } from \"./views/sounds\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { SettingsView } from \"./views/settings\";\r\n\r\nexport function MediaPanel() {\r\n  const { activeTab } = useMediaPanelStore();\r\n\r\n  const viewMap: Record<Tab, React.ReactNode> = {\r\n    media: <MediaView />,\r\n    sounds: <SoundsView />,\r\n    text: <TextView />,\r\n    stickers: (\r\n      <div className=\"p-4 text-muted-foreground\">\r\n        Stickers view coming soon...\r\n      </div>\r\n    ),\r\n    effects: (\r\n      <div className=\"p-4 text-muted-foreground\">\r\n        Effects view coming soon...\r\n      </div>\r\n    ),\r\n    transitions: (\r\n      <div className=\"p-4 text-muted-foreground\">\r\n        Transitions view coming soon...\r\n      </div>\r\n    ),\r\n    captions: (\r\n      <div className=\"p-4 text-muted-foreground\">\r\n        Captions view coming soon...\r\n      </div>\r\n    ),\r\n    filters: (\r\n      <div className=\"p-4 text-muted-foreground\">\r\n        Filters view coming soon...\r\n      </div>\r\n    ),\r\n    adjustment: (\r\n      <div className=\"p-4 text-muted-foreground\">\r\n        Adjustment view coming soon...\r\n      </div>\r\n    ),\r\n    settings: <SettingsView />,\r\n  };\r\n\r\n  return (\r\n    <div className=\"h-full flex bg-panel\">\r\n      <TabBar />\r\n      <Separator orientation=\"vertical\" />\r\n      <div className=\"flex-1 overflow-hidden\">{viewMap[activeTab]}</div>\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { ContextMenu as ContextMenuPrimitive } from \"radix-ui\";\r\nimport { Check, ChevronRight, Circle } from \"lucide-react\";\r\nimport { cva, type VariantProps } from \"class-variance-authority\";\r\n\r\nimport { cn } from \"../../lib/utils\";\r\n\r\nconst ContextMenu = ContextMenuPrimitive.Root;\r\n\r\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger;\r\n\r\nconst ContextMenuGroup = ContextMenuPrimitive.Group;\r\n\r\nconst ContextMenuPortal = ContextMenuPrimitive.Portal;\r\n\r\nconst ContextMenuSub = ContextMenuPrimitive.Sub;\r\n\r\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup;\r\n\r\nconst contextMenuItemVariants = cva(\r\n  \"relative flex cursor-pointer select-none items-center gap-2 px-2 py-1.5 text-sm outline-hidden transition-opacity data-disabled:pointer-events-none data-disabled:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"focus:opacity-65 focus:text-accent-foreground\",\r\n        destructive: \"text-destructive focus:text-destructive/80\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n    },\r\n  }\r\n);\r\n\r\nconst ContextMenuSubTrigger = React.forwardRef<\r\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\r\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\r\n    inset?: boolean;\r\n    variant?: VariantProps<typeof contextMenuItemVariants>[\"variant\"];\r\n  }\r\n>(({ className, inset, children, variant = \"default\", ...props }, ref) => (\r\n  <ContextMenuPrimitive.SubTrigger\r\n    ref={ref}\r\n    className={cn(\r\n      contextMenuItemVariants({ variant }),\r\n      \"data-[state=open]:bg-accent data-[state=open]:opacity-65\",\r\n      inset && \"pl-8\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    {children}\r\n    <ChevronRight className=\"ml-auto\" />\r\n  </ContextMenuPrimitive.SubTrigger>\r\n));\r\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName;\r\n\r\nconst ContextMenuSubContent = React.forwardRef<\r\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\r\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\r\n>(({ className, ...props }, ref) => (\r\n  <ContextMenuPrimitive.SubContent\r\n    ref={ref}\r\n    className={cn(\r\n      \"z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName;\r\n\r\nconst ContextMenuContent = React.forwardRef<\r\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\r\n>(({ className, ...props }, ref) => (\r\n  <ContextMenuPrimitive.Portal>\r\n    <ContextMenuPrimitive.Content\r\n      ref={ref}\r\n      className={cn(\r\n        \"z-50 min-w-32 overflow-hidden rounded-md border p-1 bg-popover text-popover-foreground shadow-md\",\r\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  </ContextMenuPrimitive.Portal>\r\n));\r\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName;\r\n\r\nconst ContextMenuItem = React.forwardRef<\r\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\r\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\r\n    inset?: boolean;\r\n    variant?: VariantProps<typeof contextMenuItemVariants>[\"variant\"];\r\n  }\r\n>(({ className, inset, variant = \"default\", ...props }, ref) => (\r\n  <ContextMenuPrimitive.Item\r\n    ref={ref}\r\n    className={cn(\r\n      contextMenuItemVariants({ variant }),\r\n      inset && \"pl-8\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName;\r\n\r\nconst ContextMenuCheckboxItem = React.forwardRef<\r\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\r\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem> & {\r\n    variant?: VariantProps<typeof contextMenuItemVariants>[\"variant\"];\r\n  }\r\n>(({ className, children, checked, variant = \"default\", ...props }, ref) => (\r\n  <ContextMenuPrimitive.CheckboxItem\r\n    ref={ref}\r\n    className={cn(contextMenuItemVariants({ variant }), \"pl-8 pr-2\", className)}\r\n    checked={checked}\r\n    {...props}\r\n  >\r\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\r\n      <ContextMenuPrimitive.ItemIndicator>\r\n        <Check className=\"h-4 w-4\" />\r\n      </ContextMenuPrimitive.ItemIndicator>\r\n    </span>\r\n    {children}\r\n  </ContextMenuPrimitive.CheckboxItem>\r\n));\r\nContextMenuCheckboxItem.displayName =\r\n  ContextMenuPrimitive.CheckboxItem.displayName;\r\n\r\nconst ContextMenuRadioItem = React.forwardRef<\r\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\r\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem> & {\r\n    variant?: VariantProps<typeof contextMenuItemVariants>[\"variant\"];\r\n  }\r\n>(({ className, children, variant = \"default\", ...props }, ref) => (\r\n  <ContextMenuPrimitive.RadioItem\r\n    ref={ref}\r\n    className={cn(contextMenuItemVariants({ variant }), \"pl-8 pr-2\", className)}\r\n    {...props}\r\n  >\r\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\r\n      <ContextMenuPrimitive.ItemIndicator>\r\n        <Circle className=\"h-2 w-2 fill-current\" />\r\n      </ContextMenuPrimitive.ItemIndicator>\r\n    </span>\r\n    {children}\r\n  </ContextMenuPrimitive.RadioItem>\r\n));\r\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName;\r\n\r\nconst ContextMenuLabel = React.forwardRef<\r\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\r\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\r\n    inset?: boolean;\r\n  }\r\n>(({ className, inset, ...props }, ref) => (\r\n  <ContextMenuPrimitive.Label\r\n    ref={ref}\r\n    className={cn(\r\n      \"px-2 py-1.5 text-sm font-semibold\",\r\n      inset && \"pl-8\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName;\r\n\r\nconst ContextMenuSeparator = React.forwardRef<\r\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\r\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\r\n>(({ className, ...props }, ref) => (\r\n  <ContextMenuPrimitive.Separator\r\n    ref={ref}\r\n    className={cn(\"-mx-1 my-1 h-px bg-foreground/10\", className)}\r\n    {...props}\r\n  />\r\n));\r\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName;\r\n\r\nconst ContextMenuShortcut = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLSpanElement>) => {\r\n  return (\r\n    <span\r\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n};\r\nContextMenuShortcut.displayName = \"ContextMenuShortcut\";\r\n\r\nexport {\r\n  ContextMenu,\r\n  ContextMenuTrigger,\r\n  ContextMenuContent,\r\n  ContextMenuItem,\r\n  ContextMenuCheckboxItem,\r\n  ContextMenuRadioItem,\r\n  ContextMenuLabel,\r\n  ContextMenuSeparator,\r\n  ContextMenuShortcut,\r\n  ContextMenuGroup,\r\n  ContextMenuPortal,\r\n  ContextMenuSub,\r\n  ContextMenuSubContent,\r\n  ContextMenuSubTrigger,\r\n  ContextMenuRadioGroup,\r\n};\r\n","\"use client\";\r\n\r\nimport { Dialog, DialogContent, DialogTitle } from \"./ui/dialog\";\r\nimport { Button } from \"./ui/button\";\r\nimport { ArrowRightIcon } from \"lucide-react\";\r\nimport { useState, useEffect } from \"react\";\r\nimport ReactMarkdown from \"react-markdown\";\r\n\r\nexport function Onboarding() {\r\n  const [step, setStep] = useState(0);\r\n  const [isOpen, setIsOpen] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const hasSeenOnboarding = localStorage.getItem(\"hasSeenOnboarding\");\r\n    if (!hasSeenOnboarding) {\r\n      setIsOpen(true);\r\n    }\r\n  }, []);\r\n\r\n  const handleNext = () => {\r\n    setStep(step + 1);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setIsOpen(false);\r\n    localStorage.setItem(\"hasSeenOnboarding\", \"true\");\r\n  };\r\n\r\n  const getStepTitle = () => {\r\n    switch (step) {\r\n      case 0:\r\n        return \"Welcome to OpenCut Beta! 🎉\";\r\n      case 1:\r\n        return \"⚠️ This is a super early beta!\";\r\n      case 2:\r\n        return \"🦋 Have fun testing!\";\r\n      default:\r\n        return \"OpenCut Onboarding\";\r\n    }\r\n  };\r\n\r\n  const renderStepContent = () => {\r\n    switch (step) {\r\n      case 0:\r\n        return (\r\n          <div className=\"space-y-5\">\r\n            <div className=\"space-y-3\">\r\n              <Title title=\"Welcome to OpenCut Beta! 🎉\" />\r\n              <Description description=\"You're among the first to try OpenCut - the fully open source CapCut alternative.\" />\r\n            </div>\r\n            <NextButton onClick={handleNext}>Next</NextButton>\r\n          </div>\r\n        );\r\n      case 1:\r\n        return (\r\n          <div className=\"space-y-5\">\r\n            <div className=\"space-y-3\">\r\n              <Title title={getStepTitle()} />\r\n              <Description description=\"OpenCut started just one month ago. There's still a ton of things to do to make this editor amazing.\" />\r\n              <Description description=\"If you're curious, check out our roadmap [here](https://opencut.app/roadmap)\" />\r\n            </div>\r\n            <NextButton onClick={handleNext}>Next</NextButton>\r\n          </div>\r\n        );\r\n      case 2:\r\n        return (\r\n          <div className=\"space-y-5\">\r\n            <div className=\"space-y-3\">\r\n              <Title title={getStepTitle()} />\r\n              <Description description=\"Join our [Discord](https://discord.gg/zmR9N35cjK), chat with cool people and share feedback to help make OpenCut the best editor ever.\" />\r\n            </div>\r\n            <NextButton onClick={handleClose}>Finish</NextButton>\r\n          </div>\r\n        );\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-[425px] outline-hidden!\">\r\n        <DialogTitle>\r\n          <span className=\"sr-only\">{getStepTitle()}</span>\r\n        </DialogTitle>\r\n        {renderStepContent()}\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\nfunction Title({ title }: { title: string }) {\r\n  return <h2 className=\"text-lg md:text-xl font-bold\">{title}</h2>;\r\n}\r\n\r\nfunction Subtitle({ subtitle }: { subtitle: string }) {\r\n  return <h3 className=\"text-lg font-medium\">{subtitle}</h3>;\r\n}\r\n\r\nfunction Description({ description }: { description: string }) {\r\n  return (\r\n    <div className=\"text-muted-foreground\">\r\n      <ReactMarkdown\r\n        components={{\r\n          p: ({ children }) => <p className=\"mb-0\">{children}</p>,\r\n          a: ({ href, children }) => (\r\n            <a\r\n              href={href}\r\n              target=\"_blank\"\r\n              rel=\"noopener noreferrer\"\r\n              className=\"text-foreground hover:text-foreground/80 underline\"\r\n            >\r\n              {children}\r\n            </a>\r\n          ),\r\n        }}\r\n      >\r\n        {description}\r\n      </ReactMarkdown>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction NextButton({\r\n  children,\r\n  onClick,\r\n}: {\r\n  children: React.ReactNode;\r\n  onClick: () => void;\r\n}) {\r\n  return (\r\n    <Button onClick={onClick} variant=\"default\" className=\"w-full\">\r\n      {children}\r\n      <ArrowRightIcon className=\"w-4 h-4\" />\r\n    </Button>\r\n  );\r\n}\r\n","import { useEffect, useCallback } from \"react\";\r\nimport { usePlaybackStore } from \"@/stores/playback-store\";\r\nimport { useTimelineStore } from \"@/stores/timeline-store\";\r\nimport { toast } from \"sonner\";\r\n\r\nexport const usePlaybackControls = () => {\r\n  const { isPlaying, currentTime, play, pause, seek } = usePlaybackStore();\r\n\r\n  const {\r\n    selectedElements,\r\n    tracks,\r\n    splitElement,\r\n    splitAndKeepLeft,\r\n    splitAndKeepRight,\r\n    separateAudio,\r\n  } = useTimelineStore();\r\n\r\n  const handleSplitSelectedElement = useCallback(() => {\r\n    if (selectedElements.length !== 1) {\r\n      toast.error(\"Select exactly one element to split\");\r\n      return;\r\n    }\r\n\r\n    const { trackId, elementId } = selectedElements[0];\r\n    const track = tracks.find((t) => t.id === trackId);\r\n    const element = track?.elements.find((e) => e.id === elementId);\r\n\r\n    if (!element) return;\r\n\r\n    const effectiveStart = element.startTime;\r\n    const effectiveEnd =\r\n      element.startTime +\r\n      (element.duration - element.trimStart - element.trimEnd);\r\n\r\n    if (currentTime <= effectiveStart || currentTime >= effectiveEnd) {\r\n      toast.error(\"Playhead must be within selected element\");\r\n      return;\r\n    }\r\n\r\n    splitElement(trackId, elementId, currentTime);\r\n  }, [selectedElements, tracks, currentTime, splitElement]);\r\n\r\n  const handleSplitAndKeepLeftCallback = useCallback(() => {\r\n    if (selectedElements.length !== 1) {\r\n      toast.error(\"Select exactly one element\");\r\n      return;\r\n    }\r\n\r\n    const { trackId, elementId } = selectedElements[0];\r\n    const track = tracks.find((t) => t.id === trackId);\r\n    const element = track?.elements.find((e) => e.id === elementId);\r\n\r\n    if (!element) return;\r\n\r\n    const effectiveStart = element.startTime;\r\n    const effectiveEnd =\r\n      element.startTime +\r\n      (element.duration - element.trimStart - element.trimEnd);\r\n\r\n    if (currentTime <= effectiveStart || currentTime >= effectiveEnd) {\r\n      toast.error(\"Playhead must be within selected element\");\r\n      return;\r\n    }\r\n\r\n    splitAndKeepLeft(trackId, elementId, currentTime);\r\n  }, [selectedElements, tracks, currentTime, splitAndKeepLeft]);\r\n\r\n  const handleSplitAndKeepRightCallback = useCallback(() => {\r\n    if (selectedElements.length !== 1) {\r\n      toast.error(\"Select exactly one element\");\r\n      return;\r\n    }\r\n\r\n    const { trackId, elementId } = selectedElements[0];\r\n    const track = tracks.find((t) => t.id === trackId);\r\n    const element = track?.elements.find((e) => e.id === elementId);\r\n\r\n    if (!element) return;\r\n\r\n    const effectiveStart = element.startTime;\r\n    const effectiveEnd =\r\n      element.startTime +\r\n      (element.duration - element.trimStart - element.trimEnd);\r\n\r\n    if (currentTime <= effectiveStart || currentTime >= effectiveEnd) {\r\n      toast.error(\"Playhead must be within selected element\");\r\n      return;\r\n    }\r\n\r\n    splitAndKeepRight(trackId, elementId, currentTime);\r\n  }, [selectedElements, tracks, currentTime, splitAndKeepRight]);\r\n\r\n  const handleSeparateAudioCallback = useCallback(() => {\r\n    if (selectedElements.length !== 1) {\r\n      toast.error(\"Select exactly one media element to separate audio\");\r\n      return;\r\n    }\r\n\r\n    const { trackId, elementId } = selectedElements[0];\r\n    const track = tracks.find((t) => t.id === trackId);\r\n\r\n    if (!track || track.type !== \"media\") {\r\n      toast.error(\"Select a media element to separate audio\");\r\n      return;\r\n    }\r\n\r\n    separateAudio(trackId, elementId);\r\n  }, [selectedElements, tracks, separateAudio]);\r\n};\r\n"],"names":["VideoPlayer","src","poster","className","clipStartTime","trimStart","trimEnd","clipDuration","videoRef","useRef","isPlaying","currentTime","volume","speed","muted","usePlaybackStore","clipEndTime","isInClipRange","useEffect","video","current","handleSeekEvent","e","Math","videoTime","max","min","timelineTime","detail","time","handleUpdateEvent","targetTime","abs","handleSpeed","playbackRate","window","addEventListener","removeEventListener","play","catch","pause","ref","playsInline","preload","controls","disablePictureInPicture","disableRemotePlayback","style","pointerEvents","onContextMenu","preventDefault","AudioPlayer","trackMuted","audioRef","audio","audioTime","display","EditableTimecode","duration","format","fps","onTimeChange","disabled","isEditing","setIsEditing","useState","inputValue","setInputValue","hasError","setHasError","inputRef","enterPressedRef","formattedTime","formatTimeCode","applyEdit","parsedTime","parseTimeCode","clampedTime","focus","select","input","type","value","onChange","handleInputChange","target","onKeyDown","handleKeyDown","key","onBlur","handleBlur","cn","width","length","placeholder","span","onClick","startEditing","title","undefined","FONT_CLASS_MAP","Inter","inter","Roboto","roboto","openSans","playfairDisplay","comicNeue","Arial","Helvetica","Georgia","PreviewPanel","tracks","getTotalDuration","updateTextElement","useTimelineStore","mediaItems","useMediaStore","toggle","setCurrentTime","canvasSize","useEditorStore","previewRef","containerRef","previewDimensions","setPreviewDimensions","height","isExpanded","setIsExpanded","activeProject","useProjectStore","dragState","setDragState","isDragging","elementId","trackId","startX","startY","initialElementX","initialElementY","currentX","currentY","elementWidth","elementHeight","updatePreviewSize","availableWidth","availableHeight","innerWidth","marginSpace","innerHeight","controlsHeight","container","getBoundingClientRect","computedStyle","getComputedStyle","paddingTop","parseFloat","paddingBottom","paddingLeft","paddingRight","gap","toolbar","querySelector","toolbarHeight","targetRatio","containerRatio","resizeObserver","ResizeObserver","observe","disconnect","handleEscapeKey","event","document","body","overflow","handleMouseMove","deltaX","clientX","deltaY","clientY","scaleRatio","newX","newY","halfWidth","halfHeight","constrainedX","constrainedY","prev","handleMouseUp","x","y","cursor","userSelect","toggleExpanded","useCallback","hasAnyElements","some","track","elements","activeElements","getActiveElements","forEach","element","hidden","elementStart","startTime","elementEnd","mediaItem","mediaId","find","item","id","push","blurBackgroundElements","filter","getBlurBackgroundElements","renderBlurBackground","backgroundType","blurIntensity","div","transform","transformOrigin","url","thumbnailUrl","img","alt","name","draggable","renderElement","elementData","index","fontClassName","fontFamily","onMouseDown","handleTextMouseDown","stopPropagation","rect","currentTarget","left","top","rotation","opacity","zIndex","fontSize","color","backgroundColor","textAlign","fontWeight","fontStyle","textDecoration","padding","borderRadius","whiteSpace","content","p","background","map","PreviewToolbar","onToggleExpanded","FullscreenPreview","FullscreenToolbar","seek","setIsDragging","totalDuration","progress","data-toolbar","Button","variant","size","skipBackward","SkipBack","Pause","Play","skipForward","SkipForward","handleTimelineClick","newTime","clickX","handleTimelineDrag","moveEvent","dragX","nativeEvent","Expand","timeInSeconds","hours","floor","minutes","seconds","centiseconds","frames","toString","padStart","timeCode","cleanTimeCode","trim","parts","split","parseInt","part","isNaN","AudioWaveform","audioUrl","waveformRef","wavesurfer","isLoading","setIsLoading","error","setError","mounted","ws","initWaveSurfer","newWaveSurfer","WaveSurfer","create","waveColor","progressColor","cursorColor","barWidth","barGap","normalize","interact","destroy","on","load","err","requestAnimationFrame","wsToDestroy","TimelineElement","zoomLevel","isSelected","onElementMouseDown","onElementClick","updateElementTrim","updateElementDuration","removeElementFromTrack","removeElementFromTrackWithRipple","splitElement","addElementToTrack","replaceElementMedia","rippleEditingEnabled","toggleElementHidden","isAudio","resizing","handleResizeStart","handleResizeMove","handleResizeEnd","useTimelineElementResize","onUpdateTrim","onUpdateDuration","setResizing","updateElementStartTime","pushHistory","handleDocumentMouseMove","updateTrimFromMouseMove","handleDocumentMouseUp","canExtendElementDuration","projectStore","deltaTime","projectFps","getState","side","maxAllowed","initialTrimEnd","calculated","initialTrimStart","newTrimStart","snapTimeToFrame","trimDelta","newStartTime","actualExtension","extensionAmount","maxExtension","newDuration","extensionNeeded","newTrimEnd","currentEndTime","snappedEndTime","desiredEndTime","finalTrimEnd","isResizing","effectiveDuration","TIMELINE_CONSTANTS","ELEMENT_MIN_WIDTH","PIXELS_PER_SECOND","isBeingDragged","elementLeft","elementStartTime","ContextMenu","ContextMenuTrigger","asChild","data-element-id","data-track-id","onMouseMove","onMouseUp","onMouseLeave","getTrackElementClasses","handleElementMouseDown","renderElementContent","trackHeight","getTrackHeight","tileWidth","imageUrl","TILE_ASPECT_RATIO","isImage","backgroundImage","backgroundRepeat","backgroundSize","tileHeight","backgroundPosition","aria-label","VolumeX","EyeOff","ContextMenuContent","ContextMenuItem","handleElementSplitContext","effectiveStart","effectiveEnd","secondElementId","toast","Scissors","handleToggleElementHidden","Volume2","Eye","handleElementDuplicateContext","elementWithoutId","Copy","handleReplaceClip","createElement","accept","onchange","file","files","result","success","Error","message","click","RefreshCw","ContextMenuSeparator","handleElementDeleteContext","Trash2","TimelineTrackContent","onSnapPointChange","addTrack","moveElementToTrack","updateElementStartTimeWithRipple","selectedElements","selectElement","startDrag","startDragAction","updateDragTime","endDrag","endDragAction","clearSelectedElements","insertTrackAt","snappingEnabled","snapElementPosition","snapElementEdge","useTimelineSnapping","snapThreshold","enableElementSnapping","enablePlayheadSnapping","findSnapPoints","playheadTime","excludeElementId","snapPoints","snapToNearestPoint","thresholdInSeconds","pixelsPerSecond","closestSnapPoint","closestDistance","Infinity","distance","snapPoint","snappedTime","snapDistance","elementDuration","snapToStart","snapResult","effectiveTargetTime","getDropSnappedTime","dropTime","finalTime","startSnapResult","endSnapResult","bestSnapResult","timelineRef","isDropping","setIsDropping","dropPosition","setDropPosition","wouldOverlap","setWouldOverlap","dragCounterRef","mouseDownLocation","setMouseDownLocation","c","timelineRect","adjustedTime","mouseTime","mouseX","clickOffsetTime","sourceTrack","t","isTrackThatStartedDrag","isMouseOverThisTrack","bottom","movingElement","movingElementEnd","movingElementDuration","targetTrack","existingElement","existingStart","existingEnd","isRightClick","button","isMultiSelect","metaKey","ctrlKey","shiftKey","elementRect","clickOffsetX","handleElementClick","closest","onDragOver","handleTrackDragOver","hasTimelineElement","dataTransfer","types","includes","hasMediaItem","trackContainer","mediaItemData","getData","dragData","JSON","parse","newElementEnd","newElementDuration","timelineElementData","fromTrackId","dropEffect","onDragEnter","handleTrackDragEnter","onDragLeave","handleTrackDragLeave","onDrop","handleTrackDrop","mouseY","currentTrackIndex","findIndex","adjustedStartTime","snappedStartTime","finalStartTime","hasOverlap","targetTrackId","insertIndex","mainTrack","getMainTrack","newTargetTrack","updatedTracks","textSnappedTime","DEFAULT_TEXT_DURATION","isVideoOrImage","isCompatible","canElementGoOnTrack","mediaSnappedTime","useTimelinePlayhead","rulerRef","rulerScrollRef","tracksScrollRef","playheadRef","isScrubbing","setIsScrubbing","scrubTime","setScrubTime","isDraggingRuler","setIsDraggingRuler","hasDraggedRuler","setHasDraggedRuler","autoScrollRef","lastMouseXRef","playheadPosition","handlePlayheadMouseDown","handleScrub","handleRulerMouseDown","contains","ruler","rawX","rawTime","performAutoScroll","rulerViewport","tracksViewport","viewportRect","mouseXRelative","viewportWidth","clientWidth","scrollMax","scrollSpeed","scrollLeft","edgeThreshold","maxScrollSpeed","intensity","newScrollLeft","cancelAnimationFrame","playheadPx","scrollWidth","desiredScroll","scrollMin","TimelinePlayhead","trackLabelsRef","externalPlayheadRef","isSnappingToPlayhead","internalPlayheadRef","setScrollLeft","handleScroll","timelineContainerHeight","offsetHeight","trackLabelsWidth","offsetWidth","rawLeftPosition","timelinePosition","timelineContentWidth","rightBoundary","leftPosition","leftBoundary","SelectionBox","startPos","currentPos","isActive","selectionBoxRef","containerRect","SnapIndicator","isVisible","totalHeight","Timeline","setSelectedElements","toggleTrackMute","addMediaItem","setDuration","isDragOver","setIsDragOver","isProcessing","setIsProcessing","setProgress","isInTimeline","setIsInTimeline","mouseTrackingRef","isMouseDown","downX","downY","downTime","setZoomLevel","handleWheel","useTimelineZoom","delta","preventZoom","passive","dynamicTimelineWidth","trackLabelsScrollRef","isUpdatingRef","lastRulerSync","lastTracksSync","lastVerticalSync","useTimelinePlayheadRuler","tracksContainerRef","selectionBox","handleMouseDown","handleSelectionMouseDown","isSelecting","justFinishedSelecting","useSelectionBox","onSelectionComplete","isEnabled","setSelectionBox","setJustFinishedSelecting","selectElementsInBox","endPos","timelineElements","querySelectorAll","elementAbsolute","right","selectionAbsolute","normalizedSelection","getAttribute","intersects","newSelectionBox","setTimeout","currentSnapPoint","setCurrentSnapPoint","showSnapIndicator","handleSnapPointChange","handleTimelineMouseDown","isTimelineBackground","timeStamp","handleTimelineContentClick","isRulerClick","rulerContent","tracksContent","handleDrop","itemData","addTextToNewTrack","addMediaToNewTrack","processedItem","processMediaFiles","addedItem","trackLabelsViewport","handleRulerScroll","now","Date","handleTracksScroll","handleTrackLabelsScroll","scrollTop","handleTracksVerticalScroll","handleDragEnter","handleDragOver","handleDragLeave","onMouseEnter","dragProps","TimelineToolbar","onWheel","data-ruler-area","ScrollArea","interval","getTimeInterval","zoom","Array","from","markerCount","ceil","_","i","isMainMarker","secs","toFixed","Boolean","bookmarks","bookmarkTime","Bookmark","data-track-labels","MicOff","Mic","TrackIcon","getTotalTracksHeight","getCumulativeHeightBefore","Video","TypeIcon","Music","splitAndKeepLeft","splitAndKeepRight","separateAudio","toggleSnapping","toggleRippleEditing","toggleBookmark","isBookmarked","handleToggleBookmark","currentBookmarked","TooltipProvider","delayDuration","Tooltip","TooltipTrigger","TooltipContent","minWidth","handleSplitSelected","splitCount","handleSplitAndKeepLeft","ArrowLeftToLine","handleSplitAndKeepRight","ArrowRightToLine","handleSeparateAudio","SplitSquareHorizontal","handleDuplicateSelected","el","handleFreezeSelected","info","Snowflake","handleDeleteSelected","Magnet","Link","handleZoomOut","ZoomOut","Slider","onValueChange","values","handleZoomSliderChange","step","handleZoomIn","ZoomIn","ActionEmitter","subscribe","listener","listeners","l","emit","actions","actionEmitter","boundActions","updateActiveActions","newActions","Object","keys","bindAction","action","handler","unbindAction","useActionHandler","handlerRef","isBound","setIsBound","stableHandler","args","trigger","shouldBind","setInterval","clearInterval","EditorProvider","children","isInitializing","isPanelsReady","initializeApp","disableKeybindings","enableKeybindings","useKeybindingDisabler","useKeybindingsStore","undo","redo","flatMap","allElements","keybindings","getKeybindingString","keybindingsEnabled","isRecording","actionArgs","binding","ev","boundAction","activeElement","isTextInput","tagName","isContentEditable","Loader2","DEFAULT_PANEL_SIZES","toolsPanel","previewPanel","propertiesPanel","mainContent","timeline","usePanelStore","persist","mediaViewMode","setToolsPanel","set","setPreviewPanel","setPropertiesPanel","setMainContent","setTimeline","setMediaViewMode","mode","defaultKeybindings","space","j","k","home","end","s","n","delete","backspace","get","isCustomized","updateKeybinding","newKeybindings","state","removeKeybinding","resetToDefaults","importKeybindings","entries","config","exportKeybindings","validateKeybinding","existingAction","newAction","setIsRecording","getKeybindingsForAction","generateKeybindingString","modifierKey","getActiveModifier","modifierKeys","ctrl","isAppleDevice","altKey","shift","activeModifier","join","getPressedKey","toLowerCase","code","startsWith","slice","letter","digit","isDOMElement","isTypableElement","version","React","props","SliderPrimitive","displayName","HeaderBase","leftContent","centerContent","rightContent","header","actionDescriptions","description","category","ShortcutItem","shortcut","onStartRecording","displayKeys","replace","icon","keyPart","partIndex","keyId","EditableShortcutKey","handleClick","KeyboardShortcutsHelp","open","setOpen","recordingShortcut","setRecordingShortcut","shortcuts","useKeyboardShortcutsHelp","useMemo","actionToKeys","getPlatformSpecialKey","getPlatformAlternateKey","actionInfo","sort","a","b","localeCompare","categories","Set","keyString","conflict","handleClickOutside","handleStartRecording","Dialog","onOpenChange","DialogTrigger","Keyboard","DialogContent","DialogHeader","DialogTitle","DialogDescription","h3","DialogFooter","EditorHeader","renameProject","deleteProject","isDeleteDialogOpen","setIsDeleteDialogOpen","isRenameDialogOpen","setIsRenameDialogOpen","useRouter","theme","setTheme","useTheme","handleNameSave","newName","DropdownMenu","DropdownMenuTrigger","ChevronDown","DropdownMenuContent","align","DropdownMenuItem","navigateToProjects","ArrowLeft","SquarePen","Trash","DropdownMenuSeparator","href","rel","FaDiscord","RenameProjectDialog","isOpen","onConfirm","projectName","DeleteProjectDialog","handleDelete","nav","handleExport","Download","Sun","AudioProperties","MediaProperties","Textarea","textarea","FONT_OPTIONS","label","hasClassName","weights","FontPicker","defaultValue","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","font","TextProperties","fontSizeInput","setFontSizeInput","opacityInput","setOpacityInput","round","parseAndValidateNumber","fallback","parsed","PropertyItem","direction","PropertyItemLabel","PropertyItemValue","Input","handleFontSizeChange","handleFontSizeBlur","handleOpacityChange","opacityPercent","handleOpacityBlur","PropertiesPanel","EmptyView","SquareSlashIcon","strokeWidth","PropertyGroup","defaultExpanded","ffmpeg","initFFmpeg","FFmpeg","baseURL","basePath","coreURL","toBlobURL","wasmURL","videoFile","inputName","outputName","writeFile","Uint8Array","arrayBuffer","exec","blob","Blob","readFile","deleteFile","URL","createObjectURL","getVideoInfo","ffmpegOutput","listening","data","durationMatch","match","h","m","videoStreamMatch","onProgress","fileArray","processedItems","total","completed","fileType","getFileType","dimensions","getImageDimensions","videoInfo","generateThumbnail","videoResult","generateVideoThumbnail","getMediaDuration","Promise","resolve","percent","revokeObjectURL","TooltipPrimitive","sideOffset","Separator","orientation","decorative","SeparatorPrimitive","ResizablePanelGroup","ResizablePrimitive","ResizablePanel","ResizableHandle","withHandle","playbackTimer","previousVolume","startTimer","updateTime","store","performance","lastUpdate","actualContentDuration","stopTime","frameOffset","dispatchEvent","CustomEvent","setVolume","setSpeed","newSpeed","mute","unmute","toggleMute","tabs","media","VideoIcon","sounds","MusicIcon","text","stickers","StickerIcon","effects","SparklesIcon","transitions","ArrowLeftRightIcon","captions","CaptionsIcon","filters","BlendIcon","adjustment","SlidersHorizontalIcon","settings","SettingsIcon","activeTab","setActiveTab","tab","TabBar","useMediaPanelStore","scrollContainerRef","isAtEnd","setIsAtEnd","isAtStart","setIsAtStart","checkScrollPosition","isAtEndNow","isAtStartNow","ScrollButton","scrollToStart","scrollTo","tabKey","scrollToEnd","Icon","ChevronLeft","ChevronRight","containsFiles","MediaDragOverlay","isEmptyState","Upload","AspectRatio","AspectRatioPrimitive","DraggableMediaItem","preview","onDragStart","onAddToTimeline","aspectRatio","showPlusOnDrag","showLabel","rounded","dragPosition","setDragPosition","dragRef","handleAddToTimeline","emptyImg","Image","handleDragStart","setDragImage","setData","stringify","effectAllowed","handleDragEnd","ratio","onDragEnd","PlusButton","createPortal","tooltipText","Plus","MediaItemWithContextMenu","onRemove","MediaView","removeMediaItem","fileInputRef","searchQuery","setSearchQuery","mediaFilter","setMediaFilter","sortBy","setSortBy","sortOrder","setSortOrder","processFiles","useDragDrop","options","handleFileSelect","handleRemove","formatDuration","sec","filteredMediaItems","setFilteredMediaItems","filtered","valueA","valueB","previewComponents","previews","Map","loading","renderPreview","multiple","handleFileChange","CloudUpload","List","Grid2X2","ArrowDown01","GridView","ListView","gridTemplateColumns","addMediaAtTime","textData","TextView","addTextAtTime","Tabs","TabsPrimitive","TabsList","TabsTrigger","TabsContent","useSoundsStore","hasLoaded","showCommercialOnly","toggleCommercialFilter","searchResults","isSearching","searchError","lastSearchQuery","scrollPosition","currentPage","hasNextPage","totalCount","isLoadingMore","savedSounds","isSavedSoundsLoaded","isLoadingSavedSounds","savedSoundsError","setTopSoundEffects","topSoundEffects","setLoading","setHasLoaded","loaded","query","setSearchResults","results","setSearching","searching","setSearchError","setLastSearchQuery","setScrollPosition","position","setCurrentPage","page","setHasNextPage","hasNext","setTotalCount","count","setLoadingMore","appendSearchResults","appendTopSounds","resetPagination","loadSavedSounds","savedSoundsData","storageService","errorMessage","saveSoundEffect","soundEffect","removeSavedSound","soundId","sound","isSoundSaved","toggleSavedSound","clearSavedSounds","addSoundToTimeline","previewUrl","response","fetch","ok","statusText","File","SoundsView","SoundEffectsView","SavedSoundsView","SongsView","loadMore","useSoundSearch","commercialOnly","nextPage","searchParams","URLSearchParams","json","next","status","ignore","timeoutId","encodeURIComponent","clearTimeout","playingId","setPlayingId","audioElement","setAudioElement","scrollAreaRef","displayedSounds","containerClassName","showClearIcon","onClear","ListFilter","DropdownMenuCheckboxItem","checked","onCheckedChange","onScrollCapture","scrollHeight","clientHeight","nearBottom","AudioItem","onPlay","playSound","Audio","isSaved","onToggleSaved","showClearDialog","setShowClearDialog","convertToSoundEffect","savedSound","downloadUrl","filesize","channels","bitrate","bitdepth","samplerate","username","tags","license","created","savedAt","downloads","rating","ratingCount","HeartIcon","PauseIcon","PlayIcon","PlusIcon","handleSaveClick","colors","syntaxUIGradients","SettingsView","ProjectSettingsTabs","ProjectInfoView","BackgroundView","updateProjectFps","canvasPresets","setCanvasSize","getDisplayName","useAspectRatio","canvasMode","currentPreset","preset","getCurrentAspectRatio","formatAspectRatio","ratios","isOriginal","getOriginalAspectRatio","getMediaAspectRatio","handleAspectRatioChange","handleFpsChange","FPS_PRESETS","BlurPreview","memo","blur","onSelect","fill","BackgroundPreviews","backgrounds","currentBackgroundColor","isColorBackground","handleColorSelect","useBackgroundColor","bg","updateBackgroundType","blurLevels","handleBlurSelect","currentBlurIntensity","isBlurBackground","blurPreviews","PipetteIcon","patternCraftGradients","MediaPanel","viewMap","ContextMenuPrimitive","contextMenuItemVariants","cva","variants","default","destructive","defaultVariants","ContextMenuSubTrigger","inset","Check","Circle","ContextMenuLabel","Onboarding","setStep","setIsOpen","localStorage","hasSeenOnboarding","getItem","handleNext","handleClose","setItem","getStepTitle","renderStepContent","Title","Description","NextButton","h2","ReactMarkdown","components","ArrowRightIcon","usePlaybackControls"],"sourceRoot":"","ignoreList":[]}